/*! Sdm Main V2 - v0.1.0 - * Copyright (c) 2022 Trapeze; */function X2JS(a){"use strict";function b(){void 0===a.escapeMode&&(a.escapeMode=!0),void 0===a.attributePrefix&&(a.attributePrefix="_"),void 0===a.arrayAccessForm&&(a.arrayAccessForm="none"),void 0===a.emptyNodeForm&&(a.emptyNodeForm="text")}function c(a){var b=a.localName;return null==b&&(b=a.baseName),null!=b&&""!=b||(b=a.nodeName),b}function d(a){return a.prefix}function e(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function f(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function g(b,c){switch(a.arrayAccessForm){case"property":b[c]instanceof Array?b[c+"_asArray"]=b[c]:b[c+"_asArray"]=[b[c]]}}function h(b){if(b.nodeType==t.DOCUMENT_NODE){var e=new Object,i=b.firstChild;i.nodeType==t.PROCESSING_INSTRUCTION_NODE&&(i=i.nextSibling);var j=c(i);return e[j]=h(i),e}if(b.nodeType==t.ELEMENT_NODE){var e=new Object;e.__cnt=0;for(var k=b.childNodes,l=0;l<k.length;l++){var i=k.item(l),j=c(i);if(e.__cnt++,null==e[j])e[j]=h(i),g(e,j);else{null!=e[j]&&(e[j]instanceof Array||(e[j]=[e[j]],g(e,j)));for(var m=0;null!=e[j][m];)m++;e[j][m]=h(i)}}for(var n=0;n<b.attributes.length;n++){var o=b.attributes.item(n);e.__cnt++,e[a.attributePrefix+o.name]=o.value}var p=d(b);return null!=p&&""!=p&&(e.__cnt++,e.__prefix=p),null!=e["#text"]&&(e.__text=e["#text"],e.__text instanceof Array&&(e.__text=e.__text.join("\n")),a.escapeMode&&(e.__text=f(e.__text)),delete e["#text"],"property"==a.arrayAccessForm&&delete e["#text_asArray"]),null!=e["#cdata-section"]&&(e.__cdata=e["#cdata-section"],delete e["#cdata-section"],"property"==a.arrayAccessForm&&delete e["#cdata-section_asArray"]),1==e.__cnt&&null!=e.__text?e=e.__text:0==e.__cnt&&"text"==a.emptyNodeForm&&(e=""),delete e.__cnt,null==e.__text&&null==e.__cdata||(e.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),e}if(b.nodeType==t.TEXT_NODE||b.nodeType==t.CDATA_SECTION_NODE)return b.nodeValue}function i(b,c,d,e){var f="<"+(null!=b&&null!=b.__prefix?b.__prefix+":":"")+c;if(null!=d)for(var g=0;g<d.length;g++){var h=d[g],i=b[h];f+=" "+h.substr(a.attributePrefix.length)+"='"+i+"'"}return f+=e?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(b,c){return!!("property"==a.arrayAccessForm&&k(c.toString(),"_asArray")||0==c.toString().indexOf(a.attributePrefix)||0==c.toString().indexOf("__")||b[c]instanceof Function)}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(b){var c=[];if(b instanceof Object)for(var d in b)-1==d.toString().indexOf("__")&&0==d.toString().indexOf(a.attributePrefix)&&c.push(d);return c}function o(b){var c="";return null!=b.__cdata&&(c+="<![CDATA["+b.__cdata+"]]>"),null!=b.__text&&(a.escapeMode?c+=e(b.__text):c+=b.__text),c}function p(b){var c="";return b instanceof Object?c+=o(b):null!=b&&(a.escapeMode?c+=e(b):c+=b),c}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="";if(m(a)>0)for(var c in a)if(!l(a,c)){var d=a[c],e=n(d);if(null==d||void 0==d)b+=i(d,c,e,!0);else if(d instanceof Object)if(d instanceof Array)b+=q(d,c,e);else{var f=m(d);f>0||null!=d.__text||null!=d.__cdata?(b+=i(d,c,e,!1),b+=r(d),b+=j(d,c)):b+=i(d,c,e,!0)}else b+=i(d,c,e,!1),b+=p(d),b+=j(d,c)}return b+=p(a)}var s="1.1.2";a=a||{},b();var t={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,DOCUMENT_NODE:9,PROCESSING_INSTRUCTION_NODE:7};this.parseXmlString=function(a){if(void 0===a)return null;var b;if(window.DOMParser){b=(new window.DOMParser).parseFromString(a,"text/xml")}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.asArray=function(a){return a instanceof Array?a:[a]},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s}}window.Modernizr=function(a,b,c){function d(a){t.cssText=a}function e(a,b){return d(x.join(a+";")+(b||""))}function f(a,b){return typeof a===b}function g(a,b){return!!~(""+a).indexOf(b)}function h(a,b){for(var d in a){var e=a[d];if(!g(e,"-")&&t[e]!==c)return"pfx"!=b||e}return!1}function i(a,b,d){for(var e in a){var g=b[a[e]];if(g!==c)return!1===d?a[e]:f(g,"function")?g.bind(d||b):g}return!1}function j(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+z.join(d+" ")+d).split(" ");return f(b,"string")||f(b,"undefined")?h(e,b):(e=(a+" "+A.join(d+" ")+d).split(" "),i(e,b,c))}function k(){o.input=function(c){for(var d=0,e=c.length;d<e;d++)E[c[d]]=!!(c[d]in u);return E.list&&(E.list=!(!b.createElement("datalist")||!a.HTMLDataListElement)),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),o.inputtypes=function(a){for(var d,e,f,g=0,h=a.length;g<h;g++)u.setAttribute("type",e=a[g]),d="text"!==u.type,d&&(u.value=v,u.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(e)&&u.style.WebkitAppearance!==c?(q.appendChild(u),f=b.defaultView,d=f.getComputedStyle&&"textfield"!==f.getComputedStyle(u,null).WebkitAppearance&&0!==u.offsetHeight,q.removeChild(u)):/^(search|tel)$/.test(e)||(d=/^(url|email)$/.test(e)?u.checkValidity&&!1===u.checkValidity():u.value!=v)),D[a[g]]=!!d;return D}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var l,m,n="2.6.2",o={},p=!0,q=b.documentElement,r="modernizr",s=b.createElement(r),t=s.style,u=b.createElement("input"),v=":)",w={}.toString,x=" -webkit- -moz- -o- -ms- ".split(" "),y="Webkit Moz O ms",z=y.split(" "),A=y.toLowerCase().split(" "),B={svg:"http://www.w3.org/2000/svg"},C={},D={},E={},F=[],G=F.slice,H=function(a,c,d,e){var f,g,h,i,j=b.createElement("div"),k=b.body,l=k||b.createElement("body");if(parseInt(d,10))for(;d--;)h=b.createElement("div"),h.id=e?e[d]:r+(d+1),j.appendChild(h);return f=["&#173;",'<style id="s',r,'">',a,"</style>"].join(""),j.id=r,(k?j:l).innerHTML+=f,l.appendChild(j),k||(l.style.background="",l.style.overflow="hidden",i=q.style.overflow,q.style.overflow="hidden",q.appendChild(l)),g=c(j,a),k?j.parentNode.removeChild(j):(l.parentNode.removeChild(l),q.style.overflow=i),!!g},I=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b).matches;var d;return H("@media "+b+" { #"+r+" { position: absolute; } }",function(b){d="absolute"==(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle).position}),d},J=function(){function a(a,e){e=e||b.createElement(d[a]||"div"),a="on"+a;var g=a in e;return g||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(a,""),g=f(e[a],"function"),f(e[a],"undefined")||(e[a]=c),e.removeAttribute(a))),e=null,g}var d={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return a}(),K={}.hasOwnProperty;m=f(K,"undefined")||f(K.call,"undefined")?function(a,b){return b in a&&f(a.constructor.prototype[b],"undefined")}:function(a,b){return K.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=G.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(G.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(G.call(arguments)))};return d}),C.flexbox=function(){return j("flexWrap")},C.flexboxlegacy=function(){return j("boxDirection")},C.canvas=function(){var a=b.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))},C.canvastext=function(){return!(!o.canvas||!f(b.createElement("canvas").getContext("2d").fillText,"function"))},C.webgl=function(){return!!a.WebGLRenderingContext},C.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:H(["@media (",x.join("touch-enabled),("),r,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=9===a.offsetTop}),c},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!a.postMessage},C.websqldatabase=function(){return!!a.openDatabase},C.indexedDB=function(){return!!j("indexedDB",a)},C.hashchange=function(){return J("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},C.history=function(){return!(!a.history||!history.pushState)},C.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},C.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},C.rgba=function(){return d("background-color:rgba(150,255,150,.5)"),g(t.backgroundColor,"rgba")},C.hsla=function(){return d("background-color:hsla(120,40%,100%,.5)"),g(t.backgroundColor,"rgba")||g(t.backgroundColor,"hsla")},C.multiplebgs=function(){return d("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(t.background)},C.backgroundsize=function(){return j("backgroundSize")},C.borderimage=function(){return j("borderImage")},C.borderradius=function(){return j("borderRadius")},C.boxshadow=function(){return j("boxShadow")},C.textshadow=function(){return""===b.createElement("div").style.textShadow},C.opacity=function(){return e("opacity:.55"),/^0.55$/.test(t.opacity)},C.cssanimations=function(){return j("animationName")},C.csscolumns=function(){return j("columnCount")},C.cssgradients=function(){var a="background-image:";return d((a+"-webkit- ".split(" ").join("gradient(linear,left top,right bottom,from(#9f9),to(white));"+a)+x.join("linear-gradient(left top,#9f9, white);"+a)).slice(0,-a.length)),g(t.backgroundImage,"gradient")},C.cssreflections=function(){return j("boxReflect")},C.csstransforms=function(){return!!j("transform")},C.csstransforms3d=function(){var a=!!j("perspective");return a&&"webkitPerspective"in q.style&&H("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=9===b.offsetLeft&&3===b.offsetHeight}),a},C.csstransitions=function(){return j("transition")},C.fontface=function(){var a;return H('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&0===g.indexOf(d.split(" ")[0])}),a},C.generatedcontent=function(){var a;return H(["#",r,"{font:0/0 a}#",r,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},C.video=function(){var a=b.createElement("video"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(a){}return c},C.audio=function(){var a=b.createElement("audio"),c=!1;try{(c=!!a.canPlayType)&&(c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(a){}return c},C.localstorage=function(){try{return localStorage.setItem(r,r),localStorage.removeItem(r),!0}catch(a){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(r,r),sessionStorage.removeItem(r),!0}catch(a){return!1}},C.webworkers=function(){return!!a.Worker},C.applicationcache=function(){return!!a.applicationCache},C.svg=function(){return!!b.createElementNS&&!!b.createElementNS(B.svg,"svg").createSVGRect},C.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==B.svg},C.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(w.call(b.createElementNS(B.svg,"animate")))},C.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(w.call(b.createElementNS(B.svg,"clipPath")))};for(var L in C)m(C,L)&&(l=L.toLowerCase(),o[l]=C[L](),F.push((o[l]?"":"no-")+l));return o.input||k(),o.addTest=function(a,b){if("object"==typeof a)for(var d in a)m(a,d)&&o.addTest(d,a[d]);else{if(a=a.toLowerCase(),o[a]!==c)return o;b="function"==typeof b?b():b,void 0!==p&&p&&(q.className+=" "+(b?"":"no-")+a),o[a]=b}return o},d(""),s=u=null,function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=r.elements;return"string"==typeof a?a.split(" "):a}function e(a){var b=q[a[o]];return b||(b={},p++,a[o]=p,q[p]=b),b}function f(a,c,d){if(c||(c=b),k)return c.createElement(a);d||(d=e(c));var f;return f=d.cache[a]?d.cache[a].cloneNode():n.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),f.canHaveChildren&&!m.test(a)?d.frag.appendChild(f):f}function g(a,c){if(a||(a=b),k)return a.createDocumentFragment();c=c||e(a);for(var f=c.frag.cloneNode(),g=0,h=d(),i=h.length;g<i;g++)f.createElement(h[g]);return f}function h(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?f(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function i(a){a||(a=b);var d=e(a);return!r.shivCSS||j||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),k||h(a,d),a}var j,k,l=a.html5||{},m=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,n=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,o="_html5shiv",p=0,q={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",j="hidden"in a,k=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return void 0===a.cloneNode||void 0===a.createDocumentFragment||void 0===a.createElement}()}catch(a){j=!0,k=!0}}();var r={elements:l.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:!1!==l.shivCSS,supportsUnknownElements:k,shivMethods:!1!==l.shivMethods,type:"default",shivDocument:i,createElement:f,createDocumentFragment:g};a.html5=r,i(b)}(this,b),o._version=n,o._prefixes=x,o._domPrefixes=A,o._cssomPrefixes=z,o.mq=I,o.hasEvent=J,o.testProp=function(a){return h([a])},o.testAllProps=j,o.testStyles=H,o.prefixed=function(a,b,c){return b?j(a,b,c):j(a,"pfx")},q.className=q.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+F.join(" "):""),o}(this,this.document),function(a){var b=document.createElement("input"),c="oninput"in b&&(!("documentMode"in document)||document.documentMode>9),d=function(a){return"INPUT"===a.nodeName&&("text"===a.type||"password"===a.type)},e=null,f=null,g=null,h={get:function(){return g.get.call(this)},set:function(a){f=a,g.set.call(this,a)}},i=function(a){e=a,f=a.value,g=Object.getOwnPropertyDescriptor(a.constructor.prototype,"value"),Object.defineProperty(e,"value",h),e.attachEvent("onpropertychange",k)},j=function(){e&&(delete e.value,e.detachEvent("onpropertychange",k),e=null,f=null,g=null)},k=function(b){if("value"===b.propertyName){var c=b.srcElement.value;c!==f&&(f=c,a(e).trigger("textchange"))}};c?a(document).on("input",function(b){"TEXTAREA"!==b.target.nodeName&&a(b.target).trigger("textchange")}):a(document).on("focusin",function(a){d(a.target)&&(j(),i(a.target))}).on("focusout",function(){j()}).on("selectionchange keyup keydown",function(){e&&e.value!==f&&(f=e.value,a(e).trigger("textchange"))})}(jQuery),function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&f<g;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&f<e;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&f<h;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)(f=F[c])in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(d<2||null==c)return c;for(var e=1;e<d;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;i<h;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&b<=y};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;d<e;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;d<e;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;g<e;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;if(void 0!==(d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c))&&-1!==d)return a[d]},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;f<e;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;h<i;h++)(d=a[h])>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){((e=b(a,c,d))>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;h<i;h++)(d=a[h])<f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){((e=b(a,c,d))<g||e===1/0&&f===1/0)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;f<d;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(c<d||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){if(null!=a)return null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){if(null!=a)return null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);g<h;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;j<k;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);g<h;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);d<e;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;g<c&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;d<b;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);d<e;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);f<g;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;f<d;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;g<e;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(d<=1)throw new Error("bindAll must be passed function names");for(b=1;b<d;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=!1===c.leading?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||!1!==c.leading||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||!1===c.trailing||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;j<b&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),a<=1&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;h<f;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;e<c;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;d<e;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;f<g;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;h<i;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;f<d;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!=+a?+b!=+b:0==+a?1/+a==1/b:+a==+b;case"[object Date]":case"[object Boolean]":return+a==+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if((i=a.length)!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a||(A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length)},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;e<a;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(a){throw a.source=f,a}var h=function(a){return g.call(this,a,s)},i=b.variable||"obj";return h.source="function("+i+"){\n"+f+"}",h},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),
"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}.call(this),function(){var a,b=this,c=b.Backbone,d=[],e=d.push,f=d.slice,g=d.splice;a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.0.0";var h=b._;h||"undefined"==typeof require||(h=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var i=a.Events={on:function(a,b,c){return k(this,"on",a,[b,c])&&b?(this._events||(this._events={}),(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,ctx:c||this}),this):this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:h.keys(this._events),i=0,j=g.length;i<j;i++)if(a=g[i],f=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=f.length;l<m;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=f.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){for(var f=c.split(j),g=0,h=f.length;g<h;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){return(this._listeners||(this._listeners={}))[b._listenerId||(b._listenerId=h.uniqueId("l"))]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(a,i);var n=a.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{}),(c=h.result(this,"defaults"))&&(d=h.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return h.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;m<n;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return!!this.hasChanged()&&h.clone(this.changed);var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)h.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){if(!b.set(b.parse(d,a),a))return!1;c&&c(b,d,a),b.trigger("sync",b,d,a)},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,d&&(!c||!c.wait)&&!this.set(d,c))return!1;if(c=h.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);if(c.wait&&(b=h.extend(d||{},b)),h.isObject(b)&&!i.set(b,c))return!1;j&&j(i,a,c),i.trigger("sync",i,a,c)},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return!c||(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1)}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=a.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;c<d;c++)(f=this.get(a[c]))&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,d,f,i,j,k=b.at,l=this.comparator&&null==k&&!1!==b.sort,m=h.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;c<d;c++)(f=this._prepareModel(a[c],b))&&((i=this.get(f))?(b.remove&&(p[i.cid]=!0),b.merge&&(i.set(f.attributes,b),l&&!j&&i.hasChanged(m)&&(j=!0))):b.add&&(n.push(f),f.on("all",this._onModelEvent,this),this._byId[f.cid]=f,null!=f.id&&(this._byId[f.id]=f)));if(b.remove){for(c=0,d=this.length;c<d;++c)p[(f=this.models[c]).cid]||o.push(f);o.length&&this.remove(o,b)}if(n.length&&(l&&(j=!0),this.length+=n.length,null!=k?g.apply(this.models,[k,0].concat(n)):e.apply(this.models,n)),j&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;c<d;c++)(f=n[c]).trigger("add",f,this,b);return j&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(null!=a)return this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?h.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=f.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=a.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],!1!==c&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(h.isFunction(c)||(c=this[a[b]]),c){var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(h.result(this,"el"),!1);else{var b=h.extend({},h.result(this,"attributes"));this.id&&(b.id=h.result(this,"id")),this.className&&(b.class=h.result(this,"className"));var c=a.$("<"+h.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=y[b];h.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=h.result(c,"url")||K()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){if(a.setRequestHeader("X-HTTP-Method-Override",e),g)return g.apply(this,arguments)}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(h.extend(f,d));return c.trigger("request",c,i,d),i};var y={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var z=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(b,c,d){h.isRegExp(b)||(b=this._routeToRegExp(b)),h.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=h.result(this,"routes");for(var a,b=h.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=a.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(b){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=H.exec(navigator.userAgent.toLowerCase())&&(!d||d<=7);this.root=("/"+this.root+"/").replace(G,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe))),b===this.fragment)return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return h.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!E.started)return!1;if(b&&!0!==b||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new E;var J=function(a,b){var c,d=this;c=a&&h.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},h.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&h.extend(c.prototype,a),c.__super__=d.prototype,c};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),function(){var a=this,b=a._,c=a.Backbone,d=null,e=null,f=[];(c.SharedSimpleRouter=c.SharedSimpleRouter||{}).getInstance=function(){return d||(d=new(c.Router.extend({routes:{"*defaults":"defaultRoute"}})),d.on("route:defaultRoute",function(a){for(var c=b(a).isNull()?"":a,d=b(f).filter(function(a){return a.route.test(c)}),e=0;e<d.length&&(d[e].callback(c),!d[e].preventOtherCallbacks);e++);}),e={on:function(a,e,g){if(g=g||{},a=b.isRegExp(a)?a:d._routeToRegExp(a),f.push({route:a,callback:e,preventOtherCallbacks:g.preventOtherCallbacks}),this.historyHasAlreadyStarted()){var h=c.history.getFragment();a.test(h)&&e(h)}},navigate:function(){return d.navigate.apply(d,arguments)},getCurrentRoute:function(){return c.history.fragment},historyStart:function(a){this.historyHasAlreadyStarted()||c.history.start(a)},historyHasAlreadyStarted:function(){return c.History.started}}),e}}.call(this),function(a){function b(b){var c=a(this),d=null,e=[],f=null,g=null,h=a.extend({rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:a.noop,exit:a.noop,activate:a.noop,deactivate:a.noop,exitMenu:a.noop},b),i=3,j=300,k=function(a){e.push({x:a.pageX,y:a.pageY}),e.length>i&&e.shift()},l=function(){g&&clearTimeout(g),h.exitMenu(d)&&(d&&h.deactivate(d),d=null)},m=function(){g&&clearTimeout(g),h.enter(this),q(this)},n=function(){h.exit(this)},o=function(){p(this)},p=function(a){a!=d&&(d&&h.deactivate(d),h.activate(a),d=a)},q=function(a){var b=r();b?g=setTimeout(function(){q(a)},b):p(a)},r=function(){function b(a,b){return(b.y-a.y)/(b.x-a.x)}if(!d||!a(d).is(h.submenuSelector))return 0;var g=c.offset(),i={x:g.left,y:g.top-h.tolerance},k={x:g.left+c.outerWidth(),y:i.y},l={x:g.left,y:g.top+c.outerHeight()+h.tolerance},m={x:g.left+c.outerWidth(),y:l.y},n=e[e.length-1],o=e[0];if(!n)return 0;if(o||(o=n),o.x<g.left||o.x>m.x||o.y<g.top||o.y>m.y)return 0;if(f&&n.x==f.x&&n.y==f.y)return 0;var p=k,q=m;"left"==h.submenuDirection?(p=l,q=i):"below"==h.submenuDirection?(p=m,q=l):"above"==h.submenuDirection&&(p=i,q=k);var r=b(n,p),s=b(n,q),t=b(o,p),u=b(o,q);return r<t&&s>u?(f=n,j):(f=null,0)};c.mouseleave(l).find(h.rowSelector).mouseenter(m).mouseleave(n).click(o),a(document).mousemove(k)}a.fn.menuAim=function(a){return this.each(function(){b.call(this,a)}),this}}(window.$SDM||window.jQuery),function(a,b,c){"use strict";var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;t={paneClass:"nano-pane",sliderClass:"nano-slider",contentClass:"nano-content",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},"scrollbar",p="scroll",i="mousedown",j="mousemove",l="mousewheel",k="mouseup",o="resize",h="drag",r="up",n="panedown",f="DOMMouseScroll",g="down",s="wheel","keydown","keyup",q="touchmove",d="Microsoft Internet Explorer"===b.navigator.appName&&/msie 7./i.test(b.navigator.appVersion)&&b.ActiveXObject,e=null,u=function(){var a,b,d;return a=c.createElement("div"),b=a.style,b.position="absolute",b.width="100px",b.height="100px",b.overflow=p,b.top="-9999px",c.body.appendChild(a),d=a.offsetWidth-a.clientWidth,c.body.removeChild(a),d},m=function(){function m(d,f){this.el=d,this.options=f,e||(e=u()),this.$el=a(this.el),this.doc=a(this.options.documentContext||c),this.win=a(this.options.windowContext||b),this.$content=this.$el.children("."+f.contentClass),this.$content.attr("tabindex",this.options.tabIndex||0),this.content=this.$content[0],this.options.iOSNativeScrolling&&null!=this.el.style.WebkitOverflowScrolling?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}return m.prototype.preventScrolling=function(a,b){if(this.isActive)if(a.type===f)(b===g&&a.originalEvent.detail>0||b===r&&a.originalEvent.detail<0)&&a.preventDefault();else if(a.type===l){if(!a.originalEvent||!a.originalEvent.wheelDelta)return;(b===g&&a.originalEvent.wheelDelta<0||b===r&&a.originalEvent.wheelDelta>0)&&a.preventDefault()}},m.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},m.prototype.updateScrollValues=function(){var a;a=this.content,this.maxScrollTop=a.scrollHeight-a.clientHeight,this.prevScrollTop=this.contentScrollTop||0,this.contentScrollTop=a.scrollTop,this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=0===this.maxScrollTop?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},m.prototype.createEvents=function(){var a=this;this.events={down:function(b){return a.isBeingDragged=!0,a.offsetY=b.pageY-a.slider.offset().top,a.pane.addClass("active"),a.doc.bind(j,a.events[h]).bind(k,a.events[r]),!1},drag:function(b){return a.sliderY=b.pageY-a.$el.offset().top-a.offsetY,a.scroll(),a.updateScrollValues(),a.contentScrollTop>=a.maxScrollTop&&a.prevScrollTop!==a.maxScrollTop?a.$el.trigger("scrollend"):0===a.contentScrollTop&&0!==a.prevScrollTop&&a.$el.trigger("scrolltop"),!1},up:function(){return a.isBeingDragged=!1,a.pane.removeClass("active"),a.doc.unbind(j,a.events[h]).unbind(k,a.events[r]),!1},resize:function(){a.reset()},panedown:function(b){return a.sliderY=(b.offsetY||b.originalEvent.layerY)-.5*a.sliderHeight,a.scroll(),a.events.down(b),!1},scroll:function(b){a.isBeingDragged||(a.updateScrollValues(),a.iOSNativeScrolling||(a.sliderY=a.sliderTop,a.slider.css({top:a.sliderTop})),null!=b&&(a.contentScrollTop>=a.maxScrollTop?(a.options.preventPageScrolling&&a.preventScrolling(b,g),a.prevScrollTop!==a.maxScrollTop&&a.$el.trigger("scrollend")):0===a.contentScrollTop&&(a.options.preventPageScrolling&&a.preventScrolling(b,r),0!==a.prevScrollTop&&a.$el.trigger("scrolltop"))))},wheel:function(b){var c;if(null!=b)return c=b.delta||b.wheelDelta||b.originalEvent&&b.originalEvent.wheelDelta||-b.detail||b.originalEvent&&-b.originalEvent.detail,c&&(a.sliderY+=-c/3),a.scroll(),!1}}},m.prototype.addEvents=function(){var a;this.removeEvents(),a=this.events,this.options.disableResize||this.win.bind(o,a[o]),this.iOSNativeScrolling||(this.slider.bind(i,a[g]),this.pane.bind(i,a[n]).bind(l+" "+f,a[s])),this.$content.bind(p+" "+l+" "+f+" "+q,a[p])},m.prototype.removeEvents=function(){var a;a=this.events,this.win.unbind(o,a[o]),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind(p+" "+l+" "+f+" "+q,a[p])},m.prototype.generate=function(){var a,b,c,d;return b=this.options,c=b.paneClass,d=b.sliderClass,b.contentClass,this.$el.find(""+c).length||this.$el.find(""+d).length||this.$el.append('<div class="'+c+'"><div class="'+d+'" /></div>'),this.pane=this.$el.children("."+c),this.slider=this.pane.find("."+d),e&&(a={right:-e},this.$el.addClass("has-scrollbar")),null!=a&&this.$content.css(a),this},m.prototype.restore=function(){this.stopped=!1,this.pane.show(),this.addEvents()},m.prototype.reset=function(){var a,b,c,f,g,h,i,j,k,l;return this.iOSNativeScrolling?void(this.contentHeight=this.content.scrollHeight):(this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),a=this.content,c=a.style,f=c.overflowY,d&&this.$content.css({height:this.$content.height()}),b=a.scrollHeight+e,k=parseInt(this.$el.css("max-height"),10),k>0&&(this.$el.height(""),this.$el.height(a.scrollHeight>k?k:a.scrollHeight)),h=this.pane.outerHeight(!1),j=parseInt(this.pane.css("top"),10),g=parseInt(this.pane.css("bottom"),10),i=h+j+g,l=Math.round(i/b*i),l<this.options.sliderMinHeight?l=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&l>this.options.sliderMaxHeight&&(l=this.options.sliderMaxHeight),f===p&&c.overflowX!==p&&(l+=e),this.maxSliderTop=i-l,this.contentHeight=b,this.paneHeight=h,this.paneOuterHeight=i,this.sliderHeight=l,this.slider.height(l),this.events.scroll(),this.pane.show(),this.isActive=!0,a.scrollHeight===a.clientHeight||this.pane.outerHeight(!0)>=a.scrollHeight&&f!==p?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===a.scrollHeight&&f===p?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),this)},m.prototype.scroll=function(){return this.isActive?(this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop((this.paneHeight-this.contentHeight+e)*this.sliderY/this.maxSliderTop*-1),this.iOSNativeScrolling||this.slider.css({top:this.sliderY}),this):void 0},m.prototype.scrollBottom=function(a){return this.isActive?(this.reset(),this.$content.scrollTop(this.contentHeight-this.$content.height()-a).trigger(l),this):void 0},m.prototype.scrollTop=function(a){return this.isActive?(this.reset(),this.$content.scrollTop(+a).trigger(l),this):void 0},m.prototype.scrollTo=function(b){return this.isActive?(this.reset(),this.scrollTop(a(b).get(0).offsetTop),this):void 0},m.prototype.stop=function(){return this.stopped=!0,this.removeEvents(),this.pane.hide(),this},m.prototype.destroy=function(){return this.stopped||this.stop(),this.pane.length&&this.pane.remove(),d&&this.$content.height(""),this.$content.removeAttr("tabindex"),this.$el.hasClass("has-scrollbar")&&(this.$el.removeClass("has-scrollbar"),this.$content.css({right:""})),this},m.prototype.flash=function(){var a=this;if(this.isActive)return this.reset(),this.pane.addClass("flashed"),setTimeout(function(){a.pane.removeClass("flashed")},this.options.flashDelay),this},m}(),a.fn.nanoScroller=function(b){return this.each(function(){var c,d;if((d=this.nanoscroller)||(c=a.extend({},t,b),this.nanoscroller=d=new m(this,c)),b&&"object"==typeof b){if(a.extend(d.options,b),b.scrollBottom)return d.scrollBottom(b.scrollBottom);if(b.scrollTop)return d.scrollTop(b.scrollTop);if(b.scrollTo)return d.scrollTo(b.scrollTo);if("bottom"===b.scroll)return d.scrollBottom(0);if("top"===b.scroll)return d.scrollTop(0);if(b.scroll&&b.scroll instanceof a)return d.scrollTo(b.scroll);if(b.stop)return d.stop();if(b.destroy)return d.destroy();if(b.flash)return d.flash()}return d.reset()})},a.fn.nanoScroller.Constructor=m}(jQuery,window,document),function(a,b){a.PopThat={},"function"==typeof define&&define.amd?define(["jquery","underscore"],function(c,d){return a.PopThat.Core=b(c,d)}):a.PopThat.Core=b(a.$,a._)}(this,function(a,b){var c,d=this,e="PopThat",f=a(d.window),g=a(d.document),h=d.Debug,i=h&&h.constructor&&h.call&&h.apply?new h(e):{},j=i.bind?i.bind("log"):function(){},k=function(b){this.NAME=e;var c={id:null,templates:{background:'<div class="pop-background"></div>',popthat:'<div class="pop"></div>',modal:'<div class="pop-modal"></div>',close:'<div class="pop-close"></div>',content:'<div class="pop-content"></div>'},watcher:{interval:13,threshold:400},events:{namespace:"popthat",listeners:{open:"popthat-open",reposition:"popthat-reposition",close:"popthat-close",resize:"popthat-resize",loader:"popthat-loader",clear_layout:"popthat-clear-layout",watch_layout:"popthat-watch-layout"},triggers:{open_completed:"popthat-open-completed",close_completed:"popthat-close-completed"}},animation:{background:250}},d=this._extendDefaults();"object"!=typeof d&&(d={}),this.config=a.extend(!0,c,d,b||{}),this._initialize()};k.prototype._extendDefaults=function(){},k.prototype._initialize=function(a){this._registerInstaceVars(),this._convertTemplates(),this._validateConfig()&&this._injectApp()},k.prototype._registerInstaceVars=function(){this.page_attrs=this._setPageAttrs(),this.$background=null,this.$popthat=null,this.is_open=!1,this.is_resized=!1,this.templates={},this.is_watched=!1},k.prototype._validateConfig=function(){this.config;return!0},k.prototype._injectApp=function(){this._injectBackground(),this._injectPopThat();var a=b(this.resize).bind(this),c="."+this.config.events.suffix;f.on("resize"+c,b.debounce(a,300))},k.prototype._injectBackground=function(){var b=this.templates.background;this.$background=c||(c=a(b()).appendTo("body"))},k.prototype._injectPopThat=function(){this.$popthat=a(this.templates.popthat()),this.config.id&&this.$popthat.prop("id",this.config.id),this._bindPopThat(),this.$popthat.appendTo("body")},k.prototype._bindPopThat=function(){var a=this.config.events;this.$popthat.on(a.listeners.open,b(this._handleOpen).bind(this)).on(a.listeners.close,b(this._handleClose).bind(this)).on(a.listeners.reposition,b(this._handleReposition).bind(this)).on(a.listeners.loader,b(this._handleLoader).bind(this)).on(a.listeners.resize,b(this._handleResize).bind(this)).on(a.listeners.clear_layout,b(this._handleClearLayout).bind(this)).on(a.listeners.watch_layout,b(this._handleWatchLayout).bind(this)).on("click",b(this._clickPopThat).bind(this))},k.prototype._clickPopThat=function(a){a.stopPropagation(),a.target===a.currentTarget&&this.close()},k.prototype._handleOpen=function(a,b,c){this.open(b,c)},k.prototype._handleClose=function(a,b,c){this.close(b,c)},k.prototype._handleReposition=function(a,b,c){this.reposition(b,c)},
k.prototype._handleLoader=function(a){this.loader()},k.prototype._handleResize=function(a,b){this.resize(b)},k.prototype._handleClearLayout=function(a){this.clearLayout()},k.prototype._handleWatchLayout=function(a,c){c=b.isNumber(c)?c:null,this.watchLayout(c)},k.prototype._showPopThat=function(){this._resizeOnce(),!0!==this.is_open&&(this.is_open=!0,this.$background.stop().fadeIn(this.config.animation.background),this.$popthat.show())},k.prototype._hidePopThat=function(){this.is_open=!1,this.$background.stop().fadeOut(this.config.animation.background),this.$popthat.hide(),this.$modal=null},k.prototype._injectModal=function(b){this.$modal=a(this.templates.modal()),this._updateModal(b),this.$modal.appendTo(this.$popthat)},k.prototype._updateModal=function(c){var d=a(this.templates.close()),e=a(this.templates.content());d.on("click",b(this.close).bind(this)),e.append(b.isObject(c)&&c.jquery?c.clone(!0):c),this.$modal.empty().append(d).append(e)},k.prototype._removeModal=function(a){a.remove(),null!==this.$modal&&this.$modal!==a||(this._hidePopThat(),this._triggerCloseCompleted())},k.prototype._animateModal=function(a,c,d){d||(d={}),c||(c={});var e=function(b){c.reposition&&this.$modal&&this.is_open?(a&&this._updateModal(a),c.reposition.apply(this,[b,this.$modal,this._getModalInfo(b,this.$modal),d])):(c.close&&this.$modal&&c.close.apply(this,[b,this.$modal,this._getModalInfo(b,this.$modal),d]),c.open&&(this._showPopThat(),this._injectModal(a),c.open.apply(this,[b,this.$modal,this._getModalInfo(b,this.$modal),d])))};this._getPageInfo(b(e).bind(this))},k.prototype._watchModal=function(c,d,e){d=d||a.now(),c=c||this.config.watcher.threshold,this.is_watched=!1;var f=function(f){if(this.$modal){var g=this._getModalInfo(f,this.$modal),h={top:g.top,left:g.left,width:g.innerwidth,height:g.innerheight},i=a.now();this.$modal.is(":animated")||this.$modal.css(h),i-d<c&&(e&&(e.top===h.top&&e.left===h.left&&e.width===h.width&&e.height===h.height||(d=i)),b(this._watchModal).chain().bind(this,c,d,h).delay(this.config.watcher.interval),this.is_watched=!0)}};this._getPageInfo(b(f).bind(this))},k.prototype._getPageInfo=function(a){if(!a)return!1;a(this._setPageAttrs())},k.prototype._setPageAttrs=function(){return{clientHeight:f.height(),clientWidth:f.width(),offsetTop:0,offsetLeft:0,scrollTop:g.scrollTop(),scrollLeft:g.scrollLeft()}},k.prototype._getModalInfo=function(b,c){var d=c.css("width"),e=c.css("height");c.css({width:"",height:""});var f=g.height(),h=g.width(),i=c.outerHeight(!0),j=c.outerWidth(!0),k=c.height(),l=c.width();return i>f&&(f=i,this.$background.css({height:f}),this.$popthat.css({height:f}),a("body").css({"min-height":f})),c.css({width:d,height:e}),{top:function(){var a=Math.floor((b.clientHeight-i)/2+b.scrollTop);return a<0?0:a+i>f?f-i:b.clientHeight-i<0?b.scrollTop:a}(),left:function(){var a=Math.floor((b.clientWidth-j)/2+b.scrollLeft);return a+j>h?h-j:b.clientWidth-j<0?b.scrollLeft:a}(),height:i,width:j,innerheight:k,innerwidth:l}},k.prototype._resizeOnce=function(){if(this.is_resized)return!1;this.is_resized=!0,this.resize(!1)},k.prototype._triggerOpenCompleted=function(){this.$popthat.trigger(this.config.events.triggers.open_completed)},k.prototype._triggerCloseCompleted=function(){this.$popthat.trigger(this.config.events.triggers.close_completed)},k.prototype.open=function(){j("Animation library not found")},k.prototype.close=function(){j("Animation library not found")},k.prototype.reposition=function(){j("Animation library not found")},k.prototype.resize=function(a){!0===this.is_open&&(this.$background.hide(),this.$popthat.hide());var b={height:g.height()};this.$background.css(b),this.$popthat.css(b),!0===this.is_open&&(this.$background.show(),this.$popthat.show()),!1!==a&&this.reposition()},k.prototype.loader=function(){this._showPopThat()},k.prototype.clearLayout=function(){this.$modal&&this.$modal.css({width:"",height:""})},k.prototype.watchLayout=function(a){this.$modal&&!this.is_watched&&this._watchModal(a)},k.prototype._convertTemplates=function(){b(this.config.templates).each(function(a,c){a&&!b.isFunction(a)&&(this.templates[c]=b.template(a))},this)};var l=function(){};return k.extend=function(){var a=this,b=function(){return a.apply(this,arguments)};return l.prototype=a.prototype,b.prototype=new l,b.prototype.constructor=b,b.__super__=a.prototype,b.extend=this.extend,b},k}),function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","popthat.core.js"],function(c,d,e){return a.PopThat.Slide=b(c,d,e)}):a.PopThat.Slide=b(a.$,a._,a.PopThat.Core)}(this,function(a,b,c){var d=this,e="PopThat",f=d.Debug,g=f&&f.constructor&&f.call&&f.apply?new f(e):{},h=(g.bind&&g.bind("log"),c.extend());return h.prototype._extendDefaults=function(){return this.NAME=e,{animation:{open:250,close:150}}},h.prototype.open=function(a){this._animateModal(a,{open:this._slideOpenDown,close:this._slideCloseUp,reposition:this._slideReposition})},h.prototype.next=function(a){this._animateModal(a,{open:this._slideOpenLeft,close:this._slideCloseLeft})},h.prototype.previous=function(a){this._animateModal(a,{open:this._slideOpenRight,close:this._slideCloseRightz})},h.prototype.close=function(a){this._animateModal(a,{close:this._slideCloseUp})},h.prototype.reposition=function(a){this._animateModal(a,{reposition:this._slideReposition})},h.prototype._slideOpenDown=function(a,c,d){var e={visibility:"visible",top:a.scrollTop-d.height,left:d.left},f={top:d.top},g=this.config.animation.open,h=b(this._triggerOpenCompleted).bind(this);c.css(e).animate(f,g,h)},h.prototype._slideOpenLeft=function(a,c,d){var e={visibility:"visible",top:d.top,left:a.scrollLeft+a.clientWidth},f={left:d.left},g=this.config.animation.open,h=b(this._triggerOpenCompleted).bind(this);c.css(e).animate(f,g,h)},h.prototype._slideOpenRight=function(a,c,d){var e={visibility:"visible",top:d.top,left:a.scrollLeft-d.width},f={left:d.left},g=this.config.animation.open,h=b(this._triggerOpenCompleted).bind(this);c.css(e).animate(f,g,h)},h.prototype._slideCloseUp=function(a,c,d){var e={top:a.scrollTop-d.height},f=this.config.animation.close,g=b(this._removeModal).bind(this,c);c.stop().animate(e,f,g)},h.prototype._slideCloseDown=function(a,c,d){var e={top:a.scrollTop+a.clientHeight},f=this.config.animation.close,g=b(this._removeModal).bind(this,c);c.stop().animate(e,f,g)},h.prototype._slideCloseLeft=function(a,c,d){var e={left:a.scrollLeft-d.width},f=this.config.animation.close,g=b(this._removeModal).bind(this,c);c.stop().animate(e,f,g)},h.prototype._slideCloseRight=function(a,c,d){var e={left:a.scrollLeft+a.clientWidth},f=this.config.animation.close,g=b(this._removeModal).bind(this,c);c.stop().animate(e,f,g)},h.prototype._slideReposition=function(a,c,d){var e={top:d.top,left:d.left,width:d.innerwidth,height:d.innerheight},f=this.config.animation.open,g=b(function(){c.css({overflow:"visible"}),this._triggerOpenCompleted()}).bind(this);c.stop().animate(e,f,g)},h}),function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(c){return a.Placeholder=b(c)}):a.Placeholder=b(a.jQuery)}(this,function(a){return Placeholder=function(b){var c={selector:"[placeholder]",enabled:!0,classnames:{active:"phr",state_active:"active",state_inactive:"inactive"}},d=this._extendDefaults();"object"!=typeof d&&(d={}),this.config=a.extend(!0,c,d,b||{}),this.enabled=this.config.enabled,this._initialize()},Placeholder.prototype._extendDefaults=function(){},Placeholder.prototype._initialize=function(){this.selectElements()},Placeholder.prototype._testForPlaceholder=function(){var a=document.createElement("input");return!(""!==a.placeholder||void 0===a.placeholder)},Placeholder.prototype.selectElements=function(){var b=this.config,c=b.selector,d=navigator.userAgent,e=/([0-9\.]+) Safari/,f=d.match(e);if(!this._testForPlaceholder()){if(this.$elements=a(c),this.$form=this.$elements.parents("form"),f){f[1].replace(/\./g,"")<=515&&this.$elements.add("textarea")}this.applyPlaceholders()}},Placeholder.prototype.applyPlaceholders=function(){var b=this.config.classnames;this.$elements.each(a.proxy(function(c,d){var e=a(d);""===e.val()&&e.val(e.attr("placeholder")).addClass(b.state_inactive),this.bindEvents(e)},this)),this.bindForms()},Placeholder.prototype.bindEvents=function(a){var b=this.config.classnames;a.on("focus",function(c){a.val()==a.attr("placeholder")&&a.val("").removeClass(b.state_inactive).addClass(b.state_active)}),a.on("blur",function(c){a.val()!=a.attr("placeholder")&&""!==a.val()||a.val(a.attr("placeholder")).removeClass(b.state_active).addClass(b.state_inactive)})},Placeholder.prototype.bindForms=function(){var b=this.$elements,c=this.config.selector;b.parents("form").on("submit.placeholder",function(b){a(b.currentTarget).find(c).each(function(b,c){var d=a(c);d.val()==d.attr("placeholder")&&d.val("")})})},Placeholder}),function(){function a(b,c){var d=null,e=null;return c.length>0?(d=c.shift(),e=b[d],e=b[d]=void 0!==e?e:{},a(e,c)):b}var b=this;(b.NR||(b.NR={})).resolve=function(c){return a(b,c.split("."))}}(),function(){var a=this,b=a._,c=a.CarouselModel=function(a){this._setInstanceVars(a)};c.prototype._setInstanceVars=function(a){this.current_index=0,this.number_of_panels=a.number_of_panels,this.number_of_visible=a.number_of_visible||1,this.callbacks={changeIndex:[]}},c.prototype._getMinIndex=function(){return 0},c.prototype._getMaxIndex=function(){return this.number_of_panels-1},c.prototype._getFirstBreakPointIndex=function(){return this._getMinIndex()},c.prototype._getLastBreakPointIndex=function(){return Math.max(this.number_of_panels-this.number_of_visible,this._getFirstBreakPointIndex())},c.prototype._fire=function(a,c){c=b(c).isArray()?c:[],this.callbacks[a]&&b(this.callbacks[a]).each(function(a){a.apply({},c)})},c.prototype.setIndex=function(a){var b=a,c=this.current_index;this.current_index=b,b!==c&&this._fire("changeIndex")},c.prototype.setNumberOfPanels=function(a){this.number_of_panels=a},c.prototype.setNumberOfVisible=function(a){this.number_of_visible=a},c.prototype.getCurrentIndex=function(){return this.current_index},c.prototype.getAdvancedIndex=function(a,b){var c=this.current_index+a,d=this.isValidIndex(c);return!d&&b?this._getMinIndex():d?c:null},c.prototype.getEarlierIndex=function(a,b){var c=this.current_index-a,d=this.isValidIndex(c);return!d&&b?this._getMaxIndex():d?c:null},c.prototype.isValidIndex=function(a){var c=!0;return(!b(a).isNumber()||a<this._getMinIndex()||this._getMaxIndex()<a)&&(c=!1),c},c.prototype.isBreakPointIndex=function(a){return b(a).isNumber()&&a%this.number_of_visible==0},c.prototype.getIndexOfNextBreakPoint=function(a){var b,c=null;for(b=this.current_index+1;b<=this._getMaxIndex();b++)if(this.isBreakPointIndex(b)){c=b;break}return null===c&&a?this._getFirstBreakPointIndex():c},c.prototype.getIndexOfPreviousBreakPoint=function(a){var b,c=null;for(b=this.current_index-1;this._getMinIndex()<=b;b--)if(this.isBreakPointIndex(b)){c=b;break}return null===c&&a?this._getLastBreakPointIndex():c},c.prototype.size=function(){return this.number_of_panels},c.prototype.on=function(a,b){this.callbacks[a]&&this.callbacks[a].push(b)},c.prototype.off=function(a){this.callbacks[a]&&(this.callbacks[a]=[])}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.console,e=a.CarouselView=function(a,b){var d={selectors:{container:"[data-widget-carousel]"},attributes:{panel_container:"data-wg-crs-panel-container",panel:"data-wg-crs-panel",toggles_next:"data-wg-crs-next",toggles_previous:"data-wg-crs-previous",pagination_container:"data-wg-crs-pagination-container",pagination_button:"data-wg-crs-pagination-button"},class_names:{pagination_active:"active"}};this.config=c.extend(!0,d,{},b||{}),this._setInstanceVars(a),this._initialize()};e.prototype._setInstanceVars=function(a){this.$container=a.$container,this.animation=function(){d.log("The animation function hasn't been implemented.")},this.selectors={toggles_next:"["+this.config.attributes.toggles_next+"]",toggles_previous:"["+this.config.attributes.toggles_previous+"]",panel:"["+this.config.attributes.panel+"]",panel_container:"["+this.config.attributes.panel_container+"]",pagination_button:"["+this.config.attributes.pagination_button+"]",pagination_container:"["+this.config.attributes.pagination_container+"]"},this.paginationActiveClassName=this.config.class_names.pagination_active,this.callbacks={clickNextButton:[],clickPreviousButton:[],clickPaginationButton:[],resize:[],swipePanelContainer:[]}},e.prototype._initialize=function(){if(!this.$container.is(this.config.selectors.container))return d.log("A carousel container has to have attribute "+this.config.selectors.container+"."),void d.log(this.$container[0]);this.bindClickNextButtonEvent(),this.bindClickPreviousButtonEvent(),this.bindClickPaginationButtonEvent(),this.bindResizeEvent(),this.bindSwipePanelContainerEvent()},e.prototype._fire=function(a,c){c=b(c).isArray()?c:[],this.callbacks[a]&&b(this.callbacks[a]).each(function(a){a.apply({},c)})},e.prototype.off=function(a){this.callbacks[a]&&(this.callbacks[a]=[])},e.prototype.on=function(a,b){this.callbacks[a]&&this.callbacks[a].push(b)},e.prototype.getPanelSize=function(){return this.$container.find(this.selectors.panel).length},e.prototype.setAnimation=function(a){this.animation=a},e.prototype.getAnimation=function(){return this.animation},e.prototype.animate=function(a){this.animation.call(this,a)},e.prototype.showNextButton=function(){this.$container.find(this.selectors.toggles_next).removeClass("wg-sctg-tog-next--disable")},e.prototype.showPanelContainer=function(){this.$container.find(this.selectors.panel_container).show()},e.prototype.hidePanelContainer=function(){this.$container.find(this.selectors.panel_container).hide()},e.prototype.hideNextButton=function(){this.$container.find(this.selectors.toggles_next).addClass("wg-sctg-tog-next--disable")},e.prototype.showPreviousButton=function(){this.$container.find(this.selectors.toggles_previous).removeClass("wg-sctg-tog-prev--disable")},e.prototype.hidePreviousButton=function(){this.$container.find(this.selectors.toggles_previous).addClass("wg-sctg-tog-prev--disable")},e.prototype.showPaginationButton=function(a){this.$container.find(this.selectors.pagination_button).eq(a).show()},e.prototype.hidePaginationButton=function(a){this.$container.find(this.selectors.pagination_button).eq(a).hide()},e.prototype.showAndHidePaginationButtonByFilterCallback=function(a){b(this.$container.find(this.selectors.pagination_button)).each(function(b,d){var e=c(b);a(d,b)?e.show():e.hide()})},e.prototype.makeContainerVisible=function(){this.$container.css("visibility","visible")},e.prototype.makeContainerInvisible=function(){this.$container.css("visibility","hidden")},e.prototype.makePanelContainerVisible=function(){this.$container.find(this.selectors.panel_container).css("visibility","visible")},e.prototype.makePanelContainerInvisible=function(){this.$container.find(this.selectors.panel_container).css("visibility","hidden")},e.prototype.makePaginationButtonContainerVisible=function(){this.$container.find(this.selectors.pagination_container).css("visibility","visible")},e.prototype.makePaginationButtonContainerInvisible=function(){this.$container.find(this.selectors.pagination_container).css("visibility","hidden")},e.prototype.activatePaginationButton=function(a){this.$container.find(this.selectors.pagination_button).removeClass(this.paginationActiveClassName).eq(a).addClass(this.paginationActiveClassName)},e.prototype.renderPanels=function(a){this.$container.find(this.selectors.panel_container).html(a)},e.prototype.renderPaginationButtons=function(a){this.$container.find(this.selectors.pagination_container).html(a)},e.prototype.getCarouselWidth=function(){return this.$container.width()},e.prototype.setPanelWidth=function(a){this.$container.find(this.selectors.panel).css({width:a,minWidth:a})},e.prototype.removePanelWidth=function(){this.$container.find(this.selectors.panel).css({width:"",minWidth:""})},e.prototype.bindClickNextButtonEvent=function(){this.$container.off("click",this.selectors.toggles_next).on("click",this.selectors.toggles_next,b(function(){this._fire("clickNextButton")}).bind(this))},e.prototype.bindClickPreviousButtonEvent=function(){this.$container.off("click",this.selectors.toggles_previous).on("click",this.selectors.toggles_previous,b(function(){this._fire("clickPreviousButton")}).bind(this))},e.prototype.bindClickPaginationButtonEvent=function(){this.$container.off("click",this.selectors.pagination_button).on("click",this.selectors.pagination_button,b(function(a){var b=c(a.currentTarget).index();this._fire("clickPaginationButton",[{index:b}])}).bind(this))},e.prototype.bindResizeEvent=function(){c(window).on("resize",b.debounce(function(a){this._fire("resize")},200).bind(this))},e.prototype.bindSwipePanelContainerEvent=function(){if("ontouchstart"in document.documentElement){var a=this.$container.get(0),c=null,d=null;a.addEventListener("touchstart",function(a){1===a.touches.length&&(c=a.touches[0].pageX,d=a.touches[0].pageY)},!1),a.addEventListener("touchmove",b(function(a){if(1===a.touches.length&&null!==c&&null!==d){var b=a.touches[0].pageX,e=a.touches[0].pageY,f=c-b,g=d-e;this._fire("swipePanelContainer",[a,f,g]),c=null,d=null}}).bind(this),!1)}},e.prototype.unbindClickNextButtonEvent=function(){this.$container.off("click",this.selectors.toggles_next)},e.prototype.unbindClickPreviousButtonEvent=function(){this.$container.off("click",this.selectors.toggles_previous)},e.prototype.unbindClickPaginationButtonEvent=function(){this.$container.off("click",this.selectors.pagination_button)}}.call(this),function(){var a=this,b=a._;a.jQuery;a.CarouselViewAnimations={slide:function(a){return function(b){var c=this,d=c.$container.find(c.selectors.panel).eq(b);c.$container.find(c.selectors.panel_container).stop(!0).animate({left:-d.position().left},{duration:a})}},fade:function(a){return function(a){var c=this,d=c.$container.find(c.selectors.panel);d.eq(a);b.each(d,function(b,c){b.style.opacity=a===c?"1":"0"})}}}}.call(this),function(){var a=this,b=(a._,a.jQuery);b.fn.mlTextOverflow=function(){return this.each(function(){var a=b(this),c=a.height(),d=a.css("max-height");for(a.height("auto"),a.css("max-height","none");a.height()>c;){var e=a.text(),f=e.replace(/\W*\s(\S)*$/,"...");if(a.text(f),e.length===f.length)break}a.height(c),a.css("max-height",d)})}}.call(this),function(){function a(a,b){return this._setInstanceVars(a,b),0===this.$button.length?{}:(this._initialize(),this)}var b=this,c=b._,d=b.jQuery,e="accordion";b.Accordion=function(b,c){var e={selectors:{button:"[data-wg-acc-button]",content:"[data-wg-acc-content]"},classnames:{active:"wg-acc-active",progress_of_showing:"wg-acc-showing",progress_of_hiding:"wg-acc-hiding"},animation_duration:300};return new a(b,d.extend(!0,e,c||{}))},a.prototype._setInstanceVars=function(a,b){this.config=b,this.$element=a,this.$button=a.find(b.selectors.button),this.$content=a.find(b.selectors.content),this.locked=!1,this.activeClassName=b.classnames.active,this.showingProgressClassName=b.classnames.progress_of_showing,this.hidingProgressClassName=b.classnames.progress_of_hiding,this.callbacks={clicked:[],opened:[],closed:[]}},a.prototype._initialize=function(){this._bindClickButtonEvent()},a.prototype._bindClickButtonEvent=function(){this.$button.on("click."+e,c(this._onClickButton).bind(this))},a.prototype._unbindClickButtonEvent=function(){this.$button.off("click."+e)},a.prototype._onClickButton=function(){this._isButtonLocked()||(this._isActive()?this._hide():this._show(),this._fire("clicked"))},a.prototype._on=function(a,b){this.callbacks[a].push(b)},a.prototype._show=function(a){var b=d.Deferred();return this.$content.length>0?(this.$content.queue(c(function(a){this._lockButton(),this._addShowingProgressClass(),a()}).bind(this)),this.$content.slideDown(c(a).isNumber()?a:this.config.animation_duration),this.$content.queue(c(function(a){this._removeShowingProgressClass(),this._addActiveClass(),this._unlockButton(),this._fire("opened"),a(),b.resolve()}).bind(this))):b.resolve(),b.promise()},a.prototype._hide=function(a){var b=d.Deferred();return this.$content.length>0?(this.$content.queue(c(function(a){this._lockButton(),this._addHidingProgressClass(),this._removeActiveClass(),a()}).bind(this)),this.$content.slideUp(c(a).isNumber()?a:this.config.animation_duration),this.$content.queue(c(function(a){this._removeHidingProgressClass(),this._unlockButton(),this._fire("closed"),a(),b.resolve()}).bind(this))):b.resolve(),b.promise()},a.prototype._isButtonLocked=function(){return this.locked},a.prototype._lockButton=function(){this.locked=!0},a.prototype._unlockButton=function(){this.locked=!1},a.prototype._addShowingProgressClass=function(){this.$element.addClass(this.showingProgressClassName)},a.prototype._removeShowingProgressClass=function(){this.$element.removeClass(this.showingProgressClassName)},a.prototype._addHidingProgressClass=function(){this.$element.addClass(this.hidingProgressClassName)},a.prototype._removeHidingProgressClass=function(){this.$element.removeClass(this.hidingProgressClassName)},a.prototype._addActiveClass=function(){this.$element.addClass(this.activeClassName)},a.prototype._removeActiveClass=function(){this.$element.removeClass(this.activeClassName)},a.prototype._isActive=function(){return this.$element.hasClass(this.activeClassName)},a.prototype._fire=function(a){var b=arguments.length>1?Array.prototype.splice.apply(arguments,1):[];c(this.callbacks[a]).each(function(a){a(b)})},a.prototype.open=function(a){return this._show(a)},a.prototype.close=function(a){return this._hide(a)},a.prototype.enable=function(){this._bindClickButtonEvent()},a.prototype.disable=function(){this._unbindClickButtonEvent()},a.prototype.isActive=function(){return this._isActive()},a.prototype.onOpenCompleted=function(a){this._on("opened",a)},a.prototype.onCloseCompleted=function(a){this._on("closed",a)},a.prototype.onClickButton=function(a){this._on("clicked",a)},b.Accordion.validate=function(a){return!c(a).isEmpty()}}.call(this),function(){var a={DaysOfWeek:{en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],fr:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},ShortDaysOfWeek:{en:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],fr:["dim","lun","mar","mer","jeu","ven","sam"]},MonthsOfYear:{en:["January","February","March","April","May","June","July","August","September","October","November","December"],fr:["janvier","fvrier","mars","avril","mai","juin","juillet","aot","septembre","octobre","novembre","dcembre"]},ShortMonthsOfYear:{en:["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],fr:["janv","fvr","mars","avr","mai","juin","juil","aot","sept","oct","nov","dc"]},AMPM:{en:["am","pm"],fr:["h","h"]}},b={"%a":function(b){return a.ShortDaysOfWeek[b][this.getDay()]},"%A":function(b){return a.DaysOfWeek[b][this.getDay()]},"%b":function(b){return a.ShortMonthsOfYear[b][this.getMonth()]},"%B":function(b){return a.MonthsOfYear[b][this.getMonth()]},"%r":function(){return this.getDate()},"%Y":function(){return this.getFullYear()},"%p":function(b){return this.getHours()<=11?a.AMPM[b][0]:a.AMPM[b][1]},"%i":function(a){if("en"===a){var b=this.getHours()%12;return 0===b?12:b}return this.getHours()}},c=function(){var a=[];for(var c in b)b.hasOwnProperty(c)&&a.push(c);return"("+a.join("|")+")"}();Date.prototype.format=function(a,d){var e=this;return d=d||"en",a.replace(new RegExp(c,"ig"),function(a,c){return"function"==typeof b[c]?b[c].call(e,d):a})}}.call(this),function(){Date.prototype.getTimezoneMinuteOffset=function(){var a=this.getTimezoneOffset(),b=Math.abs(a),c=Math.floor(b/60),d=Math.abs(b%60);return(a>0?-1:1)*(100*c+d)}}.call(this),function(){var a=this.NumberFormatter=function(a,b){this.setNumber(a),this.setLanguage(b)};a.prototype.setNumber=function(a){if("number"!=typeof a||isNaN(a))throw new TypeError;this._number=a},a.prototype.setLanguage=function(a){this._language=a||"en"},a.prototype.toCurrency=function(){var a=this._number.toFixed(2).split("."),b=a[0],c=a[1];return"en"===this._language?"$"+(b=b.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))+"."+c:"fr"===this._language?(b=b.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 "))+","+c+" $":void 0}}.call(this),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.moment=b()}(this,function(){"use strict";function a(){return od.apply(null,arguments)}function b(a){od=a}function c(a){return a instanceof Array||"[object Array]"===Object.prototype.toString.call(a)}function d(a){return null!=a&&"[object Object]"===Object.prototype.toString.call(a)}function e(a){var b;for(b in a)return!1;return!0}function f(a){return"number"==typeof a||"[object Number]"===Object.prototype.toString.call(a)}function g(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function h(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function i(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function j(a,b){for(var c in b)i(b,c)&&(a[c]=b[c]);return i(b,"toString")&&(a.toString=b.toString),i(b,"valueOf")&&(a.valueOf=b.valueOf),a}function k(a,b,c,d){return rb(a,b,c,d,!0).utc()}function l(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null}}function m(a){return null==a._pf&&(a._pf=l()),a._pf}function n(a){if(null==a._isValid){var b=m(a),c=qd.call(b.parsedDateParts,function(a){return null!=a}),d=!isNaN(a._d.getTime())&&b.overflow<0&&!b.empty&&!b.invalidMonth&&!b.invalidWeekday&&!b.nullInput&&!b.invalidFormat&&!b.userInvalidated&&(!b.meridiem||b.meridiem&&c);if(a._strict&&(d=d&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour),null!=Object.isFrozen&&Object.isFrozen(a))return d;a._isValid=d}return a._isValid}function o(a){var b=k(NaN);return null!=a?j(m(b),a):m(b).userInvalidated=!0,b}function p(a){return void 0===a}function q(a,b){var c,d,e;if(p(b._isAMomentObject)||(a._isAMomentObject=b._isAMomentObject),p(b._i)||(a._i=b._i),p(b._f)||(a._f=b._f),p(b._l)||(a._l=b._l),p(b._strict)||(a._strict=b._strict),p(b._tzm)||(a._tzm=b._tzm),p(b._isUTC)||(a._isUTC=b._isUTC),p(b._offset)||(a._offset=b._offset),p(b._pf)||(a._pf=m(b)),p(b._locale)||(a._locale=b._locale),rd.length>0)for(c in rd)d=rd[c],e=b[d],p(e)||(a[d]=e);return a}function r(b){q(this,b),this._d=new Date(null!=b._d?b._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===sd&&(sd=!0,a.updateOffset(this),sd=!1)}function s(a){return a instanceof r||null!=a&&null!=a._isAMomentObject}function t(a){return a<0?Math.ceil(a)||0:Math.floor(a)}function u(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=t(b)),c}function v(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;d<e;d++)(c&&a[d]!==b[d]||!c&&u(a[d])!==u(b[d]))&&g++;return g+f}function w(b){!1===a.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+b)}function x(b,c){var d=!0;return j(function(){if(null!=a.deprecationHandler&&a.deprecationHandler(null,b),d){for(var e,f=[],g=0;g<arguments.length;g++){if(e="","object"==typeof arguments[g]){e+="\n["+g+"] ";for(var h in arguments[0])e+=h+": "+arguments[0][h]+", ";e=e.slice(0,-2)}else e=arguments[g];f.push(e)}w(b+"\nArguments: "+Array.prototype.slice.call(f).join("")+"\n"+(new Error).stack),d=!1}return c.apply(this,arguments)},c)}function y(b,c){null!=a.deprecationHandler&&a.deprecationHandler(b,c),td[b]||(w(c),td[b]=!0)}function z(a){return a instanceof Function||"[object Function]"===Object.prototype.toString.call(a)}function A(a){var b,c;for(c in a)b=a[c],z(b)?this[c]=b:this["_"+c]=b;this._config=a,this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function B(a,b){var c,e=j({},a);for(c in b)i(b,c)&&(d(a[c])&&d(b[c])?(e[c]={},j(e[c],a[c]),j(e[c],b[c])):null!=b[c]?e[c]=b[c]:delete e[c]);for(c in a)i(a,c)&&!i(b,c)&&d(a[c])&&(e[c]=j({},e[c]));return e}function C(a){null!=a&&this.set(a)}function D(a,b,c){var d=this._calendar[a]||this._calendar.sameElse;return z(d)?d.call(b,c):d}function E(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];return b||!c?b:(this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a])}function F(){return this._invalidDate}function G(a){return this._ordinal.replace("%d",a)}function H(a,b,c,d){var e=this._relativeTime[c];return z(e)?e(a,b,c,d):e.replace(/%d/i,a)}function I(a,b){var c=this._relativeTime[a>0?"future":"past"];return z(c)?c(b):c.replace(/%s/i,b)}function J(a,b){var c=a.toLowerCase();Dd[c]=Dd[c+"s"]=Dd[b]=a}function K(a){return"string"==typeof a?Dd[a]||Dd[a.toLowerCase()]:void 0}function L(a){var b,c,d={};for(c in a)i(a,c)&&(b=K(c))&&(d[b]=a[c]);return d}function M(a,b){Ed[a]=b}function N(a){var b=[];for(var c in a)b.push({unit:c,priority:Ed[c]});return b.sort(function(a,b){return a.priority-b.priority}),b}function O(b,c){return function(d){return null!=d?(Q(this,b,d),a.updateOffset(this,c),this):P(this,b)}}function P(a,b){return a.isValid()?a._d["get"+(a._isUTC?"UTC":"")+b]():NaN}function Q(a,b,c){a.isValid()&&a._d["set"+(a._isUTC?"UTC":"")+b](c)}function R(a){return a=K(a),z(this[a])?this[a]():this}function S(a,b){if("object"==typeof a){a=L(a);for(var c=N(a),d=0;d<c.length;d++)this[c[d].unit](a[c[d].unit])}else if(a=K(a),z(this[a]))return this[a](b);return this}function T(a,b,c){var d=""+Math.abs(a),e=b-d.length;return(a>=0?c?"+":"":"-")+Math.pow(10,Math.max(0,e)).toString().substr(1)+d}function U(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Id[a]=e),b&&(Id[b[0]]=function(){return T(e.apply(this,arguments),b[1],b[2])}),c&&(Id[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function V(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function W(a){var b,c,d=a.match(Fd);for(b=0,c=d.length;b<c;b++)Id[d[b]]?d[b]=Id[d[b]]:d[b]=V(d[b]);return function(b){var e,f="";for(e=0;e<c;e++)f+=d[e]instanceof Function?d[e].call(b,a):d[e];return f}}function X(a,b){return a.isValid()?(b=Y(b,a.localeData()),Hd[b]=Hd[b]||W(b),Hd[b](a)):a.localeData().invalidDate()}function Y(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Gd.lastIndex=0;d>=0&&Gd.test(a);)a=a.replace(Gd,c),Gd.lastIndex=0,d-=1;return a}function Z(a,b,c){$d[a]=z(b)?b:function(a,d){return a&&c?c:b}}function $(a,b){return i($d,a)?$d[a](b._strict,b._locale):new RegExp(_(a))}function _(a){return aa(a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}))}function aa(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function ba(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),f(b)&&(d=function(a,c){c[b]=u(a)}),c=0;c<a.length;c++)_d[a[c]]=d}function ca(a,b){ba(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function da(a,b,c){null!=b&&i(_d,a)&&_d[a](b,c._a,c,a)}function ea(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function fa(a,b){return a?c(this._months)?this._months[a.month()]:this._months[(this._months.isFormat||ke).test(b)?"format":"standalone"][a.month()]:this._months}function ga(a,b){return a?c(this._monthsShort)?this._monthsShort[a.month()]:this._monthsShort[ke.test(b)?"format":"standalone"][a.month()]:this._monthsShort}function ha(a,b,c){var d,e,f,g=a.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],d=0;d<12;++d)f=k([2e3,d]),this._shortMonthsParse[d]=this.monthsShort(f,"").toLocaleLowerCase(),this._longMonthsParse[d]=this.months(f,"").toLocaleLowerCase();return c?"MMM"===b?(e=je.call(this._shortMonthsParse,g),-1!==e?e:null):(e=je.call(this._longMonthsParse,g),-1!==e?e:null):"MMM"===b?-1!==(e=je.call(this._shortMonthsParse,g))?e:(e=je.call(this._longMonthsParse,g),
-1!==e?e:null):-1!==(e=je.call(this._longMonthsParse,g))?e:(e=je.call(this._shortMonthsParse,g),-1!==e?e:null)}function ia(a,b,c){var d,e,f;if(this._monthsParseExact)return ha.call(this,a,b,c);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;d<12;d++){if(e=k([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function ja(a,b){var c;if(!a.isValid())return a;if("string"==typeof b)if(/^\d+$/.test(b))b=u(b);else if(b=a.localeData().monthsParse(b),!f(b))return a;return c=Math.min(a.date(),ea(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a}function ka(b){return null!=b?(ja(this,b),a.updateOffset(this,!0),this):P(this,"Month")}function la(){return ea(this.year(),this.month())}function ma(a){return this._monthsParseExact?(i(this,"_monthsRegex")||oa.call(this),a?this._monthsShortStrictRegex:this._monthsShortRegex):(i(this,"_monthsShortRegex")||(this._monthsShortRegex=ne),this._monthsShortStrictRegex&&a?this._monthsShortStrictRegex:this._monthsShortRegex)}function na(a){return this._monthsParseExact?(i(this,"_monthsRegex")||oa.call(this),a?this._monthsStrictRegex:this._monthsRegex):(i(this,"_monthsRegex")||(this._monthsRegex=oe),this._monthsStrictRegex&&a?this._monthsStrictRegex:this._monthsRegex)}function oa(){function a(a,b){return b.length-a.length}var b,c,d=[],e=[],f=[];for(b=0;b<12;b++)c=k([2e3,b]),d.push(this.monthsShort(c,"")),e.push(this.months(c,"")),f.push(this.months(c,"")),f.push(this.monthsShort(c,""));for(d.sort(a),e.sort(a),f.sort(a),b=0;b<12;b++)d[b]=aa(d[b]),e[b]=aa(e[b]);for(b=0;b<24;b++)f[b]=aa(f[b]);this._monthsRegex=new RegExp("^("+f.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+e.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+d.join("|")+")","i")}function pa(a){return qa(a)?366:365}function qa(a){return a%4==0&&a%100!=0||a%400==0}function ra(){return qa(this.year())}function sa(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return a<100&&a>=0&&isFinite(h.getFullYear())&&h.setFullYear(a),h}function ta(a){var b=new Date(Date.UTC.apply(null,arguments));return a<100&&a>=0&&isFinite(b.getUTCFullYear())&&b.setUTCFullYear(a),b}function ua(a,b,c){var d=7+b-c;return-(7+ta(a,0,d).getUTCDay()-b)%7+d-1}function va(a,b,c,d,e){var f,g,h=(7+c-d)%7,i=ua(a,d,e),j=1+7*(b-1)+h+i;return j<=0?(f=a-1,g=pa(f)+j):j>pa(a)?(f=a+1,g=j-pa(a)):(f=a,g=j),{year:f,dayOfYear:g}}function wa(a,b,c){var d,e,f=ua(a.year(),b,c),g=Math.floor((a.dayOfYear()-f-1)/7)+1;return g<1?(e=a.year()-1,d=g+xa(e,b,c)):g>xa(a.year(),b,c)?(d=g-xa(a.year(),b,c),e=a.year()+1):(e=a.year(),d=g),{week:d,year:e}}function xa(a,b,c){var d=ua(a,b,c),e=ua(a+1,b,c);return(pa(a)-d+e)/7}function ya(a){return wa(a,this._week.dow,this._week.doy).week}function za(){return this._week.dow}function Aa(){return this._week.doy}function Ba(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function Ca(a){var b=wa(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function Da(a,b){return"string"!=typeof a?a:isNaN(a)?(a=b.weekdaysParse(a),"number"==typeof a?a:null):parseInt(a,10)}function Ea(a,b){return"string"==typeof a?b.weekdaysParse(a)%7||7:isNaN(a)?null:a}function Fa(a,b){return a?c(this._weekdays)?this._weekdays[a.day()]:this._weekdays[this._weekdays.isFormat.test(b)?"format":"standalone"][a.day()]:this._weekdays}function Ga(a){return a?this._weekdaysShort[a.day()]:this._weekdaysShort}function Ha(a){return a?this._weekdaysMin[a.day()]:this._weekdaysMin}function Ia(a,b,c){var d,e,f,g=a.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],d=0;d<7;++d)f=k([2e3,1]).day(d),this._minWeekdaysParse[d]=this.weekdaysMin(f,"").toLocaleLowerCase(),this._shortWeekdaysParse[d]=this.weekdaysShort(f,"").toLocaleLowerCase(),this._weekdaysParse[d]=this.weekdays(f,"").toLocaleLowerCase();return c?"dddd"===b?(e=je.call(this._weekdaysParse,g),-1!==e?e:null):"ddd"===b?(e=je.call(this._shortWeekdaysParse,g),-1!==e?e:null):(e=je.call(this._minWeekdaysParse,g),-1!==e?e:null):"dddd"===b?-1!==(e=je.call(this._weekdaysParse,g))?e:-1!==(e=je.call(this._shortWeekdaysParse,g))?e:(e=je.call(this._minWeekdaysParse,g),-1!==e?e:null):"ddd"===b?-1!==(e=je.call(this._shortWeekdaysParse,g))?e:-1!==(e=je.call(this._weekdaysParse,g))?e:(e=je.call(this._minWeekdaysParse,g),-1!==e?e:null):-1!==(e=je.call(this._minWeekdaysParse,g))?e:-1!==(e=je.call(this._weekdaysParse,g))?e:(e=je.call(this._shortWeekdaysParse,g),-1!==e?e:null)}function Ja(a,b,c){var d,e,f;if(this._weekdaysParseExact)return Ia.call(this,a,b,c);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),d=0;d<7;d++){if(e=k([2e3,1]).day(d),c&&!this._fullWeekdaysParse[d]&&(this._fullWeekdaysParse[d]=new RegExp("^"+this.weekdays(e,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[d]=new RegExp("^"+this.weekdaysShort(e,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[d]=new RegExp("^"+this.weekdaysMin(e,"").replace(".",".?")+"$","i")),this._weekdaysParse[d]||(f="^"+this.weekdays(e,"")+"|^"+this.weekdaysShort(e,"")+"|^"+this.weekdaysMin(e,""),this._weekdaysParse[d]=new RegExp(f.replace(".",""),"i")),c&&"dddd"===b&&this._fullWeekdaysParse[d].test(a))return d;if(c&&"ddd"===b&&this._shortWeekdaysParse[d].test(a))return d;if(c&&"dd"===b&&this._minWeekdaysParse[d].test(a))return d;if(!c&&this._weekdaysParse[d].test(a))return d}}function Ka(a){if(!this.isValid())return null!=a?this:NaN;var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Da(a,this.localeData()),this.add(a-b,"d")):b}function La(a){if(!this.isValid())return null!=a?this:NaN;var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Ma(a){if(!this.isValid())return null!=a?this:NaN;if(null!=a){var b=Ea(a,this.localeData());return this.day(this.day()%7?b:b-7)}return this.day()||7}function Na(a){return this._weekdaysParseExact?(i(this,"_weekdaysRegex")||Qa.call(this),a?this._weekdaysStrictRegex:this._weekdaysRegex):(i(this,"_weekdaysRegex")||(this._weekdaysRegex=ue),this._weekdaysStrictRegex&&a?this._weekdaysStrictRegex:this._weekdaysRegex)}function Oa(a){return this._weekdaysParseExact?(i(this,"_weekdaysRegex")||Qa.call(this),a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(i(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=ve),this._weekdaysShortStrictRegex&&a?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function Pa(a){return this._weekdaysParseExact?(i(this,"_weekdaysRegex")||Qa.call(this),a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(i(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=we),this._weekdaysMinStrictRegex&&a?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Qa(){function a(a,b){return b.length-a.length}var b,c,d,e,f,g=[],h=[],i=[],j=[];for(b=0;b<7;b++)c=k([2e3,1]).day(b),d=this.weekdaysMin(c,""),e=this.weekdaysShort(c,""),f=this.weekdays(c,""),g.push(d),h.push(e),i.push(f),j.push(d),j.push(e),j.push(f);for(g.sort(a),h.sort(a),i.sort(a),j.sort(a),b=0;b<7;b++)h[b]=aa(h[b]),i[b]=aa(i[b]),j[b]=aa(j[b]);this._weekdaysRegex=new RegExp("^("+j.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+h.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+g.join("|")+")","i")}function Ra(){return this.hours()%12||12}function Sa(){return this.hours()||24}function Ta(a,b){U(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Ua(a,b){return b._meridiemParse}function Va(a){return"p"===(a+"").toLowerCase().charAt(0)}function Wa(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Xa(a){return a?a.toLowerCase().replace("_","-"):a}function Ya(a){for(var b,c,d,e,f=0;f<a.length;){for(e=Xa(a[f]).split("-"),b=e.length,c=Xa(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=Za(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&v(e,c,!0)>=b-1)break;b--}f++}return null}function Za(a){var b=null;if(!Be[a]&&"undefined"!=typeof module&&module&&module.exports)try{b=xe._abbr,require("./locale/"+a),$a(b)}catch(a){}return Be[a]}function $a(a,b){var c;return a&&(c=p(b)?bb(a):_a(a,b))&&(xe=c),xe._abbr}function _a(a,b){if(null!==b){var c=Ae;if(b.abbr=a,null!=Be[a])y("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),c=Be[a]._config;else if(null!=b.parentLocale){if(null==Be[b.parentLocale])return Ce[b.parentLocale]||(Ce[b.parentLocale]=[]),Ce[b.parentLocale].push({name:a,config:b}),null;c=Be[b.parentLocale]._config}return Be[a]=new C(B(c,b)),Ce[a]&&Ce[a].forEach(function(a){_a(a.name,a.config)}),$a(a),Be[a]}return delete Be[a],null}function ab(a,b){if(null!=b){var c,d=Ae;null!=Be[a]&&(d=Be[a]._config),b=B(d,b),c=new C(b),c.parentLocale=Be[a],Be[a]=c,$a(a)}else null!=Be[a]&&(null!=Be[a].parentLocale?Be[a]=Be[a].parentLocale:null!=Be[a]&&delete Be[a]);return Be[a]}function bb(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return xe;if(!c(a)){if(b=Za(a))return b;a=[a]}return Ya(a)}function cb(){return wd(Be)}function db(a){var b,c=a._a;return c&&-2===m(a).overflow&&(b=c[be]<0||c[be]>11?be:c[ce]<1||c[ce]>ea(c[ae],c[be])?ce:c[de]<0||c[de]>24||24===c[de]&&(0!==c[ee]||0!==c[fe]||0!==c[ge])?de:c[ee]<0||c[ee]>59?ee:c[fe]<0||c[fe]>59?fe:c[ge]<0||c[ge]>999?ge:-1,m(a)._overflowDayOfYear&&(b<ae||b>ce)&&(b=ce),m(a)._overflowWeeks&&-1===b&&(b=he),m(a)._overflowWeekday&&-1===b&&(b=ie),m(a).overflow=b),a}function eb(a){var b,c,d,e,f,g,h=a._i,i=De.exec(h)||Ee.exec(h);if(i){for(m(a).iso=!0,b=0,c=Ge.length;b<c;b++)if(Ge[b][1].exec(i[1])){e=Ge[b][0],d=!1!==Ge[b][2];break}if(null==e)return void(a._isValid=!1);if(i[3]){for(b=0,c=He.length;b<c;b++)if(He[b][1].exec(i[3])){f=(i[2]||" ")+He[b][0];break}if(null==f)return void(a._isValid=!1)}if(!d&&null!=f)return void(a._isValid=!1);if(i[4]){if(!Fe.exec(i[4]))return void(a._isValid=!1);g="Z"}a._f=e+(f||"")+(g||""),kb(a)}else a._isValid=!1}function fb(b){var c=Ie.exec(b._i);if(null!==c)return void(b._d=new Date(+c[1]));eb(b),!1===b._isValid&&(delete b._isValid,a.createFromInputFallback(b))}function gb(a,b,c){return null!=a?a:null!=b?b:c}function hb(b){var c=new Date(a.now());return b._useUTC?[c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]:[c.getFullYear(),c.getMonth(),c.getDate()]}function ib(a){var b,c,d,e,f=[];if(!a._d){for(d=hb(a),a._w&&null==a._a[ce]&&null==a._a[be]&&jb(a),a._dayOfYear&&(e=gb(a._a[ae],d[ae]),a._dayOfYear>pa(e)&&(m(a)._overflowDayOfYear=!0),c=ta(e,0,a._dayOfYear),a._a[be]=c.getUTCMonth(),a._a[ce]=c.getUTCDate()),b=0;b<3&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;b<7;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[de]&&0===a._a[ee]&&0===a._a[fe]&&0===a._a[ge]&&(a._nextDay=!0,a._a[de]=0),a._d=(a._useUTC?ta:sa).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[de]=24)}}function jb(a){var b,c,d,e,f,g,h,i;if(b=a._w,null!=b.GG||null!=b.W||null!=b.E)f=1,g=4,c=gb(b.GG,a._a[ae],wa(sb(),1,4).year),d=gb(b.W,1),((e=gb(b.E,1))<1||e>7)&&(i=!0);else{f=a._locale._week.dow,g=a._locale._week.doy;var j=wa(sb(),f,g);c=gb(b.gg,a._a[ae],j.year),d=gb(b.w,j.week),null!=b.d?((e=b.d)<0||e>6)&&(i=!0):null!=b.e?(e=b.e+f,(b.e<0||b.e>6)&&(i=!0)):e=f}d<1||d>xa(c,f,g)?m(a)._overflowWeeks=!0:null!=i?m(a)._overflowWeekday=!0:(h=va(c,d,e,f,g),a._a[ae]=h.year,a._dayOfYear=h.dayOfYear)}function kb(b){if(b._f===a.ISO_8601)return void eb(b);b._a=[],m(b).empty=!0;var c,d,e,f,g,h=""+b._i,i=h.length,j=0;for(e=Y(b._f,b._locale).match(Fd)||[],c=0;c<e.length;c++)f=e[c],d=(h.match($(f,b))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&m(b).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),j+=d.length),Id[f]?(d?m(b).empty=!1:m(b).unusedTokens.push(f),da(f,d,b)):b._strict&&!d&&m(b).unusedTokens.push(f);m(b).charsLeftOver=i-j,h.length>0&&m(b).unusedInput.push(h),b._a[de]<=12&&!0===m(b).bigHour&&b._a[de]>0&&(m(b).bigHour=void 0),m(b).parsedDateParts=b._a.slice(0),m(b).meridiem=b._meridiem,b._a[de]=lb(b._locale,b._a[de],b._meridiem),ib(b),db(b)}function lb(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&b<12&&(b+=12),d||12!==b||(b=0),b):b}function mb(a){var b,c,d,e,f;if(0===a._f.length)return m(a).invalidFormat=!0,void(a._d=new Date(NaN));for(e=0;e<a._f.length;e++)f=0,b=q({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],kb(b),n(b)&&(f+=m(b).charsLeftOver,f+=10*m(b).unusedTokens.length,m(b).score=f,(null==d||f<d)&&(d=f,c=b));j(a,c||b)}function nb(a){if(!a._d){var b=L(a._i);a._a=h([b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],function(a){return a&&parseInt(a,10)}),ib(a)}}function ob(a){var b=new r(db(pb(a)));return b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b}function pb(a){var b=a._i,d=a._f;return a._locale=a._locale||bb(a._l),null===b||void 0===d&&""===b?o({nullInput:!0}):("string"==typeof b&&(a._i=b=a._locale.preparse(b)),s(b)?new r(db(b)):(g(b)?a._d=b:c(d)?mb(a):d?kb(a):qb(a),n(a)||(a._d=null),a))}function qb(b){var d=b._i;void 0===d?b._d=new Date(a.now()):g(d)?b._d=new Date(d.valueOf()):"string"==typeof d?fb(b):c(d)?(b._a=h(d.slice(0),function(a){return parseInt(a,10)}),ib(b)):"object"==typeof d?nb(b):f(d)?b._d=new Date(d):a.createFromInputFallback(b)}function rb(a,b,f,g,h){var i={};return!0!==f&&!1!==f||(g=f,f=void 0),(d(a)&&e(a)||c(a)&&0===a.length)&&(a=void 0),i._isAMomentObject=!0,i._useUTC=i._isUTC=h,i._l=f,i._i=a,i._f=b,i._strict=g,ob(i)}function sb(a,b,c,d){return rb(a,b,c,d,!1)}function tb(a,b){var d,e;if(1===b.length&&c(b[0])&&(b=b[0]),!b.length)return sb();for(d=b[0],e=1;e<b.length;++e)b[e].isValid()&&!b[e][a](d)||(d=b[e]);return d}function ub(){return tb("isBefore",[].slice.call(arguments,0))}function vb(){return tb("isAfter",[].slice.call(arguments,0))}function wb(a){var b=L(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+1e3*h*60*60,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=bb(),this._bubble()}function xb(a){return a instanceof wb}function yb(a){return a<0?-1*Math.round(-1*a):Math.round(a)}function zb(a,b){U(a,0,0,function(){var a=this.utcOffset(),c="+";return a<0&&(a=-a,c="-"),c+T(~~(a/60),2)+b+T(~~a%60,2)})}function Ab(a,b){var c=(b||"").match(a);if(null===c)return null;var d=c[c.length-1]||[],e=(d+"").match(Me)||["-",0,0],f=60*e[1]+u(e[2]);return 0===f?0:"+"===e[0]?f:-f}function Bb(b,c){var d,e;return c._isUTC?(d=c.clone(),e=(s(b)||g(b)?b.valueOf():sb(b).valueOf())-d.valueOf(),d._d.setTime(d._d.valueOf()+e),a.updateOffset(d,!1),d):sb(b).local()}function Cb(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Db(b,c){var d,e=this._offset||0;if(!this.isValid())return null!=b?this:NaN;if(null!=b){if("string"==typeof b){if(null===(b=Ab(Xd,b)))return this}else Math.abs(b)<16&&(b*=60);return!this._isUTC&&c&&(d=Cb(this)),this._offset=b,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==b&&(!c||this._changeInProgress?Tb(this,Ob(b-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,a.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?e:Cb(this)}function Eb(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Fb(a){return this.utcOffset(0,a)}function Gb(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Cb(this),"m")),this}function Hb(){if(null!=this._tzm)this.utcOffset(this._tzm);else if("string"==typeof this._i){var a=Ab(Wd,this._i);null!=a?this.utcOffset(a):this.utcOffset(0,!0)}return this}function Ib(a){return!!this.isValid()&&(a=a?sb(a).utcOffset():0,(this.utcOffset()-a)%60==0)}function Jb(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Kb(){if(!p(this._isDSTShifted))return this._isDSTShifted;var a={};if(q(a,this),a=pb(a),a._a){var b=a._isUTC?k(a._a):sb(a._a);this._isDSTShifted=this.isValid()&&v(a._a,b.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Lb(){return!!this.isValid()&&!this._isUTC}function Mb(){return!!this.isValid()&&this._isUTC}function Nb(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}function Ob(a,b){var c,d,e,g=a,h=null;return xb(a)?g={ms:a._milliseconds,d:a._days,M:a._months}:f(a)?(g={},b?g[b]=a:g.milliseconds=a):(h=Ne.exec(a))?(c="-"===h[1]?-1:1,g={y:0,d:u(h[ce])*c,h:u(h[de])*c,m:u(h[ee])*c,s:u(h[fe])*c,ms:u(yb(1e3*h[ge]))*c}):(h=Oe.exec(a))?(c="-"===h[1]?-1:1,g={y:Pb(h[2],c),M:Pb(h[3],c),w:Pb(h[4],c),d:Pb(h[5],c),h:Pb(h[6],c),m:Pb(h[7],c),s:Pb(h[8],c)}):null==g?g={}:"object"==typeof g&&("from"in g||"to"in g)&&(e=Rb(sb(g.from),sb(g.to)),g={},g.ms=e.milliseconds,g.M=e.months),d=new wb(g),xb(a)&&i(a,"_locale")&&(d._locale=a._locale),d}function Pb(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function Qb(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function Rb(a,b){var c;return a.isValid()&&b.isValid()?(b=Bb(b,a),a.isBefore(b)?c=Qb(a,b):(c=Qb(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c):{milliseconds:0,months:0}}function Sb(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(y(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=Ob(c,d),Tb(this,e,a),this}}function Tb(b,c,d,e){var f=c._milliseconds,g=yb(c._days),h=yb(c._months);b.isValid()&&(e=null==e||e,f&&b._d.setTime(b._d.valueOf()+f*d),g&&Q(b,"Date",P(b,"Date")+g*d),h&&ja(b,P(b,"Month")+h*d),e&&a.updateOffset(b,g||h))}function Ub(a,b){var c=a.diff(b,"days",!0);return c<-6?"sameElse":c<-1?"lastWeek":c<0?"lastDay":c<1?"sameDay":c<2?"nextDay":c<7?"nextWeek":"sameElse"}function Vb(b,c){var d=b||sb(),e=Bb(d,this).startOf("day"),f=a.calendarFormat(this,e)||"sameElse",g=c&&(z(c[f])?c[f].call(this,d):c[f]);return this.format(g||this.localeData().calendar(f,this,sb(d)))}function Wb(){return new r(this)}function Xb(a,b){var c=s(a)?a:sb(a);return!(!this.isValid()||!c.isValid())&&(b=K(p(b)?"millisecond":b),"millisecond"===b?this.valueOf()>c.valueOf():c.valueOf()<this.clone().startOf(b).valueOf())}function Yb(a,b){var c=s(a)?a:sb(a);return!(!this.isValid()||!c.isValid())&&(b=K(p(b)?"millisecond":b),"millisecond"===b?this.valueOf()<c.valueOf():this.clone().endOf(b).valueOf()<c.valueOf())}function Zb(a,b,c,d){return d=d||"()",("("===d[0]?this.isAfter(a,c):!this.isBefore(a,c))&&(")"===d[1]?this.isBefore(b,c):!this.isAfter(b,c))}function $b(a,b){var c,d=s(a)?a:sb(a);return!(!this.isValid()||!d.isValid())&&(b=K(b||"millisecond"),"millisecond"===b?this.valueOf()===d.valueOf():(c=d.valueOf(),this.clone().startOf(b).valueOf()<=c&&c<=this.clone().endOf(b).valueOf()))}function _b(a,b){return this.isSame(a,b)||this.isAfter(a,b)}function ac(a,b){return this.isSame(a,b)||this.isBefore(a,b)}function bc(a,b,c){var d,e,f,g;return this.isValid()?(d=Bb(a,this),d.isValid()?(e=6e4*(d.utcOffset()-this.utcOffset()),b=K(b),"year"===b||"month"===b||"quarter"===b?(g=cc(this,d),"quarter"===b?g/=3:"year"===b&&(g/=12)):(f=this-d,g="second"===b?f/1e3:"minute"===b?f/6e4:"hour"===b?f/36e5:"day"===b?(f-e)/864e5:"week"===b?(f-e)/6048e5:f),c?g:t(g)):NaN):NaN}function cc(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return b-f<0?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)||0}function dc(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function ec(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?z(Date.prototype.toISOString)?this.toDate().toISOString():X(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):X(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function fc(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var a="moment",b="";this.isLocal()||(a=0===this.utcOffset()?"moment.utc":"moment.parseZone",b="Z");var c="["+a+'("]',d=0<this.year()&&this.year()<=9999?"YYYY":"YYYYYY",e=b+'[")]';return this.format(c+d+"-MM-DD[T]HH:mm:ss.SSS"+e)}function gc(b){b||(b=this.isUtc()?a.defaultFormatUtc:a.defaultFormat);var c=X(this,b);return this.localeData().postformat(c)}function hc(a,b){return this.isValid()&&(s(a)&&a.isValid()||sb(a).isValid())?Ob({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function ic(a){return this.from(sb(),a)}function jc(a,b){return this.isValid()&&(s(a)&&a.isValid()||sb(a).isValid())?Ob({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function kc(a){return this.to(sb(),a)}function lc(a){var b;return void 0===a?this._locale._abbr:(b=bb(a),null!=b&&(this._locale=b),this)}function mc(){return this._locale}function nc(a){switch(a=K(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function oc(a){return void 0===(a=K(a))||"millisecond"===a?this:("date"===a&&(a="day"),this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms"))}function pc(){return this._d.valueOf()-6e4*(this._offset||0)}function qc(){return Math.floor(this.valueOf()/1e3)}function rc(){return new Date(this.valueOf())}function sc(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function tc(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function uc(){return this.isValid()?this.toISOString():null}function vc(){return n(this)}function wc(){return j({},m(this))}function xc(){return m(this).overflow}function yc(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function zc(a,b){U(0,[a,a.length],0,b)}function Ac(a){return Ec.call(this,a,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function Bc(a){return Ec.call(this,a,this.isoWeek(),this.isoWeekday(),1,4)}function Cc(){return xa(this.year(),1,4)}function Dc(){var a=this.localeData()._week;return xa(this.year(),a.dow,a.doy)}function Ec(a,b,c,d,e){var f;return null==a?wa(this,d,e).year:(f=xa(a,d,e),b>f&&(b=f),Fc.call(this,a,b,c,d,e))}function Fc(a,b,c,d,e){var f=va(a,b,c,d,e),g=ta(f.year,0,f.dayOfYear);return this.year(g.getUTCFullYear()),this.month(g.getUTCMonth()),this.date(g.getUTCDate()),this}function Gc(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Hc(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function Ic(a,b){b[ge]=u(1e3*("0."+a))}function Jc(){return this._isUTC?"UTC":""}function Kc(){return this._isUTC?"Coordinated Universal Time":""}function Lc(a){return sb(1e3*a)}function Mc(){return sb.apply(null,arguments).parseZone()}function Nc(a){return a}function Oc(a,b,c,d){var e=bb(),f=k().set(d,b);return e[c](f,a)}function Pc(a,b,c){if(f(a)&&(b=a,a=void 0),a=a||"",null!=b)return Oc(a,b,c,"month");var d,e=[];for(d=0;d<12;d++)e[d]=Oc(a,d,c,"month");return e}function Qc(a,b,c,d){"boolean"==typeof a?(f(b)&&(c=b,b=void 0),b=b||""):(b=a,c=b,a=!1,f(b)&&(c=b,b=void 0),b=b||"");var e=bb(),g=a?e._week.dow:0;if(null!=c)return Oc(b,(c+g)%7,d,"day");var h,i=[];for(h=0;h<7;h++)i[h]=Oc(b,(h+g)%7,d,"day");return i}function Rc(a,b){return Pc(a,b,"months")}function Sc(a,b){return Pc(a,b,"monthsShort")}function Tc(a,b,c){return Qc(a,b,c,"weekdays")}function Uc(a,b,c){return Qc(a,b,c,"weekdaysShort")}function Vc(a,b,c){return Qc(a,b,c,"weekdaysMin")}function Wc(){var a=this._data;return this._milliseconds=Ze(this._milliseconds),this._days=Ze(this._days),this._months=Ze(this._months),a.milliseconds=Ze(a.milliseconds),a.seconds=Ze(a.seconds),a.minutes=Ze(a.minutes),a.hours=Ze(a.hours),a.months=Ze(a.months),a.years=Ze(a.years),this}function Xc(a,b,c,d){var e=Ob(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function Yc(a,b){return Xc(this,a,b,1)}function Zc(a,b){return Xc(this,a,b,-1)}function $c(a){return a<0?Math.floor(a):Math.ceil(a)}function _c(){var a,b,c,d,e,f=this._milliseconds,g=this._days,h=this._months,i=this._data;return f>=0&&g>=0&&h>=0||f<=0&&g<=0&&h<=0||(f+=864e5*$c(bd(h)+g),g=0,h=0),i.milliseconds=f%1e3,a=t(f/1e3),i.seconds=a%60,b=t(a/60),i.minutes=b%60,c=t(b/60),i.hours=c%24,g+=t(c/24),e=t(ad(g)),h+=e,g-=$c(bd(e)),d=t(h/12),h%=12,i.days=g,i.months=h,i.years=d,this}function ad(a){return 4800*a/146097}function bd(a){return 146097*a/4800}function cd(a){var b,c,d=this._milliseconds;if("month"===(a=K(a))||"year"===a)return b=this._days+d/864e5,c=this._months+ad(b),"month"===a?c:c/12;switch(b=this._days+Math.round(bd(this._months)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function dd(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*u(this._months/12)}function ed(a){return function(){return this.as(a)}}function fd(a){return a=K(a),this[a+"s"]()}function gd(a){return function(){return this._data[a]}}function hd(){return t(this.days()/7)}function id(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function jd(a,b,c){var d=Ob(a).abs(),e=of(d.as("s")),f=of(d.as("m")),g=of(d.as("h")),h=of(d.as("d")),i=of(d.as("M")),j=of(d.as("y")),k=e<pf.s&&["s",e]||f<=1&&["m"]||f<pf.m&&["mm",f]||g<=1&&["h"]||g<pf.h&&["hh",g]||h<=1&&["d"]||h<pf.d&&["dd",h]||i<=1&&["M"]||i<pf.M&&["MM",i]||j<=1&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,id.apply(null,k)}function kd(a){return void 0===a?of:"function"==typeof a&&(of=a,!0)}function ld(a,b){return void 0!==pf[a]&&(void 0===b?pf[a]:(pf[a]=b,!0))}function md(a){var b=this.localeData(),c=jd(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function nd(){var a,b,c,d=qf(this._milliseconds)/1e3,e=qf(this._days),f=qf(this._months);a=t(d/60),b=t(a/60),d%=60,a%=60,c=t(f/12),f%=12;var g=c,h=f,i=e,j=b,k=a,l=d,m=this.asSeconds();return m?(m<0?"-":"")+"P"+(g?g+"Y":"")+(h?h+"M":"")+(i?i+"D":"")+(j||k||l?"T":"")+(j?j+"H":"")+(k?k+"M":"")+(l?l+"S":""):"P0D"}var od,pd;pd=Array.prototype.some?Array.prototype.some:function(a){for(var b=Object(this),c=b.length>>>0,d=0;d<c;d++)if(d in b&&a.call(this,b[d],d,b))return!0;return!1};var qd=pd,rd=a.momentProperties=[],sd=!1,td={};a.suppressDeprecationWarnings=!1,a.deprecationHandler=null;var ud;ud=Object.keys?Object.keys:function(a){var b,c=[];for(b in a)i(a,b)&&c.push(b);return c};var vd,wd=ud,xd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},yd={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},zd="Invalid date",Ad="%d",Bd=/\d{1,2}/,Cd={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Dd={},Ed={},Fd=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Gd=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Hd={},Id={},Jd=/\d/,Kd=/\d\d/,Ld=/\d{3}/,Md=/\d{4}/,Nd=/[+-]?\d{6}/,Od=/\d\d?/,Pd=/\d\d\d\d?/,Qd=/\d\d\d\d\d\d?/,Rd=/\d{1,3}/,Sd=/\d{1,4}/,Td=/[+-]?\d{1,6}/,Ud=/\d+/,Vd=/[+-]?\d+/,Wd=/Z|[+-]\d\d:?\d\d/gi,Xd=/Z|[+-]\d\d(?::?\d\d)?/gi,Yd=/[+-]?\d+(\.\d{1,3})?/,Zd=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,$d={},_d={},ae=0,be=1,ce=2,de=3,ee=4,fe=5,ge=6,he=7,ie=8;vd=Array.prototype.indexOf?Array.prototype.indexOf:function(a){var b;for(b=0;b<this.length;++b)if(this[b]===a)return b;return-1};var je=vd;U("M",["MM",2],"Mo",function(){return this.month()+1}),U("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),U("MMMM",0,0,function(a){return this.localeData().months(this,a)}),J("month","M"),M("month",8),Z("M",Od),Z("MM",Od,Kd),Z("MMM",function(a,b){return b.monthsShortRegex(a)}),Z("MMMM",function(a,b){return b.monthsRegex(a)}),ba(["M","MM"],function(a,b){b[be]=u(a)-1}),ba(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[be]=e:m(c).invalidMonth=a});var ke=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,le="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),me="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),ne=Zd,oe=Zd;U("Y",0,0,function(){var a=this.year();return a<=9999?""+a:"+"+a}),U(0,["YY",2],0,function(){return this.year()%100}),U(0,["YYYY",4],0,"year"),U(0,["YYYYY",5],0,"year"),U(0,["YYYYYY",6,!0],0,"year"),J("year","y"),M("year",1),Z("Y",Vd),Z("YY",Od,Kd),Z("YYYY",Sd,Md),Z("YYYYY",Td,Nd),Z("YYYYYY",Td,Nd),ba(["YYYYY","YYYYYY"],ae),ba("YYYY",function(b,c){c[ae]=2===b.length?a.parseTwoDigitYear(b):u(b)}),ba("YY",function(b,c){c[ae]=a.parseTwoDigitYear(b)}),ba("Y",function(a,b){b[ae]=parseInt(a,10)}),a.parseTwoDigitYear=function(a){return u(a)+(u(a)>68?1900:2e3)};var pe=O("FullYear",!0);U("w",["ww",2],"wo","week"),U("W",["WW",2],"Wo","isoWeek"),J("week","w"),J("isoWeek","W"),M("week",5),M("isoWeek",5),Z("w",Od),Z("ww",Od,Kd),Z("W",Od),Z("WW",Od,Kd),ca(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=u(a)});var qe={dow:0,doy:6};U("d",0,"do","day"),U("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),U("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),U("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),U("e",0,0,"weekday"),U("E",0,0,"isoWeekday"),J("day","d"),J("weekday","e"),J("isoWeekday","E"),M("day",11),M("weekday",11),M("isoWeekday",11),Z("d",Od),Z("e",Od),Z("E",Od),Z("dd",function(a,b){return b.weekdaysMinRegex(a)}),Z("ddd",function(a,b){return b.weekdaysShortRegex(a)}),Z("dddd",function(a,b){return b.weekdaysRegex(a)}),ca(["dd","ddd","dddd"],function(a,b,c,d){var e=c._locale.weekdaysParse(a,d,c._strict);null!=e?b.d=e:m(c).invalidWeekday=a}),ca(["d","e","E"],function(a,b,c,d){b[d]=u(a)});var re="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),se="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),te="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),ue=Zd,ve=Zd,we=Zd;U("H",["HH",2],0,"hour"),U("h",["hh",2],0,Ra),U("k",["kk",2],0,Sa),U("hmm",0,0,function(){return""+Ra.apply(this)+T(this.minutes(),2)}),U("hmmss",0,0,function(){return""+Ra.apply(this)+T(this.minutes(),2)+T(this.seconds(),2)}),U("Hmm",0,0,function(){return""+this.hours()+T(this.minutes(),2)}),U("Hmmss",0,0,function(){return""+this.hours()+T(this.minutes(),2)+T(this.seconds(),2)}),Ta("a",!0),Ta("A",!1),J("hour","h"),
M("hour",13),Z("a",Ua),Z("A",Ua),Z("H",Od),Z("h",Od),Z("HH",Od,Kd),Z("hh",Od,Kd),Z("hmm",Pd),Z("hmmss",Qd),Z("Hmm",Pd),Z("Hmmss",Qd),ba(["H","HH"],de),ba(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),ba(["h","hh"],function(a,b,c){b[de]=u(a),m(c).bigHour=!0}),ba("hmm",function(a,b,c){var d=a.length-2;b[de]=u(a.substr(0,d)),b[ee]=u(a.substr(d)),m(c).bigHour=!0}),ba("hmmss",function(a,b,c){var d=a.length-4,e=a.length-2;b[de]=u(a.substr(0,d)),b[ee]=u(a.substr(d,2)),b[fe]=u(a.substr(e)),m(c).bigHour=!0}),ba("Hmm",function(a,b,c){var d=a.length-2;b[de]=u(a.substr(0,d)),b[ee]=u(a.substr(d))}),ba("Hmmss",function(a,b,c){var d=a.length-4,e=a.length-2;b[de]=u(a.substr(0,d)),b[ee]=u(a.substr(d,2)),b[fe]=u(a.substr(e))});var xe,ye=/[ap]\.?m?\.?/i,ze=O("Hours",!0),Ae={calendar:xd,longDateFormat:yd,invalidDate:zd,ordinal:Ad,ordinalParse:Bd,relativeTime:Cd,months:le,monthsShort:me,week:qe,weekdays:re,weekdaysMin:te,weekdaysShort:se,meridiemParse:ye},Be={},Ce={},De=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ee=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Fe=/Z|[+-]\d\d(?::?\d\d)?/,Ge=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],He=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Ie=/^\/?Date\((\-?\d+)/i;a.createFromInputFallback=x("value provided is not in a recognized ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),a.ISO_8601=function(){};var Je=x("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=sb.apply(null,arguments);return this.isValid()&&a.isValid()?a<this?this:a:o()}),Ke=x("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var a=sb.apply(null,arguments);return this.isValid()&&a.isValid()?a>this?this:a:o()}),Le=function(){return Date.now?Date.now():+new Date};zb("Z",":"),zb("ZZ",""),Z("Z",Xd),Z("ZZ",Xd),ba(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ab(Xd,a)});var Me=/([\+\-]|\d\d)/gi;a.updateOffset=function(){};var Ne=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Oe=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;Ob.fn=wb.prototype;var Pe=Sb(1,"add"),Qe=Sb(-1,"subtract");a.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",a.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Re=x("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});U(0,["gg",2],0,function(){return this.weekYear()%100}),U(0,["GG",2],0,function(){return this.isoWeekYear()%100}),zc("gggg","weekYear"),zc("ggggg","weekYear"),zc("GGGG","isoWeekYear"),zc("GGGGG","isoWeekYear"),J("weekYear","gg"),J("isoWeekYear","GG"),M("weekYear",1),M("isoWeekYear",1),Z("G",Vd),Z("g",Vd),Z("GG",Od,Kd),Z("gg",Od,Kd),Z("GGGG",Sd,Md),Z("gggg",Sd,Md),Z("GGGGG",Td,Nd),Z("ggggg",Td,Nd),ca(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=u(a)}),ca(["gg","GG"],function(b,c,d,e){c[e]=a.parseTwoDigitYear(b)}),U("Q",0,"Qo","quarter"),J("quarter","Q"),M("quarter",7),Z("Q",Jd),ba("Q",function(a,b){b[be]=3*(u(a)-1)}),U("D",["DD",2],"Do","date"),J("date","D"),M("date",9),Z("D",Od),Z("DD",Od,Kd),Z("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),ba(["D","DD"],ce),ba("Do",function(a,b){b[ce]=u(a.match(Od)[0],10)});var Se=O("Date",!0);U("DDD",["DDDD",3],"DDDo","dayOfYear"),J("dayOfYear","DDD"),M("dayOfYear",4),Z("DDD",Rd),Z("DDDD",Ld),ba(["DDD","DDDD"],function(a,b,c){c._dayOfYear=u(a)}),U("m",["mm",2],0,"minute"),J("minute","m"),M("minute",14),Z("m",Od),Z("mm",Od,Kd),ba(["m","mm"],ee);var Te=O("Minutes",!1);U("s",["ss",2],0,"second"),J("second","s"),M("second",15),Z("s",Od),Z("ss",Od,Kd),ba(["s","ss"],fe);var Ue=O("Seconds",!1);U("S",0,0,function(){return~~(this.millisecond()/100)}),U(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),U(0,["SSS",3],0,"millisecond"),U(0,["SSSS",4],0,function(){return 10*this.millisecond()}),U(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),U(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),U(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),U(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),U(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),J("millisecond","ms"),M("millisecond",16),Z("S",Rd,Jd),Z("SS",Rd,Kd),Z("SSS",Rd,Ld);var Ve;for(Ve="SSSS";Ve.length<=9;Ve+="S")Z(Ve,Ud);for(Ve="S";Ve.length<=9;Ve+="S")ba(Ve,Ic);var We=O("Milliseconds",!1);U("z",0,0,"zoneAbbr"),U("zz",0,0,"zoneName");var Xe=r.prototype;Xe.add=Pe,Xe.calendar=Vb,Xe.clone=Wb,Xe.diff=bc,Xe.endOf=oc,Xe.format=gc,Xe.from=hc,Xe.fromNow=ic,Xe.to=jc,Xe.toNow=kc,Xe.get=R,Xe.invalidAt=xc,Xe.isAfter=Xb,Xe.isBefore=Yb,Xe.isBetween=Zb,Xe.isSame=$b,Xe.isSameOrAfter=_b,Xe.isSameOrBefore=ac,Xe.isValid=vc,Xe.lang=Re,Xe.locale=lc,Xe.localeData=mc,Xe.max=Ke,Xe.min=Je,Xe.parsingFlags=wc,Xe.set=S,Xe.startOf=nc,Xe.subtract=Qe,Xe.toArray=sc,Xe.toObject=tc,Xe.toDate=rc,Xe.toISOString=ec,Xe.inspect=fc,Xe.toJSON=uc,Xe.toString=dc,Xe.unix=qc,Xe.valueOf=pc,Xe.creationData=yc,Xe.year=pe,Xe.isLeapYear=ra,Xe.weekYear=Ac,Xe.isoWeekYear=Bc,Xe.quarter=Xe.quarters=Gc,Xe.month=ka,Xe.daysInMonth=la,Xe.week=Xe.weeks=Ba,Xe.isoWeek=Xe.isoWeeks=Ca,Xe.weeksInYear=Dc,Xe.isoWeeksInYear=Cc,Xe.date=Se,Xe.day=Xe.days=Ka,Xe.weekday=La,Xe.isoWeekday=Ma,Xe.dayOfYear=Hc,Xe.hour=Xe.hours=ze,Xe.minute=Xe.minutes=Te,Xe.second=Xe.seconds=Ue,Xe.millisecond=Xe.milliseconds=We,Xe.utcOffset=Db,Xe.utc=Fb,Xe.local=Gb,Xe.parseZone=Hb,Xe.hasAlignedHourOffset=Ib,Xe.isDST=Jb,Xe.isLocal=Lb,Xe.isUtcOffset=Mb,Xe.isUtc=Nb,Xe.isUTC=Nb,Xe.zoneAbbr=Jc,Xe.zoneName=Kc,Xe.dates=x("dates accessor is deprecated. Use date instead.",Se),Xe.months=x("months accessor is deprecated. Use month instead",ka),Xe.years=x("years accessor is deprecated. Use year instead",pe),Xe.zone=x("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",Eb),Xe.isDSTShifted=x("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Kb);var Ye=C.prototype;Ye.calendar=D,Ye.longDateFormat=E,Ye.invalidDate=F,Ye.ordinal=G,Ye.preparse=Nc,Ye.postformat=Nc,Ye.relativeTime=H,Ye.pastFuture=I,Ye.set=A,Ye.months=fa,Ye.monthsShort=ga,Ye.monthsParse=ia,Ye.monthsRegex=na,Ye.monthsShortRegex=ma,Ye.week=ya,Ye.firstDayOfYear=Aa,Ye.firstDayOfWeek=za,Ye.weekdays=Fa,Ye.weekdaysMin=Ha,Ye.weekdaysShort=Ga,Ye.weekdaysParse=Ja,Ye.weekdaysRegex=Na,Ye.weekdaysShortRegex=Oa,Ye.weekdaysMinRegex=Pa,Ye.isPM=Va,Ye.meridiem=Wa,$a("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10;return a+(1===u(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th")}}),a.lang=x("moment.lang is deprecated. Use moment.locale instead.",$a),a.langData=x("moment.langData is deprecated. Use moment.localeData instead.",bb);var Ze=Math.abs,$e=ed("ms"),_e=ed("s"),af=ed("m"),bf=ed("h"),cf=ed("d"),df=ed("w"),ef=ed("M"),ff=ed("y"),gf=gd("milliseconds"),hf=gd("seconds"),jf=gd("minutes"),kf=gd("hours"),lf=gd("days"),mf=gd("months"),nf=gd("years"),of=Math.round,pf={s:45,m:45,h:22,d:26,M:11},qf=Math.abs,rf=wb.prototype;return rf.abs=Wc,rf.add=Yc,rf.subtract=Zc,rf.as=cd,rf.asMilliseconds=$e,rf.asSeconds=_e,rf.asMinutes=af,rf.asHours=bf,rf.asDays=cf,rf.asWeeks=df,rf.asMonths=ef,rf.asYears=ff,rf.valueOf=dd,rf._bubble=_c,rf.get=fd,rf.milliseconds=gf,rf.seconds=hf,rf.minutes=jf,rf.hours=kf,rf.days=lf,rf.weeks=hd,rf.months=mf,rf.years=nf,rf.humanize=md,rf.toISOString=nd,rf.toString=nd,rf.toJSON=nd,rf.locale=lc,rf.localeData=mc,rf.toIsoString=x("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",nd),rf.lang=Re,U("X",0,0,"unix"),U("x",0,0,"valueOf"),Z("x",Vd),Z("X",Yd),ba("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),ba("x",function(a,b,c){c._d=new Date(u(a))}),a.version="2.17.1",b(sb),a.fn=Xe,a.min=ub,a.max=vb,a.now=Le,a.utc=k,a.unix=Lc,a.months=Rc,a.isDate=g,a.locale=$a,a.invalid=o,a.duration=Ob,a.isMoment=s,a.weekdays=Tc,a.parseZone=Mc,a.localeData=bb,a.isDuration=xb,a.monthsShort=Sc,a.weekdaysMin=Vc,a.defineLocale=_a,a.updateLocale=ab,a.locales=cb,a.weekdaysShort=Uc,a.normalizeUnits=K,a.relativeTimeRounding=kd,a.relativeTimeThreshold=ld,a.calendarFormat=Ub,a.prototype=Xe,a}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Velocity=b()}(this,function(){"use strict";function a(a){return!0===a||!1===a}function b(a){return"[object Function]"===Object.prototype.toString.call(a)}function c(a){return!(!a||!a.nodeType)}function d(a){return"number"==typeof a}function e(a){if(!a||"object"!==(void 0===a?"undefined":Ba(a))||a.nodeType||"[object Object]"!==Object.prototype.toString.call(a))return!1;var b=Object.getPrototypeOf(a);return!b||b.hasOwnProperty("constructor")&&b.constructor===Object}function f(a){return"string"==typeof a}function g(a){return a&&d(a.length)&&b(a.velocity)}function h(a){return a&&a!==window&&d(a.length)&&!f(a)&&!b(a)&&!c(a)&&(0===a.length||c(a[0]))}function i(a){return Array.prototype.slice.call(a,0)}function j(a,b,c,d){a&&Object.defineProperty(a,b,{configurable:!d,writable:!d,value:c})}function k(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var d=!0,e=!1,f=void 0;try{for(var g,h=arguments[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;if(void 0!==i&&i==i)return i}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}}function l(a,b){a instanceof Element&&(a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(\\s|$)","gi")," "))}function m(a,c){var d,e,g=a[0],h=a[1];f(g)?b(h)?Ga[g]&&(d=Ga,e=g,!Object.prototype.propertyIsEnumerable.call(d,e))?console.warn("VelocityJS: Trying to override internal 'registerAction' callback",g):!0===c?j(Ga,g,h):Ga[g]=h:console.warn("VelocityJS: Trying to set 'registerAction' callback to an invalid value:",g,h):console.warn("VelocityJS: Trying to set 'registerAction' name to an invalid value:",g)}function n(a){var c=a[0],d=a[1];f(c)?b(d)?Ja[c]?console.warn("VelocityJS: Trying to override 'registerEasing' callback",c):Ja[c]=d:console.warn("VelocityJS: Trying to set 'registerEasing' callback to an invalid value:",c,d):console.warn("VelocityJS: Trying to set 'registerEasing' name to an invalid value:",c)}function o(a,b,c,d){return b+a*(c-b)}function p(a){return Math.min(Math.max(a,0),1)}function q(a,b){return 1-3*b+3*a}function r(a,b){return 3*b-6*a}function s(a){return 3*a}function t(a,b,c){return((q(b,c)*a+r(b,c))*a+s(b))*a}function u(a,b,c){return 3*q(b,c)*a*a+2*r(b,c)*a+s(b)}function v(a,b,c,d){function e(b){for(var d=k-1,e=0,f=1;f!==d&&o[f]<=b;++f)e+=l;var m=e+(b-o[--f])/(o[f+1]-o[f])*l,n=u(m,a,c);return n>=h?function(b,d){for(var e=0;e<g;++e){var f=u(d,a,c);if(0===f)return d;d-=(t(d,a,c)-b)/f}return d}(b,m):0===n?m:function(b,d,e){var f=void 0,g=void 0,h=0;do{(f=t(g=d+(e-d)/2,a,c)-b)>0?e=g:d=g}while(Math.abs(f)>i&&++h<j);return g}(b,e,e+l)}function f(){q=!0,a===b&&c===d||function(){for(var b=0;b<k;++b)o[b]=t(b*l,a,c)}()}var g=4,h=.001,i=1e-7,j=10,k=11,l=1/(k-1),m="Float32Array"in window;if(4===arguments.length){for(var n=0;n<4;++n)if("number"!=typeof arguments[n]||isNaN(arguments[n])||!isFinite(arguments[n]))return;a=p(a),c=p(c);var o=m?new Float32Array(k):new Array(k),q=!1,r="generateBezier("+[a,b,c,d]+")",s=function(g,h,i,j){return q||f(),0===g?h:1===g?i:a===b&&c===d?h+g*(i-h):h+t(e(g),b,d)*(i-h)};return s.getControlPoints=function(){return[{x:a,y:b},{x:c,y:d}]},s.toString=function(){return r},s}}function w(a){return-a.tension*a.x-a.friction*a.v}function x(a,b,c){var d={x:a.x+c.dx*b,v:a.v+c.dv*b,tension:a.tension,friction:a.friction};return{dx:d.v,dv:w(d)}}function y(a,b){var c={dx:a.v,dv:w(a)},d=x(a,.5*b,c),e=x(a,.5*b,d),f=x(a,b,e),g=1/6*(c.dx+2*(d.dx+e.dx)+f.dx),h=1/6*(c.dv+2*(d.dv+e.dv)+f.dv);return a.x=a.x+g*b,a.v=a.v+h*b,a}function z(a,b){return d(a)?a:f(a)?Ia[a.toLowerCase()]||parseFloat(a.replace("ms","").replace("s","000")):null==b?void 0:z(b)}function A(b){if(a(b))return b;null!=b&&console.warn("VelocityJS: Trying to set 'cache' to an invalid value:",b)}function B(a){if(b(a))return a;null!=a&&console.warn("VelocityJS: Trying to set 'begin' to an invalid value:",a)}function C(a,c){if(b(a))return a;null==a||c||console.warn("VelocityJS: Trying to set 'complete' to an invalid value:",a)}function D(a){var b=z(a);if(!isNaN(b))return b;null!=a&&console.error("VelocityJS: Trying to set 'delay' to an invalid value:",a)}function E(a,b){var c=z(a);if(!isNaN(c)&&c>=0)return c;null==a||b||console.error("VelocityJS: Trying to set 'duration' to an invalid value:",a)}function F(a,c,d){if(f(a))return Ja[a];if(b(a))return a;if(Array.isArray(a)){if(1===a.length)return e=a[0],Na[e]||(Na[e]=function(a,b,c){return 0===a?b:1===a?c:b+Math.round(a*e)*(1/e)*(c-b)});if(2===a.length)return function a(b,c,d){var e={x:-1,v:0,tension:parseFloat(b)||500,friction:parseFloat(c)||20},f=[0],g=null!=d,h=0,i=void 0,j=void 0;for(i=g?(h=a(e.tension,e.friction))/d*.016:.016;j=y(j||e,i),f.push(1+j.x),h+=16,Math.abs(j.x)>1e-4&&Math.abs(j.v)>1e-4;);return g?function(a,b,c){return 0===a?b:1===a?c:b+f[Math.floor(a*(f.length-1))]*(c-b)}:h}(a[0],a[1],c);if(4===a.length)return v.apply(null,a)||!1}var e;null==a||d||console.error("VelocityJS: Trying to set 'easing' to an invalid value:",a)}function G(a){if(!1===a)return 0;var b=parseInt(a,10);if(!isNaN(b)&&b>=0)return Math.min(b,60);null!=a&&console.warn("VelocityJS: Trying to set 'fpsLimit' to an invalid value:",a)}function H(a){switch(a){case!1:return 0;case!0:return!0;default:var b=parseInt(a,10);if(!isNaN(b)&&b>=0)return b}null!=a&&console.warn("VelocityJS: Trying to set 'loop' to an invalid value:",a)}function I(a,b){if(!1===a||f(a))return a;null==a||b||console.warn("VelocityJS: Trying to set 'queue' to an invalid value:",a)}function J(a){switch(a){case!1:return 0;case!0:return!0;default:var b=parseInt(a,10);if(!isNaN(b)&&b>=0)return b}null!=a&&console.warn("VelocityJS: Trying to set 'repeat' to an invalid value:",a)}function K(a){if(d(a))return a;null!=a&&console.error("VelocityJS: Trying to set 'speed' to an invalid value:",a)}function L(b){if(a(b))return b;null!=b&&console.error("VelocityJS: Trying to set 'sync' to an invalid value:",b)}function M(a){var b=a[ib];if(b)return b;for(var c=a.ownerDocument.defaultView,d=0,e=0;e<gb.length;e++){var g=gb[e];f(g)?a instanceof c[g]&&(d|=1<<e):a instanceof g&&(d|=1<<e)}var h={types:d,count:0,computedStyle:null,cache:{},queueList:{},lastAnimationList:{},lastFinishList:{},window:c};return Object.defineProperty(a,ib,{value:h}),h}function N(a){var b=lb.last;a._prev=b,a._next=void 0,b?b._next=a:lb.first=a,lb.last=a,lb.firstNew||(lb.firstNew=a);var c=a.element;M(c).count++||function(a,b){a instanceof Element&&(a.classList?a.classList.add(b):(l(a,b),a.className+=(a.className.length?" ":"")+b))}(c,lb.className)}function O(a,b,c){var d=M(a);if(!1!==c&&(d.lastAnimationList[c]=b),!1===c)N(b);else{f(c)||(c="");var e=d.queueList[c];if(e){for(;e._next;)e=e._next;e._next=b,b._prev=e}else null===e?d.queueList[c]=b:(d.queueList[c]=null,N(b))}}function P(a){var b=a._next,c=a._prev,d=null==a.queue?a.options.queue:a.queue;lb.firstNew===a&&(lb.firstNew=b),lb.first===a?lb.first=b:c&&(c._next=b),lb.last===a?lb.last=c:b&&(b._prev=c),d&&M(a.element)&&(a._next=a._prev=void 0)}function Q(a){var b=a.options,c=k(a.queue,b.queue),d=k(a.loop,b.loop,cb.loop),e=k(a.repeat,b.repeat,cb.repeat),g=8&a._flags;if(g||!d&&!e){var h=a.element,i=M(h);if(--i.count||g||l(h,lb.className),b&&++b._completed===b._total){!g&&b.complete&&(function(a){var b=a.complete||a.options.complete;if(b)try{var c=a.elements;b.call(c,c,a)}catch(a){setTimeout(function(){throw a},1)}}(a),b.complete=null);var j=b._resolver;j&&(j(a.elements),delete b._resolver)}!1!==c&&(g||(i.lastFinishList[c]=a.timeStart+k(a.duration,b.duration,cb.duration)),function(a,b,c){if(!1!==b){f(b)||(b="");var d=M(a),e=d.queueList[b];e?(d.queueList[b]=e._next||null,c||N(e)):null===e&&delete d.queueList[b]}}(h,c)),P(a)}else e&&!0!==e?a.repeat=e-1:d&&!0!==d&&(a.loop=d-1,a.repeat=k(a.repeatAgain,b.repeatAgain,cb.repeatAgain)),d&&(a._flags^=64),!1!==c&&(M(a.element).lastFinishList[c]=a.timeStart+k(a.duration,b.duration,cb.duration)),a.timeStart=a.ellapsedTime=a.percentComplete=0,a._flags&=-5}function R(a){var c=a[0],d=a[1],e=a[2];if((!f(c)||window[c]instanceof Object)&&(f(c)||c instanceof Object))if(f(d))if(b(e)){var g=gb.indexOf(c),h=3;if(g<0&&!f(c))if(hb.has(c))g=gb.indexOf(hb.get(c));else for(var i in window)if(window[i]===c){(g=gb.indexOf(i))<0&&(g=gb.push(i)-1,db[g]={},hb.set(c,i));break}if(g<0&&(g=gb.push(c)-1,db[g]={}),db[g][d]=e,f(a[h])){var j=a[h++],k=eb[j];k||(k=eb[j]=[]),k.push(e)}!1===a[h]&&fb.add(d)}else console.warn("VelocityJS: Trying to set 'registerNormalization' callback to an invalid value:",d,e);else console.warn("VelocityJS: Trying to set 'registerNormalization' name to an invalid value:",d);else console.warn("VelocityJS: Trying to set 'registerNormalization' constructor to an invalid value:",c)}function S(a){var b=a[0],c=a[1],d=gb.indexOf(b);if(d<0&&!f(b))if(hb.has(b))d=gb.indexOf(hb.get(b));else for(var e in window)if(window[e]===b){d=gb.indexOf(e);break}return d>=0&&db[d].hasOwnProperty(c)}function T(a,b){for(var c=M(a),d=void 0,e=gb.length-1,f=c.types;!d&&e>=0;e--)f&1<<e&&(d=db[e][b]);return d}function U(a,b,c,d){var e=fb.has(b),f=!e&&M(a);(e||f&&f.cache[b]!==c)&&(e||(f.cache[b]=c||void 0),(d=d||T(a,b))&&d(a,c),ac.debug>=2&&console.info('Set "'+b+'": "'+c+'"',a))}function V(a){if(a.indexOf("calc(")>=0){for(var b=a.split(/([\(\)])/),c=0,d=0;d<b.length;d++){var e=b[d];switch(e){case"(":c++;break;case")":c--;break;default:c&&"0"===e[0]&&(b[d]=e.replace(/^0[a-z%]+ \+ /,""))}}return b.join("").replace(/(?:calc)?\(([0-9\.]+[a-z%]+)\)/g,"$1")}return a}function W(a){return nb[a]||(nb[a]=a.replace(/-([a-z])/g,function(a,b){return b.toUpperCase()}))}function X(a,b,c,d){return"rgba("+parseInt(b,16)+","+parseInt(c,16)+","+parseInt(d,16)+",1)"}function Y(a){return a.replace(ob,X).replace(pb,function(a,b,c,d){return X(0,b+b,c+c,d+d)}).replace(qb,function(a,b,c){return tb[c]?(b||"rgba(")+tb[c]+(b?"":",1)"):a}).replace(rb,function(a,b,c){return"rgba("+c.replace(sb,"")+(b?"":",1")+")"})}function Z(a,b,c){if("border-box"===aa(a,"boxSizing").toString().toLowerCase()===c){var d="width"===b?["Left","Right"]:["Top","Bottom"],e=["padding"+d[0],"padding"+d[1],"border"+d[0]+"Width","border"+d[1]+"Width"],f=0,g=!0,h=!1,i=void 0;try{for(var j,k=e[Symbol.iterator]();!(g=(j=k.next()).done);g=!0){var l=j.value,m=parseFloat(aa(a,l));isNaN(m)||(f+=m)}}catch(a){h=!0,i=a}finally{try{!g&&k.return&&k.return()}finally{if(h)throw i}}return c?-f:f}return 0}function $(a,b){return a.getBoundingClientRect()[b]+Z(a,b,!0)+"px"}function _(a,b){var c=M(a),d=c.computedStyle?c.computedStyle:c.window.getComputedStyle(a,null),e=0;if(c.computedStyle||(c.computedStyle=d),"none"===d.display)switch(b){case"width":case"height":return U(a,"display","auto"),e=$(a,b),U(a,"display","none"),String(e)}if((e=d[b])||(e=a.style[b]),"auto"===e)switch(b){case"width":case"height":e=$(a,b);break;case"top":case"left":case"right":case"bottom":var f=aa(a,"position");if("fixed"===f||"absolute"===f){e=a.getBoundingClientRect[b]+"px";break}default:e="0px"}return e?String(e):""}function aa(a,b,c,d){var e=M(a),f=void 0;return fb.has(b)&&(d=!0),!d&&e&&null!=e.cache[b]?f=e.cache[b]:(c=c||T(a,b))&&(f=c(a),e&&(e.cache[b]=f)),ac.debug>=2&&console.info('Get "'+b+'": "'+f+'"',a),f}function ba(a,c){var e=a.tweens=Object.create(null),g=a.elements,h=a.element,i=g.indexOf(h),j=M(h),l=k(a.queue,a.options.queue),m=k(a.options.duration,cb.duration);for(var n in c)if(c.hasOwnProperty(n)){var o=W(n),p=T(h,o),q=c[n];if(!p&&"tween"!==o){ac.debug&&console.log('Skipping "'+n+'" due to a lack of browser support.');continue}if(null==q){ac.debug&&console.log('Skipping "'+n+'" due to no value supplied.');continue}var r=e[o]={},s=void 0,t=void 0;if(r.fn=p,b(q)&&(q=q.call(h,i,g.length,g)),Array.isArray(q)){var u=q[1],v=q[2];s=q[0],f(u)&&(/^[\d-]/.test(u)||ub.test(u))||b(u)||d(u)?t=u:f(u)&&Ja[u]||Array.isArray(u)?(r.easing=F(u,m),t=v):t=u||v}else s=q;r.end=vb[void 0===s?"undefined":Ba(s)](s,h,g,i,o,r),null==t&&!1!==l&&void 0!==j.queueList[l]||(r.start=vb[void 0===t?"undefined":Ba(t)](t,h,g,i,o,r),da(o,r,m))}}function ca(a,b){for(var c=a.length,d=[],e=[],g=void 0,h=0;h<c;h++){if(!f(a[h]))return;""===a[h]?d[h]=[""]:d[h]=i(a[h].match(wb)),e[h]=0,g=g||d[h].length>1}for(var j=[],k=j.pattern=[],l=function(a){if(f(k[k.length-1]))k[k.length-1]+=a;else if(a){k.push(a);for(var b=0;b<c;b++)j[b].push(null)}},m=function(){if(!(g||k.length>1)){for(var d="display"===b,e="visibility"===b,f=0;f<c;f++){var h=a[f];j[f][0]=h,j[f].easing=F(d&&"none"===h||e&&"hidden"===h||!d&&!e?"at-end":"at-start",400)}return k[0]=!1,j}},n=!0,o=0;o<c;o++)j[o]=[];for(;n;){for(var p=[],q=[],r=void 0,s=!1,t=!1,u=0;u<c;u++){var v=e[u]++,w=d[u][v];if(!w){if(u)return;for(;u<c;u++){var x=e[u]++;if(d[u][x])return m()}n=!1;break}var y=w.match(xb);if(y){if(r)return m();var z=parseFloat(y[2]),A=y[3],B=y[1]?y[1][0]+A:void 0,C=B||A;z&&!q.includes(C)&&q.push(C),A||(z?t=!0:s=!0),p[u]=B?[z,C,!0]:[z,C]}else{if(p.length)return m();if(r){if(r!==w)return m()}else r=w}}if(r)l(r);else if(q.length)if(2===q.length&&s&&!t&&q.splice(q[0]?1:0,1),1===q.length){var D=q[0];switch(D[0]){case"+":case"-":case"*":case"/":return void(b&&console.error('Velocity: The first property must not contain a relative function "'+b+'":',a))}k.push(!1);for(var E=0;E<c;E++)j[E].push(p[E][0]);l(D)}else{l("calc(");for(var G=k.length-1,H=0;H<q.length;H++){var I=q[H],J=I[0],K="*"===J||"/"===J,L=K||"+"===J||"-"===J;K&&(k[G]+="(",l(")")),H&&l(" "+(L?J:"+")+" "),k.push(!1);for(var M=0;M<c;M++){var N=p[M],O=N[1]===I?N[0]:3===N.length?j[M-1][j[M-1].length-1]:K?1:0;j[M].push(O)}l(L?I.substring(1):I)}l(")")}}for(var P=0,Q=0;P<k.length;P++){var R=k[P];f(R)?Q&&R.indexOf(",")>=0?Q++:R.indexOf("rgb")>=0&&(Q=1):Q&&(Q<4?k[P]=!0:Q=0)}return j}function da(a,b,c,d){var e=b.start,g=b.end;if(f(g)&&f(e)){var h=ca([e,g],a);if(!h&&d){var i=e.match(/\d\.?\d*/g)||["0"],j=i.length,k=0;h=ca([g.replace(/\d+\.?\d*/g,function(){return i[k++%j]}),g],a)}if(h)switch(ac.debug&&console.log("Velocity: Sequence found:",h),h[0].percent=0,h[1].percent=1,b.sequence=h,b.easing){case Ja["at-start"]:case Ja.during:case Ja["at-end"]:h[0].easing=h[1].easing=b.easing}}}function ea(a){if(lb.firstNew===a&&(lb.firstNew=a._next),!(1&a._flags)){var b=a.element,c=a.tweens;k(a.options.duration,cb.duration);for(var d in c){var e=c[d];if(null==e.start){var g=aa(a.element,d);f(g)?(e.start=Y(g),da(d,e,0,!0)):Array.isArray(g)||console.warn("bad type",e,d,g)}ac.debug&&console.log('tweensContainer "'+d+'": '+JSON.stringify(e),b)}a._flags|=1}}function fa(a){var b=a.begin||a.options.begin;if(b)try{var c=a.elements;b.call(c,c,a)}catch(a){setTimeout(function(){throw a},1)}}function ga(a){var b=a.progress||a.options.progress;if(b)try{var c=a.elements,d=a.percentComplete,e=a.options,f=a.tween;b.call(c,c,d,Math.max(0,a.timeStart+(null!=a.duration?a.duration:null!=e.duration?e.duration:cb.duration)-Gb),void 0!==f?f:String(100*d),a)}catch(a){setTimeout(function(){throw a},1)}}function ha(){var a=!0,b=!1,c=void 0;try{for(var d,e=Ab[Symbol.iterator]();!(a=(d=e.next()).done);a=!0)ga(d.value)}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}Ab.clear();var f=!0,g=!1,h=void 0;try{for(var i,j=zb[Symbol.iterator]();!(f=(i=j.next()).done);f=!0)Q(i.value)}catch(a){g=!0,h=a}finally{try{!f&&j.return&&j.return()}finally{if(g)throw h}}zb.clear()}function ia(a){if(!Eb){if(Eb=!0,!1!==a){var b=Bb.now(),c=Gb?b-Gb:yb,d=cb.speed,e=cb.easing,f=cb.duration,g=void 0,h=void 0;if(c>=cb.minFrameTime||!Gb){for(Gb=b;lb.firstNew;)ea(lb.firstNew);for(g=lb.first;g&&g!==lb.firstNew;g=g._next){var i=g.element,j=M(i);if(i.parentNode&&j){var k=g.options,l=g._flags,m=g.timeStart;if(!m){var n=null!=g.queue?g.queue:k.queue;m=b-c,!1!==n&&(m=Math.max(m,j.lastFinishList[n]||0)),g.timeStart=m}16&l?g.timeStart+=c:2&l||(g._flags|=2,k._ready++)}else P(g)}for(g=lb.first;g&&g!==lb.firstNew;g=h){var p=g._flags;if(h=g._next,2&p&&!(16&p)){var q=g.options;if(32&p&&q._ready<q._total)g.timeStart+=c;else{var r=null!=g.speed?g.speed:null!=q.speed?q.speed:d,s=g.timeStart;if(!(4&p)){var t=null!=g.delay?g.delay:q.delay;if(t){if(s+t/r>b)continue;g.timeStart=s+=t/(t>0?r:1)}g._flags|=4,0==q._started++&&(q._first=g,q.begin&&(fa(g),q.begin=void 0))}1!==r&&(g.timeStart=s+=Math.min(c,b-s)*(1-r));var u=null!=g.easing?g.easing:null!=q.easing?q.easing:e,v=g.ellapsedTime=b-s,w=null!=g.duration?g.duration:null!=q.duration?q.duration:f,x=g.percentComplete=ac.mock?1:Math.min(v/w,1),y=g.tweens,z=64&p;for(var A in(g.progress||q._first===g&&q.progress)&&Ab.add(g),1===x&&zb.add(g),y){var B=y[A],C=B.sequence,D=C.pattern,E="",F=0;if(D){for(var G=(B.easing||u)(x,0,1,A),H=0,I=0;I<C.length-1;I++)C[I].percent<G&&(H=I);for(var J=C[H],K=C[H+1]||J,L=(x-J.percent)/(K.percent-J.percent),N=z?1-L:L,O=K.easing||u||o;F<D.length;F++){var Q=J[F];if(null==Q)E+=D[F];else{var R=K[F];if(Q===R)E+=Q;else{var S=O(N,Q,R,A);E+=!0!==D[F]?S:Math.round(S)}}}"tween"!==A?(1===x&&(E=V(E)),U(g.element,A,E,B.fn)):g.tween=E}else console.warn("VelocityJS: Missing pattern:",A,JSON.stringify(B[A])),delete y[A]}}}}(Ab.size||zb.size)&&(document.hidden?Fb?Fb.postMessage(""):setTimeout(ha,1):ha())}}lb.first?(lb.isTicking=!0,document.hidden?Fb?!1===a&&Fb.postMessage(!0):Cb(ia):Db(ia)):(lb.isTicking=!1,Gb=0,document.hidden&&Fb&&Fb.postMessage(!1)),Eb=!1}}function ja(a,b,c){if(ea(a),void 0===b||b===k(a.queue,a.options.queue,c)){if(!(4&a._flags)){var d=a.options;0==d._started++&&(d._first=a,d.begin&&(fa(a),d.begin=void 0)),a._flags|=4}for(var e in a.tweens){var f=a.tweens[e],g=f.sequence,h=g.pattern,i="",j=0;if(h)for(var l=g[g.length-1];j<h.length;j++){var m=l[j];i+=null==m?h[j]:m}U(a.element,e,i,f.fn)}Q(a)}}function ka(a,b,c,d){void 0!==b&&b!==k(a.queue,a.options.queue,c)||(d?a._flags|=16:a._flags&=-17)}function la(a,b,c,d){var e=0===d.indexOf("pause"),f="false"!==(d.indexOf(".")>=0?d.replace(/^.*\./,""):void 0)&&I(a[0]),h=cb.queue;if(g(b)&&b.velocity.animations){var i=!0,j=!1,k=void 0;try{for(var l,m=b.velocity.animations[Symbol.iterator]();!(i=(l=m.next()).done);i=!0)ka(l.value,f,h,e)}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}}else for(var n=lb.first;n;)b&&!b.includes(n.element)||ka(n,f,h,e),n=n._next;c&&(g(b)&&b.velocity.animations&&b.then?b.then(c._resolver):c._resolver(b))}function ma(a,b,c,h){var i=a[0],j=a[1];if(!i)return console.warn("VelocityJS: Cannot access a non-existant property!"),null;if(void 0===j&&!e(i)){if(Array.isArray(i)){if(1===b.length){var k={},l=!0,m=!1,n=void 0;try{for(var o,p=i[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){var q=o.value;k[q]=Y(aa(b[0],q))}}catch(a){m=!0,n=a}finally{try{!l&&p.return&&p.return()}finally{if(m)throw n}}return k}var r=[],s=!0,t=!1,u=void 0;try{for(var v,w=b[Symbol.iterator]();!(s=(v=w.next()).done);s=!0){var x=v.value,y={},z=!0,A=!1,B=void 0;try{for(var C,D=i[Symbol.iterator]();!(z=(C=D.next()).done);z=!0){var E=C.value;y[E]=Y(aa(x,E))}}catch(a){A=!0,B=a}finally{try{!z&&D.return&&D.return()}finally{if(A)throw B}}r.push(y)}}catch(a){t=!0,u=a}finally{try{!s&&w.return&&w.return()}finally{if(t)throw u}}return r}if(1===b.length)return Y(aa(b[0],i));var F=[],G=!0,H=!1,I=void 0;try{for(var J,K=b[Symbol.iterator]();!(G=(J=K.next()).done);G=!0){var L=J.value;F.push(Y(aa(L,i)))}}catch(a){H=!0,I=a}finally{try{!G&&K.return&&K.return()}finally{if(H)throw I}}return F}var M=[];if(e(i)){for(var N in i)if(i.hasOwnProperty(N)){var O=!0,P=!1,Q=void 0;try{for(var R,S=b[Symbol.iterator]();!(O=(R=S.next()).done);O=!0){var T=R.value,V=i[N];f(V)||d(V)?U(T,N,i[N]):(M.push('Cannot set a property "'+N+'" to an unknown type: '+(void 0===V?"undefined":Ba(V))),console.warn('VelocityJS: Cannot set a property "'+N+'" to an unknown type:',V))}}catch(a){P=!0,Q=a}finally{try{!O&&S.return&&S.return()}finally{if(P)throw Q}}}}else if(f(j)||d(j)){var W=!0,X=!1,Z=void 0;try{for(var $,_=b[Symbol.iterator]();!(W=($=_.next()).done);W=!0)U($.value,i,String(j))}catch(a){X=!0,Z=a}finally{try{!W&&_.return&&_.return()}finally{if(X)throw Z}}}else M.push('Cannot set a property "'+i+'" to an unknown type: '+(void 0===j?"undefined":Ba(j))),console.warn('VelocityJS: Cannot set a property "'+i+'" to an unknown type:',j);c&&(M.length?c._rejecter(M.join(", ")):g(b)&&b.velocity.animations&&b.then?b.then(c._resolver):c._resolver(b))}function na(a,b,c){ea(a),void 0!==b&&b!==k(a.queue,a.options.queue,c)||(a._flags|=8,Q(a))}function oa(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}function pa(a){return 1-oa(1-a)}function qa(a,b){return function(c,d){if(void 0===d)return Z(c,a,b)+"px";U(c,a,parseFloat(d)-Z(c,a,b)+"px")}}function ra(a,b){return function(c,d){if(null==d)return aa(c,"client"+a,null,!0),aa(c,"scroll"+a,null,!0),c["scroll"+b]+"px";var e=parseFloat(d);switch(d.replace(String(e),"")){case"":case"px":c["scroll"+b]=e;break;case"%":var f=parseFloat(aa(c,"client"+a)),g=parseFloat(aa(c,"scroll"+a));c["scroll"+b]=Math.max(0,g-f)*e/100}}}function sa(a,b){return function(c,d){if(void 0===d)return _(c,a)||_(c,b);c.style[a]=c.style[b]=d}}function ta(a){return function(b,c){if(void 0===c)return _(b,a);b.style[a]=c}}function ua(a){return function(b,c){if(void 0===c)return b.getAttribute(a);b.setAttribute(a,c)}}function va(a){return function(b,c){if(void 0===c)try{return b.getBBox()[a]+"px"}catch(a){return"0px"}b.setAttribute(a,c)}}function wa(a,b){var c=a.tweens=Object.create(null),d=a.element;for(var e in b.tweens)if(b.tweens.hasOwnProperty(e)){var f=T(d,e);if(!f&&"tween"!==e){ac.debug&&console.log("Skipping ["+e+"] due to a lack of browser support.");continue}c[e]={fn:f,sequence:b.tweens[e]}}}function xa(a,b){j(b,"promise",a),j(b,"then",a.then.bind(a)),j(b,"catch",a.catch.bind(a)),a.finally&&j(b,"finally",a.finally.bind(a))}function ya(){for(var l=arguments.length,m=Array(l),n=0;n<l;n++)m[n]=arguments[n];var o=cb,p=arguments,q=p[0],r=e(q)&&(q.p||e(q.properties)&&!q.properties.names||f(q.properties)),s=0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0;c(this)?t=[this]:h(this)?(t=i(this),g(this)&&(w=this.velocity.animations)):r?(t=i(q.elements||q.e),s++):c(q)?(t=i([q]),s++):h(q)&&(t=i(q),s++),t&&(j(t,"velocity",ya.bind(t)),w&&j(t.velocity,"animations",w));var A="reverse"===(u=r?k(q.properties,q.p):p[s++]),G=!A&&f(u),N=G&&mb[u],P=r?k(q.options,q.o):p[s];if(e(P)&&(v=P),gc&&k(v&&v.promise,o.promise)&&(x=new gc(function(a,b){z=b,y=function(b){g(b)&&b.promise?(delete b.then,delete b.catch,delete b.finally,a(b),xa(b.promise,b)):a(b)}}),t&&xa(x,t)),x){var Q=v&&v.promiseRejectEmpty,R=k(Q,o.promiseRejectEmpty)
;t||G?u||(R?z("Velocity: No properties supplied"+(a(Q)?"":ic)+". Aborting."):y()):R?z("Velocity: No elements supplied"+(a(Q)?"":ic)+". Aborting."):y()}if(!t&&!G||!u)return x;if(G){for(var S=[],T=x&&{_promise:x,_resolver:y,_rejecter:z};s<p.length;)S.push(p[s++]);var U=u.replace(/\..*$/,""),V=Ga[U];if(V){var W=V(S,t,T,u);return void 0!==W?W:t||x}if(!N)return void console.error("VelocityJS: First argument ("+u+") was not a property map, a known action, or a registered redirect. Aborting.")}var X=void 0;if(e(u)||A||N){var Y={},Z=o.sync;if(x&&(j(Y,"_promise",x),j(Y,"_rejecter",z),j(Y,"_resolver",y)),j(Y,"_ready",0),j(Y,"_started",0),j(Y,"_completed",0),j(Y,"_total",0),e(v)){var $=E(v.duration);X=void 0!==$,Y.duration=k($,o.duration),Y.delay=k(D(v.delay),o.delay),Y.easing=F(k(v.easing,o.easing),Y.duration)||F(o.easing,Y.duration),Y.loop=k(H(v.loop),o.loop),Y.repeat=Y.repeatAgain=k(J(v.repeat),o.repeat),null!=v.speed&&(Y.speed=k(K(v.speed),1)),a(v.promise)&&(Y.promise=v.promise),Y.queue=k(I(v.queue),o.queue),v.mobileHA&&!lb.isGingerbread&&(Y.mobileHA=!0),!0===v.drag&&(Y.drag=!0),(d(v.stagger)||b(v.stagger))&&(Y.stagger=v.stagger),A||(null!=v.display&&(u.display=v.display,console.error('Deprecated "options.display" used, this is now a property:',v.display)),null!=v.visibility&&(u.visibility=v.visibility,console.error('Deprecated "options.visibility" used, this is now a property:',v.visibility)));var _=B(v.begin),aa=C(v.complete),ca=function(a){if(b(a))return a;null!=a&&console.warn("VelocityJS: Trying to set 'progress' to an invalid value:",a)}(v.progress),da=L(v.sync);null!=_&&(Y.begin=_),null!=aa&&(Y.complete=aa),null!=ca&&(Y.progress=ca),null!=da&&(Z=da)}else if(!r){var ea=0;if(Y.duration=E(p[s],!0),void 0===Y.duration?Y.duration=o.duration:(X=!0,ea++),!b(p[s+ea])){var fa=F(p[s+ea],k(Y&&E(Y.duration),o.duration),!0);void 0!==fa&&(ea++,Y.easing=fa)}var ga=C(p[s+ea],!0);void 0!==ga&&(Y.complete=ga),Y.delay=o.delay,Y.loop=o.loop,Y.repeat=Y.repeatAgain=o.repeat}if(A&&!1===Y.queue)throw new Error("VelocityJS: Cannot reverse a queue:false animation.");!X&&N&&N.duration&&(Y.duration=N.duration);var ha={options:Y,elements:t,_prev:void 0,_next:void 0,_flags:Z?32:0,percentComplete:0,ellapsedTime:0,timeStart:0};w=[];for(var ja=0;ja<t.length;ja++){var ka=t[ja],la=0;if(c(ka)){if(A){var ma=M(ka).lastAnimationList[Y.queue];if(!(u=ma&&ma.tweens)){console.error("VelocityJS: Attempting to reverse an animation on an element with no previous animation:",ka);continue}la|=64&~(64&ma._flags)}var na=Object.assign({},ha,{element:ka,_flags:ha._flags|la});if(Y._total++,w.push(na),Y.stagger)if(b(Y.stagger)){var oa=za(Y.stagger,ka,ja,t.length,t,"stagger");d(oa)&&(na.delay=Y.delay+oa)}else na.delay=Y.delay+Y.stagger*ja;Y.drag&&(na.duration=Y.duration-Y.duration*Math.max(1-(ja+1)/t.length,.75)),N?wa(na,N):A?na.tweens=u:(na.tweens=Object.create(null),ba(na,u)),O(ka,na,Y.queue)}}!1===lb.isTicking&&ia(!1),w&&j(t.velocity,"animations",w)}return t||x}function za(a,b,c,d,e,f){try{return a.call(b,c,d,e,f)}catch(a){console.error("VelocityJS: Exception when calling '"+f+"' callback:",a)}}function Aa(a,b){try{j(a,(b?"V":"v")+"elocity",ya)}catch(a){console.warn("VelocityJS: Error when trying to add prototype.",a)}}var Ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ca=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},Da=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Ea=function(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},Fa=Date.now?Date.now:function(){return(new Date).getTime()},Ga={};m(["registerAction",m],!0);var Ha=400,Ia={fast:200,normal:400,slow:600},Ja={};m(["registerEasing",n],!0),n(["linear",o]),n(["swing",function(a,b,c){return b+(.5-Math.cos(a*Math.PI)/2)*(c-b)}]),n(["spring",function(a,b,c){return b+(1-Math.cos(4.5*a*Math.PI)*Math.exp(6*-a))*(c-b)}]);var Ka=v(.42,0,1,1),La=v(0,0,.58,1),Ma=v(.42,0,.58,1);n(["ease",v(.25,.1,.25,1)]),n(["easeIn",Ka]),n(["ease-in",Ka]),n(["easeOut",La]),n(["ease-out",La]),n(["easeInOut",Ma]),n(["ease-in-out",Ma]),n(["easeInSine",v(.47,0,.745,.715)]),n(["easeOutSine",v(.39,.575,.565,1)]),n(["easeInOutSine",v(.445,.05,.55,.95)]),n(["easeInQuad",v(.55,.085,.68,.53)]),n(["easeOutQuad",v(.25,.46,.45,.94)]),n(["easeInOutQuad",v(.455,.03,.515,.955)]),n(["easeInCubic",v(.55,.055,.675,.19)]),n(["easeOutCubic",v(.215,.61,.355,1)]),n(["easeInOutCubic",v(.645,.045,.355,1)]),n(["easeInQuart",v(.895,.03,.685,.22)]),n(["easeOutQuart",v(.165,.84,.44,1)]),n(["easeInOutQuart",v(.77,0,.175,1)]),n(["easeInQuint",v(.755,.05,.855,.06)]),n(["easeOutQuint",v(.23,1,.32,1)]),n(["easeInOutQuint",v(.86,0,.07,1)]),n(["easeInExpo",v(.95,.05,.795,.035)]),n(["easeOutExpo",v(.19,1,.22,1)]),n(["easeInOutExpo",v(1,0,0,1)]),n(["easeInCirc",v(.6,.04,.98,.335)]),n(["easeOutCirc",v(.075,.82,.165,1)]),n(["easeInOutCirc",v(.785,.135,.15,.86)]);var Na={},Oa=void 0,Pa=void 0,Qa=void 0,Ra=void 0,Sa=void 0,Ta=void 0,Ua=void 0,Va=void 0,Wa=void 0,Xa=void 0,Ya=void 0,Za=void 0,$a=void 0,_a=void 0,ab=void 0,bb=void 0,cb=function(){function b(){Ca(this,b)}return Da(b,null,[{key:"reset",value:function(){Oa=!0,Pa=void 0,Qa=void 0,Ra=0,Sa=Ha,Ta=F("swing",Ha),Ua=60,Va=0,Xa=980/60,Ya=!0,Za=!0,$a="",_a=0,ab=1,bb=!0}},{key:"cache",get:function(){return Oa},set:function(a){void 0!==(a=A(a))&&(Oa=a)}},{key:"begin",get:function(){return Pa},set:function(a){void 0!==(a=B(a))&&(Pa=a)}},{key:"complete",get:function(){return Qa},set:function(a){void 0!==(a=C(a))&&(Qa=a)}},{key:"delay",get:function(){return Ra},set:function(a){void 0!==(a=D(a))&&(Ra=a)}},{key:"duration",get:function(){return Sa},set:function(a){void 0!==(a=E(a))&&(Sa=a)}},{key:"easing",get:function(){return Ta},set:function(a){void 0!==(a=F(a,Sa))&&(Ta=a)}},{key:"fpsLimit",get:function(){return Ua},set:function(a){void 0!==(a=G(a))&&(Ua=a,Xa=980/a)}},{key:"loop",get:function(){return Va},set:function(a){void 0!==(a=H(a))&&(Va=a)}},{key:"mobileHA",get:function(){return Wa},set:function(b){a(b)&&(Wa=b)}},{key:"minFrameTime",get:function(){return Xa}},{key:"promise",get:function(){return Ya},set:function(b){void 0!==(b=function(b){if(a(b))return b;null!=b&&console.warn("VelocityJS: Trying to set 'promise' to an invalid value:",b)}(b))&&(Ya=b)}},{key:"promiseRejectEmpty",get:function(){return Za},set:function(b){void 0!==(b=function(b){if(a(b))return b;null!=b&&console.warn("VelocityJS: Trying to set 'promiseRejectEmpty' to an invalid value:",b)}(b))&&(Za=b)}},{key:"queue",get:function(){return $a},set:function(a){void 0!==(a=I(a))&&($a=a)}},{key:"repeat",get:function(){return _a},set:function(a){void 0!==(a=J(a))&&(_a=a)}},{key:"repeatAgain",get:function(){return _a}},{key:"speed",get:function(){return ab},set:function(a){void 0!==(a=K(a))&&(ab=a)}},{key:"sync",get:function(){return bb},set:function(a){void 0!==(a=L(a))&&(bb=a)}}]),b}();Object.freeze(cb),cb.reset();var db=[],eb={},fb=new Set,gb=[],hb=new Map,ib="velocityData",jb=window&&window===window.window,kb=jb&&void 0!==window.pageYOffset,lb={isClient:jb,isMobile:jb&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isGingerbread:jb&&/Android 2\.3\.[3-7]/i.test(navigator.userAgent),prefixElement:jb&&document.createElement("div"),windowScrollAnchor:kb,scrollAnchor:kb?window:!jb||document.documentElement||document.body.parentNode||document.body,scrollPropertyLeft:kb?"pageXOffset":"scrollLeft",scrollPropertyTop:kb?"pageYOffset":"scrollTop",className:"velocity-animating",isTicking:!1,first:void 0,last:void 0,firstNew:void 0},mb={};m(["registerNormalization",R]),m(["hasNormalization",S]);var nb={},ob=/#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})/gi,pb=/#([a-f\d])([a-f\d])([a-f\d])/gi,qb=/(rgba?\(\s*)?(\b[a-z]+\b)/g,rb=/rgb(a?)\(([^\)]+)\)/gi,sb=/\s+/g,tb={},ub=/^#([A-f\d]{3}){1,2}$/i,vb={function:function(a,b,c,d,e,f){return a.call(b,d,c.length,e)},number:function(a,b,c,d,e,f){return String(a)+function(a){for(var b in eb)if(eb[b].includes(a))return b;return""}(f.fn)},string:function(a,b,c,d,e,f){return Y(a)},undefined:function(a,b,c,d,e,f){return Y(aa(b,e,f.fn)||"")}},wb=/((?:[+\-*\/]=)?(?:[+-]?\d*\.\d+|[+-]?\d+)[a-z%]*|(?:.(?!$|[+-]?\d|[+\-*\/]=[+-]?\d))+.|.)/g,xb=/^([+\-*\/]=)?([+-]?\d*\.\d+|[+-]?\d+)(.*)$/,yb=1e3/60,zb=new Set,Ab=new Set,Bb=function(){var a=window.performance||{};if("function"!=typeof a.now){var b=a.timing&&a.timing.navigationStart?a.timing.navigationStart:Fa();a.now=function(){return Fa()-b}}return a}(),Cb=function(a){return setTimeout(a,Math.max(0,yb-(Bb.now()-Gb)))},Db=window.requestAnimationFrame||Cb,Eb=void 0,Fb=void 0,Gb=0;try{(Fb=new Worker(URL.createObjectURL(new Blob(["("+function(){var a=this,b=void 0;this.onmessage=function(c){switch(c.data){case!0:b||(b=setInterval(function(){a.postMessage(!0)},1e3/30));break;case!1:b&&(clearInterval(b),b=0);break;default:a.postMessage(c.data)}}}+")()"])))).onmessage=function(a){!0===a.data?ia():ha()},lb.isMobile||void 0===document.hidden||document.addEventListener("visibilitychange",function(){Fb.postMessage(lb.isTicking&&document.hidden)})}catch(Ba){}m(["finish",function(a,b,c){var d=I(a[0],!0),e=cb.queue,f=!0===a[void 0===d?0:1];if(g(b)&&b.velocity.animations){var h=!0,i=!1,j=void 0;try{for(var k,l=b.velocity.animations[Symbol.iterator]();!(h=(k=l.next()).done);h=!0)ja(k.value,d,e)}catch(a){i=!0,j=a}finally{try{!h&&l.return&&l.return()}finally{if(i)throw j}}}else{for(;lb.firstNew;)ea(lb.firstNew);for(var m,n=lb.first;n&&(f||n!==lb.firstNew);n=m||lb.firstNew)m=n._next,b&&!b.includes(n.element)||ja(n,d,e)}c&&(g(b)&&b.velocity.animations&&b.then?b.then(c._resolver):c._resolver(b))}],!0);var Hb={isExpanded:1,isReady:2,isStarted:4,isStopped:8,isPaused:16,isSync:32,isReverse:64};m(["option",function(a,b,c,d){var e=a[0],f=d.indexOf(".")>=0?d.replace(/^.*\./,""):void 0,h="false"!==f&&I(f,!0),i=void 0,j=a[1];if(!e)return console.warn("VelocityJS: Cannot access a non-existant key!"),null;if(g(b)&&b.velocity.animations)i=b.velocity.animations;else{i=[];for(var l=lb.first;l;l=l._next)b.indexOf(l.element)>=0&&k(l.queue,l.options.queue)===h&&i.push(l);if(b.length>1&&i.length>1){for(var m=1,n=i[0].options;m<i.length;)if(i[m++].options!==n){n=null;break}n&&(i=[i[0]])}}if(void 0===j){var o=[],p=Hb[e],q=!0,r=!1,s=void 0;try{for(var t,u=i[Symbol.iterator]();!(q=(t=u.next()).done);q=!0){var v=t.value;void 0===p?o.push(k(v[e],v.options[e])):o.push(0==(v._flags&p))}}catch(a){r=!0,s=a}finally{try{!q&&u.return&&u.return()}finally{if(r)throw s}}return 1===b.length&&1===i.length?o[0]:o}var w=void 0;switch(e){case"cache":j=A(j);break;case"begin":j=B(j);break;case"complete":j=C(j);break;case"delay":j=D(j);break;case"duration":j=E(j);break;case"fpsLimit":j=G(j);break;case"loop":j=H(j);break;case"percentComplete":w=!0,j=parseFloat(j);break;case"repeat":case"repeatAgain":j=J(j);break;default:if("_"!==e[0]){var x=parseFloat(j);j===String(x)&&(j=x);break}case"queue":case"promise":case"promiseRejectEmpty":case"easing":case"started":return void console.warn("VelocityJS: Trying to set a read-only key:",e)}if(void 0===j||j!=j)return console.warn("VelocityJS: Trying to set an invalid value:"+e+"="+j+" ("+a[1]+")"),null;var y=!0,z=!1,F=void 0;try{for(var K,L=i[Symbol.iterator]();!(y=(K=L.next()).done);y=!0){var M=K.value;w?M.timeStart=Gb-k(M.duration,M.options.duration,cb.duration)*j:M[e]=j}}catch(a){z=!0,F=a}finally{try{!y&&L.return&&L.return()}finally{if(z)throw F}}c&&(g(b)&&b.velocity.animations&&b.then?b.then(c._resolver):c._resolver(b))}],!0),m(["pause",la],!0),m(["resume",la],!0),m(["property",ma],!0),m(["reverse",function(a,b,c,d){throw new SyntaxError("VelocityJS: The 'reverse' action is built in and private.")}],!0),m(["stop",function(a,b,c,d){var e=I(a[0],!0),f=cb.queue,h=!0===a[void 0===e?0:1];if(g(b)&&b.velocity.animations){var i=!0,j=!1,k=void 0;try{for(var l,m=b.velocity.animations[Symbol.iterator]();!(i=(l=m.next()).done);i=!0)na(l.value,e,f)}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}}else{for(;lb.firstNew;)ea(lb.firstNew);for(var n,o=lb.first;o&&(h||o!==lb.firstNew);o=n||lb.firstNew)n=o._next,b&&!b.includes(o.element)||na(o,e,f)}c&&(g(b)&&b.velocity.animations&&b.then?b.then(c._resolver):c._resolver(b))}],!0),m(["style",ma],!0),m(["tween",function(a,b,c,g){var h=void 0;if(b){if(1!==b.length)throw new Error("VelocityJS: Cannot tween more than one element!")}else{if(!a.length)return console.info('Velocity(<element>, "tween", percentComplete, property, end | [end, <easing>, <start>], <easing>) => value\nVelocity(<element>, "tween", percentComplete, {property: end | [end, <easing>, <start>], ...}, <easing>) => {property: value, ...}'),null;b=[document.body],h=!0}var i=a[0],j={elements:b,element:b[0],queue:!1,options:{duration:1e3},tweens:null},l={},m=a[1],n=void 0,p=void 0,q=a[2],r=0;if(f(a[1])?mb&&mb[a[1]]?(p=mb[a[1]],m={},q=a[2]):(n=!0,m=Ea({},a[1],a[2]),q=a[3]):Array.isArray(a[1])&&(n=!0,m={tween:a[1]},q=a[2]),!d(i)||i<0||i>1)throw new Error("VelocityJS: Must tween a percentage from 0 to 1!");if(!e(m))throw new Error("VelocityJS: Cannot tween an invalid property!");if(h)for(var s in m)if(m.hasOwnProperty(s)&&(!Array.isArray(m[s])||m[s].length<2))throw new Error("VelocityJS: When not supplying an element you must force-feed values: "+s);var t=F(k(q,cb.easing),Ha);for(var u in p?wa(j,p):ba(j,m),j.tweens){var v=j.tweens[u],w=v.sequence,x=w.pattern,y="",z=0;if(r++,x){for(var A=(v.easing||t)(i,0,1,u),B=0,C=0;C<w.length-1;C++)w[C].percent<A&&(B=C);for(var D=w[B],E=w[B+1]||D,G=(i-D.percent)/(E.percent-D.percent),H=E.easing||o;z<x.length;z++){var I=D[z];if(null==I)y+=x[z];else{var J=E[z];if(I===J)y+=I;else{var K=H(G,I,J,u);y+=!0===x[z]?Math.round(K):K}}}l[u]=y}}if(n&&1===r)for(var L in l)if(l.hasOwnProperty(L))return l[L];return l}],!0);var Ib={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};for(var Jb in Ib)if(Ib.hasOwnProperty(Jb)){var Kb=Ib[Jb];tb[Jb]=Math.floor(Kb/65536)+","+Math.floor(Kb/256%256)+","+Kb%256}!function(a,b){n([a,function(a,c,d){return 0===a?c:1===a?d:Math.pow(a,2)*((b+1)*a-b)*(d-c)}])}("easeInBack",1.7),function(a,b){n([a,function(a,c,d){return 0===a?c:1===a?d:(Math.pow(--a,2)*((b+1)*a+b)+1)*(d-c)}])}("easeOutBack",1.7),function(a,b){b*=1.525,n([a,function(a,c,d){return 0===a?c:1===a?d:.5*((a*=2)<1?Math.pow(a,2)*((b+1)*a-b):Math.pow(a-2,2)*((b+1)*(a-2)+b)+2)*(d-c)}])}("easeInOutBack",1.7),n(["easeInBounce",function(a,b,c){return 0===a?b:1===a?c:pa(a)*(c-b)}]),n(["easeOutBounce",function(a,b,c){return 0===a?b:1===a?c:oa(a)*(c-b)}]),n(["easeInOutBounce",function(a,b,c){return 0===a?b:1===a?c:(a<.5?.5*pa(2*a):.5*oa(2*a-1)+.5)*(c-b)}]);var Lb=2*Math.PI;!function(a,b,c){n([a,function(a,d,e){return 0===a?d:1===a?e:-b*Math.pow(2,10*(a-=1))*Math.sin((a-c/Lb*Math.asin(1/b))*Lb/c)*(e-d)}])}("easeInElastic",1,.3),function(a,b,c){n([a,function(a,d,e){return 0===a?d:1===a?e:(b*Math.pow(2,-10*a)*Math.sin((a-c/Lb*Math.asin(1/b))*Lb/c)+1)*(e-d)}])}("easeOutElastic",1,.3),function(a,b,c){n([a,function(a,d,e){if(0===a)return d;if(1===a)return e;var f=c/Lb*Math.asin(1/b);return((a=2*a-1)<0?b*Math.pow(2,10*a)*Math.sin((a-f)*Lb/c)*-.5:b*Math.pow(2,-10*a)*Math.sin((a-f)*Lb/c)*.5+1)*(e-d)}])}("easeInOutElastic",1,.3*1.5),n(["at-start",function(a,b,c){return 0===a?b:c}]),n(["during",function(a,b,c){return 0===a||1===a?b:c}]),n(["at-end",function(a,b,c){return 1===a?c:b}]),R(["Element","innerWidth",qa("width",!0)]),R(["Element","innerHeight",qa("height",!0)]),R(["Element","outerWidth",qa("width",!1)]),R(["Element","outerHeight",qa("height",!1)]);var Mb=/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|let|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i,Nb=/^(li)$/i,Ob=/^(tr)$/i,Pb=/^(table)$/i,Qb=/^(tbody)$/i;R(["Element","display",function(a,b){var c=a.style;if(void 0===b)return _(a,"display");if("auto"===b){var d=a&&a.nodeName,e=M(a);b=Mb.test(d)?"inline":Nb.test(d)?"list-item":Ob.test(d)?"table-row":Pb.test(d)?"table":Qb.test(d)?"table-row-group":"block",e.cache.display=b}c.display=b}]),R(["HTMLElement","scroll",ra("Height","Top"),!1]),R(["HTMLElement","scrollTop",ra("Height","Top"),!1]),R(["HTMLElement","scrollLeft",ra("Width","Left"),!1]),R(["HTMLElement","scrollWidth",function(a,b){if(null==b)return a.scrollWidth+"px"}]),R(["HTMLElement","clientWidth",function(a,b){if(null==b)return a.clientWidth+"px"}]),R(["HTMLElement","scrollHeight",function(a,b){if(null==b)return a.scrollHeight+"px"}]),R(["HTMLElement","clientHeight",function(a,b){if(null==b)return a.clientHeight+"px"}]);var Rb=/^(b(lockSize|o(rder(Bottom(LeftRadius|RightRadius|Width)|Image(Outset|Width)|LeftWidth|R(adius|ightWidth)|Spacing|Top(LeftRadius|RightRadius|Width)|Width)|ttom))|column(Gap|RuleWidth|Width)|f(lexBasis|ontSize)|grid(ColumnGap|Gap|RowGap)|height|inlineSize|le(ft|tterSpacing)|m(a(rgin(Bottom|Left|Right|Top)|x(BlockSize|Height|InlineSize|Width))|in(BlockSize|Height|InlineSize|Width))|o(bjectPosition|utline(Offset|Width))|p(adding(Bottom|Left|Right|Top)|erspective)|right|s(hapeMargin|troke(Dashoffset|Width))|t(extIndent|op|ransformOrigin)|w(idth|ordSpacing))$/,Sb=/^(webkit|moz|ms|o)[A-Z]/,Tb=lb.prefixElement;if(Tb)for(var Ub in Tb.style)if(Sb.test(Ub)){var Vb=Ub.replace(/^[a-z]+([A-Z])/,function(a,b){return b.toLowerCase()}),Wb=Rb.test(Vb)?"px":void 0;R(["Element",Vb,sa(Ub,Vb),Wb])}else if(!S(["Element",Ub])){var Xb=Rb.test(Ub)?"px":void 0;R(["Element",Ub,ta(Ub),Xb])}var Yb=document.createElement("div"),Zb=/^SVG(.*)Element$/,$b=/Element$/;Object.getOwnPropertyNames(window).forEach(function(a){var c=Zb.exec(a);if(c&&"SVG"!==c[1])try{var d=c[1]?document.createElementNS("http://www.w3.org/2000/svg",(c[1]||"svg").toLowerCase()):document.createElement("svg");for(var e in d){var g=d[e];!f(e)||"o"===e[0]&&"n"===e[1]||e===e.toUpperCase()||$b.test(e)||e in Yb||b(g)||R([a,e,ua(e)])}}catch(c){console.error("VelocityJS: Error when trying to identify SVG attributes on "+a+".",c)}}),R(["SVGElement","width",va("width")]),R(["SVGElement","height",va("height")]),R(["Element","tween",function(a,b){if(void 0===b)return""}]);var _b,ac=ya;if(function(a){a.Actions=Ga,a.Easings=Ja,a.Sequences=mb,a.State=lb,a.defaults=cb,a.patch=Aa,a.debug=!1,a.mock=!1,a.version="2.0.5",a.Velocity=ya}(_b||(_b={})),function(){if(document.documentMode)return document.documentMode;for(var a=7;a>4;a--){var b=document.createElement("div");if(b.innerHTML="\x3c!--[if IE "+a+"]><span></span><![endif]--\x3e",b.getElementsByTagName("span").length)return b=null,a}}()<=8)throw new Error("VelocityJS cannot run on Internet Explorer 8 or earlier");if(window){var bc=window.jQuery,cc=window.Zepto;Aa(window,!0),Aa(Element&&Element.prototype),Aa(NodeList&&NodeList.prototype),Aa(HTMLCollection&&HTMLCollection.prototype),Aa(bc,!0),Aa(bc&&bc.fn),Aa(cc,!0),Aa(cc&&cc.fn)}var dc=function(a){if(_b.hasOwnProperty(a))switch(void 0===a?"undefined":Ba(a)){case"number":case"boolean":j(ac,a,{get:function(){return _b[a]},set:function(b){_b[a]=b}},!0);break;default:j(ac,a,_b[a],!0)}};for(var ec in _b)dc(ec);Object.freeze(ac);var fc=/(\d*\.\d+|\d+\.?|from|to)/g;m(["registerSequence",function a(b){if(e(b[0]))for(var c in b[0])b[0].hasOwnProperty(c)&&a([c,b[0][c]]);else if(f(b[0])){var g=b[0],h=b[1];if(f(g))if(e(h)){mb[g]&&console.warn("VelocityJS: Replacing named sequence:",g);var i={},j=new Array(100),k=[],l=mb[g]={},m=E(h.duration);for(var n in l.tweens={},d(m)&&(l.duration=m),h)if(h.hasOwnProperty(n)){var o=String(n).match(fc);if(o){var p=!0,q=!1,r=void 0;try{for(var s,t=o[Symbol.iterator]();!(p=(s=t.next()).done);p=!0){var u=s.value,v="from"===u?0:"to"===u?100:parseFloat(u);if(v<0||v>100)console.warn("VelocityJS: Trying to use an invalid value as a percentage (0 <= n <= 100):",g,v);else if(isNaN(v))console.warn("VelocityJS: Trying to use an invalid number as a percentage:",g,n,u);else for(var w in i[String(v)]||(i[String(v)]=[]),i[String(v)].push(n),h[n])k.includes(w)||k.push(w)}}catch(a){q=!0,r=a}finally{try{!p&&t.return&&t.return()}finally{if(q)throw r}}}}var x=Object.keys(i).sort(function(a,b){var c=parseFloat(a),d=parseFloat(b);return c>d?1:c<d?-1:0});x.forEach(function(a){j.push.apply(i[a])});var y=!0,z=!1,A=void 0;try{for(var B,C=k[Symbol.iterator]();!(y=(B=C.next()).done);y=!0){var D=B.value,G=[],H=W(D),I=!0,J=!1,K=void 0;try{for(var L,M=x[Symbol.iterator]();!(I=(L=M.next()).done);I=!0){var N=L.value,O=!0,P=!1,Q=void 0;try{for(var R,S=i[N][Symbol.iterator]();!(O=(R=S.next()).done);O=!0){var T=h[R.value];T[H]&&G.push(f(T[H])?T[H]:T[H][0])}}catch(a){P=!0,Q=a}finally{try{!O&&S.return&&S.return()}finally{if(P)throw Q}}}}catch(a){J=!0,K=a}finally{try{!I&&M.return&&M.return()}finally{if(J)throw K}}if(G.length){var U=ca(G,H),V=0;if(U){var X=!0,Y=!1,Z=void 0;try{for(var $,_=x[Symbol.iterator]();!(X=($=_.next()).done);X=!0){var aa=$.value,ba=!0,da=!1,ea=void 0;try{for(var fa,ga=i[aa][Symbol.iterator]();!(ba=(fa=ga.next()).done);ba=!0){var ha=h[fa.value][H];ha&&(Array.isArray(ha)&&ha.length>1&&(f(ha[1])||Array.isArray(ha[1]))&&(U[V].easing=F(ha[1],l.duration||Ha)),U[V++].percent=parseFloat(aa)/100)}}catch(a){da=!0,ea=a}finally{try{!ba&&ga.return&&ga.return()}finally{if(da)throw ea}}}}catch(a){Y=!0,Z=a}finally{try{!X&&_.return&&_.return()}finally{if(Y)throw Z}}l.tweens[H]=U}}}}catch(a){z=!0,A=a}finally{try{!y&&C.return&&C.return()}finally{if(z)throw A}}}else console.warn("VelocityJS: Trying to set 'registerSequence' sequence to an invalid value:",g,h);else console.warn("VelocityJS: Trying to set 'registerSequence' name to an invalid value:",g)}}],!0);var gc=void 0;try{gc=Promise}catch(Ba){}var hc,ic=", if that is deliberate then pass `promiseRejectEmpty:false` as an option",jc=ya;if(function(a){a.Actions=Ga,a.Easings=Ja,a.Sequences=mb,a.State=lb,a.defaults=cb,a.patch=Aa,a.debug=!1,a.mock=!1,a.version="2.0.5",a.Velocity=ya}(hc||(hc={})),function(){if(document.documentMode)return document.documentMode;for(var a=7;a>4;a--){var b=document.createElement("div");if(b.innerHTML="\x3c!--[if IE "+a+"]><span></span><![endif]--\x3e",b.getElementsByTagName("span").length)return b=null,a}}()<=8)throw new Error("VelocityJS cannot run on Internet Explorer 8 or earlier");if(window){var kc=window.jQuery,lc=window.Zepto;Aa(window,!0),Aa(Element&&Element.prototype),Aa(NodeList&&NodeList.prototype),Aa(HTMLCollection&&HTMLCollection.prototype),Aa(kc,!0),Aa(kc&&kc.fn),Aa(lc,!0),Aa(lc&&lc.fn)}var mc=function(a){if(hc.hasOwnProperty(a))switch(void 0===a?"undefined":Ba(a)){case"number":case"boolean":j(jc,a,{get:function(){return hc[a]},set:function(b){hc[a]=b}},!0);break;default:j(jc,a,hc[a],!0)}};for(var nc in hc)mc(nc);return Object.freeze(jc),jc});var d=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},yall=function(a){var b=function(a){if("IMG"===a.tagName){var b=a.parentNode;if("PICTURE"===b.tagName&&[].slice.call(b.querySelectorAll("source")).forEach(function(a){return c(a)}),!0===g.asyncDecodeSupport&&!0===g.replaceWithSupport){var d=new Image;c(d,a),d.decode().then(function(){for(var b=0;b<a.attributes.length;b++){var c=a.attributes[b].name,e=a.attributes[b].value;-1===g.ignoredImgAttributes.indexOf(c)&&d.setAttribute(c,e)}a.replaceWith(d)})}else c(a)}"VIDEO"===a.tagName&&([].slice.call(a.querySelectorAll("source")).forEach(function(a){return c(a)}),a.load()),"IFRAME"===a.tagName&&(a.src=a.dataset.src,a.removeAttribute("data-src")),a.classList.contains(h.lazyBackgroundClass)&&(a.classList.remove(h.lazyBackgroundClass),a.classList.add(h.lazyBackgroundLoaded))},c=function(a){var b=(1<arguments.length&&void 0!==arguments[1]&&arguments[1]).dataset||a.dataset;for(var c in b)-1!==g.acceptedDataAttributes.indexOf("data-"+c)&&(a.setAttribute(c,b[c]),a.removeAttribute("data-"+c))},e=function a(){var c=!1;!1===c&&0<k.length&&(c=!0,setTimeout(function(){k.forEach(function(a){a.getBoundingClientRect().top<=window.innerHeight+h.threshold&&a.getBoundingClientRect().bottom>=-h.threshold&&"none"!==getComputedStyle(a).display&&(!0===h.idlyLoad&&!0===g.idleCallbackSupport?requestIdleCallback(function(){b(a)},j):b(a),a.classList.remove(h.lazyClass),k=k.filter(function(b){return b!==a}))}),c=!1,0===k.length&&!1===h.observeChanges&&g.eventsToBind.forEach(function(b){return b[0].removeEventListener(b[1],a)})},h.throttleTime))},f=new Image,g={intersectionObserverSupport:"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype,mutationObserverSupport:"MutationObserver"in window,idleCallbackSupport:"requestIdleCallback"in window,asyncDecodeSupport:"decode"in f,replaceWithSupport:"replaceWith"in f,ignoredImgAttributes:["data-src","data-sizes","data-media","data-srcset","src","srcset"],acceptedDataAttributes:["data-src","data-sizes","data-media","data-srcset"],eventsToBind:[[document,"scroll"],[document,"touchmove"],[window,"resize"],[window,"orientationchange"]]},h=d({lazyClass:"lazy",lazyBackgroundClass:"lazy-bg",lazyBackgroundLoaded:"lazy-bg-loaded",throttleTime:200,idlyLoad:!1,idleLoadTimeout:100,threshold:200,observeChanges:!1,observeRootSelector:"body",mutationObserverOptions:{childList:!0}},a),i="img."+h.lazyClass+",video."+h.lazyClass+",iframe."+h.lazyClass+",."+h.lazyBackgroundClass,j={timeout:h.idleLoadTimeout},k=[].slice.call(document.querySelectorAll(i));if(!0===g.intersectionObserverSupport){var l=new IntersectionObserver(function(a,c){a.forEach(function(a){if(!0===a.isIntersecting||0<a.intersectionRatio){var d=a.target;!0===h.idlyLoad&&!0===g.idleCallbackSupport?requestIdleCallback(function(){b(d)},j):b(d),d.classList.remove(h.lazyClass),c.unobserve(d),k=k.filter(function(a){return a!==d})}})},{rootMargin:h.threshold+"px 0%"});k.forEach(function(a){return l.observe(a)})}else g.eventsToBind.forEach(function(a){return a[0].addEventListener(a[1],e)}),e();!0===g.mutationObserverSupport&&!0===h.observeChanges&&new MutationObserver(function(a){a.forEach(function(a){[].slice.call(document.querySelectorAll(i)).forEach(function(a){-1===k.indexOf(a)&&(k.push(a),!0===g.intersectionObserverSupport?l.observe(a):e())})})}).observe(document.querySelector(h.observeRootSelector),h.mutationObserverOptions)};!function(a,b){if("function"==typeof define&&define.amd)define([],b);else if("undefined"!=typeof exports)b();else{var c={exports:{}};b(),a.FileSaver=c.exports}}(this,function(){"use strict";function a(a,b){return void 0===b?b={autoBom:!1}:"object"!=typeof b&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a}function b(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){f(d.response,b,c)},d.onerror=function(){console.error("could not download file")},d.send()}function c(a){var b=new XMLHttpRequest;b.open("HEAD",a,!1);try{b.send()}catch(a){}return b.status>=200&&b.status<=299}function d(a){try{a.dispatchEvent(new MouseEvent("click"))}catch(c){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var e="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,f=e.saveAs||("object"!=typeof window||window!==e?function(){}:"download"in HTMLAnchorElement.prototype?function(a,f,g){var h=e.URL||e.webkitURL,i=document.createElement("a");f=f||a.name||"download",i.download=f,i.rel="noopener","string"==typeof a?(i.href=a,i.origin!==location.origin?c(i.href)?b(a,f,g):d(i,i.target="_blank"):d(i)):(i.href=h.createObjectURL(a),setTimeout(function(){h.revokeObjectURL(i.href)},4e4),setTimeout(function(){d(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,f,g){if(f=f||e.name||"download","string"==typeof e)if(c(e))b(e,f,g);else{var h=document.createElement("a");h.href=e,h.target="_blank",setTimeout(function(){d(h)})}else navigator.msSaveOrOpenBlob(a(e,g),f)}:function(a,c,d,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),"string"==typeof a)return b(a,c,d);var g="application/octet-stream"===a.type,h=/constructor/i.test(e.HTMLElement)||e.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||g&&h)&&"undefined"!=typeof FileReader){var j=new FileReader;j.onloadend=function(){var a=j.result;a=i?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=a:location=a,f=null},j.readAsDataURL(a)}else{var k=e.URL||e.webkitURL,l=k.createObjectURL(a);f?f.location=l:location.href=l,f=null,setTimeout(function(){k.revokeObjectURL(l)},4e4)}});e.saveAs=f.saveAs=f,"undefined"!=typeof module&&(module.exports=f)}),function(){function a(a){return a.map(function(a){if(a.buffer instanceof ArrayBuffer){var b=a.buffer;if(a.byteLength!==b.byteLength){var c=new Uint8Array(a.byteLength);c.set(new Uint8Array(b,a.byteOffset,a.byteLength)),b=c.buffer}return b}return a})}
function b(b,c){c=c||{};var d=new j;return a(b).forEach(function(a){d.append(a)}),c.type?d.getBlob(c.type):d.getBlob()}function c(b,c){return new k(a(b),c||{})}function d(a){for(var b=0,c=a.length,d=i.Uint8Array||Array,e=0,f=Math.max(32,c+(c>>1)+7),g=new d(f>>3<<3);b<c;){var h=a.charCodeAt(b++);if(h>=55296&&h<=56319){if(b<c){var j=a.charCodeAt(b);56320==(64512&j)&&(++b,h=((1023&h)<<10)+(1023&j)+65536)}if(h>=55296&&h<=56319)continue}if(e+4>g.length){f+=8,f*=1+b/a.length*2,f=f>>3<<3;const k=new Uint8Array(f);k.set(g),g=k}if(0!=(4294967168&h)){if(0==(4294965248&h))g[e++]=h>>6&31|192;else if(0==(4294901760&h))g[e++]=h>>12&15|224,g[e++]=h>>6&63|128;else{if(0!=(4292870144&h))continue;g[e++]=h>>18&7|240,g[e++]=h>>12&63|128,g[e++]=h>>6&63|128}g[e++]=63&h|128}else g[e++]=h}return g.slice(0,e)}function e(a){for(var b=a.length,c=[],d=0;d<b;){var e=a[d],f=null,g=e>239?4:e>223?3:e>191?2:1;if(d+g<=b){var h,i,j,k;switch(g){case 1:e<128&&(f=e);break;case 2:h=a[d+1],128==(192&h)&&(k=(31&e)<<6|63&h)>127&&(f=k);break;case 3:h=a[d+1],i=a[d+2],128==(192&h)&&128==(192&i)&&(k=(15&e)<<12|(63&h)<<6|63&i)>2047&&(k<55296||k>57343)&&(f=k);break;case 4:h=a[d+1],i=a[d+2],j=a[d+3],128==(192&h)&&128==(192&i)&&128==(192&j)&&(k=(15&e)<<18|(63&h)<<12|(63&i)<<6|63&j)>65535&&k<1114112&&(f=k)}}null===f?(f=65533,g=1):f>65535&&(f-=65536,c.push(f>>>10&1023|55296),f=56320|1023&f),c.push(f),d+=g}for(var l=c.length,m="",d=0;d<l;)m+=String.fromCharCode.apply(String,c.slice(d,d+=4096));return m}function f(){function a(a){return a&&DataView.prototype.isPrototypeOf(a)}function b(a){for(var b=new Array(a.byteLength),c=new Uint8Array(a),d=b.length;d--;)b[d]=c[d];return b}function c(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=[],d=0;d<a.length;d+=3){var e=a[d],f=d+1<a.length,g=f?a[d+1]:0,h=d+2<a.length,i=h?a[d+2]:0,j=e>>2,k=(3&e)<<4|g>>4,l=(15&g)<<2|i>>6,m=63&i;h||(m=64,f||(l=64)),c.push(b[j],b[k],b[l],b[m])}return c.join("")}function d(a){for(var b=0,c=a.length;c--;)b+=a[c].length;var d=new Uint8Array(b),e=0;for(c=0,l=a.length;c<l;c++){var f=a[c];d.set(f,e),e+=f.byteLength||f.length}return d}function e(c,f){c=c||[],f=null==f?{}:f;for(var g=0,h=c.length;g<h;g++){var j=c[g];j instanceof e?c[g]=j._buffer:"string"==typeof j?c[g]=t(j):r&&(ArrayBuffer.prototype.isPrototypeOf(j)||o(j))?c[g]=b(j):r&&a(j)?c[g]=b(j.buffer):c[g]=t(String(j))}this._buffer=i.Uint8Array?d(c):[].concat.apply([],c),this.size=this._buffer.length,this.type=f.type||"",/[^\u0020-\u007E]/.test(this.type)?this.type="":this.type=this.type.toLowerCase()}function f(a,b,c){c=c||{};var d=e.call(this,a,c)||this;return d.name=b.replace(/\//g,":"),d.lastModifiedDate=c.lastModified?new Date(c.lastModified):new Date,d.lastModified=+d.lastModifiedDate,d}function g(){if(!(this instanceof g))throw new TypeError("Failed to construct 'FileReader': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");var a=document.createDocumentFragment();this.addEventListener=a.addEventListener,this.dispatchEvent=function(b){var c=this["on"+b.type];"function"==typeof c&&c(b),a.dispatchEvent(b)},this.removeEventListener=a.removeEventListener}function h(a,b,c){if(!(b instanceof e))throw new TypeError("Failed to execute '"+c+"' on 'FileReader': parameter 1 is not of type 'Blob'.");a.result="",setTimeout(function(){this.readyState=g.LOADING,a.dispatchEvent(new Event("load")),a.dispatchEvent(new Event("loadend"))})}var j=Object.create||function(a){function b(){}return b.prototype=a,new b};if(r)var k=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=ArrayBuffer.isView||function(a){return a&&k.indexOf(Object.prototype.toString.call(a))>-1};if(e.prototype.arrayBuffer=function(){return Promise.resolve(this._buffer)},e.prototype.text=function(){return Promise.resolve(u(this._buffer))},e.prototype.slice=function(a,b,c){return new e([this._buffer.slice(a||0,b||this._buffer.length)],{type:c})},e.prototype.toString=function(){return"[object Blob]"},f.prototype=j(e.prototype),f.prototype.constructor=f,Object.setPrototypeOf)Object.setPrototypeOf(f,e);else try{f.__proto__=e}catch(a){}f.prototype.toString=function(){return"[object File]"},g.EMPTY=0,g.LOADING=1,g.DONE=2,g.prototype.error=null,g.prototype.onabort=null,g.prototype.onerror=null,g.prototype.onload=null,g.prototype.onloadend=null,g.prototype.onloadstart=null,g.prototype.onprogress=null,g.prototype.readAsDataURL=function(a){h(this,a,"readAsDataURL"),this.result="data:"+a.type+";base64,"+c(a._buffer)},g.prototype.readAsText=function(a){h(this,a,"readAsText"),this.result=u(a._buffer)},g.prototype.readAsArrayBuffer=function(a){h(this,a,"readAsText"),this.result=(a._buffer.buffer||a._buffer).slice()},g.prototype.abort=function(){},URL.createObjectURL=function(a){return a instanceof e?"data:"+a.type+";base64,"+c(a._buffer):m.call(URL,a)},URL.revokeObjectURL=function(a){n&&n.call(URL,a)};var p=i.XMLHttpRequest&&i.XMLHttpRequest.prototype.send;p&&(XMLHttpRequest.prototype.send=function(a){a instanceof e?(this.setRequestHeader("Content-Type",a.type),p.call(this,u(a._buffer))):p.call(this,a)}),i.FileReader=g,i.File=f,i.Blob=e}function g(){var a=!!i.ActiveXObject||"-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style,b=i.XMLHttpRequest&&i.XMLHttpRequest.prototype.send;a&&b&&(XMLHttpRequest.prototype.send=function(a){a instanceof Blob?(this.setRequestHeader("Content-Type",a.type),b.call(this,a)):b.call(this,a)});try{new File([],"")}catch(a){try{var c=new Function('class File extends Blob {constructor(chunks, name, opts) {opts = opts || {};super(chunks, opts || {});this.name = name.replace(///g, ":");this.lastModifiedDate = opts.lastModified ? new Date(opts.lastModified) : new Date();this.lastModified = +this.lastModifiedDate;}};return new File([], ""), File')();i.File=c}catch(a){var c=function(a,b,c){var d=new Blob(a,c),e=c&&void 0!==c.lastModified?new Date(c.lastModified):new Date;return d.name=b.replace(/\//g,":"),d.lastModifiedDate=e,d.lastModified=+e,d.toString=function(){return"[object File]"},o&&(d[o]="File"),d};i.File=c}}}function h(a){return new Promise(function(b,c){a.onload=a.onerror=function(d){a.onload=a.onerror=null,"load"===d.type?b(a.result||a):c(new Error("Failed to read the blob/file"))}})}var i="object"==typeof window?window:"object"==typeof self?self:this,j=i.BlobBuilder||i.WebKitBlobBuilder||i.MSBlobBuilder||i.MozBlobBuilder;i.URL=i.URL||i.webkitURL||function(a,b){return b=document.createElement("a"),b.href=a,b};var k=i.Blob,m=URL.createObjectURL,n=URL.revokeObjectURL,o=i.Symbol&&i.Symbol.toStringTag,p=!1,q=!1,r=!!i.ArrayBuffer,s=j&&j.prototype.append&&j.prototype.getBlob;try{p=2===new Blob([""]).size,q=2===new Blob([new Uint8Array([1,2])]).size}catch(a){}i.Blob&&(b.prototype=Blob.prototype,c.prototype=Blob.prototype);var t="function"==typeof TextEncoder?TextEncoder.prototype.encode.bind(new TextEncoder):d,u="function"==typeof TextDecoder?TextDecoder.prototype.decode.bind(new TextDecoder):e;p?(g(),i.Blob=q?i.Blob:c):s?(g(),i.Blob=b):f(),o&&(File.prototype[o]="File",Blob.prototype[o]="Blob",FileReader.prototype[o]="FileReader");var v,w=i.Blob.prototype;try{new ReadableStream({type:"bytes"}),v=function(){var a=0,b=this;return new ReadableStream({type:"bytes",autoAllocateChunkSize:524288,pull:function(c){var d=c.byobRequest.view;return b.slice(a,a+d.byteLength).arrayBuffer().then(function(e){var f=new Uint8Array(e),g=f.byteLength;a+=g,d.set(f),c.byobRequest.respond(g),a>=b.size&&c.close()})}})}}catch(a){try{new ReadableStream({}),v=function(a){var b=0,a=this;return new ReadableStream({pull:function(c){return a.slice(b,b+524288).arrayBuffer().then(function(d){b+=d.byteLength;var e=new Uint8Array(d);c.enqueue(e),b==a.size&&c.close()})}})}}catch(a){try{new Response("").body.getReader().read(),v=function(){return new Response(this).body}}catch(a){v=function(){throw new Error("Include https://github.com/MattiasBuelens/web-streams-polyfill")}}}}w.arrayBuffer||(w.arrayBuffer=function(){var a=new FileReader;return a.readAsArrayBuffer(this),h(a)}),w.text||(w.text=function(){var a=new FileReader;return a.readAsText(this),h(a)}),w.stream||(w.stream=v)}();var ics=function(a,b){"use strict";if(navigator.userAgent.indexOf("MSIE")>-1&&-1==navigator.userAgent.indexOf("MSIE 10"))return void console.log("Unsupported Browser");void 0===a&&(a="default"),void 0===b&&(b="Calendar");var c=-1!==navigator.appVersion.indexOf("Win")?"\r\n":"\n",d=[],e=["BEGIN:VCALENDAR","PRODID:"+b,"VERSION:2.0"].join(c),f=c+"END:VCALENDAR",g=["SU","MO","TU","WE","TH","FR","SA"];return{events:function(){return d},calendar:function(){return e+c+d.join(c)+f},addEvent:function(b,e,f,h,i,j){if(void 0===b||void 0===e||void 0===f||void 0===h||void 0===i)return!1;if(j&&!j.rrule){if("YEARLY"!==j.freq&&"MONTHLY"!==j.freq&&"WEEKLY"!==j.freq&&"DAILY"!==j.freq)throw"Recurrence rrule frequency must be provided and be one of the following: 'YEARLY', 'MONTHLY', 'WEEKLY', or 'DAILY'";if(j.until&&isNaN(Date.parse(j.until)))throw"Recurrence rrule 'until' must be a valid date string";if(j.interval&&isNaN(parseInt(j.interval)))throw"Recurrence rrule 'interval' must be an integer";if(j.count&&isNaN(parseInt(j.count)))throw"Recurrence rrule 'count' must be an integer";if(void 0!==j.byday){if("[object Array]"!==Object.prototype.toString.call(j.byday))throw"Recurrence rrule 'byday' must be an array";if(j.byday.length>7)throw"Recurrence rrule 'byday' array must not be longer than the 7 days in a week";j.byday=j.byday.filter(function(a,b){return j.byday.indexOf(a)==b});for(var k in j.byday)if(g.indexOf(j.byday[k])<0)throw"Recurrence rrule 'byday' values must include only the following: 'SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'"}}var l=new Date(h),m=new Date(i),n=new Date,o=("0000"+l.getFullYear().toString()).slice(-4),p=("00"+(l.getMonth()+1).toString()).slice(-2),q=("00"+l.getDate().toString()).slice(-2),r=("00"+l.getHours().toString()).slice(-2),s=("00"+l.getMinutes().toString()).slice(-2),t=("00"+l.getSeconds().toString()).slice(-2),u=("0000"+m.getFullYear().toString()).slice(-4),v=("00"+(m.getMonth()+1).toString()).slice(-2),w=("00"+m.getDate().toString()).slice(-2),x=("00"+m.getHours().toString()).slice(-2),y=("00"+m.getMinutes().toString()).slice(-2),z=("00"+m.getSeconds().toString()).slice(-2),A=("0000"+n.getFullYear().toString()).slice(-4),B=("00"+(n.getMonth()+1).toString()).slice(-2),C=("00"+n.getDate().toString()).slice(-2),D=("00"+n.getHours().toString()).slice(-2),E=("00"+n.getMinutes().toString()).slice(-2),F=("00"+n.getSeconds().toString()).slice(-2),G="",H="";r+s+t+x+y+z!=0&&(G="T"+r+s+t,H="T"+x+y+z);var I,J="T"+D+E+F,K=o+p+q+G,L=u+v+w+H,M=A+B+C+J;if(j)if(j.rrule)I=j.rrule;else{if(I="rrule:FREQ="+j.freq,j.until){var N=new Date(Date.parse(j.until)).toISOString();I+=";UNTIL="+N.substring(0,N.length-13).replace(/[-]/g,"")+"000000Z"}j.interval&&(I+=";INTERVAL="+j.interval),j.count&&(I+=";COUNT="+j.count),j.byday&&j.byday.length>0&&(I+=";BYDAY="+j.byday.join(","))}var O=((new Date).toISOString(),["BEGIN:VEVENT","UID:"+d.length+"@"+a+"_"+Math.floor(1e6*Math.random()),"CLASS:PUBLIC","DESCRIPTION:"+e,"DTSTAMP;VALUE=DATE-TIME:"+M,"DTSTART;VALUE=DATE-TIME:"+K,"DTEND;VALUE=DATE-TIME:"+L,"LOCATION:"+f,"SUMMARY;LANGUAGE=en-us:"+b,"TRANSP:TRANSPARENT","END:VEVENT"]);return I&&O.splice(4,0,I),O=O.join(c),d.push(O),O},download:function(a,b){if(d.length<1)return!1;b=void 0!==b?b:".ics",a=void 0!==a?a:"flu-shot-date_vaccination-antigrippale";var g,h=e+c+d.join(c)+f;if(-1===navigator.userAgent.indexOf("MSIE 10"))g=new Blob([h],{type:"text/calendar"});else{var i=new BlobBuilder;i.append(h),g=i.getBlob("text/x-vCalendar;charset="+document.characterSet)}return saveAs(g,a+b),h},build:function(){return!(d.length<1)&&e+c+d.join(c)+f}}},Box2D={};!function(a,b){function c(){}a.inherit=function(a,b){var d=a;c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=d},a.generateCallback=function(a,b){return function(){b.apply(a,arguments)}},a.NVector=function(a){a===b&&(a=0);for(var c=new Array(a||0),d=0;d<a;++d)c[d]=0;return c},a.is=function(a,c){return null!==a&&(c instanceof Function&&a instanceof c||!(a.constructor.__implements==b||!a.constructor.__implements[c]))},a.parseUInt=function(a){return Math.abs(parseInt(a))}}(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;void 0===Box2D&&(Box2D={}),void 0===Box2D.Collision&&(Box2D.Collision={}),void 0===Box2D.Collision.Shapes&&(Box2D.Collision.Shapes={}),void 0===Box2D.Common&&(Box2D.Common={}),void 0===Box2D.Common.Math&&(Box2D.Common.Math={}),void 0===Box2D.Dynamics&&(Box2D.Dynamics={}),void 0===Box2D.Dynamics.Contacts&&(Box2D.Dynamics.Contacts={}),void 0===Box2D.Dynamics.Controllers&&(Box2D.Dynamics.Controllers={}),void 0===Box2D.Dynamics.Joints&&(Box2D.Dynamics.Joints={}),function(){function a(){a.b2AABB.apply(this,arguments)}function b(){b.b2Bound.apply(this,arguments)}function c(){c.b2BoundValues.apply(this,arguments),this.constructor===c&&this.b2BoundValues.apply(this,arguments)}function d(){d.b2Collision.apply(this,arguments)}function e(){e.b2ContactID.apply(this,arguments),this.constructor===e&&this.b2ContactID.apply(this,arguments)}function f(){f.b2ContactPoint.apply(this,arguments)}function g(){g.b2Distance.apply(this,arguments)}function h(){h.b2DistanceInput.apply(this,arguments)}function i(){i.b2DistanceOutput.apply(this,arguments)}function j(){j.b2DistanceProxy.apply(this,arguments)}function k(){k.b2DynamicTree.apply(this,arguments),this.constructor===k&&this.b2DynamicTree.apply(this,arguments)}function l(){l.b2DynamicTreeBroadPhase.apply(this,arguments)}function m(){m.b2DynamicTreeNode.apply(this,arguments)}function n(){n.b2DynamicTreePair.apply(this,arguments)}function o(){o.b2Manifold.apply(this,arguments),this.constructor===o&&this.b2Manifold.apply(this,arguments)}function p(){p.b2ManifoldPoint.apply(this,arguments),this.constructor===p&&this.b2ManifoldPoint.apply(this,arguments)}function q(){q.b2Point.apply(this,arguments)}function r(){r.b2RayCastInput.apply(this,arguments),this.constructor===r&&this.b2RayCastInput.apply(this,arguments)}function s(){s.b2RayCastOutput.apply(this,arguments)}function t(){t.b2Segment.apply(this,arguments)}function u(){u.b2SeparationFunction.apply(this,arguments)}function v(){v.b2Simplex.apply(this,arguments),this.constructor===v&&this.b2Simplex.apply(this,arguments)}function w(){w.b2SimplexCache.apply(this,arguments)}function x(){x.b2SimplexVertex.apply(this,arguments)}function y(){y.b2TimeOfImpact.apply(this,arguments)}function z(){z.b2TOIInput.apply(this,arguments)}function A(){A.b2WorldManifold.apply(this,arguments),this.constructor===A&&this.b2WorldManifold.apply(this,arguments)}function B(){B.ClipVertex.apply(this,arguments)}function C(){C.Features.apply(this,arguments)}function D(){D.b2CircleShape.apply(this,arguments),this.constructor===D&&this.b2CircleShape.apply(this,arguments)}function E(){E.b2EdgeChainDef.apply(this,arguments),this.constructor===E&&this.b2EdgeChainDef.apply(this,arguments)}function F(){F.b2EdgeShape.apply(this,arguments),this.constructor===F&&this.b2EdgeShape.apply(this,arguments)}function G(){G.b2MassData.apply(this,arguments)}function H(){H.b2PolygonShape.apply(this,arguments),this.constructor===H&&this.b2PolygonShape.apply(this,arguments)}function I(){I.b2Shape.apply(this,arguments),this.constructor===I&&this.b2Shape.apply(this,arguments)}function J(){J.b2Color.apply(this,arguments),this.constructor===J&&this.b2Color.apply(this,arguments)}function K(){K.b2Settings.apply(this,arguments)}function L(){L.b2Mat22.apply(this,arguments),this.constructor===L&&this.b2Mat22.apply(this,arguments)}function M(){M.b2Mat33.apply(this,arguments),this.constructor===M&&this.b2Mat33.apply(this,arguments)}function N(){N.b2Math.apply(this,arguments)}function O(){O.b2Sweep.apply(this,arguments)}function P(){P.b2Transform.apply(this,arguments),this.constructor===P&&this.b2Transform.apply(this,arguments)}function Q(){Q.b2Vec2.apply(this,arguments),this.constructor===Q&&this.b2Vec2.apply(this,arguments)}function R(){R.b2Vec3.apply(this,arguments),this.constructor===R&&this.b2Vec3.apply(this,arguments)}function S(){S.b2Body.apply(this,arguments),this.constructor===S&&this.b2Body.apply(this,arguments)}function T(){T.b2BodyDef.apply(this,arguments),this.constructor===T&&this.b2BodyDef.apply(this,arguments)}function U(){U.b2ContactFilter.apply(this,arguments)}function V(){V.b2ContactImpulse.apply(this,arguments)}function W(){W.b2ContactListener.apply(this,arguments)}function X(){X.b2ContactManager.apply(this,arguments),this.constructor===X&&this.b2ContactManager.apply(this,arguments)}function Y(){Y.b2DebugDraw.apply(this,arguments),this.constructor===Y&&this.b2DebugDraw.apply(this,arguments)}function Z(){Z.b2DestructionListener.apply(this,arguments)}function $(){$.b2FilterData.apply(this,arguments)}function _(){_.b2Fixture.apply(this,arguments),this.constructor===_&&this.b2Fixture.apply(this,arguments)}function aa(){aa.b2FixtureDef.apply(this,arguments),this.constructor===aa&&this.b2FixtureDef.apply(this,arguments)}function ba(){ba.b2Island.apply(this,arguments),this.constructor===ba&&this.b2Island.apply(this,arguments)}function ca(){ca.b2TimeStep.apply(this,arguments)}function da(){da.b2World.apply(this,arguments),this.constructor===da&&this.b2World.apply(this,arguments)}function ea(){ea.b2CircleContact.apply(this,arguments)}function fa(){fa.b2Contact.apply(this,arguments),this.constructor===fa&&this.b2Contact.apply(this,arguments)}function ga(){ga.b2ContactConstraint.apply(this,arguments),this.constructor===ga&&this.b2ContactConstraint.apply(this,arguments)}function ha(){ha.b2ContactConstraintPoint.apply(this,arguments)}function ia(){ia.b2ContactEdge.apply(this,arguments)}function ja(){ja.b2ContactFactory.apply(this,arguments),this.constructor===ja&&this.b2ContactFactory.apply(this,arguments)}function ka(){ka.b2ContactRegister.apply(this,arguments)}function la(){la.b2ContactResult.apply(this,arguments)}function ma(){ma.b2ContactSolver.apply(this,arguments),this.constructor===ma&&this.b2ContactSolver.apply(this,arguments)}function na(){na.b2EdgeAndCircleContact.apply(this,arguments)}function oa(){oa.b2NullContact.apply(this,arguments),this.constructor===oa&&this.b2NullContact.apply(this,arguments)}function pa(){pa.b2PolyAndCircleContact.apply(this,arguments)}function qa(){qa.b2PolyAndEdgeContact.apply(this,arguments)}function ra(){ra.b2PolygonContact.apply(this,arguments)}function sa(){sa.b2PositionSolverManifold.apply(this,arguments),this.constructor===sa&&this.b2PositionSolverManifold.apply(this,arguments)}function ta(){ta.b2BuoyancyController.apply(this,arguments)}function ua(){ua.b2ConstantAccelController.apply(this,arguments)}function va(){va.b2ConstantForceController.apply(this,arguments)}function wa(){wa.b2Controller.apply(this,arguments)}function xa(){xa.b2ControllerEdge.apply(this,arguments)}function ya(){ya.b2GravityController.apply(this,arguments)}function za(){za.b2TensorDampingController.apply(this,arguments)}function Aa(){Aa.b2DistanceJoint.apply(this,arguments),this.constructor===Aa&&this.b2DistanceJoint.apply(this,arguments)}function Ba(){Ba.b2DistanceJointDef.apply(this,arguments),this.constructor===Ba&&this.b2DistanceJointDef.apply(this,arguments)}function Ca(){Ca.b2FrictionJoint.apply(this,arguments),this.constructor===Ca&&this.b2FrictionJoint.apply(this,arguments)}function Da(){Da.b2FrictionJointDef.apply(this,arguments),this.constructor===Da&&this.b2FrictionJointDef.apply(this,arguments)}function Ea(){Ea.b2GearJoint.apply(this,arguments),this.constructor===Ea&&this.b2GearJoint.apply(this,arguments)}function Fa(){Fa.b2GearJointDef.apply(this,arguments),this.constructor===Fa&&this.b2GearJointDef.apply(this,arguments)}function Ga(){Ga.b2Jacobian.apply(this,arguments)}function Ha(){Ha.b2Joint.apply(this,arguments),this.constructor===Ha&&this.b2Joint.apply(this,arguments)}function Ia(){Ia.b2JointDef.apply(this,arguments),this.constructor===Ia&&this.b2JointDef.apply(this,arguments)}function Ja(){Ja.b2JointEdge.apply(this,arguments)}function Ka(){Ka.b2LineJoint.apply(this,arguments),this.constructor===Ka&&this.b2LineJoint.apply(this,arguments)}function La(){La.b2LineJointDef.apply(this,arguments),this.constructor===La&&this.b2LineJointDef.apply(this,arguments)}function Ma(){Ma.b2MouseJoint.apply(this,arguments),this.constructor===Ma&&this.b2MouseJoint.apply(this,arguments)}function Na(){Na.b2MouseJointDef.apply(this,arguments),this.constructor===Na&&this.b2MouseJointDef.apply(this,arguments)}function Oa(){Oa.b2PrismaticJoint.apply(this,arguments),this.constructor===Oa&&this.b2PrismaticJoint.apply(this,arguments)}function Pa(){Pa.b2PrismaticJointDef.apply(this,arguments),this.constructor===Pa&&this.b2PrismaticJointDef.apply(this,arguments)}function Qa(){Qa.b2PulleyJoint.apply(this,arguments),this.constructor===Qa&&this.b2PulleyJoint.apply(this,arguments)}function Ra(){Ra.b2PulleyJointDef.apply(this,arguments),this.constructor===Ra&&this.b2PulleyJointDef.apply(this,arguments)}function Sa(){Sa.b2RevoluteJoint.apply(this,arguments),this.constructor===Sa&&this.b2RevoluteJoint.apply(this,arguments)}function Ta(){Ta.b2RevoluteJointDef.apply(this,arguments),this.constructor===Ta&&this.b2RevoluteJointDef.apply(this,arguments)}function Ua(){Ua.b2WeldJoint.apply(this,arguments),this.constructor===Ua&&this.b2WeldJoint.apply(this,arguments)}function Va(){Va.b2WeldJointDef.apply(this,arguments),this.constructor===Va&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=a,Box2D.Collision.b2Bound=b,Box2D.Collision.b2BoundValues=c,Box2D.Collision.b2Collision=d,Box2D.Collision.b2ContactID=e,Box2D.Collision.b2ContactPoint=f,Box2D.Collision.b2Distance=g,Box2D.Collision.b2DistanceInput=h,Box2D.Collision.b2DistanceOutput=i,Box2D.Collision.b2DistanceProxy=j,Box2D.Collision.b2DynamicTree=k,Box2D.Collision.b2DynamicTreeBroadPhase=l,Box2D.Collision.b2DynamicTreeNode=m,Box2D.Collision.b2DynamicTreePair=n,Box2D.Collision.b2Manifold=o,Box2D.Collision.b2ManifoldPoint=p,Box2D.Collision.b2Point=q,Box2D.Collision.b2RayCastInput=r,Box2D.Collision.b2RayCastOutput=s,Box2D.Collision.b2Segment=t,Box2D.Collision.b2SeparationFunction=u,Box2D.Collision.b2Simplex=v,Box2D.Collision.b2SimplexCache=w,Box2D.Collision.b2SimplexVertex=x,Box2D.Collision.b2TimeOfImpact=y,Box2D.Collision.b2TOIInput=z,Box2D.Collision.b2WorldManifold=A,Box2D.Collision.ClipVertex=B,Box2D.Collision.Features=C,Box2D.Collision.Shapes.b2CircleShape=D,Box2D.Collision.Shapes.b2EdgeChainDef=E,Box2D.Collision.Shapes.b2EdgeShape=F,Box2D.Collision.Shapes.b2MassData=G,Box2D.Collision.Shapes.b2PolygonShape=H,Box2D.Collision.Shapes.b2Shape=I,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=J,Box2D.Common.b2Settings=K,Box2D.Common.Math.b2Mat22=L,Box2D.Common.Math.b2Mat33=M,Box2D.Common.Math.b2Math=N,Box2D.Common.Math.b2Sweep=O,Box2D.Common.Math.b2Transform=P,Box2D.Common.Math.b2Vec2=Q,Box2D.Common.Math.b2Vec3=R,Box2D.Dynamics.b2Body=S,Box2D.Dynamics.b2BodyDef=T,Box2D.Dynamics.b2ContactFilter=U,Box2D.Dynamics.b2ContactImpulse=V,Box2D.Dynamics.b2ContactListener=W,Box2D.Dynamics.b2ContactManager=X,Box2D.Dynamics.b2DebugDraw=Y,Box2D.Dynamics.b2DestructionListener=Z,Box2D.Dynamics.b2FilterData=$,Box2D.Dynamics.b2Fixture=_,Box2D.Dynamics.b2FixtureDef=aa,Box2D.Dynamics.b2Island=ba,Box2D.Dynamics.b2TimeStep=ca,Box2D.Dynamics.b2World=da,Box2D.Dynamics.Contacts.b2CircleContact=ea,Box2D.Dynamics.Contacts.b2Contact=fa,Box2D.Dynamics.Contacts.b2ContactConstraint=ga,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ha,Box2D.Dynamics.Contacts.b2ContactEdge=ia,Box2D.Dynamics.Contacts.b2ContactFactory=ja,Box2D.Dynamics.Contacts.b2ContactRegister=ka,Box2D.Dynamics.Contacts.b2ContactResult=la,Box2D.Dynamics.Contacts.b2ContactSolver=ma,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=na,Box2D.Dynamics.Contacts.b2NullContact=oa,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=pa,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=qa,Box2D.Dynamics.Contacts.b2PolygonContact=ra,Box2D.Dynamics.Contacts.b2PositionSolverManifold=sa,Box2D.Dynamics.Controllers.b2BuoyancyController=ta,Box2D.Dynamics.Controllers.b2ConstantAccelController=ua,Box2D.Dynamics.Controllers.b2ConstantForceController=va,Box2D.Dynamics.Controllers.b2Controller=wa,Box2D.Dynamics.Controllers.b2ControllerEdge=xa,Box2D.Dynamics.Controllers.b2GravityController=ya,Box2D.Dynamics.Controllers.b2TensorDampingController=za,Box2D.Dynamics.Joints.b2DistanceJoint=Aa,Box2D.Dynamics.Joints.b2DistanceJointDef=Ba,Box2D.Dynamics.Joints.b2FrictionJoint=Ca,Box2D.Dynamics.Joints.b2FrictionJointDef=Da,Box2D.Dynamics.Joints.b2GearJoint=Ea,Box2D.Dynamics.Joints.b2GearJointDef=Fa,Box2D.Dynamics.Joints.b2Jacobian=Ga,Box2D.Dynamics.Joints.b2Joint=Ha,Box2D.Dynamics.Joints.b2JointDef=Ia,Box2D.Dynamics.Joints.b2JointEdge=Ja,Box2D.Dynamics.Joints.b2LineJoint=Ka,Box2D.Dynamics.Joints.b2LineJointDef=La,Box2D.Dynamics.Joints.b2MouseJoint=Ma,Box2D.Dynamics.Joints.b2MouseJointDef=Na,Box2D.Dynamics.Joints.b2PrismaticJoint=Oa,Box2D.Dynamics.Joints.b2PrismaticJointDef=Pa,Box2D.Dynamics.Joints.b2PulleyJoint=Qa,Box2D.Dynamics.Joints.b2PulleyJointDef=Ra,Box2D.Dynamics.Joints.b2RevoluteJoint=Sa,Box2D.Dynamics.Joints.b2RevoluteJointDef=Ta,Box2D.Dynamics.Joints.b2WeldJoint=Ua,Box2D.Dynamics.Joints.b2WeldJointDef=Va}(),Box2D.postDefs=[],function(){var a=Box2D.Collision.Shapes.b2CircleShape,b=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),c=Box2D.Collision.Shapes.b2Shape,d=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),e=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),f=Box2D.Common.Math.b2Sweep,g=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,i=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB),j=Box2D.Collision.b2Bound,k=Box2D.Collision.b2BoundValues,l=Box2D.Collision.b2Collision,m=Box2D.Collision.b2ContactID,n=Box2D.Collision.b2ContactPoint,o=Box2D.Collision.b2Distance,p=Box2D.Collision.b2DistanceInput,q=Box2D.Collision.b2DistanceOutput,r=Box2D.Collision.b2DistanceProxy,s=Box2D.Collision.b2DynamicTree,t=Box2D.Collision.b2DynamicTreeBroadPhase,u=Box2D.Collision.b2DynamicTreeNode,v=Box2D.Collision.b2DynamicTreePair,w=Box2D.Collision.b2Manifold,x=Box2D.Collision.b2ManifoldPoint,y=Box2D.Collision.b2Point,z=Box2D.Collision.b2RayCastInput,A=Box2D.Collision.b2RayCastOutput,B=Box2D.Collision.b2Segment,C=Box2D.Collision.b2SeparationFunction,D=Box2D.Collision.b2Simplex,E=Box2D.Collision.b2SimplexCache,F=Box2D.Collision.b2SimplexVertex,G=Box2D.Collision.b2TimeOfImpact,H=Box2D.Collision.b2TOIInput,I=Box2D.Collision.b2WorldManifold,J=Box2D.Collision.ClipVertex,K=Box2D.Collision.Features,L=Box2D.Collision.IBroadPhase;i.b2AABB=function(){this.lowerBound=new h,this.upperBound=new h},i.prototype.IsValid=function(){var a=this.upperBound.x-this.lowerBound.x,b=this.upperBound.y-this.lowerBound.y,c=a>=0&&b>=0;return c=c&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},i.prototype.GetCenter=function(){return new h((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},i.prototype.GetExtents=function(){return new h((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},i.prototype.Contains=function(a){var b=!0;return b=b&&this.lowerBound.x<=a.lowerBound.x,b=b&&this.lowerBound.y<=a.lowerBound.y,b=b&&a.upperBound.x<=this.upperBound.x,b=b&&a.upperBound.y<=this.upperBound.y},i.prototype.RayCast=function(a,b){var c=-Number.MAX_VALUE,d=Number.MAX_VALUE,e=b.p1.x,f=b.p1.y,g=b.p2.x-b.p1.x,h=b.p2.y-b.p1.y,i=Math.abs(g),j=Math.abs(h),k=a.normal,l=0,m=0,n=0,o=0,p=0;if(i<Number.MIN_VALUE){if(e<this.lowerBound.x||this.upperBound.x<e)return!1}else if(l=1/g,m=(this.lowerBound.x-e)*l,n=(this.upperBound.x-e)*l,p=-1,m>n&&(o=m,m=n,n=o,p=1),m>c&&(k.x=p,k.y=0,c=m),d=Math.min(d,n),c>d)return!1;if(j<Number.MIN_VALUE){if(f<this.lowerBound.y||this.upperBound.y<f)return!1}else if(l=1/h,m=(this.lowerBound.y-f)*l,n=(this.upperBound.y-f)*l,p=-1,m>n&&(o=m,m=n,n=o,p=1),m>c&&(k.y=p,k.x=0,c=m),d=Math.min(d,n),c>d)return!1;return a.fraction=c,!0},i.prototype.TestOverlap=function(a){var b=a.lowerBound.x-this.upperBound.x,c=a.lowerBound.y-this.upperBound.y,d=this.lowerBound.x-a.upperBound.x,e=this.lowerBound.y-a.upperBound.y;return!(b>0||c>0)&&!(d>0||e>0)},i.Combine=function(a,b){var c=new i;return c.Combine(a,b),c},i.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x),this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y),this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x),this.upperBound.y=Math.max(a.upperBound.y,b.upperBound.y)},j.b2Bound=function(){},j.prototype.IsLower=function(){return 0==(1&this.value)},j.prototype.IsUpper=function(){return 1==(1&this.value)},j.prototype.Swap=function(a){var b=this.value,c=this.proxy,d=this.stabbingCount;this.value=a.value,this.proxy=a.proxy,this.stabbingCount=a.stabbingCount,a.value=b,a.proxy=c,a.stabbingCount=d},k.b2BoundValues=function(){},k.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},l.b2Collision=function(){},l.ClipSegmentToLine=function(a,b,c,d){void 0===d&&(d=0);var e,f=0;e=b[0];var g=e.v;e=b[1];var h=e.v,i=c.x*g.x+c.y*g.y-d,j=c.x*h.x+c.y*h.y-d;if(i<=0&&a[f++].Set(b[0]),j<=0&&a[f++].Set(b[1]),i*j<0){var k=i/(i-j);e=a[f];var l=e.v;l.x=g.x+k*(h.x-g.x),l.y=g.y+k*(h.y-g.y),e=a[f];var m;i>0?(m=b[0],e.id=m.id):(m=b[1],e.id=m.id),++f}return f},l.EdgeSeparation=function(a,b,c,d,e){void 0===c&&(c=0);var f,g,h=(parseInt(a.m_vertexCount),a.m_vertices),i=a.m_normals,j=parseInt(d.m_vertexCount),k=d.m_vertices;f=b.R,g=i[c];var l=f.col1.x*g.x+f.col2.x*g.y,m=f.col1.y*g.x+f.col2.y*g.y;f=e.R;for(var n=f.col1.x*l+f.col1.y*m,o=f.col2.x*l+f.col2.y*m,p=0,q=Number.MAX_VALUE,r=0;r<j;++r){g=k[r];var s=g.x*n+g.y*o;s<q&&(q=s,p=r)}g=h[c],f=b.R;var t=b.position.x+(f.col1.x*g.x+f.col2.x*g.y),u=b.position.y+(f.col1.y*g.x+f.col2.y*g.y);g=k[p],f=e.R;var v=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),w=e.position.y+(f.col1.y*g.x+f.col2.y*g.y);return v-=t,w-=u,v*l+w*m},l.FindMaxSeparation=function(a,b,c,d,e){var f,g,h=parseInt(b.m_vertexCount),i=b.m_normals;g=e.R,f=d.m_centroid;var j=e.position.x+(g.col1.x*f.x+g.col2.x*f.y),k=e.position.y+(g.col1.y*f.x+g.col2.y*f.y);g=c.R,f=b.m_centroid,j-=c.position.x+(g.col1.x*f.x+g.col2.x*f.y),k-=c.position.y+(g.col1.y*f.x+g.col2.y*f.y);for(var m=j*c.R.col1.x+k*c.R.col1.y,n=j*c.R.col2.x+k*c.R.col2.y,o=0,p=-Number.MAX_VALUE,q=0;q<h;++q){f=i[q];var r=f.x*m+f.y*n;r>p&&(p=r,o=q)}var s=l.EdgeSeparation(b,c,o,d,e),t=parseInt(o-1>=0?o-1:h-1),u=l.EdgeSeparation(b,c,t,d,e),v=parseInt(o+1<h?o+1:0),w=l.EdgeSeparation(b,c,v,d,e),x=0,y=0,z=0;if(u>s&&u>w)z=-1,x=t,y=u;else{if(!(w>s))return a[0]=o,s;z=1,x=v,y=w}for(;;){if(o=-1==z?x-1>=0?x-1:h-1:x+1<h?x+1:0,!((s=l.EdgeSeparation(b,c,o,d,e))>y))break;x=o,y=s}return a[0]=x,y},l.FindIncidentEdge=function(a,b,c,d,e,f){void 0===d&&(d=0);var g,h,i=(parseInt(b.m_vertexCount),b.m_normals),j=parseInt(e.m_vertexCount),k=e.m_vertices,l=e.m_normals;g=c.R,h=i[d];var m=g.col1.x*h.x+g.col2.x*h.y,n=g.col1.y*h.x+g.col2.y*h.y;g=f.R;var o=g.col1.x*m+g.col1.y*n;n=g.col2.x*m+g.col2.y*n,m=o;for(var p=0,q=Number.MAX_VALUE,r=0;r<j;++r){h=l[r];var s=m*h.x+n*h.y;s<q&&(q=s,p=r)}var t,u=parseInt(p),v=parseInt(u+1<j?u+1:0);t=a[0],h=k[u],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=u,t.id.features.incidentVertex=0,t=a[1],h=k[v],g=f.R,t.v.x=f.position.x+(g.col1.x*h.x+g.col2.x*h.y),t.v.y=f.position.y+(g.col1.y*h.x+g.col2.y*h.y),t.id.features.referenceEdge=d,t.id.features.incidentEdge=v,
t.id.features.incidentVertex=1},l.MakeClipPointVector=function(){var a=new Vector(2);return a[0]=new J,a[1]=new J,a},l.CollidePolygons=function(a,b,c,e,f){var g;a.m_pointCount=0;var h=b.m_radius+e.m_radius,i=0;l.s_edgeAO[0]=i;var j=l.FindMaxSeparation(l.s_edgeAO,b,c,e,f);if(i=l.s_edgeAO[0],!(j>h)){var k=0;l.s_edgeBO[0]=k;var m=l.FindMaxSeparation(l.s_edgeBO,e,f,b,c);if(k=l.s_edgeBO[0],!(m>h)){var n,o,p,q,r,s=0,t=0,u=.98,v=.001;m>u*j+v?(n=e,o=b,p=f,q=c,s=k,a.m_type=w.e_faceB,t=1):(n=b,o=e,p=c,q=f,s=i,a.m_type=w.e_faceA,t=0);var x=l.s_incidentEdge;l.FindIncidentEdge(x,n,p,s,o,q);var y,z=parseInt(n.m_vertexCount),A=n.m_vertices,B=A[s];y=s+1<z?A[parseInt(s+1)]:A[0];var C=l.s_localTangent;C.Set(y.x-B.x,y.y-B.y),C.Normalize();var D=l.s_localNormal;D.x=C.y,D.y=-C.x;var E=l.s_planePoint;E.Set(.5*(B.x+y.x),.5*(B.y+y.y));var F=l.s_tangent;r=p.R,F.x=r.col1.x*C.x+r.col2.x*C.y,F.y=r.col1.y*C.x+r.col2.y*C.y;var G=l.s_tangent2;G.x=-F.x,G.y=-F.y;var H=l.s_normal;H.x=F.y,H.y=-F.x;var I=l.s_v11,J=l.s_v12;I.x=p.position.x+(r.col1.x*B.x+r.col2.x*B.y),I.y=p.position.y+(r.col1.y*B.x+r.col2.y*B.y),J.x=p.position.x+(r.col1.x*y.x+r.col2.x*y.y),J.y=p.position.y+(r.col1.y*y.x+r.col2.y*y.y);var K=H.x*I.x+H.y*I.y,L=-F.x*I.x-F.y*I.y+h,M=F.x*J.x+F.y*J.y+h,N=l.s_clipPoints1,O=l.s_clipPoints2;if(!(l.ClipSegmentToLine(N,x,G,L)<2||l.ClipSegmentToLine(O,N,F,M)<2)){a.m_localPlaneNormal.SetV(D),a.m_localPoint.SetV(E);for(var P=0,Q=0;Q<d.b2_maxManifoldPoints;++Q){g=O[Q];if(H.x*g.v.x+H.y*g.v.y-K<=h){var R=a.m_points[P];r=q.R;var S=g.v.x-q.position.x,T=g.v.y-q.position.y;R.m_localPoint.x=S*r.col1.x+T*r.col1.y,R.m_localPoint.y=S*r.col2.x+T*r.col2.y,R.m_id.Set(g.id),R.m_id.features.flip=t,++P}}a.m_pointCount=P}}}},l.CollideCircles=function(a,b,c,d,e){a.m_pointCount=0;var f,g;f=c.R,g=b.m_p;var h=c.position.x+(f.col1.x*g.x+f.col2.x*g.y),i=c.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=e.R,g=d.m_p;var j=e.position.x+(f.col1.x*g.x+f.col2.x*g.y),k=e.position.y+(f.col1.y*g.x+f.col2.y*g.y),l=j-h,m=k-i,n=l*l+m*m,o=b.m_radius+d.m_radius;n>o*o||(a.m_type=w.e_circles,a.m_localPoint.SetV(b.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0)},l.CollidePolygonAndCircle=function(a,b,c,d,e){a.m_pointCount=0;var f,g,h=0,i=0;g=e.R,f=d.m_p;var j=e.position.x+(g.col1.x*f.x+g.col2.x*f.y),k=e.position.y+(g.col1.y*f.x+g.col2.y*f.y);h=j-c.position.x,i=k-c.position.y,g=c.R;for(var l=h*g.col1.x+i*g.col1.y,m=h*g.col2.x+i*g.col2.y,n=0,o=-Number.MAX_VALUE,p=b.m_radius+d.m_radius,q=parseInt(b.m_vertexCount),r=b.m_vertices,s=b.m_normals,t=0;t<q;++t){f=r[t],h=l-f.x,i=m-f.y,f=s[t];var u=f.x*h+f.y*i;if(u>p)return;u>o&&(o=u,n=t)}var v=parseInt(n),x=parseInt(v+1<q?v+1:0),y=r[v],z=r[x];if(o<Number.MIN_VALUE)return a.m_pointCount=1,a.m_type=w.e_faceA,a.m_localPlaneNormal.SetV(s[n]),a.m_localPoint.x=.5*(y.x+z.x),a.m_localPoint.y=.5*(y.y+z.y),a.m_points[0].m_localPoint.SetV(d.m_p),void(a.m_points[0].m_id.key=0);var A=(l-y.x)*(z.x-y.x)+(m-y.y)*(z.y-y.y),B=(l-z.x)*(y.x-z.x)+(m-z.y)*(y.y-z.y);if(A<=0){if((l-y.x)*(l-y.x)+(m-y.y)*(m-y.y)>p*p)return;a.m_pointCount=1,a.m_type=w.e_faceA,a.m_localPlaneNormal.x=l-y.x,a.m_localPlaneNormal.y=m-y.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(y),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else if(B<=0){if((l-z.x)*(l-z.x)+(m-z.y)*(m-z.y)>p*p)return;a.m_pointCount=1,a.m_type=w.e_faceA,a.m_localPlaneNormal.x=l-z.x,a.m_localPlaneNormal.y=m-z.y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.SetV(z),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}else{var C=.5*(y.x+z.x),D=.5*(y.y+z.y);if((o=(l-C)*s[v].x+(m-D)*s[v].y)>p)return;a.m_pointCount=1,a.m_type=w.e_faceA,a.m_localPlaneNormal.x=s[v].x,a.m_localPlaneNormal.y=s[v].y,a.m_localPlaneNormal.Normalize(),a.m_localPoint.Set(C,D),a.m_points[0].m_localPoint.SetV(d.m_p),a.m_points[0].m_id.key=0}},l.TestOverlap=function(a,b){var c=b.lowerBound,d=a.upperBound,e=c.x-d.x,f=c.y-d.y;c=a.lowerBound,d=b.upperBound;var g=c.x-d.x,h=c.y-d.y;return!(e>0||f>0)&&!(g>0||h>0)},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=l.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=l.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=l.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new h,Box2D.Collision.b2Collision.s_localNormal=new h,Box2D.Collision.b2Collision.s_planePoint=new h,Box2D.Collision.b2Collision.s_normal=new h,Box2D.Collision.b2Collision.s_tangent=new h,Box2D.Collision.b2Collision.s_tangent2=new h,Box2D.Collision.b2Collision.s_v11=new h,Box2D.Collision.b2Collision.s_v12=new h,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new h,Box2D.Collision.b2Collision.b2_nullFeature=255}),m.b2ContactID=function(){this.features=new K},m.prototype.b2ContactID=function(){this.features._m_id=this},m.prototype.Set=function(a){this.key=a._key},m.prototype.Copy=function(){var a=new m;return a.key=this.key,a},Object.defineProperty(m.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(m.prototype,"key",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._key=a,this.features._referenceEdge=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255}}),n.b2ContactPoint=function(){this.position=new h,this.velocity=new h,this.normal=new h,this.id=new m},o.b2Distance=function(){},o.Distance=function(a,b,c){++o.b2_gjkCalls;var f=c.proxyA,g=c.proxyB,i=c.transformA,j=c.transformB,k=o.s_simplex;k.ReadCache(b,f,i,g,j);for(var l,m=k.m_vertices,n=20,p=o.s_saveA,q=o.s_saveB,r=0,s=k.GetClosestPoint(),t=s.LengthSquared(),u=t,v=0,w=0;w<n;){for(r=k.m_count,v=0;v<r;v++)p[v]=m[v].indexA,q[v]=m[v].indexB;switch(k.m_count){case 1:break;case 2:k.Solve2();break;case 3:k.Solve3();break;default:d.b2Assert(!1)}if(3==k.m_count)break;l=k.GetClosestPoint(),u=l.LengthSquared(),t=u;var x=k.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var y=m[k.m_count];y.indexA=f.GetSupport(e.MulTMV(i.R,x.GetNegative())),y.wA=e.MulX(i,f.GetVertex(y.indexA)),y.indexB=g.GetSupport(e.MulTMV(j.R,x)),y.wB=e.MulX(j,g.GetVertex(y.indexB)),y.w=e.SubtractVV(y.wB,y.wA),++w,++o.b2_gjkIters;var z=!1;for(v=0;v<r;v++)if(y.indexA==p[v]&&y.indexB==q[v]){z=!0;break}if(z)break;++k.m_count}if(o.b2_gjkMaxIters=e.Max(o.b2_gjkMaxIters,w),k.GetWitnessPoints(a.pointA,a.pointB),a.distance=e.SubtractVV(a.pointA,a.pointB).Length(),a.iterations=w,k.WriteCache(b),c.useRadii){var A=f.m_radius,B=g.m_radius;if(a.distance>A+B&&a.distance>Number.MIN_VALUE){a.distance-=A+B;var C=e.SubtractVV(a.pointB,a.pointA);C.Normalize(),a.pointA.x+=A*C.x,a.pointA.y+=A*C.y,a.pointB.x-=B*C.x,a.pointB.y-=B*C.y}else l=new h,l.x=.5*(a.pointA.x+a.pointB.x),l.y=.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=l.x,a.pointA.y=a.pointB.y=l.y,a.distance=0}},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new D,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),p.b2DistanceInput=function(){},q.b2DistanceOutput=function(){this.pointA=new h,this.pointB=new h},r.b2DistanceProxy=function(){},r.prototype.Set=function(e){switch(e.GetType()){case c.e_circleShape:var f=e instanceof a?e:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=f.m_p,this.m_count=1,this.m_radius=f.m_radius;break;case c.e_polygonShape:var g=e instanceof b?e:null;this.m_vertices=g.m_vertices,this.m_count=g.m_vertexCount,this.m_radius=g.m_radius;break;default:d.b2Assert(!1)}},r.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},r.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_count;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},r.prototype.GetVertexCount=function(){return this.m_count},r.prototype.GetVertex=function(a){return void 0===a&&(a=0),d.b2Assert(0<=a&&a<this.m_count),this.m_vertices[a]},s.b2DynamicTree=function(){},s.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},s.prototype.CreateProxy=function(a,b){var c=this.AllocateNode(),e=d.b2_aabbExtension,f=d.b2_aabbExtension;return c.aabb.lowerBound.x=a.lowerBound.x-e,c.aabb.lowerBound.y=a.lowerBound.y-f,c.aabb.upperBound.x=a.upperBound.x+e,c.aabb.upperBound.y=a.upperBound.y+f,c.userData=b,this.InsertLeaf(c),c},s.prototype.DestroyProxy=function(a){this.RemoveLeaf(a),this.FreeNode(a)},s.prototype.MoveProxy=function(a,b,c){if(d.b2Assert(a.IsLeaf()),a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var e=d.b2_aabbExtension+d.b2_aabbMultiplier*(c.x>0?c.x:-c.x),f=d.b2_aabbExtension+d.b2_aabbMultiplier*(c.y>0?c.y:-c.y);return a.aabb.lowerBound.x=b.lowerBound.x-e,a.aabb.lowerBound.y=b.lowerBound.y-f,a.aabb.upperBound.x=b.upperBound.x+e,a.aabb.upperBound.y=b.upperBound.y+f,this.InsertLeaf(a),!0},s.prototype.Rebalance=function(a){if(void 0===a&&(a=0),null!=this.m_root)for(var b=0;b<a;b++){for(var c=this.m_root,d=0;0==c.IsLeaf();)c=this.m_path>>d&1?c.child2:c.child1,d=d+1&31;++this.m_path,this.RemoveLeaf(c),this.InsertLeaf(c)}},s.prototype.GetFatAABB=function(a){return a.aabb},s.prototype.GetUserData=function(a){return a.userData},s.prototype.Query=function(a,b){if(null!=this.m_root){var c=new Vector,d=0;for(c[d++]=this.m_root;d>0;){var e=c[--d];if(e.aabb.TestOverlap(b))if(e.IsLeaf()){var f=a(e);if(!f)return}else c[d++]=e.child1,c[d++]=e.child2}}},s.prototype.RayCast=function(a,b){if(null!=this.m_root){var c=b.p1,d=b.p2,f=e.SubtractVV(c,d);f.Normalize();var g=e.CrossFV(1,f),h=e.AbsV(g),j=b.maxFraction,k=new i,l=0,m=0;l=c.x+j*(d.x-c.x),m=c.y+j*(d.y-c.y),k.lowerBound.x=Math.min(c.x,l),k.lowerBound.y=Math.min(c.y,m),k.upperBound.x=Math.max(c.x,l),k.upperBound.y=Math.max(c.y,m);var n=new Vector,o=0;for(n[o++]=this.m_root;o>0;){var p=n[--o];if(0!=p.aabb.TestOverlap(k)){var q=p.aabb.GetCenter(),r=p.aabb.GetExtents();if(!(Math.abs(g.x*(c.x-q.x)+g.y*(c.y-q.y))-h.x*r.x-h.y*r.y>0))if(p.IsLeaf()){var s=new z;if(s.p1=b.p1,s.p2=b.p2,s.maxFraction=b.maxFraction,0==(j=a(s,p)))return;j>0&&(l=c.x+j*(d.x-c.x),m=c.y+j*(d.y-c.y),k.lowerBound.x=Math.min(c.x,l),k.lowerBound.y=Math.min(c.y,m),k.upperBound.x=Math.max(c.x,l),k.upperBound.y=Math.max(c.y,m))}else n[o++]=p.child1,n[o++]=p.child2}}}},s.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;return this.m_freeList=a.parent,a.parent=null,a.child1=null,a.child2=null,a}return new u},s.prototype.FreeNode=function(a){a.parent=this.m_freeList,this.m_freeList=a},s.prototype.InsertLeaf=function(a){if(++this.m_insertionCount,null==this.m_root)return this.m_root=a,void(this.m_root.parent=null);var b=a.aabb.GetCenter(),c=this.m_root;if(0==c.IsLeaf())do{var d=c.child1,e=c.child2,f=Math.abs((d.aabb.lowerBound.x+d.aabb.upperBound.x)/2-b.x)+Math.abs((d.aabb.lowerBound.y+d.aabb.upperBound.y)/2-b.y),g=Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-b.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-b.y);c=f<g?d:e}while(0==c.IsLeaf());var h=c.parent,i=this.AllocateNode();if(i.parent=h,i.userData=null,i.aabb.Combine(a.aabb,c.aabb),h){c.parent.child1==c?h.child1=i:h.child2=i,i.child1=c,i.child2=a,c.parent=i,a.parent=i;do{if(h.aabb.Contains(i.aabb))break;h.aabb.Combine(h.child1.aabb,h.child2.aabb),i=h,h=h.parent}while(h)}else i.child1=c,i.child2=a,c.parent=i,a.parent=i,this.m_root=i},s.prototype.RemoveLeaf=function(a){if(a==this.m_root)return void(this.m_root=null);var b,c=a.parent,d=c.parent;if(b=c.child1==a?c.child2:c.child1,d)for(d.child1==c?d.child1=b:d.child2=b,b.parent=d,this.FreeNode(c);d;){var e=d.aabb;if(d.aabb=i.Combine(d.child1.aabb,d.child2.aabb),e.Contains(d.aabb))break;d=d.parent}else this.m_root=b,b.parent=null,this.FreeNode(c)},t.b2DynamicTreeBroadPhase=function(){this.m_tree=new s,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},t.prototype.CreateProxy=function(a,b){var c=this.m_tree.CreateProxy(a,b);return++this.m_proxyCount,this.BufferMove(c),c},t.prototype.DestroyProxy=function(a){this.UnBufferMove(a),--this.m_proxyCount,this.m_tree.DestroyProxy(a)},t.prototype.MoveProxy=function(a,b,c){this.m_tree.MoveProxy(a,b,c)&&this.BufferMove(a)},t.prototype.TestOverlap=function(a,b){var c=this.m_tree.GetFatAABB(a),d=this.m_tree.GetFatAABB(b);return c.TestOverlap(d)},t.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)},t.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)},t.prototype.GetProxyCount=function(){return this.m_proxyCount},t.prototype.UpdatePairs=function(a){function b(a){if(a==d)return!0;c.m_pairCount==c.m_pairBuffer.length&&(c.m_pairBuffer[c.m_pairCount]=new v);var b=c.m_pairBuffer[c.m_pairCount];return b.proxyA=a<d?a:d,b.proxyB=a>=d?a:d,++c.m_pairCount,!0}var c=this;c.m_pairCount=0;var d,e=0;for(e=0;e<c.m_moveBuffer.length;++e){d=c.m_moveBuffer[e];var f=c.m_tree.GetFatAABB(d);c.m_tree.Query(b,f)}c.m_moveBuffer.length=0;for(var e=0;e<c.m_pairCount;){var g=c.m_pairBuffer[e],h=c.m_tree.GetUserData(g.proxyA),i=c.m_tree.GetUserData(g.proxyB);for(a(h,i),++e;e<c.m_pairCount;){var j=c.m_pairBuffer[e];if(j.proxyA!=g.proxyA||j.proxyB!=g.proxyB)break;++e}}},t.prototype.Query=function(a,b){this.m_tree.Query(a,b)},t.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)},t.prototype.Validate=function(){},t.prototype.Rebalance=function(a){void 0===a&&(a=0),this.m_tree.Rebalance(a)},t.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a},t.prototype.UnBufferMove=function(a){var b=parseInt(this.m_moveBuffer.indexOf(a));this.m_moveBuffer.splice(b,1)},t.prototype.ComparePairs=function(a,b){return 0},t.__implements={},t.__implements[L]=!0,u.b2DynamicTreeNode=function(){this.aabb=new i},u.prototype.IsLeaf=function(){return null==this.child1},v.b2DynamicTreePair=function(){},w.b2Manifold=function(){this.m_pointCount=0},w.prototype.b2Manifold=function(){this.m_points=new Vector(d.b2_maxManifoldPoints);for(var a=0;a<d.b2_maxManifoldPoints;a++)this.m_points[a]=new x;this.m_localPlaneNormal=new h,this.m_localPoint=new h},w.prototype.Reset=function(){for(var a=0;a<d.b2_maxManifoldPoints;a++)(this.m_points[a]instanceof x?this.m_points[a]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},w.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<d.b2_maxManifoldPoints;b++)(this.m_points[b]instanceof x?this.m_points[b]:null).Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal),this.m_localPoint.SetV(a.m_localPoint),this.m_type=a.m_type},w.prototype.Copy=function(){var a=new w;return a.Set(this),a},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),x.b2ManifoldPoint=function(){this.m_localPoint=new h,this.m_id=new m},x.prototype.b2ManifoldPoint=function(){this.Reset()},x.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},x.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint),this.m_normalImpulse=a.m_normalImpulse,this.m_tangentImpulse=a.m_tangentImpulse,this.m_id.Set(a.m_id)},y.b2Point=function(){this.p=new h},y.prototype.Support=function(a,b,c){return void 0===b&&(b=0),void 0===c&&(c=0),this.p},y.prototype.GetFirstVertex=function(a){return this.p},z.b2RayCastInput=function(){this.p1=new h,this.p2=new h},z.prototype.b2RayCastInput=function(a,b,c){void 0===a&&(a=null),void 0===b&&(b=null),void 0===c&&(c=1),a&&this.p1.SetV(a),b&&this.p2.SetV(b),this.maxFraction=c},A.b2RayCastOutput=function(){this.normal=new h},B.b2Segment=function(){this.p1=new h,this.p2=new h},B.prototype.TestSegment=function(a,b,c,d){void 0===d&&(d=0);var e=c.p1,f=c.p2.x-e.x,g=c.p2.y-e.y,h=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y,j=i,k=-h,l=100*Number.MIN_VALUE,m=-(f*j+g*k);if(m>l){var n=e.x-this.p1.x,o=e.y-this.p1.y,p=n*j+o*k;if(0<=p&&p<=d*m){var q=-f*o+g*n;if(-l*m<=q&&q<=m*(1+l)){p/=m;var r=Math.sqrt(j*j+k*k);return j/=r,k/=r,a[0]=p,b.Set(j,k),!0}}}return!1},B.prototype.Extend=function(a){this.ExtendForward(a),this.ExtendBackward(a)},B.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,c=this.p2.y-this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:b<0?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p1.y)/c:c<0?(a.lowerBound.y-this.p1.y)/c:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+b*d,this.p2.y=this.p1.y+c*d},B.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,c=-this.p2.y+this.p1.y,d=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:b<0?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,c>0?(a.upperBound.y-this.p2.y)/c:c<0?(a.lowerBound.y-this.p2.y)/c:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*d,this.p1.y=this.p2.y+c*d},C.b2SeparationFunction=function(){this.m_localPoint=new h,this.m_axis=new h},C.prototype.Initialize=function(a,b,c,f,g){this.m_proxyA=b,this.m_proxyB=f;var i=parseInt(a.count);d.b2Assert(0<i&&i<3);var j,k,l,m,n,o,p,q,r=0,s=0,t=0,u=0,v=0,w=0,x=0;if(1==i)this.m_type=C.e_points,j=this.m_proxyA.GetVertex(a.indexA[0]),m=this.m_proxyB.GetVertex(a.indexB[0]),q=j,p=c.R,r=c.position.x+(p.col1.x*q.x+p.col2.x*q.y),s=c.position.y+(p.col1.y*q.x+p.col2.y*q.y),q=m,p=g.R,t=g.position.x+(p.col1.x*q.x+p.col2.x*q.y),u=g.position.y+(p.col1.y*q.x+p.col2.y*q.y),this.m_axis.x=t-r,this.m_axis.y=u-s,this.m_axis.Normalize();else if(a.indexB[0]==a.indexB[1])this.m_type=C.e_faceA,k=this.m_proxyA.GetVertex(a.indexA[0]),l=this.m_proxyA.GetVertex(a.indexA[1]),m=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=.5*(k.x+l.x),this.m_localPoint.y=.5*(k.y+l.y),this.m_axis=e.CrossVF(e.SubtractVV(l,k),1),this.m_axis.Normalize(),q=this.m_axis,p=c.R,v=p.col1.x*q.x+p.col2.x*q.y,w=p.col1.y*q.x+p.col2.y*q.y,q=this.m_localPoint,p=c.R,r=c.position.x+(p.col1.x*q.x+p.col2.x*q.y),s=c.position.y+(p.col1.y*q.x+p.col2.y*q.y),q=m,p=g.R,t=g.position.x+(p.col1.x*q.x+p.col2.x*q.y),u=g.position.y+(p.col1.y*q.x+p.col2.y*q.y),(x=(t-r)*v+(u-s)*w)<0&&this.m_axis.NegativeSelf();else if(a.indexA[0]==a.indexA[0])this.m_type=C.e_faceB,n=this.m_proxyB.GetVertex(a.indexB[0]),o=this.m_proxyB.GetVertex(a.indexB[1]),j=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=.5*(n.x+o.x),this.m_localPoint.y=.5*(n.y+o.y),this.m_axis=e.CrossVF(e.SubtractVV(o,n),1),this.m_axis.Normalize(),q=this.m_axis,p=g.R,v=p.col1.x*q.x+p.col2.x*q.y,w=p.col1.y*q.x+p.col2.y*q.y,q=this.m_localPoint,p=g.R,t=g.position.x+(p.col1.x*q.x+p.col2.x*q.y),u=g.position.y+(p.col1.y*q.x+p.col2.y*q.y),q=j,p=c.R,r=c.position.x+(p.col1.x*q.x+p.col2.x*q.y),s=c.position.y+(p.col1.y*q.x+p.col2.y*q.y),(x=(r-t)*v+(s-u)*w)<0&&this.m_axis.NegativeSelf();else{k=this.m_proxyA.GetVertex(a.indexA[0]),l=this.m_proxyA.GetVertex(a.indexA[1]),n=this.m_proxyB.GetVertex(a.indexB[0]),o=this.m_proxyB.GetVertex(a.indexB[1]);var y=(e.MulX(c,j),e.MulMV(c.R,e.SubtractVV(l,k))),z=(e.MulX(g,m),e.MulMV(g.R,e.SubtractVV(o,n))),A=y.x*y.x+y.y*y.y,B=z.x*z.x+z.y*z.y,D=e.SubtractVV(z,y),E=y.x*D.x+y.y*D.y,F=z.x*D.x+z.y*D.y,G=y.x*z.x+y.y*z.y,H=A*B-G*G;x=0,0!=H&&(x=e.Clamp((G*F-E*B)/H,0,1));var I=(G*x+F)/B;I<0&&(I=0,x=e.Clamp((G-E)/A,0,1)),j=new h,j.x=k.x+x*(l.x-k.x),j.y=k.y+x*(l.y-k.y),m=new h,m.x=n.x+x*(o.x-n.x),m.y=n.y+x*(o.y-n.y),0==x||1==x?(this.m_type=C.e_faceB,this.m_axis=e.CrossVF(e.SubtractVV(o,n),1),this.m_axis.Normalize(),this.m_localPoint=m,q=this.m_axis,p=g.R,v=p.col1.x*q.x+p.col2.x*q.y,w=p.col1.y*q.x+p.col2.y*q.y,q=this.m_localPoint,p=g.R,t=g.position.x+(p.col1.x*q.x+p.col2.x*q.y),u=g.position.y+(p.col1.y*q.x+p.col2.y*q.y),q=j,p=c.R,r=c.position.x+(p.col1.x*q.x+p.col2.x*q.y),s=c.position.y+(p.col1.y*q.x+p.col2.y*q.y),(r-t)*v+(s-u)*w,x<0&&this.m_axis.NegativeSelf()):(this.m_type=C.e_faceA,this.m_axis=e.CrossVF(e.SubtractVV(l,k),1),this.m_localPoint=j,q=this.m_axis,p=c.R,v=p.col1.x*q.x+p.col2.x*q.y,w=p.col1.y*q.x+p.col2.y*q.y,q=this.m_localPoint,p=c.R,r=c.position.x+(p.col1.x*q.x+p.col2.x*q.y),s=c.position.y+(p.col1.y*q.x+p.col2.y*q.y),q=m,p=g.R,t=g.position.x+(p.col1.x*q.x+p.col2.x*q.y),u=g.position.y+(p.col1.y*q.x+p.col2.y*q.y),(t-r)*v+(u-s)*w,x<0&&this.m_axis.NegativeSelf())}},C.prototype.Evaluate=function(a,b){var c,f,g,h,i,j,k;switch(this.m_type){case C.e_points:return c=e.MulTMV(a.R,this.m_axis),f=e.MulTMV(b.R,this.m_axis.GetNegative()),g=this.m_proxyA.GetSupportVertex(c),h=this.m_proxyB.GetSupportVertex(f),i=e.MulX(a,g),j=e.MulX(b,h),(j.x-i.x)*this.m_axis.x+(j.y-i.y)*this.m_axis.y;case C.e_faceA:return k=e.MulMV(a.R,this.m_axis),i=e.MulX(a,this.m_localPoint),f=e.MulTMV(b.R,k.GetNegative()),h=this.m_proxyB.GetSupportVertex(f),j=e.MulX(b,h),(j.x-i.x)*k.x+(j.y-i.y)*k.y;case C.e_faceB:return k=e.MulMV(b.R,this.m_axis),j=e.MulX(b,this.m_localPoint),c=e.MulTMV(a.R,k.GetNegative()),g=this.m_proxyA.GetSupportVertex(c),i=e.MulX(a,g),(i.x-j.x)*k.x+(i.y-j.y)*k.y;default:return d.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),D.b2Simplex=function(){this.m_v1=new F,this.m_v2=new F,this.m_v3=new F,this.m_vertices=new Vector(3)},D.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},D.prototype.ReadCache=function(a,b,c,f,g){d.b2Assert(0<=a.count&&a.count<=3);var h,i;this.m_count=a.count;for(var j=this.m_vertices,k=0;k<this.m_count;k++){var l=j[k];l.indexA=a.indexA[k],l.indexB=a.indexB[k],h=b.GetVertex(l.indexA),i=f.GetVertex(l.indexB),l.wA=e.MulX(c,h),l.wB=e.MulX(g,i),l.w=e.SubtractVV(l.wB,l.wA),l.a=0}if(this.m_count>1){var m=a.metric,n=this.GetMetric();(n<.5*m||2*m<n||n<Number.MIN_VALUE)&&(this.m_count=0)}0==this.m_count&&(l=j[0],l.indexA=0,l.indexB=0,h=b.GetVertex(0),i=f.GetVertex(0),l.wA=e.MulX(c,h),l.wB=e.MulX(g,i),l.w=e.SubtractVV(l.wB,l.wA),this.m_count=1)},D.prototype.WriteCache=function(a){a.metric=this.GetMetric(),a.count=Box2D.parseUInt(this.m_count);for(var b=this.m_vertices,c=0;c<this.m_count;c++)a.indexA[c]=Box2D.parseUInt(b[c].indexA),a.indexB[c]=Box2D.parseUInt(b[c].indexB)},D.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=e.SubtractVV(this.m_v2.w,this.m_v1.w);return e.CrossVV(a,this.m_v1.w.GetNegative())>0?e.CrossFV(1,a):e.CrossVF(a,1);default:return d.b2Assert(!1),new h}},D.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return d.b2Assert(!1),new h;case 1:return this.m_v1.w;case 2:return new h(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return d.b2Assert(!1),new h}},D.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:d.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA),b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:d.b2Assert(!1)}},D.prototype.GetMetric=function(){switch(this.m_count){case 0:return d.b2Assert(!1),0;case 1:return 0;case 2:return e.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return e.CrossVV(e.SubtractVV(this.m_v2.w,this.m_v1.w),e.SubtractVV(this.m_v3.w,this.m_v1.w));default:return d.b2Assert(!1),0}},D.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,c=e.SubtractVV(b,a),d=-(a.x*c.x+a.y*c.y);if(d<=0)return this.m_v1.a=1,void(this.m_count=1);var f=b.x*c.x+b.y*c.y;if(f<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);var g=1/(f+d);this.m_v1.a=f*g,this.m_v2.a=d*g,this.m_count=2},D.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,c=this.m_v3.w,d=e.SubtractVV(b,a),f=e.Dot(a,d),g=e.Dot(b,d),h=g,i=-f,j=e.SubtractVV(c,a),k=e.Dot(a,j),l=e.Dot(c,j),m=l,n=-k,o=e.SubtractVV(c,b),p=e.Dot(b,o),q=e.Dot(c,o),r=q,s=-p,t=e.CrossVV(d,j),u=t*e.CrossVV(b,c),v=t*e.CrossVV(c,a),w=t*e.CrossVV(a,b);if(i<=0&&n<=0)return this.m_v1.a=1,void(this.m_count=1);if(h>0&&i>0&&w<=0){var x=1/(h+i);return this.m_v1.a=h*x,this.m_v2.a=i*x,void(this.m_count=2)}if(m>0&&n>0&&v<=0){var y=1/(m+n);return this.m_v1.a=m*y,this.m_v3.a=n*y,this.m_count=2,void this.m_v2.Set(this.m_v3)}if(h<=0&&s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Set(this.m_v2);if(m<=0&&r<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Set(this.m_v3);if(r>0&&s>0&&u<=0){var z=1/(r+s);return this.m_v2.a=r*z,this.m_v3.a=s*z,this.m_count=2,void this.m_v1.Set(this.m_v3)}var A=1/(u+v+w);this.m_v1.a=u*A,this.m_v2.a=v*A,this.m_v3.a=w*A,this.m_count=3},E.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},F.b2SimplexVertex=function(){},F.prototype.Set=function(a){this.wA.SetV(a.wA),this.wB.SetV(a.wB),this.w.SetV(a.w),this.a=a.a,this.indexA=a.indexA,this.indexB=a.indexB},G.b2TimeOfImpact=function(){},G.TimeOfImpact=function(a){++G.b2_toiCalls;var b=a.proxyA,c=a.proxyB,f=a.sweepA,g=a.sweepB;d.b2Assert(f.t0==g.t0),d.b2Assert(1-f.t0>Number.MIN_VALUE);var h=b.m_radius+c.m_radius,i=a.tolerance,j=0,k=0,l=0;for(G.s_cache.count=0,G.s_distanceInput.useRadii=!1;;){if(f.GetTransform(G.s_xfA,j),g.GetTransform(G.s_xfB,j),G.s_distanceInput.proxyA=b,G.s_distanceInput.proxyB=c,G.s_distanceInput.transformA=G.s_xfA,G.s_distanceInput.transformB=G.s_xfB,o.Distance(G.s_distanceOutput,G.s_cache,G.s_distanceInput),G.s_distanceOutput.distance<=0){j=1;break}G.s_fcn.Initialize(G.s_cache,b,G.s_xfA,c,G.s_xfB);var m=G.s_fcn.Evaluate(G.s_xfA,G.s_xfB);if(m<=0){j=1;break}if(0==k&&(l=m>h?e.Max(h-i,.75*h):e.Max(m-i,.02*h)),m-l<.5*i){if(0==k){j=1;break}break}var n=j,p=j,q=1,r=m;f.GetTransform(G.s_xfA,q),g.GetTransform(G.s_xfB,q);var s=G.s_fcn.Evaluate(G.s_xfA,G.s_xfB);if(s>=l){j=1;break}for(var t=0;;){var u=0;u=1&t?p+(l-r)*(q-p)/(s-r):.5*(p+q),f.GetTransform(G.s_xfA,u),g.GetTransform(G.s_xfB,u);var v=G.s_fcn.Evaluate(G.s_xfA,G.s_xfB);if(e.Abs(v-l)<.025*i){n=u;break}if(v>l?(p=u,r=v):(q=u,s=v),++t,++G.b2_toiRootIters,50==t)break}if(G.b2_toiMaxRootIters=e.Max(G.b2_toiMaxRootIters,t),n<(1+100*Number.MIN_VALUE)*j)break;if(j=n,k++,++G.b2_toiIters,1e3==k)break}return G.b2_toiMaxIters=e.Max(G.b2_toiMaxIters,k),j},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new E,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new p,Box2D.Collision.b2TimeOfImpact.s_xfA=new g,Box2D.Collision.b2TimeOfImpact.s_xfB=new g,Box2D.Collision.b2TimeOfImpact.s_fcn=new C,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new q}),H.b2TOIInput=function(){this.proxyA=new r,this.proxyB=new r,this.sweepA=new f,this.sweepB=new f},I.b2WorldManifold=function(){this.m_normal=new h},I.prototype.b2WorldManifold=function(){this.m_points=new Vector(d.b2_maxManifoldPoints);for(var a=0;a<d.b2_maxManifoldPoints;a++)this.m_points[a]=new h},I.prototype.Initialize=function(a,b,c,d,e){if(void 0===c&&(c=0),void 0===e&&(e=0),0!=a.m_pointCount){var f,g,h=0,i=0,j=0,k=0,l=0,m=0,n=0;switch(a.m_type){case w.e_circles:g=b.R,f=a.m_localPoint;var o=b.position.x+g.col1.x*f.x+g.col2.x*f.y,p=b.position.y+g.col1.y*f.x+g.col2.y*f.y;g=d.R,f=a.m_points[0].m_localPoint;var q=d.position.x+g.col1.x*f.x+g.col2.x*f.y,r=d.position.y+g.col1.y*f.x+g.col2.y*f.y,s=q-o,t=r-p,u=s*s+t*t;if(u>Number.MIN_VALUE*Number.MIN_VALUE){var v=Math.sqrt(u);this.m_normal.x=s/v,this.m_normal.y=t/v}else this.m_normal.x=1,this.m_normal.y=0;var x=o+c*this.m_normal.x,y=p+c*this.m_normal.y,z=q-e*this.m_normal.x,A=r-e*this.m_normal.y;this.m_points[0].x=.5*(x+z),this.m_points[0].y=.5*(y+A);break;case w.e_faceA:for(g=b.R,f=a.m_localPlaneNormal,i=g.col1.x*f.x+g.col2.x*f.y,j=g.col1.y*f.x+g.col2.y*f.y,g=b.R,f=a.m_localPoint,k=b.position.x+g.col1.x*f.x+g.col2.x*f.y,l=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=i,this.m_normal.y=j,h=0;h<a.m_pointCount;h++)g=d.R,f=a.m_points[h].m_localPoint,m=d.position.x+g.col1.x*f.x+g.col2.x*f.y,n=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[h].x=m+.5*(c-(m-k)*i-(n-l)*j-e)*i,this.m_points[h].y=n+.5*(c-(m-k)*i-(n-l)*j-e)*j;break;case w.e_faceB:for(g=d.R,f=a.m_localPlaneNormal,i=g.col1.x*f.x+g.col2.x*f.y,j=g.col1.y*f.x+g.col2.y*f.y,g=d.R,f=a.m_localPoint,k=d.position.x+g.col1.x*f.x+g.col2.x*f.y,l=d.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_normal.x=-i,this.m_normal.y=-j,h=0;h<a.m_pointCount;h++)g=b.R,f=a.m_points[h].m_localPoint,m=b.position.x+g.col1.x*f.x+g.col2.x*f.y,n=b.position.y+g.col1.y*f.x+g.col2.y*f.y,this.m_points[h].x=m+.5*(e-(m-k)*i-(n-l)*j-c)*i,this.m_points[h].y=n+.5*(e-(m-k)*i-(n-l)*j-c)*j}}},J.ClipVertex=function(){this.v=new h,this.id=new m},J.prototype.Set=function(a){this.v.SetV(a.v),this.id.Set(a.id)},K.Features=function(){},Object.defineProperty(K.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(K.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._referenceEdge=a,this._m_id._key=4294967040&this._m_id._key|255&this._referenceEdge}}),Object.defineProperty(K.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(K.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._incidentEdge=a,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280}}),Object.defineProperty(K.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(K.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._incidentVertex=a,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680}}),Object.defineProperty(K.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(K.prototype,"flip",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._flip=a,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080}})}(),function(){var a=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),b=Box2D.Collision.Shapes.b2CircleShape,c=Box2D.Collision.Shapes.b2EdgeChainDef,d=Box2D.Collision.Shapes.b2EdgeShape,e=Box2D.Collision.Shapes.b2MassData,f=Box2D.Collision.Shapes.b2PolygonShape,g=Box2D.Collision.Shapes.b2Shape,h=Box2D.Common.Math.b2Mat22,i=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),j=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform),k=Box2D.Common.Math.b2Vec2,l=(Box2D.Common.Math.b2Vec3,Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance),m=Box2D.Collision.b2DistanceInput,n=Box2D.Collision.b2DistanceOutput,o=Box2D.Collision.b2DistanceProxy,p=(Box2D.Collision.b2DynamicTree,
Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache);Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase;Box2D.inherit(b,Box2D.Collision.Shapes.b2Shape),b.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,b.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new k},b.prototype.Copy=function(){var a=new b;return a.Set(this),a},b.prototype.Set=function(a){if(this.__super.Set.call(this,a),Box2D.is(a,b)){var c=a instanceof b?a:null;this.m_p.SetV(c.m_p)}},b.prototype.TestPoint=function(a,b){var c=a.R,d=a.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);return d=b.x-d,e=b.y-e,d*d+e*e<=this.m_radius*this.m_radius},b.prototype.RayCast=function(a,b,c){var d=c.R,e=c.position.x+(d.col1.x*this.m_p.x+d.col2.x*this.m_p.y),f=c.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y),g=b.p1.x-e,h=b.p1.y-f,i=g*g+h*h-this.m_radius*this.m_radius,j=b.p2.x-b.p1.x,k=b.p2.y-b.p1.y,l=g*j+h*k,m=j*j+k*k,n=l*l-m*i;if(n<0||m<Number.MIN_VALUE)return!1;var o=-(l+Math.sqrt(n));return 0<=o&&o<=b.maxFraction*m&&(o/=m,a.fraction=o,a.normal.x=g+o*j,a.normal.y=h+o*k,a.normal.Normalize(),!0)},b.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),e=b.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,e-this.m_radius),a.upperBound.Set(d+this.m_radius,e+this.m_radius)},b.prototype.ComputeMass=function(b,c){void 0===c&&(c=0),b.mass=c*a.b2_pi*this.m_radius*this.m_radius,b.center.SetV(this.m_p),b.I=b.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},b.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var e=i.MulX(c,this.m_p),f=-(i.Dot(a,e)-b);if(f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return d.SetV(e),Math.PI*this.m_radius*this.m_radius;var g=this.m_radius*this.m_radius,h=f*f,j=g*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(g-h),k=-2/3*Math.pow(g-h,1.5)/j;return d.x=e.x+a.x*k,d.y=e.y+a.y*k,j},b.prototype.GetLocalPosition=function(){return this.m_p},b.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)},b.prototype.GetRadius=function(){return this.m_radius},b.prototype.SetRadius=function(a){void 0===a&&(a=0),this.m_radius=a},b.prototype.b2CircleShape=function(a){void 0===a&&(a=0),this.__super.b2Shape.call(this),this.m_type=g.e_circleShape,this.m_radius=a},c.b2EdgeChainDef=function(){},c.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(d,Box2D.Collision.Shapes.b2Shape),d.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,d.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new k,this.m_v1=new k,this.m_v2=new k,this.m_coreV1=new k,this.m_coreV2=new k,this.m_normal=new k,this.m_direction=new k,this.m_cornerDir1=new k,this.m_cornerDir2=new k},d.prototype.TestPoint=function(a,b){return!1},d.prototype.RayCast=function(a,b,c){var d,e=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;d=c.R;var g=c.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),h=c.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),i=c.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-h,j=-(c.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-g),k=100*Number.MIN_VALUE,l=-(e*i+f*j);if(l>k){var m=b.p1.x-g,n=b.p1.y-h,o=m*i+n*j;if(0<=o&&o<=b.maxFraction*l){var p=-e*n+f*m;if(-k*l<=p&&p<=l*(1+k)){o/=l,a.fraction=o;var q=Math.sqrt(i*i+j*j);return a.normal.x=i/q,a.normal.y=j/q,!0}}}return!1},d.prototype.ComputeAABB=function(a,b){var c=b.R,d=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),e=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),f=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),g=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);d<f?(a.lowerBound.x=d,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=d),e<g?(a.lowerBound.y=e,a.upperBound.y=g):(a.lowerBound.y=g,a.upperBound.y=e)},d.prototype.ComputeMass=function(a,b){void 0===b&&(b=0),a.mass=0,a.center.SetV(this.m_v1),a.I=0},d.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var e=new k(a.x*b,a.y*b),f=i.MulX(c,this.m_v1),g=i.MulX(c,this.m_v2),h=i.Dot(a,f)-b,j=i.Dot(a,g)-b;if(h>0){if(j>0)return 0;f.x=-j/(h-j)*f.x+h/(h-j)*g.x,f.y=-j/(h-j)*f.y+h/(h-j)*g.y}else j>0&&(g.x=-j/(h-j)*f.x+h/(h-j)*g.x,g.y=-j/(h-j)*f.y+h/(h-j)*g.y);return d.x=(e.x+f.x+g.x)/3,d.y=(e.y+f.y+g.y)/3,.5*((f.x-e.x)*(g.y-e.y)-(f.y-e.y)*(g.x-e.x))},d.prototype.GetLength=function(){return this.m_length},d.prototype.GetVertex1=function(){return this.m_v1},d.prototype.GetVertex2=function(){return this.m_v2},d.prototype.GetCoreVertex1=function(){return this.m_coreV1},d.prototype.GetCoreVertex2=function(){return this.m_coreV2},d.prototype.GetNormalVector=function(){return this.m_normal},d.prototype.GetDirectionVector=function(){return this.m_direction},d.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},d.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},d.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},d.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},d.prototype.GetFirstVertex=function(a){var b=a.R;return new k(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))},d.prototype.GetNextEdge=function(){return this.m_nextEdge},d.prototype.GetPrevEdge=function(){return this.m_prevEdge},d.prototype.Support=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d=a.R,e=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),f=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),g=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),h=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);return e*b+f*c>g*b+h*c?(this.s_supportVec.x=e,this.s_supportVec.y=f):(this.s_supportVec.x=g,this.s_supportVec.y=h),this.s_supportVec},d.prototype.b2EdgeShape=function(b,c){this.__super.b2Shape.call(this),this.m_type=g.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=b,this.m_v2=c,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-a.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-a.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-a.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-a.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},d.prototype.SetPrevEdge=function(a,b,c,d){this.m_prevEdge=a,this.m_coreV1=b,this.m_cornerDir1=c,this.m_cornerConvex1=d},d.prototype.SetNextEdge=function(a,b,c,d){this.m_nextEdge=a,this.m_coreV2=b,this.m_cornerDir2=c,this.m_cornerConvex2=d},e.b2MassData=function(){this.mass=0,this.center=new k(0,0),this.I=0},Box2D.inherit(f,Box2D.Collision.Shapes.b2Shape),f.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,f.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},f.prototype.Copy=function(){var a=new f;return a.Set(this),a},f.prototype.Set=function(a){if(this.__super.Set.call(this,a),Box2D.is(a,f)){var b=a instanceof f?a:null;this.m_centroid.SetV(b.m_centroid),this.m_vertexCount=b.m_vertexCount,this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(b.m_vertices[c]),this.m_normals[c].SetV(b.m_normals[c])}},f.prototype.SetAsArray=function(a,b){void 0===b&&(b=0);var c,d=new Vector,e=0;for(e=0;e<a.length;++e)c=a[e],d.push(c);this.SetAsVector(d,b)},f.AsArray=function(a,b){void 0===b&&(b=0);var c=new f;return c.SetAsArray(a,b),c},f.prototype.SetAsVector=function(b,c){void 0===c&&(c=0),0==c&&(c=b.length),a.b2Assert(2<=c),this.m_vertexCount=c,this.Reserve(c);var d=0;for(d=0;d<this.m_vertexCount;d++)this.m_vertices[d].SetV(b[d]);for(d=0;d<this.m_vertexCount;++d){var e=parseInt(d),g=parseInt(d+1<this.m_vertexCount?d+1:0),h=i.SubtractVV(this.m_vertices[g],this.m_vertices[e]);a.b2Assert(h.LengthSquared()>Number.MIN_VALUE),this.m_normals[d].SetV(i.CrossVF(h,1)),this.m_normals[d].Normalize()}this.m_centroid=f.ComputeCentroid(this.m_vertices,this.m_vertexCount)},f.AsVector=function(a,b){void 0===b&&(b=0);var c=new f;return c.SetAsVector(a,b),c},f.prototype.SetAsBox=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},f.AsBox=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0);var c=new f;return c.SetAsBox(a,b),c},f.prototype.SetAsOrientedBox=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=null),void 0===d&&(d=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-a,-b),this.m_vertices[1].Set(a,-b),this.m_vertices[2].Set(a,b),this.m_vertices[3].Set(-a,b),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=c;var e=new j;e.position=c,e.R.Set(d);for(var f=0;f<this.m_vertexCount;++f)this.m_vertices[f]=i.MulX(e,this.m_vertices[f]),this.m_normals[f]=i.MulMV(e.R,this.m_normals[f])},f.AsOrientedBox=function(a,b,c,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=null),void 0===d&&(d=0);var e=new f;return e.SetAsOrientedBox(a,b,c,d),e},f.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(a),this.m_vertices[1].SetV(b),this.m_centroid.x=.5*(a.x+b.x),this.m_centroid.y=.5*(a.y+b.y),this.m_normals[0]=i.CrossVF(i.SubtractVV(b,a),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},f.AsEdge=function(a,b){var c=new f;return c.SetAsEdge(a,b),c},f.prototype.TestPoint=function(a,b){for(var c,d=a.R,e=b.x-a.position.x,f=b.y-a.position.y,g=e*d.col1.x+f*d.col1.y,h=e*d.col2.x+f*d.col2.y,i=0;i<this.m_vertexCount;++i){c=this.m_vertices[i],e=g-c.x,f=h-c.y,c=this.m_normals[i];if(c.x*e+c.y*f>0)return!1}return!0},f.prototype.RayCast=function(a,b,c){var d,e,f=0,g=b.maxFraction,h=0,i=0;h=b.p1.x-c.position.x,i=b.p1.y-c.position.y,d=c.R;var j=h*d.col1.x+i*d.col1.y,k=h*d.col2.x+i*d.col2.y;h=b.p2.x-c.position.x,i=b.p2.y-c.position.y,d=c.R;for(var l=h*d.col1.x+i*d.col1.y,m=h*d.col2.x+i*d.col2.y,n=l-j,o=m-k,p=parseInt(-1),q=0;q<this.m_vertexCount;++q){e=this.m_vertices[q],h=e.x-j,i=e.y-k,e=this.m_normals[q];var r=e.x*h+e.y*i,s=e.x*n+e.y*o;if(0==s){if(r<0)return!1}else s<0&&r<f*s?(f=r/s,p=q):s>0&&r<g*s&&(g=r/s);if(g<f-Number.MIN_VALUE)return!1}return p>=0&&(a.fraction=f,d=c.R,e=this.m_normals[p],a.normal.x=d.col1.x*e.x+d.col2.x*e.y,a.normal.y=d.col1.y*e.x+d.col2.y*e.y,!0)},f.prototype.ComputeAABB=function(a,b){for(var c=b.R,d=this.m_vertices[0],e=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),f=b.position.y+(c.col1.y*d.x+c.col2.y*d.y),g=e,h=f,i=1;i<this.m_vertexCount;++i){d=this.m_vertices[i];var j=b.position.x+(c.col1.x*d.x+c.col2.x*d.y),k=b.position.y+(c.col1.y*d.x+c.col2.y*d.y);e=e<j?e:j,f=f<k?f:k,g=g>j?g:j,h=h>k?h:k}a.lowerBound.x=e-this.m_radius,a.lowerBound.y=f-this.m_radius,a.upperBound.x=g+this.m_radius,a.upperBound.y=h+this.m_radius},f.prototype.ComputeMass=function(a,b){if(void 0===b&&(b=0),2==this.m_vertexCount)return a.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,void(a.I=0);for(var c=0,d=0,e=0,f=0,g=0,h=0,i=1/3,j=0;j<this.m_vertexCount;++j){var k=this.m_vertices[j],l=j+1<this.m_vertexCount?this.m_vertices[parseInt(j+1)]:this.m_vertices[0],m=k.x-g,n=k.y-h,o=l.x-g,p=l.y-h,q=m*p-n*o,r=.5*q;e+=r,c+=r*i*(g+k.x+l.x),d+=r*i*(h+k.y+l.y);var s=g,t=h,u=m,v=n,w=o,x=p;f+=q*(i*(.25*(u*u+w*u+w*w)+(s*u+s*w))+.5*s*s+(i*(.25*(v*v+x*v+x*x)+(t*v+t*x))+.5*t*t))}a.mass=b*e,c*=1/e,d*=1/e,a.center.Set(c,d),a.I=b*f},f.prototype.ComputeSubmergedArea=function(a,b,c,d){void 0===b&&(b=0);var f=i.MulTMV(c.R,a),g=b-i.Dot(a,c.position),h=new Vector_a2j_Number,j=0,l=parseInt(-1),m=parseInt(-1),n=!1,o=0;for(o=0;o<this.m_vertexCount;++o){h[o]=i.Dot(f,this.m_vertices[o])-g;var p=h[o]<-Number.MIN_VALUE;o>0&&(p?n||(l=o-1,j++):n&&(m=o-1,j++)),n=p}switch(j){case 0:if(n){var q=new e;return this.ComputeMass(q,1),d.SetV(i.MulX(c,q.center)),q.mass}return 0;case 1:-1==l?l=this.m_vertexCount-1:m=this.m_vertexCount-1}var r,s=parseInt((l+1)%this.m_vertexCount),t=parseInt((m+1)%this.m_vertexCount),u=(0-h[l])/(h[s]-h[l]),v=(0-h[m])/(h[t]-h[m]),w=new k(this.m_vertices[l].x*(1-u)+this.m_vertices[s].x*u,this.m_vertices[l].y*(1-u)+this.m_vertices[s].y*u),x=new k(this.m_vertices[m].x*(1-v)+this.m_vertices[t].x*v,this.m_vertices[m].y*(1-v)+this.m_vertices[t].y*v),y=0,z=new k,A=this.m_vertices[s];for(o=s;o!=t;){o=(o+1)%this.m_vertexCount,r=o==t?x:this.m_vertices[o];var B=.5*((A.x-w.x)*(r.y-w.y)-(A.y-w.y)*(r.x-w.x));y+=B,z.x+=B*(w.x+A.x+r.x)/3,z.y+=B*(w.y+A.y+r.y)/3,A=r}return z.Multiply(1/y),d.SetV(i.MulX(c,z)),y},f.prototype.GetVertexCount=function(){return this.m_vertexCount},f.prototype.GetVertices=function(){return this.m_vertices},f.prototype.GetNormals=function(){return this.m_normals},f.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return b},f.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var e=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;e>c&&(b=d,c=e)}return this.m_vertices[b]},f.prototype.Validate=function(){return!1},f.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=g.e_polygonShape,this.m_centroid=new k,this.m_vertices=new Vector,this.m_normals=new Vector},f.prototype.Reserve=function(a){void 0===a&&(a=0);for(var b=parseInt(this.m_vertices.length);b<a;b++)this.m_vertices[b]=new k,this.m_normals[b]=new k},f.ComputeCentroid=function(a,b){void 0===b&&(b=0);for(var c=new k,d=0,e=0,f=0,g=1/3,h=0;h<b;++h){var i=a[h],j=h+1<b?a[parseInt(h+1)]:a[0],l=i.x-e,m=i.y-f,n=j.x-e,o=j.y-f,p=l*o-m*n,q=.5*p;d+=q,c.x+=q*g*(e+i.x+j.x),c.y+=q*g*(f+i.y+j.y)}return c.x*=1/d,c.y*=1/d,c},f.ComputeOBB=function(a,b,c){void 0===c&&(c=0);var d=0,e=new Vector(c+1);for(d=0;d<c;++d)e[d]=b[d];e[c]=e[0];var f=Number.MAX_VALUE;for(d=1;d<=c;++d){var g=e[parseInt(d-1)],h=e[d].x-g.x,i=e[d].y-g.y,j=Math.sqrt(h*h+i*i);h/=j,i/=j;for(var k=-i,l=h,m=Number.MAX_VALUE,n=Number.MAX_VALUE,o=-Number.MAX_VALUE,p=-Number.MAX_VALUE,q=0;q<c;++q){var r=e[q].x-g.x,s=e[q].y-g.y,t=h*r+i*s,u=k*r+l*s;t<m&&(m=t),u<n&&(n=u),t>o&&(o=t),u>p&&(p=u)}var v=(o-m)*(p-n);if(v<.95*f){f=v,a.R.col1.x=h,a.R.col1.y=i,a.R.col2.x=k,a.R.col2.y=l;var w=.5*(m+o),x=.5*(n+p),y=a.R;a.center.x=g.x+(y.col1.x*w+y.col2.x*x),a.center.y=g.y+(y.col1.y*w+y.col2.y*x),a.extents.x=.5*(o-m),a.extents.y=.5*(p-n)}}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new h}),g.b2Shape=function(){},g.prototype.Copy=function(){return null},g.prototype.Set=function(a){this.m_radius=a.m_radius},g.prototype.GetType=function(){return this.m_type},g.prototype.TestPoint=function(a,b){return!1},g.prototype.RayCast=function(a,b,c){return!1},g.prototype.ComputeAABB=function(a,b){},g.prototype.ComputeMass=function(a,b){void 0===b&&(b=0)},g.prototype.ComputeSubmergedArea=function(a,b,c,d){return void 0===b&&(b=0),0},g.TestOverlap=function(a,b,c,d){var e=new m;e.proxyA=new o,e.proxyA.Set(a),e.proxyB=new o,e.proxyB.Set(c),e.transformA=b,e.transformB=d,e.useRadii=!0;var f=new p;f.count=0;var g=new n;return l.Distance(g,f,e),g.distance<10*Number.MIN_VALUE},g.prototype.b2Shape=function(){this.m_type=g.e_unknownShape,this.m_radius=a.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var a=Box2D.Common.b2Color,b=(Box2D.Common.b2internal,Box2D.Common.b2Settings),c=(Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math);Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2,Box2D.Common.Math.b2Vec3;a.b2Color=function(){this._r=0,this._g=0,this._b=0},a.prototype.b2Color=function(a,b,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===d&&(d=0),this._r=Box2D.parseUInt(255*c.Clamp(a,0,1)),this._g=Box2D.parseUInt(255*c.Clamp(b,0,1)),this._b=Box2D.parseUInt(255*c.Clamp(d,0,1))},a.prototype.Set=function(a,b,d){void 0===a&&(a=0),void 0===b&&(b=0),void 0===d&&(d=0),this._r=Box2D.parseUInt(255*c.Clamp(a,0,1)),this._g=Box2D.parseUInt(255*c.Clamp(b,0,1)),this._b=Box2D.parseUInt(255*c.Clamp(d,0,1))},Object.defineProperty(a.prototype,"r",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._r=Box2D.parseUInt(255*c.Clamp(a,0,1))}}),Object.defineProperty(a.prototype,"g",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._g=Box2D.parseUInt(255*c.Clamp(a,0,1))}}),Object.defineProperty(a.prototype,"b",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0),this._b=Box2D.parseUInt(255*c.Clamp(a,0,1))}}),Object.defineProperty(a.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),b.b2Settings=function(){},b.b2MixFriction=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),Math.sqrt(a*b)},b.b2MixRestitution=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a>b?a:b},b.b2Assert=function(a){if(!a)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*b.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*b.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*b.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*b.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=b.b2_maxTranslation*b.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*b.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=b.b2_maxRotation*b.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*b.b2_pi})}(),function(){var a=(Box2D.Collision.b2AABB,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Common.Math.b2Mat22),b=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,d=Box2D.Common.Math.b2Sweep,e=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,g=Box2D.Common.Math.b2Vec3;a.b2Mat22=function(){this.col1=new f,this.col2=new f},a.prototype.b2Mat22=function(){this.SetIdentity()},a.FromAngle=function(b){void 0===b&&(b=0);var c=new a;return c.Set(b),c},a.FromVV=function(b,c){var d=new a;return d.SetVV(b,c),d},a.prototype.Set=function(a){void 0===a&&(a=0);var b=Math.cos(a),c=Math.sin(a);this.col1.x=b,this.col2.x=-c,this.col1.y=c,this.col2.y=b},a.prototype.SetVV=function(a,b){this.col1.SetV(a),this.col2.SetV(b)},a.prototype.Copy=function(){var b=new a;return b.SetM(this),b},a.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2)},a.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y},a.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},a.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},a.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},a.prototype.GetInverse=function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,e=this.col2.y,f=b*e-c*d;return 0!=f&&(f=1/f),a.col1.x=f*e,a.col2.x=-f*c,a.col1.y=-f*d,a.col2.y=f*b,a},a.prototype.Solve=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},a.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},b.b2Mat33=function(){this.col1=new g,this.col2=new g,this.col3=new g},b.prototype.b2Mat33=function(a,b,c){void 0===a&&(a=null),void 0===b&&(b=null),void 0===c&&(c=null),a||b||c?(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)):(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero())},b.prototype.SetVVV=function(a,b,c){this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c)},b.prototype.Copy=function(){return new b(this.col1,this.col2,this.col3)},b.prototype.SetM=function(a){this.col1.SetV(a.col1),this.col2.SetV(a.col2),this.col3.SetV(a.col3)},b.prototype.AddM=function(a){this.col1.x+=a.col1.x,this.col1.y+=a.col1.y,this.col1.z+=a.col1.z,this.col2.x+=a.col2.x,this.col2.y+=a.col2.y,this.col2.z+=a.col2.z,this.col3.x+=a.col3.x,this.col3.y+=a.col3.y,this.col3.z+=a.col3.z},b.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},b.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},b.prototype.Solve22=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=0);var d=this.col1.x,e=this.col2.x,f=this.col1.y,g=this.col2.y,h=d*g-e*f;return 0!=h&&(h=1/h),a.x=h*(g*b-e*c),a.y=h*(d*c-f*b),a},b.prototype.Solve33=function(a,b,c,d){void 0===b&&(b=0),void 0===c&&(c=0),void 0===d&&(d=0);var e=this.col1.x,f=this.col1.y,g=this.col1.z,h=this.col2.x,i=this.col2.y,j=this.col2.z,k=this.col3.x,l=this.col3.y,m=this.col3.z,n=e*(i*m-j*l)+f*(j*k-h*m)+g*(h*l-i*k);return 0!=n&&(n=1/n),a.x=n*(b*(i*m-j*l)+c*(j*k-h*m)+d*(h*l-i*k)),a.y=n*(e*(c*m-d*l)+f*(d*k-b*m)+g*(b*l-c*k)),a.z=n*(e*(i*d-j*c)+f*(j*b-h*d)+g*(h*c-i*b)),a},c.b2Math=function(){},c.IsValid=function(a){return void 0===a&&(a=0),isFinite(a)},c.Dot=function(a,b){return a.x*b.x+a.y*b.y},c.CrossVV=function(a,b){return a.x*b.y-a.y*b.x},c.CrossVF=function(a,b){return void 0===b&&(b=0),new f(b*a.y,-b*a.x)},c.CrossFV=function(a,b){return void 0===a&&(a=0),new f(-a*b.y,a*b.x)},c.MulMV=function(a,b){return new f(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+a.col2.y*b.y)},c.MulTMV=function(a,b){return new f(c.Dot(b,a.col1),c.Dot(b,a.col2))},c.MulX=function(a,b){var d=c.MulMV(a.R,b);return d.x+=a.position.x,d.y+=a.position.y,d},c.MulXT=function(a,b){var d=c.SubtractVV(b,a.position),e=d.x*a.R.col1.x+d.y*a.R.col1.y;return d.y=d.x*a.R.col2.x+d.y*a.R.col2.y,d.x=e,d},c.AddVV=function(a,b){return new f(a.x+b.x,a.y+b.y)},c.SubtractVV=function(a,b){return new f(a.x-b.x,a.y-b.y)},c.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},c.DistanceSquared=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d},c.MulFV=function(a,b){return void 0===a&&(a=0),new f(a*b.x,a*b.y)},c.AddMM=function(b,d){return a.FromVV(c.AddVV(b.col1,d.col1),c.AddVV(b.col2,d.col2))},c.MulMM=function(b,d){return a.FromVV(c.MulMV(b,d.col1),c.MulMV(b,d.col2))},c.MulTMM=function(b,d){var e=new f(c.Dot(b.col1,d.col1),c.Dot(b.col2,d.col1)),g=new f(c.Dot(b.col1,d.col2),c.Dot(b.col2,d.col2));return a.FromVV(e,g)},c.Abs=function(a){return void 0===a&&(a=0),a>0?a:-a},c.AbsV=function(a){return new f(c.Abs(a.x),c.Abs(a.y))},c.AbsM=function(b){return a.FromVV(c.AbsV(b.col1),c.AbsV(b.col2))},c.Min=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a<b?a:b},c.MinV=function(a,b){return new f(c.Min(a.x,b.x),c.Min(a.y,b.y))},c.Max=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),a>b?a:b},c.MaxV=function(a,b){return new f(c.Max(a.x,b.x),c.Max(a.y,b.y))},c.Clamp=function(a,b,c){return void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),a<b?b:a>c?c:a},c.ClampV=function(a,b,d){return c.MaxV(b,c.MinV(a,d))},c.Swap=function(a,b){var c=a[0];a[0]=b[0],b[0]=c},c.Random=function(){return 2*Math.random()-1},c.RandomRange=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0);var c=Math.random();return c=(b-a)*c+a},c.NextPowerOfTwo=function(a){return void 0===a&&(a=0),a|=a>>1&2147483647,a|=a>>2&1073741823,a|=a>>4&268435455,a|=a>>8&16777215,(a|=a>>16&65535)+1},c.IsPowerOfTwo=function(a){return void 0===a&&(a=0),a>0&&0==(a&a-1)},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new f(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=a.FromVV(new f(1,0),new f(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new e(c.b2Vec2_zero,c.b2Mat22_identity)}),d.b2Sweep=function(){this.localCenter=new f,this.c0=new f,this.c=new f},d.prototype.Set=function(a){this.localCenter.SetV(a.localCenter),this.c0.SetV(a.c0),this.c.SetV(a.c),this.a0=a.a0,this.a=a.a,this.t0=a.t0},d.prototype.Copy=function(){var a=new d;return a.localCenter.SetV(this.localCenter),a.c0.SetV(this.c0),a.c.SetV(this.c),a.a0=this.a0,a.a=this.a,a.t0=this.t0,a},d.prototype.GetTransform=function(a,b){void 0===b&&(b=0),a.position.x=(1-b)*this.c0.x+b*this.c.x,a.position.y=(1-b)*this.c0.y+b*this.c.y;var c=(1-b)*this.a0+b*this.a;a.R.Set(c);var d=a.R;a.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y,a.position.y-=d.col1.y*this.localCenter.x+d.col2.y*this.localCenter.y},d.prototype.Advance=function(a){if(void 0===a&&(a=0),this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x,this.c0.y=(1-b)*this.c0.y+b*this.c.y,this.a0=(1-b)*this.a0+b*this.a,this.t0=a}},e.b2Transform=function(){this.position=new f,this.R=new a},e.prototype.b2Transform=function(a,b){void 0===a&&(a=null),void 0===b&&(b=null),a&&(this.position.SetV(a),this.R.SetM(b))},e.prototype.Initialize=function(a,b){this.position.SetV(a),this.R.SetM(b)},e.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},e.prototype.Set=function(a){this.position.SetV(a.position),this.R.SetM(a.R)},e.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},f.b2Vec2=function(){},f.prototype.b2Vec2=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b},f.prototype.SetZero=function(){this.x=0,this.y=0},f.prototype.Set=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.x=a,this.y=b},f.prototype.SetV=function(a){this.x=a.x,this.y=a.y},f.prototype.GetNegative=function(){return new f(-this.x,-this.y)},f.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},f.Make=function(a,b){return void 0===a&&(a=0),void 0===b&&(b=0),new f(a,b)},f.prototype.Copy=function(){return new f(this.x,this.y)},f.prototype.Add=function(a){this.x+=a.x,this.y+=a.y},f.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y},f.prototype.Multiply=function(a){void 0===a&&(a=0),this.x*=a,this.y*=a},f.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y,this.y=a.col1.y*b+a.col2.y*this.y},f.prototype.MulTM=function(a){var b=c.Dot(this,a.col1);this.y=c.Dot(this,a.col2),this.x=b},f.prototype.CrossVF=function(a){void 0===a&&(a=0);var b=this.x;this.x=a*this.y,this.y=-a*b},f.prototype.CrossFV=function(a){void 0===a&&(a=0);var b=this.x;this.x=-a*this.y,this.y=a*b},f.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x,this.y=this.y<a.y?this.y:a.y},f.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x,this.y=this.y>a.y?this.y:a.y},f.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},f.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},f.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},f.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;return this.x*=b,this.y*=b,a},f.prototype.IsValid=function(){return c.IsValid(this.x)&&c.IsValid(this.y)},g.b2Vec3=function(){},g.prototype.b2Vec3=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.x=a,this.y=b,this.z=c},g.prototype.SetZero=function(){this.x=this.y=this.z=0},g.prototype.Set=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.x=a,this.y=b,this.z=c},g.prototype.SetV=function(a){this.x=a.x,this.y=a.y,this.z=a.z},g.prototype.GetNegative=function(){return new g(-this.x,-this.y,-this.z)},g.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},g.prototype.Copy=function(){return new g(this.x,this.y,this.z)},g.prototype.Add=function(a){this.x+=a.x,this.y+=a.y,this.z+=a.z},g.prototype.Subtract=function(a){this.x-=a.x,this.y-=a.y,this.z-=a.z},g.prototype.Multiply=function(a){void 0===a&&(a=0),this.x*=a,this.y*=a,this.z*=a}}(),function(){var a=(Box2D.Dynamics.Controllers.b2ControllerEdge,Box2D.Common.Math.b2Mat22,Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),b=Box2D.Common.Math.b2Sweep,c=Box2D.Common.Math.b2Transform,d=Box2D.Common.Math.b2Vec2,e=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),f=(Box2D.Common.b2internal,Box2D.Common.b2Settings),g=Box2D.Collision.b2AABB,h=(Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision,Box2D.Collision.b2ContactID,Box2D.Collision.b2ContactPoint),i=(Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase),j=(Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold,Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput),k=Box2D.Collision.b2RayCastOutput,l=(Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact,Box2D.Collision.b2TOIInput,Box2D.Collision.b2WorldManifold,Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase,Box2D.Collision.Shapes.b2CircleShape),m=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),n=Box2D.Collision.Shapes.b2MassData,o=Box2D.Collision.Shapes.b2PolygonShape,p=Box2D.Collision.Shapes.b2Shape,q=Box2D.Dynamics.b2Body,r=Box2D.Dynamics.b2BodyDef,s=Box2D.Dynamics.b2ContactFilter,t=Box2D.Dynamics.b2ContactImpulse,u=Box2D.Dynamics.b2ContactListener,v=Box2D.Dynamics.b2ContactManager,w=Box2D.Dynamics.b2DebugDraw,x=Box2D.Dynamics.b2DestructionListener,y=Box2D.Dynamics.b2FilterData,z=Box2D.Dynamics.b2Fixture,A=Box2D.Dynamics.b2FixtureDef,B=Box2D.Dynamics.b2Island,C=Box2D.Dynamics.b2TimeStep,D=Box2D.Dynamics.b2World,E=(Box2D.Dynamics.Contacts.b2CircleContact,Box2D.Dynamics.Contacts.b2Contact),F=(Box2D.Dynamics.Contacts.b2ContactConstraint,Box2D.Dynamics.Contacts.b2ContactConstraintPoint,Box2D.Dynamics.Contacts.b2ContactEdge,Box2D.Dynamics.Contacts.b2ContactFactory),G=(Box2D.Dynamics.Contacts.b2ContactRegister,Box2D.Dynamics.Contacts.b2ContactResult,
Box2D.Dynamics.Contacts.b2ContactSolver),H=(Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,Box2D.Dynamics.Contacts.b2NullContact,Box2D.Dynamics.Contacts.b2PolyAndCircleContact,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,Box2D.Dynamics.Contacts.b2PolygonContact,Box2D.Dynamics.Contacts.b2PositionSolverManifold,Box2D.Dynamics.Controllers.b2Controller,Box2D.Dynamics.Joints.b2DistanceJoint,Box2D.Dynamics.Joints.b2DistanceJointDef,Box2D.Dynamics.Joints.b2FrictionJoint,Box2D.Dynamics.Joints.b2FrictionJointDef,Box2D.Dynamics.Joints.b2GearJoint,Box2D.Dynamics.Joints.b2GearJointDef,Box2D.Dynamics.Joints.b2Jacobian,Box2D.Dynamics.Joints.b2Joint),I=(Box2D.Dynamics.Joints.b2JointDef,Box2D.Dynamics.Joints.b2JointEdge,Box2D.Dynamics.Joints.b2LineJoint,Box2D.Dynamics.Joints.b2LineJointDef,Box2D.Dynamics.Joints.b2MouseJoint,Box2D.Dynamics.Joints.b2MouseJointDef,Box2D.Dynamics.Joints.b2PrismaticJoint,Box2D.Dynamics.Joints.b2PrismaticJointDef,Box2D.Dynamics.Joints.b2PulleyJoint);Box2D.Dynamics.Joints.b2PulleyJointDef,Box2D.Dynamics.Joints.b2RevoluteJoint,Box2D.Dynamics.Joints.b2RevoluteJointDef,Box2D.Dynamics.Joints.b2WeldJoint,Box2D.Dynamics.Joints.b2WeldJointDef;q.b2Body=function(){this.m_xf=new c,this.m_sweep=new b,this.m_linearVelocity=new d,this.m_force=new d},q.prototype.connectEdges=function(b,c,d){void 0===d&&(d=0);var e=Math.atan2(c.GetDirectionVector().y,c.GetDirectionVector().x),g=Math.tan(.5*(e-d)),h=a.MulFV(g,c.GetDirectionVector());h=a.SubtractVV(h,c.GetNormalVector()),h=a.MulFV(f.b2_toiSlop,h),h=a.AddVV(h,c.GetVertex1());var i=a.AddVV(b.GetDirectionVector(),c.GetDirectionVector());i.Normalize();var j=a.Dot(b.GetDirectionVector(),c.GetNormalVector())>0;return b.SetNextEdge(c,h,i,j),c.SetPrevEdge(b,h,i,j),e},q.prototype.CreateFixture=function(a){if(1==this.m_world.IsLocked())return null;var b=new z;if(b.Create(this,this.m_xf,a),this.m_flags&q.e_activeFlag){var c=this.m_world.m_contactManager.m_broadPhase;b.CreateProxy(c,this.m_xf)}return b.m_next=this.m_fixtureList,this.m_fixtureList=b,++this.m_fixtureCount,b.m_body=this,b.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=D.e_newFixture,b},q.prototype.CreateFixture2=function(a,b){void 0===b&&(b=0);var c=new A;return c.shape=a,c.density=b,this.CreateFixture(c)},q.prototype.DestroyFixture=function(a){if(1!=this.m_world.IsLocked()){for(var b=this.m_fixtureList,c=null;null!=b;){if(b==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next,!0;break}c=b,b=b.m_next}for(var d=this.m_contactList;d;){var e=d.contact;d=d.next;var f=e.GetFixtureA(),g=e.GetFixtureB();a!=f&&a!=g||this.m_world.m_contactManager.Destroy(e)}if(this.m_flags&q.e_activeFlag){var h=this.m_world.m_contactManager.m_broadPhase;a.DestroyProxy(h)}a.Destroy(),a.m_body=null,a.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},q.prototype.SetPositionAndAngle=function(a,b){void 0===b&&(b=0);var c;if(1!=this.m_world.IsLocked()){this.m_xf.R.Set(b),this.m_xf.position.SetV(a);var d=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=d.col1.x*e.x+d.col2.x*e.y,this.m_sweep.c.y=d.col1.y*e.x+d.col2.y*e.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=b;var f=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(f,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},q.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())},q.prototype.GetTransform=function(){return this.m_xf},q.prototype.GetPosition=function(){return this.m_xf.position},q.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())},q.prototype.GetAngle=function(){return this.m_sweep.a},q.prototype.SetAngle=function(a){void 0===a&&(a=0),this.SetPositionAndAngle(this.GetPosition(),a)},q.prototype.GetWorldCenter=function(){return this.m_sweep.c},q.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},q.prototype.SetLinearVelocity=function(a){this.m_type!=q.b2_staticBody&&this.m_linearVelocity.SetV(a)},q.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},q.prototype.SetAngularVelocity=function(a){void 0===a&&(a=0),this.m_type!=q.b2_staticBody&&(this.m_angularVelocity=a)},q.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},q.prototype.GetDefinition=function(){var a=new r;return a.type=this.GetType(),a.allowSleep=(this.m_flags&q.e_allowSleepFlag)==q.e_allowSleepFlag,a.angle=this.GetAngle(),a.angularDamping=this.m_angularDamping,a.angularVelocity=this.m_angularVelocity,a.fixedRotation=(this.m_flags&q.e_fixedRotationFlag)==q.e_fixedRotationFlag,a.bullet=(this.m_flags&q.e_bulletFlag)==q.e_bulletFlag,a.awake=(this.m_flags&q.e_awakeFlag)==q.e_awakeFlag,a.linearDamping=this.m_linearDamping,a.linearVelocity.SetV(this.GetLinearVelocity()),a.position=this.GetPosition(),a.userData=this.GetUserData(),a},q.prototype.ApplyForce=function(a,b){this.m_type==q.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)},q.prototype.ApplyTorque=function(a){void 0===a&&(a=0),this.m_type==q.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=a)},q.prototype.ApplyImpulse=function(a,b){this.m_type==q.b2_dynamicBody&&(0==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))},q.prototype.Split=function(b){for(var c,d=this.GetLinearVelocity().Copy(),e=this.GetAngularVelocity(),f=this.GetWorldCenter(),g=this,h=this.m_world.CreateBody(this.GetDefinition()),i=g.m_fixtureList;i;)if(b(i)){var j=i.m_next;c?c.m_next=j:g.m_fixtureList=j,g.m_fixtureCount--,i.m_next=h.m_fixtureList,h.m_fixtureList=i,h.m_fixtureCount++,i.m_body=h,i=j}else c=i,i=i.m_next;g.ResetMassData(),h.ResetMassData();var k=g.GetWorldCenter(),l=h.GetWorldCenter(),m=a.AddVV(d,a.CrossFV(e,a.SubtractVV(k,f))),n=a.AddVV(d,a.CrossFV(e,a.SubtractVV(l,f)));return g.SetLinearVelocity(m),h.SetLinearVelocity(n),g.SetAngularVelocity(e),h.SetAngularVelocity(e),g.SynchronizeFixtures(),h.SynchronizeFixtures(),h},q.prototype.Merge=function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--,b.m_next=this.m_fixtureList,this.m_fixtureList=b,this.m_fixtureCount++,b.m_body=e,b=c}d.m_fixtureCount=0;var d=this,e=a;d.GetWorldCenter(),e.GetWorldCenter(),d.GetLinearVelocity().Copy(),e.GetLinearVelocity().Copy(),d.GetAngularVelocity(),e.GetAngularVelocity();d.ResetMassData(),this.SynchronizeFixtures()},q.prototype.GetMass=function(){return this.m_mass},q.prototype.GetInertia=function(){return this.m_I},q.prototype.GetMassData=function(a){a.mass=this.m_mass,a.I=this.m_I,a.center.SetV(this.m_sweep.localCenter)},q.prototype.SetMassData=function(b){if(f.b2Assert(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==q.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=b.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,b.I>0&&0==(this.m_flags&q.e_fixedRotationFlag)&&(this.m_I=b.I-this.m_mass*(b.center.x*b.center.x+b.center.y*b.center.y),this.m_invI=1/this.m_I);var c=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(b.center),this.m_sweep.c0.SetV(a.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-c.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-c.x)}},q.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type!=q.b2_staticBody&&this.m_type!=q.b2_kinematicBody){for(var b=d.Make(0,0),c=this.m_fixtureList;c;c=c.m_next)if(0!=c.m_density){var e=c.GetMassData();this.m_mass+=e.mass,b.x+=e.center.x*e.mass,b.y+=e.center.y*e.mass,this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,b.x*=this.m_invMass,b.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&q.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(b.x*b.x+b.y*b.y),this.m_I*=this.m_inertiaScale,f.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var g=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(b),this.m_sweep.c0.SetV(a.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-g.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-g.x)}},q.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,c=new d(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,c},q.prototype.GetWorldVector=function(b){return a.MulMV(this.m_xf.R,b)},q.prototype.GetLocalPoint=function(b){return a.MulXT(this.m_xf,b)},q.prototype.GetLocalVector=function(b){return a.MulTMV(this.m_xf.R,b)},q.prototype.GetLinearVelocityFromWorldPoint=function(a){return new d(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))},q.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,c=new d(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);return c.x+=this.m_xf.position.x,c.y+=this.m_xf.position.y,new d(this.m_linearVelocity.x-this.m_angularVelocity*(c.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(c.x-this.m_sweep.c.x))},q.prototype.GetLinearDamping=function(){return this.m_linearDamping},q.prototype.SetLinearDamping=function(a){void 0===a&&(a=0),this.m_linearDamping=a},q.prototype.GetAngularDamping=function(){return this.m_angularDamping},q.prototype.SetAngularDamping=function(a){void 0===a&&(a=0),this.m_angularDamping=a},q.prototype.SetType=function(a){if(void 0===a&&(a=0),this.m_type!=a){this.m_type=a,this.ResetMassData(),this.m_type==q.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var b=this.m_contactList;b;b=b.next)b.contact.FlagForFiltering()}},q.prototype.GetType=function(){return this.m_type},q.prototype.SetBullet=function(a){a?this.m_flags|=q.e_bulletFlag:this.m_flags&=~q.e_bulletFlag},q.prototype.IsBullet=function(){return(this.m_flags&q.e_bulletFlag)==q.e_bulletFlag},q.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=q.e_allowSleepFlag:(this.m_flags&=~q.e_allowSleepFlag,this.SetAwake(!0))},q.prototype.SetAwake=function(a){a?(this.m_flags|=q.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~q.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},q.prototype.IsAwake=function(){return(this.m_flags&q.e_awakeFlag)==q.e_awakeFlag},q.prototype.SetFixedRotation=function(a){a?this.m_flags|=q.e_fixedRotationFlag:this.m_flags&=~q.e_fixedRotationFlag,this.ResetMassData()},q.prototype.IsFixedRotation=function(){return(this.m_flags&q.e_fixedRotationFlag)==q.e_fixedRotationFlag},q.prototype.SetActive=function(a){if(a!=this.IsActive()){var b,c;if(a)for(this.m_flags|=q.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.CreateProxy(b,this.m_xf);else{for(this.m_flags&=~q.e_activeFlag,b=this.m_world.m_contactManager.m_broadPhase,c=this.m_fixtureList;c;c=c.m_next)c.DestroyProxy(b);for(var d=this.m_contactList;d;){var e=d;d=d.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null}}},q.prototype.IsActive=function(){return(this.m_flags&q.e_activeFlag)==q.e_activeFlag},q.prototype.IsSleepingAllowed=function(){return(this.m_flags&q.e_allowSleepFlag)==q.e_allowSleepFlag},q.prototype.GetFixtureList=function(){return this.m_fixtureList},q.prototype.GetJointList=function(){return this.m_jointList},q.prototype.GetControllerList=function(){return this.m_controllerList},q.prototype.GetContactList=function(){return this.m_contactList},q.prototype.GetNext=function(){return this.m_next},q.prototype.GetUserData=function(){return this.m_userData},q.prototype.SetUserData=function(a){this.m_userData=a},q.prototype.GetWorld=function(){return this.m_world},q.prototype.b2Body=function(a,b){this.m_flags=0,a.bullet&&(this.m_flags|=q.e_bulletFlag),a.fixedRotation&&(this.m_flags|=q.e_fixedRotationFlag),a.allowSleep&&(this.m_flags|=q.e_allowSleepFlag),a.awake&&(this.m_flags|=q.e_awakeFlag),a.active&&(this.m_flags|=q.e_activeFlag),this.m_world=b,this.m_xf.position.SetV(a.position),this.m_xf.R.Set(a.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y,this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(a.linearVelocity),this.m_angularVelocity=a.angularVelocity,this.m_linearDamping=a.linearDamping,this.m_angularDamping=a.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=a.type,this.m_type==q.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=a.inertiaScale,this.m_userData=a.userData,this.m_fixtureList=null,this.m_fixtureCount=0},q.prototype.SynchronizeFixtures=function(){var a=q.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y),a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y);var d,e=this.m_world.m_contactManager.m_broadPhase;for(d=this.m_fixtureList;d;d=d.m_next)d.Synchronize(e,a,this.m_xf)},q.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y),this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)},q.prototype.ShouldCollide=function(a){if(this.m_type!=q.b2_dynamicBody&&a.m_type!=q.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&0==b.joint.m_collideConnected)return!1;return!0},q.prototype.Advance=function(a){void 0===a&&(a=0),this.m_sweep.Advance(a),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new c,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),r.b2BodyDef=function(){this.position=new d,this.linearVelocity=new d},r.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=q.b2_staticBody,this.active=!0,this.inertiaScale=1},s.b2ContactFilter=function(){},s.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();return c.groupIndex==d.groupIndex&&0!=c.groupIndex?c.groupIndex>0:0!=(c.maskBits&d.categoryBits)&&0!=(c.categoryBits&d.maskBits)},s.prototype.RayCollide=function(a,b){return!a||this.ShouldCollide(a instanceof z?a:null,b)},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new s}),t.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(f.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(f.b2_maxManifoldPoints)},u.b2ContactListener=function(){},u.prototype.BeginContact=function(a){},u.prototype.EndContact=function(a){},u.prototype.PreSolve=function(a,b){},u.prototype.PostSolve=function(a,b){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new u}),v.b2ContactManager=function(){},v.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=s.b2_defaultFilter,this.m_contactListener=u.b2_defaultListener,this.m_contactFactory=new F(this.m_allocator),this.m_broadPhase=new i},v.prototype.AddPair=function(a,b){var c=a instanceof z?a:null,d=b instanceof z?b:null,e=c.GetBody(),f=d.GetBody();if(e!=f){for(var g=f.GetContactList();g;){if(g.other==e){var h=g.contact.GetFixtureA(),i=g.contact.GetFixtureB();if(h==c&&i==d)return;if(h==d&&i==c)return}g=g.next}if(0!=f.ShouldCollide(e)&&0!=this.m_contactFilter.ShouldCollide(c,d)){var j=this.m_contactFactory.Create(c,d);c=j.GetFixtureA(),d=j.GetFixtureB(),e=c.m_body,f=d.m_body,j.m_prev=null,j.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=j),this.m_world.m_contactList=j,j.m_nodeA.contact=j,j.m_nodeA.other=f,j.m_nodeA.prev=null,j.m_nodeA.next=e.m_contactList,null!=e.m_contactList&&(e.m_contactList.prev=j.m_nodeA),e.m_contactList=j.m_nodeA,j.m_nodeB.contact=j,j.m_nodeB.other=e,j.m_nodeB.prev=null,j.m_nodeB.next=f.m_contactList,null!=f.m_contactList&&(f.m_contactList.prev=j.m_nodeB),f.m_contactList=j.m_nodeB,++this.m_world.m_contactCount}}},v.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},v.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a),a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_world.m_contactList&&(this.m_world.m_contactList=a.m_next),a.m_nodeA.prev&&(a.m_nodeA.prev.next=a.m_nodeA.next),a.m_nodeA.next&&(a.m_nodeA.next.prev=a.m_nodeA.prev),a.m_nodeA==d.m_contactList&&(d.m_contactList=a.m_nodeA.next),a.m_nodeB.prev&&(a.m_nodeB.prev.next=a.m_nodeB.next),a.m_nodeB.next&&(a.m_nodeB.next.prev=a.m_nodeB.prev),a.m_nodeB==e.m_contactList&&(e.m_contactList=a.m_nodeB.next),this.m_contactFactory.Destroy(a),--this.m_contactCount},v.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),e=c.GetBody();if(0!=d.IsAwake()||0!=e.IsAwake()){if(a.m_flags&E.e_filterFlag){if(0==e.ShouldCollide(d)){var f=a;a=f.GetNext(),this.Destroy(f);continue}if(0==this.m_contactFilter.ShouldCollide(b,c)){f=a,a=f.GetNext(),this.Destroy(f);continue}a.m_flags&=~E.e_filterFlag}var g=b.m_proxy,h=c.m_proxy;0!=this.m_broadPhase.TestOverlap(g,h)?(a.Update(this.m_contactListener),a=a.GetNext()):(f=a,a=f.GetNext(),this.Destroy(f))}else a=a.GetNext()}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new h}),w.b2DebugDraw=function(){},w.prototype.b2DebugDraw=function(){},w.prototype.SetFlags=function(a){void 0===a&&(a=0)},w.prototype.GetFlags=function(){},w.prototype.AppendFlags=function(a){void 0===a&&(a=0)},w.prototype.ClearFlags=function(a){void 0===a&&(a=0)},w.prototype.SetSprite=function(a){},w.prototype.GetSprite=function(){},w.prototype.SetDrawScale=function(a){void 0===a&&(a=0)},w.prototype.GetDrawScale=function(){},w.prototype.SetLineThickness=function(a){void 0===a&&(a=0)},w.prototype.GetLineThickness=function(){},w.prototype.SetAlpha=function(a){void 0===a&&(a=0)},w.prototype.GetAlpha=function(){},w.prototype.SetFillAlpha=function(a){void 0===a&&(a=0)},w.prototype.GetFillAlpha=function(){},w.prototype.SetXFormScale=function(a){void 0===a&&(a=0)},w.prototype.GetXFormScale=function(){},w.prototype.DrawPolygon=function(a,b,c){void 0===b&&(b=0)},w.prototype.DrawSolidPolygon=function(a,b,c){void 0===b&&(b=0)},w.prototype.DrawCircle=function(a,b,c){void 0===b&&(b=0)},w.prototype.DrawSolidCircle=function(a,b,c,d){void 0===b&&(b=0)},w.prototype.DrawSegment=function(a,b,c){},w.prototype.DrawTransform=function(a){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),x.b2DestructionListener=function(){},x.prototype.SayGoodbyeJoint=function(a){},x.prototype.SayGoodbyeFixture=function(a){},y.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},y.prototype.Copy=function(){var a=new y;return a.categoryBits=this.categoryBits,a.maskBits=this.maskBits,a.groupIndex=this.groupIndex,a},z.b2Fixture=function(){this.m_filter=new y},z.prototype.GetType=function(){return this.m_shape.GetType()},z.prototype.GetShape=function(){return this.m_shape},z.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();d!=this&&e!=this||c.SetSensor(d.IsSensor()||e.IsSensor()),b=b.next}},z.prototype.IsSensor=function(){return this.m_isSensor},z.prototype.SetFilterData=function(a){if(this.m_filter=a.Copy(),!this.m_body)for(var b=this.m_body.GetContactList();b;){var c=b.contact,d=c.GetFixtureA(),e=c.GetFixtureB();d!=this&&e!=this||c.FlagForFiltering(),b=b.next}},z.prototype.GetFilterData=function(){return this.m_filter.Copy()},z.prototype.GetBody=function(){return this.m_body},z.prototype.GetNext=function(){return this.m_next},z.prototype.GetUserData=function(){return this.m_userData},z.prototype.SetUserData=function(a){this.m_userData=a},z.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)},z.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())},z.prototype.GetMassData=function(a){return void 0===a&&(a=null),null==a&&(a=new n),this.m_shape.ComputeMass(a,this.m_density),a},z.prototype.SetDensity=function(a){void 0===a&&(a=0),this.m_density=a},z.prototype.GetDensity=function(){return this.m_density},z.prototype.GetFriction=function(){return this.m_friction},z.prototype.SetFriction=function(a){void 0===a&&(a=0),this.m_friction=a},z.prototype.GetRestitution=function(){return this.m_restitution},z.prototype.SetRestitution=function(a){void 0===a&&(a=0),this.m_restitution=a},z.prototype.GetAABB=function(){return this.m_aabb},z.prototype.b2Fixture=function(){this.m_aabb=new g,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},z.prototype.Create=function(a,b,c){this.m_userData=c.userData,this.m_friction=c.friction,this.m_restitution=c.restitution,this.m_body=a,this.m_next=null,this.m_filter=c.filter.Copy(),this.m_isSensor=c.isSensor,this.m_shape=c.shape.Copy(),this.m_density=c.density},z.prototype.Destroy=function(){this.m_shape=null},z.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b),this.m_proxy=a.CreateProxy(this.m_aabb,this)},z.prototype.DestroyProxy=function(a){null!=this.m_proxy&&(a.DestroyProxy(this.m_proxy),this.m_proxy=null)},z.prototype.Synchronize=function(b,c,d){if(this.m_proxy){var e=new g,f=new g;this.m_shape.ComputeAABB(e,c),this.m_shape.ComputeAABB(f,d),this.m_aabb.Combine(e,f);var h=a.SubtractVV(d.position,c.position);b.MoveProxy(this.m_proxy,this.m_aabb,h)}},A.b2FixtureDef=function(){this.filter=new y},A.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},B.b2Island=function(){},B.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},B.prototype.Initialize=function(a,b,c,d,e,f){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0);var g=0;for(this.m_bodyCapacity=a,this.m_contactCapacity=b,this.m_jointCapacity=c,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=d,this.m_listener=e,this.m_contactSolver=f,g=this.m_bodies.length;g<a;g++)this.m_bodies[g]=null;for(g=this.m_contacts.length;g<b;g++)this.m_contacts[g]=null;for(g=this.m_joints.length;g<c;g++)this.m_joints[g]=null},B.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},B.prototype.Solve=function(b,c,d){var e,g,h=0,i=0;for(h=0;h<this.m_bodyCount;++h)e=this.m_bodies[h],e.GetType()==q.b2_dynamicBody&&(e.m_linearVelocity.x+=b.dt*(c.x+e.m_invMass*e.m_force.x),e.m_linearVelocity.y+=b.dt*(c.y+e.m_invMass*e.m_force.y),e.m_angularVelocity+=b.dt*e.m_invI*e.m_torque,e.m_linearVelocity.Multiply(a.Clamp(1-b.dt*e.m_linearDamping,0,1)),e.m_angularVelocity*=a.Clamp(1-b.dt*e.m_angularDamping,0,1));this.m_contactSolver.Initialize(b,this.m_contacts,this.m_contactCount,this.m_allocator);var j=this.m_contactSolver;for(j.InitVelocityConstraints(b),h=0;h<this.m_jointCount;++h)g=this.m_joints[h],g.InitVelocityConstraints(b);for(h=0;h<b.velocityIterations;++h){for(i=0;i<this.m_jointCount;++i)g=this.m_joints[i],g.SolveVelocityConstraints(b);j.SolveVelocityConstraints()}for(h=0;h<this.m_jointCount;++h)g=this.m_joints[h],g.FinalizeVelocityConstraints();for(j.FinalizeVelocityConstraints(),h=0;h<this.m_bodyCount;++h)if(e=this.m_bodies[h],e.GetType()!=q.b2_staticBody){var k=b.dt*e.m_linearVelocity.x,l=b.dt*e.m_linearVelocity.y;k*k+l*l>f.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=f.b2_maxTranslation*b.inv_dt,e.m_linearVelocity.y*=f.b2_maxTranslation*b.inv_dt);var m=b.dt*e.m_angularVelocity;m*m>f.b2_maxRotationSquared&&(e.m_angularVelocity<0?e.m_angularVelocity=-f.b2_maxRotation*b.inv_dt:e.m_angularVelocity=f.b2_maxRotation*b.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=b.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=b.dt*e.m_linearVelocity.y,e.m_sweep.a+=b.dt*e.m_angularVelocity,e.SynchronizeTransform()}for(h=0;h<b.positionIterations;++h){var n=j.SolvePositionConstraints(f.b2_contactBaumgarte),o=!0;for(i=0;i<this.m_jointCount;++i){g=this.m_joints[i];var p=g.SolvePositionConstraints(f.b2_contactBaumgarte);o=o&&p}if(n&&o)break}if(this.Report(j.m_constraints),d){var r=Number.MAX_VALUE,s=f.b2_linearSleepTolerance*f.b2_linearSleepTolerance,t=f.b2_angularSleepTolerance*f.b2_angularSleepTolerance;for(h=0;h<this.m_bodyCount;++h)e=this.m_bodies[h],e.GetType()!=q.b2_staticBody&&(0==(e.m_flags&q.e_allowSleepFlag)&&(e.m_sleepTime=0,r=0),0==(e.m_flags&q.e_allowSleepFlag)||e.m_angularVelocity*e.m_angularVelocity>t||a.Dot(e.m_linearVelocity,e.m_linearVelocity)>s?(e.m_sleepTime=0,r=0):(e.m_sleepTime+=b.dt,r=a.Min(r,e.m_sleepTime)));if(r>=f.b2_timeToSleep)for(h=0;h<this.m_bodyCount;++h)e=this.m_bodies[h],e.SetAwake(!1)}},B.prototype.SolveTOI=function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);var d=this.m_contactSolver;for(b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b)for(d.SolveVelocityConstraints(),c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a);for(b=0;b<this.m_bodyCount;++b){var e=this.m_bodies[b];if(e.GetType()!=q.b2_staticBody){var g=a.dt*e.m_linearVelocity.x,h=a.dt*e.m_linearVelocity.y;g*g+h*h>f.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=f.b2_maxTranslation*a.inv_dt,e.m_linearVelocity.y*=f.b2_maxTranslation*a.inv_dt);var i=a.dt*e.m_angularVelocity;i*i>f.b2_maxRotationSquared&&(e.m_angularVelocity<0?e.m_angularVelocity=-f.b2_maxRotation*a.inv_dt:e.m_angularVelocity=f.b2_maxRotation*a.inv_dt),e.m_sweep.c0.SetV(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_sweep.c.x+=a.dt*e.m_linearVelocity.x,e.m_sweep.c.y+=a.dt*e.m_linearVelocity.y,e.m_sweep.a+=a.dt*e.m_angularVelocity,e.SynchronizeTransform()}}for(b=0;b<a.positionIterations;++b){var j=d.SolvePositionConstraints(.75),k=!0;for(c=0;c<this.m_jointCount;++c){var l=this.m_joints[c].SolvePositionConstraints(f.b2_contactBaumgarte);k=k&&l}if(j&&k)break}this.Report(d.m_constraints)},B.prototype.Report=function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],d=a[b],e=0;e<d.pointCount;++e)B.s_impulse.normalImpulses[e]=d.points[e].normalImpulse,B.s_impulse.tangentImpulses[e]=d.points[e].tangentImpulse;this.m_listener.PostSolve(c,B.s_impulse)}},B.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=a},B.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a},B.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new t}),C.b2TimeStep=function(){},C.prototype.Set=function(a){this.dt=a.dt,this.inv_dt=a.inv_dt,this.positionIterations=a.positionIterations,this.velocityIterations=a.velocityIterations,this.warmStarting=a.warmStarting},D.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new v,this.m_contactSolver=new G,this.m_island=new B},D.prototype.b2World=function(a,b){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,D.m_warmStarting=!0,D.m_continuousPhysics=!0,this.m_allowSleep=b,this.m_gravity=a,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var c=new r;this.m_groundBody=this.CreateBody(c)},D.prototype.SetDestructionListener=function(a){this.m_destructionListener=a},D.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a},D.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a},D.prototype.SetDebugDraw=function(a){this.m_debugDraw=a},D.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var d=c.m_fixtureList;d;d=d.m_next)d.m_proxy=a.CreateProxy(b.GetFatAABB(d.m_proxy),d)},D.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},D.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},D.prototype.CreateBody=function(a){if(1==this.IsLocked())return null;var b=new q(a,this);return b.m_prev=null,b.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=b),this.m_bodyList=b,++this.m_bodyCount,b},D.prototype.DestroyBody=function(a){if(1!=this.IsLocked()){for(var b=a.m_jointList;b;){var c=b;b=b.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint),this.DestroyJoint(c.joint)}for(var d=a.m_controllerList;d;){var e=d;d=d.nextController,e.controller.RemoveBody(a)}for(var f=a.m_contactList;f;){var g=f;f=f.next,this.m_contactManager.Destroy(g.contact)}a.m_contactList=null;for(var h=a.m_fixtureList;h;){var i=h;h=h.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(i),i.DestroyProxy(this.m_contactManager.m_broadPhase),i.Destroy()}a.m_fixtureList=null,a.m_fixtureCount=0,a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),a==this.m_bodyList&&(this.m_bodyList=a.m_next),--this.m_bodyCount}},D.prototype.CreateJoint=function(a){var b=H.Create(a,null);b.m_prev=null,b.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=b),this.m_jointList=b,++this.m_jointCount,b.m_edgeA.joint=b,b.m_edgeA.other=b.m_bodyB,b.m_edgeA.prev=null,b.m_edgeA.next=b.m_bodyA.m_jointList,b.m_bodyA.m_jointList&&(b.m_bodyA.m_jointList.prev=b.m_edgeA),b.m_bodyA.m_jointList=b.m_edgeA,b.m_edgeB.joint=b,b.m_edgeB.other=b.m_bodyA,b.m_edgeB.prev=null,b.m_edgeB.next=b.m_bodyB.m_jointList,b.m_bodyB.m_jointList&&(b.m_bodyB.m_jointList.prev=b.m_edgeB),b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(0==a.collideConnected)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next;return b},D.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),
a==this.m_jointList&&(this.m_jointList=a.m_next);var c=a.m_bodyA,d=a.m_bodyB;if(c.SetAwake(!0),d.SetAwake(!0),a.m_edgeA.prev&&(a.m_edgeA.prev.next=a.m_edgeA.next),a.m_edgeA.next&&(a.m_edgeA.next.prev=a.m_edgeA.prev),a.m_edgeA==c.m_jointList&&(c.m_jointList=a.m_edgeA.next),a.m_edgeA.prev=null,a.m_edgeA.next=null,a.m_edgeB.prev&&(a.m_edgeB.prev.next=a.m_edgeB.next),a.m_edgeB.next&&(a.m_edgeB.next.prev=a.m_edgeB.prev),a.m_edgeB==d.m_jointList&&(d.m_jointList=a.m_edgeB.next),a.m_edgeB.prev=null,a.m_edgeB.next=null,H.Destroy(a,null),--this.m_jointCount,0==b)for(var e=d.GetContactList();e;)e.other==c&&e.contact.FlagForFiltering(),e=e.next},D.prototype.AddController=function(a){return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList=a,a.m_world=this,this.m_controllerCount++,a},D.prototype.RemoveController=function(a){a.m_prev&&(a.m_prev.m_next=a.m_next),a.m_next&&(a.m_next.m_prev=a.m_prev),this.m_controllerList==a&&(this.m_controllerList=a.m_next),this.m_controllerCount--},D.prototype.CreateController=function(a){if(a.m_world!=this)throw new Error("Controller can only be a member of one world");return a.m_next=this.m_controllerList,a.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=a),this.m_controllerList=a,++this.m_controllerCount,a.m_world=this,a},D.prototype.DestroyController=function(a){a.Clear(),a.m_next&&(a.m_next.m_prev=a.m_prev),a.m_prev&&(a.m_prev.m_next=a.m_next),a==this.m_controllerList&&(this.m_controllerList=a.m_next),--this.m_controllerCount},D.prototype.SetWarmStarting=function(a){D.m_warmStarting=a},D.prototype.SetContinuousPhysics=function(a){D.m_continuousPhysics=a},D.prototype.GetBodyCount=function(){return this.m_bodyCount},D.prototype.GetJointCount=function(){return this.m_jointCount},D.prototype.GetContactCount=function(){return this.m_contactCount},D.prototype.SetGravity=function(a){this.m_gravity=a},D.prototype.GetGravity=function(){return this.m_gravity},D.prototype.GetGroundBody=function(){return this.m_groundBody},D.prototype.Step=function(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0),void 0===c&&(c=0),this.m_flags&D.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~D.e_newFixture),this.m_flags|=D.e_locked;var d=D.s_timestep2;d.dt=a,d.velocityIterations=b,d.positionIterations=c,d.inv_dt=a>0?1/a:0,d.dtRatio=this.m_inv_dt0*a,d.warmStarting=D.m_warmStarting,this.m_contactManager.Collide(),d.dt>0&&this.Solve(d),D.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d),d.dt>0&&(this.m_inv_dt0=d.inv_dt),this.m_flags&=~D.e_locked},D.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0},D.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var a,b,c,f,h,i,j=this.m_debugDraw.GetFlags(),k=(new d,new d,new d,new g,new g,[new d,new d,new d,new d]),l=new e(0,0,0);if(j&w.e_shapeBit)for(a=this.m_bodyList;a;a=a.m_next)for(i=a.m_xf,b=a.GetFixtureList();b;b=b.m_next)c=b.GetShape(),0==a.IsActive()?(l.Set(.5,.5,.3),this.DrawShape(c,i,l)):a.GetType()==q.b2_staticBody?(l.Set(.5,.9,.5),this.DrawShape(c,i,l)):a.GetType()==q.b2_kinematicBody?(l.Set(.5,.5,.9),this.DrawShape(c,i,l)):0==a.IsAwake()?(l.Set(.6,.6,.6),this.DrawShape(c,i,l)):(l.Set(.9,.7,.7),this.DrawShape(c,i,l));if(j&w.e_jointBit)for(f=this.m_jointList;f;f=f.m_next)this.DrawJoint(f);if(j&w.e_controllerBit)for(var m=this.m_controllerList;m;m=m.m_next)m.Draw(this.m_debugDraw);if(j&w.e_pairBit){l.Set(.3,.9,.9);for(var n=this.m_contactManager.m_contactList;n;n=n.GetNext()){var o=n.GetFixtureA(),p=n.GetFixtureB(),r=o.GetAABB().GetCenter(),s=p.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(r,s,l)}}if(j&w.e_aabbBit)for(h=this.m_contactManager.m_broadPhase,k=[new d,new d,new d,new d],a=this.m_bodyList;a;a=a.GetNext())if(0!=a.IsActive())for(b=a.GetFixtureList();b;b=b.GetNext()){var t=h.GetFatAABB(b.m_proxy);k[0].Set(t.lowerBound.x,t.lowerBound.y),k[1].Set(t.upperBound.x,t.lowerBound.y),k[2].Set(t.upperBound.x,t.upperBound.y),k[3].Set(t.lowerBound.x,t.upperBound.y),this.m_debugDraw.DrawPolygon(k,4,l)}if(j&w.e_centerOfMassBit)for(a=this.m_bodyList;a;a=a.m_next)i=D.s_xf,i.R=a.m_xf.R,i.position=a.GetWorldCenter(),this.m_debugDraw.DrawTransform(i)}},D.prototype.QueryAABB=function(a,b){function c(b){return a(e.GetUserData(b))}var d=this,e=d.m_contactManager.m_broadPhase;e.Query(c,b)},D.prototype.QueryShape=function(a,b,d){function e(c){var e=h.GetUserData(c)instanceof z?h.GetUserData(c):null;return!p.TestOverlap(b,d,e.GetShape(),e.GetBody().GetTransform())||a(e)}var f=this;void 0===d&&(d=null),null==d&&(d=new c,d.SetIdentity());var h=f.m_contactManager.m_broadPhase,i=new g;b.ComputeAABB(i,d),h.Query(e,i)},D.prototype.QueryPoint=function(a,b){function c(c){var d=e.GetUserData(c)instanceof z?e.GetUserData(c):null;return!d.TestPoint(b)||a(d)}var d=this,e=d.m_contactManager.m_broadPhase,h=new g;h.lowerBound.Set(b.x-f.b2_linearSlop,b.y-f.b2_linearSlop),h.upperBound.Set(b.x+f.b2_linearSlop,b.y+f.b2_linearSlop),e.Query(c,h)},D.prototype.RayCast=function(a,b,c){function e(e,f){var i=g.GetUserData(f),j=i instanceof z?i:null;if(j.RayCast(h,e)){var k=h.fraction,l=new d((1-k)*b.x+k*c.x,(1-k)*b.y+k*c.y);return a(j,l,h.normal,k)}return e.maxFraction}var f=this,g=f.m_contactManager.m_broadPhase,h=new k,i=new j(b,c);g.RayCast(e,i)},D.prototype.RayCastOne=function(a,b){function c(a,b,c,e){return void 0===e&&(e=0),d=a,e}var d,e=this;return e.RayCast(c,a,b),d},D.prototype.RayCastAll=function(a,b){function c(a,b,c,d){return void 0===d&&(d=0),e[e.length]=a,1}var d=this,e=new Vector;return d.RayCast(c,a,b),e},D.prototype.GetBodyList=function(){return this.m_bodyList},D.prototype.GetJointList=function(){return this.m_jointList},D.prototype.GetContactList=function(){return this.m_contactList},D.prototype.IsLocked=function(){return(this.m_flags&D.e_locked)>0},D.prototype.Solve=function(a){for(var b,c=this.m_controllerList;c;c=c.m_next)c.Step(a);var d=this.m_island;for(d.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver),b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~q.e_islandFlag;for(var e=this.m_contactList;e;e=e.m_next)e.m_flags&=~E.e_islandFlag;for(var f=this.m_jointList;f;f=f.m_next)f.m_islandFlag=!1;for(var g=(parseInt(this.m_bodyCount),this.s_stack),h=this.m_bodyList;h;h=h.m_next)if(!(h.m_flags&q.e_islandFlag)&&0!=h.IsAwake()&&0!=h.IsActive()&&h.GetType()!=q.b2_staticBody){d.Clear();var i=0;for(g[i++]=h,h.m_flags|=q.e_islandFlag;i>0;)if(b=g[--i],d.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=q.b2_staticBody){for(var j,k=b.m_contactList;k;k=k.next)k.contact.m_flags&E.e_islandFlag||1!=k.contact.IsSensor()&&0!=k.contact.IsEnabled()&&0!=k.contact.IsTouching()&&(d.AddContact(k.contact),k.contact.m_flags|=E.e_islandFlag,j=k.other,j.m_flags&q.e_islandFlag||(g[i++]=j,j.m_flags|=q.e_islandFlag));for(var l=b.m_jointList;l;l=l.next)1!=l.joint.m_islandFlag&&(j=l.other,0!=j.IsActive()&&(d.AddJoint(l.joint),l.joint.m_islandFlag=!0,j.m_flags&q.e_islandFlag||(g[i++]=j,j.m_flags|=q.e_islandFlag)))}d.Solve(a,this.m_gravity,this.m_allowSleep);for(var m=0;m<d.m_bodyCount;++m)b=d.m_bodies[m],b.GetType()==q.b2_staticBody&&(b.m_flags&=~q.e_islandFlag)}for(m=0;m<g.length&&g[m];++m)g[m]=null;for(b=this.m_bodyList;b;b=b.m_next)0!=b.IsAwake()&&0!=b.IsActive()&&b.GetType()!=q.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},D.prototype.SolveTOI=function(a){var b,c,d,e,g,h,i,j=this.m_island;j.Initialize(this.m_bodyCount,f.b2_maxTOIContactsPerIsland,f.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var k=D.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~q.e_islandFlag,b.m_sweep.t0=0;var l;for(l=this.m_contactList;l;l=l.m_next)l.m_flags&=~(E.e_toiFlag|E.e_islandFlag);for(i=this.m_jointList;i;i=i.m_next)i.m_islandFlag=!1;for(;;){var m=null,n=1;for(l=this.m_contactList;l;l=l.m_next)if(1!=l.IsSensor()&&0!=l.IsEnabled()&&0!=l.IsContinuous()){var o=1;if(l.m_flags&E.e_toiFlag)o=l.m_toi;else{if(c=l.m_fixtureA,d=l.m_fixtureB,e=c.m_body,g=d.m_body,!(e.GetType()==q.b2_dynamicBody&&0!=e.IsAwake()||g.GetType()==q.b2_dynamicBody&&0!=g.IsAwake()))continue;var p=e.m_sweep.t0;e.m_sweep.t0<g.m_sweep.t0?(p=g.m_sweep.t0,e.m_sweep.Advance(p)):g.m_sweep.t0<e.m_sweep.t0&&(p=e.m_sweep.t0,g.m_sweep.Advance(p)),o=l.ComputeTOI(e.m_sweep,g.m_sweep),f.b2Assert(0<=o&&o<=1),o>0&&o<1&&(o=(1-o)*p+o)>1&&(o=1),l.m_toi=o,l.m_flags|=E.e_toiFlag}Number.MIN_VALUE<o&&o<n&&(m=l,n=o)}if(null==m||1-100*Number.MIN_VALUE<n)break;if(c=m.m_fixtureA,d=m.m_fixtureB,e=c.m_body,g=d.m_body,D.s_backupA.Set(e.m_sweep),D.s_backupB.Set(g.m_sweep),e.Advance(n),g.Advance(n),m.Update(this.m_contactManager.m_contactListener),m.m_flags&=~E.e_toiFlag,1!=m.IsSensor()&&0!=m.IsEnabled()){if(0!=m.IsTouching()){var r=e;r.GetType()!=q.b2_dynamicBody&&(r=g),j.Clear();var s=0,t=0;for(k[s+t++]=r,r.m_flags|=q.e_islandFlag;t>0;)if(b=k[s++],--t,j.AddBody(b),0==b.IsAwake()&&b.SetAwake(!0),b.GetType()==q.b2_dynamicBody){for(h=b.m_contactList;h&&j.m_contactCount!=j.m_contactCapacity;h=h.next)if(!(h.contact.m_flags&E.e_islandFlag)&&1!=h.contact.IsSensor()&&0!=h.contact.IsEnabled()&&0!=h.contact.IsTouching()){j.AddContact(h.contact),h.contact.m_flags|=E.e_islandFlag;var u=h.other;u.m_flags&q.e_islandFlag||(u.GetType()!=q.b2_staticBody&&(u.Advance(n),u.SetAwake(!0)),k[s+t]=u,++t,u.m_flags|=q.e_islandFlag)}for(var v=b.m_jointList;v;v=v.next)j.m_jointCount!=j.m_jointCapacity&&1!=v.joint.m_islandFlag&&(u=v.other,0!=u.IsActive()&&(j.AddJoint(v.joint),v.joint.m_islandFlag=!0,u.m_flags&q.e_islandFlag||(u.GetType()!=q.b2_staticBody&&(u.Advance(n),u.SetAwake(!0)),k[s+t]=u,++t,u.m_flags|=q.e_islandFlag)))}var w=D.s_timestep;w.warmStarting=!1,w.dt=(1-n)*a.dt,w.inv_dt=1/w.dt,w.dtRatio=0,w.velocityIterations=a.velocityIterations,w.positionIterations=a.positionIterations,j.SolveTOI(w);var x=0;for(x=0;x<j.m_bodyCount;++x)if(b=j.m_bodies[x],b.m_flags&=~q.e_islandFlag,0!=b.IsAwake()&&b.GetType()==q.b2_dynamicBody)for(b.SynchronizeFixtures(),h=b.m_contactList;h;h=h.next)h.contact.m_flags&=~E.e_toiFlag;for(x=0;x<j.m_contactCount;++x)l=j.m_contacts[x],l.m_flags&=~(E.e_toiFlag|E.e_islandFlag);for(x=0;x<j.m_jointCount;++x)i=j.m_joints[x],i.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}else e.m_sweep.Set(D.s_backupA),g.m_sweep.Set(D.s_backupB),e.SynchronizeTransform(),g.SynchronizeTransform()}},D.prototype.DrawJoint=function(a){var b=a.GetBodyA(),c=a.GetBodyB(),d=b.m_xf,e=c.m_xf,f=d.position,g=e.position,h=a.GetAnchorA(),i=a.GetAnchorB(),j=D.s_jointColor;switch(a.m_type){case H.e_distanceJoint:this.m_debugDraw.DrawSegment(h,i,j);break;case H.e_pulleyJoint:var k=a instanceof I?a:null,l=k.GetGroundAnchorA(),m=k.GetGroundAnchorB();this.m_debugDraw.DrawSegment(l,h,j),this.m_debugDraw.DrawSegment(m,i,j),this.m_debugDraw.DrawSegment(l,m,j);break;case H.e_mouseJoint:this.m_debugDraw.DrawSegment(h,i,j);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(f,h,j),this.m_debugDraw.DrawSegment(h,i,j),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(g,i,j)}},D.prototype.DrawShape=function(b,c,d){switch(b.m_type){case p.e_circleShape:var e=b instanceof l?b:null,f=a.MulX(c,e.m_p),g=e.m_radius,h=c.R.col1;this.m_debugDraw.DrawSolidCircle(f,g,h,d);break;case p.e_polygonShape:var i=0,j=b instanceof o?b:null,k=parseInt(j.GetVertexCount()),n=j.GetVertices(),q=new Vector(k);for(i=0;i<k;++i)q[i]=a.MulX(c,n[i]);this.m_debugDraw.DrawSolidPolygon(q,k,d);break;case p.e_edgeShape:var r=b instanceof m?b:null;this.m_debugDraw.DrawSegment(a.MulX(c,r.GetVertex1()),a.MulX(c,r.GetVertex2()),d)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new C,Box2D.Dynamics.b2World.s_xf=new c,Box2D.Dynamics.b2World.s_backupA=new b,Box2D.Dynamics.b2World.s_backupB=new b,Box2D.Dynamics.b2World.s_timestep=new C,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new e(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var a=Box2D.Collision.Shapes.b2CircleShape,b=(Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape),c=(Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape),d=Box2D.Collision.Shapes.b2Shape,e=Box2D.Dynamics.Contacts.b2CircleContact,f=Box2D.Dynamics.Contacts.b2Contact,g=Box2D.Dynamics.Contacts.b2ContactConstraint,h=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,i=Box2D.Dynamics.Contacts.b2ContactEdge,j=Box2D.Dynamics.Contacts.b2ContactFactory,k=Box2D.Dynamics.Contacts.b2ContactRegister,l=Box2D.Dynamics.Contacts.b2ContactResult,m=Box2D.Dynamics.Contacts.b2ContactSolver,n=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,o=Box2D.Dynamics.Contacts.b2NullContact,p=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,q=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,r=Box2D.Dynamics.Contacts.b2PolygonContact,s=Box2D.Dynamics.Contacts.b2PositionSolverManifold,t=Box2D.Dynamics.b2Body,u=(Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep),v=(Box2D.Dynamics.b2World,Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),w=Box2D.Common.Math.b2Mat22,x=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),y=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),z=(Box2D.Common.Math.b2Vec3,Box2D.Collision.b2AABB,Box2D.Collision.b2Bound,Box2D.Collision.b2BoundValues,Box2D.Collision.b2Collision),A=Box2D.Collision.b2ContactID,B=(Box2D.Collision.b2ContactPoint,Box2D.Collision.b2Distance,Box2D.Collision.b2DistanceInput,Box2D.Collision.b2DistanceOutput,Box2D.Collision.b2DistanceProxy,Box2D.Collision.b2DynamicTree,Box2D.Collision.b2DynamicTreeBroadPhase,Box2D.Collision.b2DynamicTreeNode,Box2D.Collision.b2DynamicTreePair,Box2D.Collision.b2Manifold),C=(Box2D.Collision.b2ManifoldPoint,Box2D.Collision.b2Point,Box2D.Collision.b2RayCastInput,Box2D.Collision.b2RayCastOutput,Box2D.Collision.b2Segment,Box2D.Collision.b2SeparationFunction,Box2D.Collision.b2Simplex,Box2D.Collision.b2SimplexCache,Box2D.Collision.b2SimplexVertex,Box2D.Collision.b2TimeOfImpact),D=Box2D.Collision.b2TOIInput,E=Box2D.Collision.b2WorldManifold;Box2D.Collision.ClipVertex,Box2D.Collision.Features,Box2D.Collision.IBroadPhase;Box2D.inherit(e,Box2D.Dynamics.Contacts.b2Contact),e.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,e.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},e.Create=function(a){return new e},e.Destroy=function(a,b){},e.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)},e.prototype.Evaluate=function(){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody();z.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof a?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,c.m_xf)},f.b2Contact=function(){this.m_nodeA=new i,this.m_nodeB=new i,this.m_manifold=new B,this.m_oldManifold=new B},f.prototype.GetManifold=function(){return this.m_manifold},f.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),e.m_radius)},f.prototype.IsTouching=function(){return(this.m_flags&f.e_touchingFlag)==f.e_touchingFlag},f.prototype.IsContinuous=function(){return(this.m_flags&f.e_continuousFlag)==f.e_continuousFlag},f.prototype.SetSensor=function(a){a?this.m_flags|=f.e_sensorFlag:this.m_flags&=~f.e_sensorFlag},f.prototype.IsSensor=function(){return(this.m_flags&f.e_sensorFlag)==f.e_sensorFlag},f.prototype.SetEnabled=function(a){a?this.m_flags|=f.e_enabledFlag:this.m_flags&=~f.e_enabledFlag},f.prototype.IsEnabled=function(){return(this.m_flags&f.e_enabledFlag)==f.e_enabledFlag},f.prototype.GetNext=function(){return this.m_next},f.prototype.GetFixtureA=function(){return this.m_fixtureA},f.prototype.GetFixtureB=function(){return this.m_fixtureB},f.prototype.FlagForFiltering=function(){this.m_flags|=f.e_filterFlag},f.prototype.b2Contact=function(){},f.prototype.Reset=function(a,b){if(void 0===a&&(a=null),void 0===b&&(b=null),this.m_flags=f.e_enabledFlag,!a||!b)return this.m_fixtureA=null,void(this.m_fixtureB=null);(a.IsSensor()||b.IsSensor())&&(this.m_flags|=f.e_sensorFlag);var c=a.GetBody(),d=b.GetBody();(c.GetType()!=t.b2_dynamicBody||c.IsBullet()||d.GetType()!=t.b2_dynamicBody||d.IsBullet())&&(this.m_flags|=f.e_continuousFlag),this.m_fixtureA=a,this.m_fixtureB=b,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},f.prototype.Update=function(a){var b=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=b,this.m_flags|=f.e_enabledFlag;var c=!1,e=(this.m_flags&f.e_touchingFlag)==f.e_touchingFlag,g=this.m_fixtureA.m_body,h=this.m_fixtureB.m_body,i=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&f.e_sensorFlag){if(i){var j=this.m_fixtureA.GetShape(),k=this.m_fixtureB.GetShape(),l=g.GetTransform(),m=h.GetTransform();c=d.TestOverlap(j,l,k,m)}this.m_manifold.m_pointCount=0}else{if(g.GetType()!=t.b2_dynamicBody||g.IsBullet()||h.GetType()!=t.b2_dynamicBody||h.IsBullet()?this.m_flags|=f.e_continuousFlag:this.m_flags&=~f.e_continuousFlag,i){this.Evaluate(),c=this.m_manifold.m_pointCount>0;for(var n=0;n<this.m_manifold.m_pointCount;++n){var o=this.m_manifold.m_points[n];o.m_normalImpulse=0,o.m_tangentImpulse=0;for(var p=o.m_id,q=0;q<this.m_oldManifold.m_pointCount;++q){var r=this.m_oldManifold.m_points[q];if(r.m_id.key==p.key){o.m_normalImpulse=r.m_normalImpulse,o.m_tangentImpulse=r.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;c!=e&&(g.SetAwake(!0),h.SetAwake(!0))}c?this.m_flags|=f.e_touchingFlag:this.m_flags&=~f.e_touchingFlag,0==e&&1==c&&a.BeginContact(this),1==e&&0==c&&a.EndContact(this),0==(this.m_flags&f.e_sensorFlag)&&a.PreSolve(this,this.m_oldManifold)},f.prototype.Evaluate=function(){},f.prototype.ComputeTOI=function(a,b){return f.s_input.proxyA.Set(this.m_fixtureA.GetShape()),f.s_input.proxyB.Set(this.m_fixtureB.GetShape()),f.s_input.sweepA=a,f.s_input.sweepB=b,f.s_input.tolerance=v.b2_linearSlop,C.TimeOfImpact(f.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new D}),g.b2ContactConstraint=function(){this.localPlaneNormal=new y,this.localPoint=new y,this.normal=new y,this.normalMass=new w,this.K=new w},g.prototype.b2ContactConstraint=function(){this.points=new Vector(v.b2_maxManifoldPoints);for(var a=0;a<v.b2_maxManifoldPoints;a++)this.points[a]=new h},h.b2ContactConstraintPoint=function(){this.localPoint=new y,this.rA=new y,this.rB=new y},i.b2ContactEdge=function(){},j.b2ContactFactory=function(){},j.prototype.b2ContactFactory=function(a){this.m_allocator=a,this.InitializeRegisters()},j.prototype.AddType=function(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0),this.m_registers[c][d].createFcn=a,this.m_registers[c][d].destroyFcn=b,this.m_registers[c][d].primary=!0,c!=d&&(this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1)},j.prototype.InitializeRegisters=function(){this.m_registers=new Vector(d.e_shapeTypeCount);for(var a=0;a<d.e_shapeTypeCount;a++){this.m_registers[a]=new Vector(d.e_shapeTypeCount);for(var b=0;b<d.e_shapeTypeCount;b++)this.m_registers[a][b]=new k}this.AddType(e.Create,e.Destroy,d.e_circleShape,d.e_circleShape),this.AddType(p.Create,p.Destroy,d.e_polygonShape,d.e_circleShape),this.AddType(r.Create,r.Destroy,d.e_polygonShape,d.e_polygonShape),this.AddType(n.Create,n.Destroy,d.e_edgeShape,d.e_circleShape),this.AddType(q.Create,q.Destroy,d.e_polygonShape,d.e_edgeShape)},j.prototype.Create=function(a,b){var c,d=parseInt(a.GetType()),e=parseInt(b.GetType()),f=this.m_registers[d][e];if(f.pool)return c=f.pool,f.pool=c.m_next,f.poolCount--,c.Reset(a,b),c;var g=f.createFcn;return null!=g?f.primary?(c=g(this.m_allocator),c.Reset(a,b),c):(c=g(this.m_allocator),c.Reset(b,a),c):null},j.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=parseInt(a.m_fixtureA.GetType()),c=parseInt(a.m_fixtureB.GetType()),d=this.m_registers[b][c];d.poolCount++,a.m_next=d.pool,d.pool=a,(0,d.destroyFcn)(a,this.m_allocator)},k.b2ContactRegister=function(){},l.b2ContactResult=function(){this.position=new y,this.normal=new y,this.id=new A},m.b2ContactSolver=function(){this.m_step=new u,this.m_constraints=new Vector},m.prototype.b2ContactSolver=function(){},m.prototype.Initialize=function(a,b,c,d){void 0===c&&(c=0);var e;this.m_step.Set(a),this.m_allocator=d;var f=0;for(this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new g;for(f=0;f<c;++f){e=b[f];var h=e.m_fixtureA,i=e.m_fixtureB,j=h.m_shape,k=i.m_shape,l=j.m_radius,n=k.m_radius,o=h.m_body,p=i.m_body,q=e.GetManifold(),r=v.b2MixFriction(h.GetFriction(),i.GetFriction()),s=v.b2MixRestitution(h.GetRestitution(),i.GetRestitution()),t=o.m_linearVelocity.x,u=o.m_linearVelocity.y,w=p.m_linearVelocity.x,x=p.m_linearVelocity.y,y=o.m_angularVelocity,z=p.m_angularVelocity;v.b2Assert(q.m_pointCount>0),m.s_worldManifold.Initialize(q,o.m_xf,l,p.m_xf,n);var A=m.s_worldManifold.m_normal.x,B=m.s_worldManifold.m_normal.y,C=this.m_constraints[f];C.bodyA=o,C.bodyB=p,C.manifold=q,C.normal.x=A,C.normal.y=B,C.pointCount=q.m_pointCount,C.friction=r,C.restitution=s,C.localPlaneNormal.x=q.m_localPlaneNormal.x,C.localPlaneNormal.y=q.m_localPlaneNormal.y,C.localPoint.x=q.m_localPoint.x,C.localPoint.y=q.m_localPoint.y,C.radius=l+n,C.type=q.m_type;for(var D=0;D<C.pointCount;++D){var E=q.m_points[D],F=C.points[D];F.normalImpulse=E.m_normalImpulse,F.tangentImpulse=E.m_tangentImpulse,F.localPoint.SetV(E.m_localPoint);var G=F.rA.x=m.s_worldManifold.m_points[D].x-o.m_sweep.c.x,H=F.rA.y=m.s_worldManifold.m_points[D].y-o.m_sweep.c.y,I=F.rB.x=m.s_worldManifold.m_points[D].x-p.m_sweep.c.x,J=F.rB.y=m.s_worldManifold.m_points[D].y-p.m_sweep.c.y,K=G*B-H*A,L=I*B-J*A;K*=K,L*=L;var M=o.m_invMass+p.m_invMass+o.m_invI*K+p.m_invI*L;F.normalMass=1/M;var N=o.m_mass*o.m_invMass+p.m_mass*p.m_invMass;N+=o.m_mass*o.m_invI*K+p.m_mass*p.m_invI*L,F.equalizedMass=1/N;var O=B,P=-A,Q=G*P-H*O,R=I*P-J*O;Q*=Q,R*=R;var S=o.m_invMass+p.m_invMass+o.m_invI*Q+p.m_invI*R;F.tangentMass=1/S,F.velocityBias=0;var T=w+-z*J-t- -y*H,U=x+z*I-u-y*G,V=C.normal.x*T+C.normal.y*U;V<-v.b2_velocityThreshold&&(F.velocityBias+=-C.restitution*V)}if(2==C.pointCount){var W=C.points[0],X=C.points[1],Y=o.m_invMass,Z=o.m_invI,$=p.m_invMass,_=p.m_invI,aa=W.rA.x*B-W.rA.y*A,ba=W.rB.x*B-W.rB.y*A,ca=X.rA.x*B-X.rA.y*A,da=X.rB.x*B-X.rB.y*A,ea=Y+$+Z*aa*aa+_*ba*ba,fa=Y+$+Z*ca*ca+_*da*da,ga=Y+$+Z*aa*ca+_*ba*da;ea*ea<100*(ea*fa-ga*ga)?(C.K.col1.Set(ea,ga),C.K.col2.Set(ga,fa),C.K.GetInverse(C.normalMass)):C.pointCount=1}}},m.prototype.InitVelocityConstraints=function(a){for(var b=0;b<this.m_constraintCount;++b){var c=this.m_constraints[b],d=c.bodyA,e=c.bodyB,f=d.m_invMass,g=d.m_invI,h=e.m_invMass,i=e.m_invI,j=c.normal.x,k=c.normal.y,l=k,m=-j,n=0,o=0;if(a.warmStarting)for(o=c.pointCount,n=0;n<o;++n){var p=c.points[n];p.normalImpulse*=a.dtRatio,p.tangentImpulse*=a.dtRatio;var q=p.normalImpulse*j+p.tangentImpulse*l,r=p.normalImpulse*k+p.tangentImpulse*m;d.m_angularVelocity-=g*(p.rA.x*r-p.rA.y*q),d.m_linearVelocity.x-=f*q,d.m_linearVelocity.y-=f*r,e.m_angularVelocity+=i*(p.rB.x*r-p.rB.y*q),e.m_linearVelocity.x+=h*q,e.m_linearVelocity.y+=h*r}else for(o=c.pointCount,n=0;n<o;++n){var s=c.points[n];s.normalImpulse=0,s.tangentImpulse=0}}},m.prototype.SolveVelocityConstraints=function(){for(var a,b,c=0,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0;s<this.m_constraintCount;++s){var t=this.m_constraints[s],u=t.bodyA,v=t.bodyB,w=u.m_angularVelocity,y=v.m_angularVelocity,z=u.m_linearVelocity,A=v.m_linearVelocity,B=u.m_invMass,C=u.m_invI,D=v.m_invMass,E=v.m_invI,F=t.normal.x,G=t.normal.y,H=G,I=-F,J=t.friction;for(c=0;c<t.pointCount;c++)a=t.points[c],d=A.x-y*a.rB.y-z.x+w*a.rA.y,e=A.y+y*a.rB.x-z.y-w*a.rA.x,g=d*H+e*I,h=a.tangentMass*-g,i=J*a.normalImpulse,j=x.Clamp(a.tangentImpulse+h,-i,i),h=j-a.tangentImpulse,k=h*H,l=h*I,z.x-=B*k,z.y-=B*l,w-=C*(a.rA.x*l-a.rA.y*k),A.x+=D*k,A.y+=D*l,y+=E*(a.rB.x*l-a.rB.y*k),a.tangentImpulse=j;parseInt(t.pointCount);if(1==t.pointCount)a=t.points[0],d=A.x+-y*a.rB.y-z.x- -w*a.rA.y,e=A.y+y*a.rB.x-z.y-w*a.rA.x,f=d*F+e*G,h=-a.normalMass*(f-a.velocityBias),j=a.normalImpulse+h,j=j>0?j:0,h=j-a.normalImpulse,k=h*F,l=h*G,z.x-=B*k,z.y-=B*l,w-=C*(a.rA.x*l-a.rA.y*k),A.x+=D*k,A.y+=D*l,y+=E*(a.rB.x*l-a.rB.y*k),a.normalImpulse=j;else{var K=t.points[0],L=t.points[1],M=K.normalImpulse,N=L.normalImpulse,O=A.x-y*K.rB.y-z.x+w*K.rA.y,P=A.y+y*K.rB.x-z.y-w*K.rA.x,Q=A.x-y*L.rB.y-z.x+w*L.rA.y,R=A.y+y*L.rB.x-z.y-w*L.rA.x,S=O*F+P*G,T=Q*F+R*G,U=S-K.velocityBias,V=T-L.velocityBias;b=t.K,U-=b.col1.x*M+b.col2.x*N,V-=b.col1.y*M+b.col2.y*N;for(;;){b=t.normalMass;var W=-(b.col1.x*U+b.col2.x*V),X=-(b.col1.y*U+b.col2.y*V);if(W>=0&&X>=0){m=W-M,n=X-N,o=m*F,p=m*G,q=n*F,r=n*G,z.x-=B*(o+q),z.y-=B*(p+r),w-=C*(K.rA.x*p-K.rA.y*o+L.rA.x*r-L.rA.y*q),A.x+=D*(o+q),A.y+=D*(p+r),y+=E*(K.rB.x*p-K.rB.y*o+L.rB.x*r-L.rB.y*q),K.normalImpulse=W,L.normalImpulse=X;break}if(W=-K.normalMass*U,X=0,S=0,T=t.K.col1.y*W+V,W>=0&&T>=0){m=W-M,n=X-N,o=m*F,p=m*G,q=n*F,r=n*G,z.x-=B*(o+q),z.y-=B*(p+r),w-=C*(K.rA.x*p-K.rA.y*o+L.rA.x*r-L.rA.y*q),A.x+=D*(o+q),A.y+=D*(p+r),y+=E*(K.rB.x*p-K.rB.y*o+L.rB.x*r-L.rB.y*q),K.normalImpulse=W,L.normalImpulse=X;break}if(W=0,X=-L.normalMass*V,S=t.K.col2.x*X+U,T=0,X>=0&&S>=0){m=W-M,n=X-N,o=m*F,p=m*G,q=n*F,r=n*G,z.x-=B*(o+q),z.y-=B*(p+r),w-=C*(K.rA.x*p-K.rA.y*o+L.rA.x*r-L.rA.y*q),A.x+=D*(o+q),A.y+=D*(p+r),y+=E*(K.rB.x*p-K.rB.y*o+L.rB.x*r-L.rB.y*q),K.normalImpulse=W,L.normalImpulse=X;break}if(W=0,X=0,S=U,T=V,S>=0&&T>=0){m=W-M,n=X-N,o=m*F,p=m*G,q=n*F,r=n*G,z.x-=B*(o+q),z.y-=B*(p+r),w-=C*(K.rA.x*p-K.rA.y*o+L.rA.x*r-L.rA.y*q),A.x+=D*(o+q),A.y+=D*(p+r),y+=E*(K.rB.x*p-K.rB.y*o+L.rB.x*r-L.rB.y*q),K.normalImpulse=W,L.normalImpulse=X;break}break}}u.m_angularVelocity=w,v.m_angularVelocity=y}},m.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],c=b.manifold,d=0;d<b.pointCount;++d){var e=c.m_points[d],f=b.points[d];e.m_normalImpulse=f.normalImpulse,e.m_tangentImpulse=f.tangentImpulse}},m.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],e=d.bodyA,f=d.bodyB,g=e.m_mass*e.m_invMass,h=e.m_mass*e.m_invI,i=f.m_mass*f.m_invMass,j=f.m_mass*f.m_invI;m.s_psm.Initialize(d);for(var k=m.s_psm.m_normal,l=0;l<d.pointCount;l++){var n=d.points[l],o=m.s_psm.m_points[l],p=m.s_psm.m_separations[l],q=o.x-e.m_sweep.c.x,r=o.y-e.m_sweep.c.y,s=o.x-f.m_sweep.c.x,t=o.y-f.m_sweep.c.y;b=b<p?b:p;var u=x.Clamp(a*(p+v.b2_linearSlop),-v.b2_maxLinearCorrection,0),w=-n.equalizedMass*u,y=w*k.x,z=w*k.y;e.m_sweep.c.x-=g*y,e.m_sweep.c.y-=g*z,e.m_sweep.a-=h*(q*z-r*y),e.SynchronizeTransform(),f.m_sweep.c.x+=i*y,f.m_sweep.c.y+=i*z,f.m_sweep.a+=j*(s*z-t*y),f.SynchronizeTransform()}}return b>-1.5*v.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new E,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new s}),Box2D.inherit(n,Box2D.Dynamics.Contacts.b2Contact),n.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,n.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},n.Create=function(a){return new n},n.Destroy=function(a,b){},n.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)},n.prototype.Evaluate=function(){var c=this.m_fixtureA.GetBody(),d=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof b?this.m_fixtureA.GetShape():null,c.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,d.m_xf)},n.prototype.b2CollideEdgeAndCircle=function(a,b,c,d,e){},Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact),o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,o.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},o.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},o.prototype.Evaluate=function(){},Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact),p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,p.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},p.Create=function(a){return new p},p.Destroy=function(a,b){},p.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b),v.b2Assert(a.GetType()==d.e_polygonShape),v.b2Assert(b.GetType()==d.e_circleShape)},p.prototype.Evaluate=function(){var b=this.m_fixtureA.m_body,d=this.m_fixtureB.m_body;z.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,b.m_xf,this.m_fixtureB.GetShape()instanceof a?this.m_fixtureB.GetShape():null,d.m_xf)},Box2D.inherit(q,Box2D.Dynamics.Contacts.b2Contact),q.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,q.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},q.Create=function(a){return new q},q.Destroy=function(a,b){},q.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b),v.b2Assert(a.GetType()==d.e_polygonShape),v.b2Assert(b.GetType()==d.e_edgeShape)},q.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),d=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,d.m_xf)},q.prototype.b2CollidePolyAndEdge=function(a,b,c,d,e){},Box2D.inherit(r,Box2D.Dynamics.Contacts.b2Contact),r.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,r.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},r.Create=function(a){return new r},r.Destroy=function(a,b){},r.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)},r.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();z.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof c?this.m_fixtureB.GetShape():null,b.m_xf)},s.b2PositionSolverManifold=function(){},s.prototype.b2PositionSolverManifold=function(){this.m_normal=new y,this.m_separations=new Vector_a2j_Number(v.b2_maxManifoldPoints),this.m_points=new Vector(v.b2_maxManifoldPoints);for(var a=0;a<v.b2_maxManifoldPoints;a++)this.m_points[a]=new y},s.prototype.Initialize=function(a){v.b2Assert(a.pointCount>0);var b,c,d=0,e=0,f=0,g=0,h=0;switch(a.type){case B.e_circles:b=a.bodyA.m_xf.R,c=a.localPoint;var i=a.bodyA.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),j=a.bodyA.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y);b=a.bodyB.m_xf.R,c=a.points[0].localPoint;var k=a.bodyB.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),l=a.bodyB.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),m=k-i,n=l-j,o=m*m+n*n;if(o>Number.MIN_VALUE*Number.MIN_VALUE){var p=Math.sqrt(o);this.m_normal.x=m/p,
this.m_normal.y=n/p}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(i+k),this.m_points[0].y=.5*(j+l),this.m_separations[0]=m*this.m_normal.x+n*this.m_normal.y-a.radius;break;case B.e_faceA:for(b=a.bodyA.m_xf.R,c=a.localPlaneNormal,this.m_normal.x=b.col1.x*c.x+b.col2.x*c.y,this.m_normal.y=b.col1.y*c.x+b.col2.y*c.y,b=a.bodyA.m_xf.R,c=a.localPoint,g=a.bodyA.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),h=a.bodyA.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),b=a.bodyB.m_xf.R,d=0;d<a.pointCount;++d)c=a.points[d].localPoint,e=a.bodyB.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),f=a.bodyB.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),this.m_separations[d]=(e-g)*this.m_normal.x+(f-h)*this.m_normal.y-a.radius,this.m_points[d].x=e,this.m_points[d].y=f;break;case B.e_faceB:for(b=a.bodyB.m_xf.R,c=a.localPlaneNormal,this.m_normal.x=b.col1.x*c.x+b.col2.x*c.y,this.m_normal.y=b.col1.y*c.x+b.col2.y*c.y,b=a.bodyB.m_xf.R,c=a.localPoint,g=a.bodyB.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),h=a.bodyB.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),b=a.bodyA.m_xf.R,d=0;d<a.pointCount;++d)c=a.points[d].localPoint,e=a.bodyA.m_xf.position.x+(b.col1.x*c.x+b.col2.x*c.y),f=a.bodyA.m_xf.position.y+(b.col1.y*c.x+b.col2.y*c.y),this.m_separations[d]=(e-g)*this.m_normal.x+(f-h)*this.m_normal.y-a.radius,this.m_points[d].Set(e,f);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new y,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new y})}(),function(){var a=(Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World,Box2D.Common.Math.b2Mat22),b=(Box2D.Common.Math.b2Mat33,Box2D.Common.Math.b2Math),c=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),d=(Box2D.Common.Math.b2Vec3,Box2D.Common.b2Color),e=(Box2D.Common.b2internal,Box2D.Common.b2Settings,Box2D.Collision.Shapes.b2CircleShape,Box2D.Collision.Shapes.b2EdgeChainDef,Box2D.Collision.Shapes.b2EdgeShape,Box2D.Collision.Shapes.b2MassData,Box2D.Collision.Shapes.b2PolygonShape,Box2D.Collision.Shapes.b2Shape,Box2D.Dynamics.Controllers.b2BuoyancyController),f=Box2D.Dynamics.Controllers.b2ConstantAccelController,g=Box2D.Dynamics.Controllers.b2ConstantForceController,h=Box2D.Dynamics.Controllers.b2Controller,i=Box2D.Dynamics.Controllers.b2ControllerEdge,j=Box2D.Dynamics.Controllers.b2GravityController,k=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(e,Box2D.Dynamics.Controllers.b2Controller),e.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,e.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new c(0,-1),this.offset=0,this.density=0,this.velocity=new c(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},e.prototype.Step=function(a){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var b=this.m_bodyList;b;b=b.nextBody){var d=b.body;if(0!=d.IsAwake()){for(var e=new c,f=new c,g=0,h=0,i=d.GetFixtureList();i;i=i.GetNext()){var j=new c,k=i.GetShape().ComputeSubmergedArea(this.normal,this.offset,d.GetTransform(),j);g+=k,e.x+=k*j.x,e.y+=k*j.y;var l=0;l=(this.useDensity,1),h+=k*l,f.x+=k*j.x*l,f.y+=k*j.y*l}if(e.x/=g,e.y/=g,f.x/=h,f.y/=h,!(g<Number.MIN_VALUE)){var m=this.gravity.GetNegative();m.Multiply(this.density*g),d.ApplyForce(m,f);var n=d.GetLinearVelocityFromWorldPoint(e);n.Subtract(this.velocity),n.Multiply(-this.linearDrag*g),d.ApplyForce(n,e),d.ApplyTorque(-d.GetInertia()/d.GetMass()*g*d.GetAngularVelocity()*this.angularDrag)}}}}},e.prototype.Draw=function(a){var b=1e3,e=new c,f=new c;e.x=this.normal.x*this.offset+this.normal.y*b,e.y=this.normal.y*this.offset-this.normal.x*b,f.x=this.normal.x*this.offset-this.normal.y*b,f.y=this.normal.y*this.offset+this.normal.x*b;var g=new d(0,0,1);a.DrawSegment(e,f,g)},Box2D.inherit(f,Box2D.Dynamics.Controllers.b2Controller),f.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,f.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new c(0,0)},f.prototype.Step=function(a){for(var b=new c(this.A.x*a.dt,this.A.y*a.dt),d=this.m_bodyList;d;d=d.nextBody){var e=d.body;e.IsAwake()&&e.SetLinearVelocity(new c(e.GetLinearVelocity().x+b.x,e.GetLinearVelocity().y+b.y))}},Box2D.inherit(g,Box2D.Dynamics.Controllers.b2Controller),g.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,g.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new c(0,0)},g.prototype.Step=function(a){for(var b=this.m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.ApplyForce(this.F,c.GetWorldCenter())}},h.b2Controller=function(){},h.prototype.Step=function(a){},h.prototype.Draw=function(a){},h.prototype.AddBody=function(a){var b=new i;b.controller=this,b.body=a,b.nextBody=this.m_bodyList,b.prevBody=null,this.m_bodyList=b,b.nextBody&&(b.nextBody.prevBody=b),this.m_bodyCount++,b.nextController=a.m_controllerList,b.prevController=null,a.m_controllerList=b,b.nextController&&(b.nextController.prevController=b),a.m_controllerCount++},h.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;b.prevBody&&(b.prevBody.nextBody=b.nextBody),b.nextBody&&(b.nextBody.prevBody=b.prevBody),b.nextController&&(b.nextController.prevController=b.prevController),b.prevController&&(b.prevController.nextController=b.nextController),this.m_bodyList==b&&(this.m_bodyList=b.nextBody),a.m_controllerList==b&&(a.m_controllerList=b.nextController),a.m_controllerCount--,this.m_bodyCount--},h.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},h.prototype.GetNext=function(){return this.m_next},h.prototype.GetWorld=function(){return this.m_world},h.prototype.GetBodyList=function(){return this.m_bodyList},i.b2ControllerEdge=function(){},Box2D.inherit(j,Box2D.Dynamics.Controllers.b2Controller),j.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,j.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},j.prototype.Step=function(a){var b=null,d=null,e=null,f=0,g=null,h=null,i=null,j=0,k=0,l=0,m=null;if(this.invSqr)for(b=this.m_bodyList;b;b=b.nextBody)for(d=b.body,e=d.GetWorldCenter(),f=d.GetMass(),g=this.m_bodyList;g!=b;g=g.nextBody)h=g.body,i=h.GetWorldCenter(),j=i.x-e.x,k=i.y-e.y,(l=j*j+k*k)<Number.MIN_VALUE||(m=new c(j,k),m.Multiply(this.G/l/Math.sqrt(l)*f*h.GetMass()),d.IsAwake()&&d.ApplyForce(m,e),m.Multiply(-1),h.IsAwake()&&h.ApplyForce(m,i));else for(b=this.m_bodyList;b;b=b.nextBody)for(d=b.body,e=d.GetWorldCenter(),f=d.GetMass(),g=this.m_bodyList;g!=b;g=g.nextBody)h=g.body,i=h.GetWorldCenter(),j=i.x-e.x,k=i.y-e.y,(l=j*j+k*k)<Number.MIN_VALUE||(m=new c(j,k),m.Multiply(this.G/l*f*h.GetMass()),d.IsAwake()&&d.ApplyForce(m,e),m.Multiply(-1),h.IsAwake()&&h.ApplyForce(m,i))},Box2D.inherit(k,Box2D.Dynamics.Controllers.b2Controller),k.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,k.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new a,this.maxTimestep=0},k.prototype.SetAxisAligned=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.T.col1.x=-a,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-b,this.maxTimestep=a>0||b>0?1/Math.max(a,b):0},k.prototype.Step=function(a){var d=a.dt;if(!(d<=Number.MIN_VALUE)){d>this.maxTimestep&&this.maxTimestep>0&&(d=this.maxTimestep);for(var e=this.m_bodyList;e;e=e.nextBody){var f=e.body;if(f.IsAwake()){var g=f.GetWorldVector(b.MulMV(this.T,f.GetLocalVector(f.GetLinearVelocity())));f.SetLinearVelocity(new c(f.GetLinearVelocity().x+g.x*d,f.GetLinearVelocity().y+g.y*d))}}}}}(),function(){var a=(Box2D.Common.b2Color,Box2D.Common.b2internal,Box2D.Common.b2Settings),b=Box2D.Common.Math.b2Mat22,c=Box2D.Common.Math.b2Mat33,d=Box2D.Common.Math.b2Math,e=(Box2D.Common.Math.b2Sweep,Box2D.Common.Math.b2Transform,Box2D.Common.Math.b2Vec2),f=Box2D.Common.Math.b2Vec3,g=Box2D.Dynamics.Joints.b2DistanceJoint,h=Box2D.Dynamics.Joints.b2DistanceJointDef,i=Box2D.Dynamics.Joints.b2FrictionJoint,j=Box2D.Dynamics.Joints.b2FrictionJointDef,k=Box2D.Dynamics.Joints.b2GearJoint,l=Box2D.Dynamics.Joints.b2GearJointDef,m=Box2D.Dynamics.Joints.b2Jacobian,n=Box2D.Dynamics.Joints.b2Joint,o=Box2D.Dynamics.Joints.b2JointDef,p=Box2D.Dynamics.Joints.b2JointEdge,q=Box2D.Dynamics.Joints.b2LineJoint,r=Box2D.Dynamics.Joints.b2LineJointDef,s=Box2D.Dynamics.Joints.b2MouseJoint,t=Box2D.Dynamics.Joints.b2MouseJointDef,u=Box2D.Dynamics.Joints.b2PrismaticJoint,v=Box2D.Dynamics.Joints.b2PrismaticJointDef,w=Box2D.Dynamics.Joints.b2PulleyJoint,x=Box2D.Dynamics.Joints.b2PulleyJointDef,y=Box2D.Dynamics.Joints.b2RevoluteJoint,z=Box2D.Dynamics.Joints.b2RevoluteJointDef,A=Box2D.Dynamics.Joints.b2WeldJoint,B=Box2D.Dynamics.Joints.b2WeldJointDef;Box2D.Dynamics.b2Body,Box2D.Dynamics.b2BodyDef,Box2D.Dynamics.b2ContactFilter,Box2D.Dynamics.b2ContactImpulse,Box2D.Dynamics.b2ContactListener,Box2D.Dynamics.b2ContactManager,Box2D.Dynamics.b2DebugDraw,Box2D.Dynamics.b2DestructionListener,Box2D.Dynamics.b2FilterData,Box2D.Dynamics.b2Fixture,Box2D.Dynamics.b2FixtureDef,Box2D.Dynamics.b2Island,Box2D.Dynamics.b2TimeStep,Box2D.Dynamics.b2World;Box2D.inherit(g,Box2D.Dynamics.Joints.b2Joint),g.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,g.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new e,this.m_localAnchor2=new e,this.m_u=new e},g.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},g.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},g.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)},g.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},g.prototype.GetLength=function(){return this.m_length},g.prototype.SetLength=function(a){void 0===a&&(a=0),this.m_length=a},g.prototype.GetFrequency=function(){return this.m_frequencyHz},g.prototype.SetFrequency=function(a){void 0===a&&(a=0),this.m_frequencyHz=a},g.prototype.GetDampingRatio=function(){return this.m_dampingRatio},g.prototype.SetDampingRatio=function(a){void 0===a&&(a=0),this.m_dampingRatio=a},g.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_length=a.length,this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},g.prototype.InitVelocityConstraints=function(b){var c,d=0,e=this.m_bodyA,f=this.m_bodyB;c=e.m_xf.R;var g=this.m_localAnchor1.x-e.m_sweep.localCenter.x,h=this.m_localAnchor1.y-e.m_sweep.localCenter.y;d=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=d,c=f.m_xf.R;var i=this.m_localAnchor2.x-f.m_sweep.localCenter.x,j=this.m_localAnchor2.y-f.m_sweep.localCenter.y;d=c.col1.x*i+c.col2.x*j,j=c.col1.y*i+c.col2.y*j,i=d,this.m_u.x=f.m_sweep.c.x+i-e.m_sweep.c.x-g,this.m_u.y=f.m_sweep.c.y+j-e.m_sweep.c.y-h;var k=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);k>a.b2_linearSlop?this.m_u.Multiply(1/k):this.m_u.SetZero();var l=g*this.m_u.y-h*this.m_u.x,m=i*this.m_u.y-j*this.m_u.x,n=e.m_invMass+e.m_invI*l*l+f.m_invMass+f.m_invI*m*m;if(this.m_mass=0!=n?1/n:0,this.m_frequencyHz>0){var o=k-this.m_length,p=2*Math.PI*this.m_frequencyHz,q=2*this.m_mass*this.m_dampingRatio*p,r=this.m_mass*p*p;this.m_gamma=b.dt*(q+b.dt*r),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=o*b.dt*r*this.m_gamma,this.m_mass=n+this.m_gamma,this.m_mass=0!=this.m_mass?1/this.m_mass:0}if(b.warmStarting){this.m_impulse*=b.dtRatio;var s=this.m_impulse*this.m_u.x,t=this.m_impulse*this.m_u.y;e.m_linearVelocity.x-=e.m_invMass*s,e.m_linearVelocity.y-=e.m_invMass*t,e.m_angularVelocity-=e.m_invI*(g*t-h*s),f.m_linearVelocity.x+=f.m_invMass*s,f.m_linearVelocity.y+=f.m_invMass*t,f.m_angularVelocity+=f.m_invI*(i*t-j*s)}else this.m_impulse=0},g.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,d=this.m_bodyB;b=c.m_xf.R;var e=this.m_localAnchor1.x-c.m_sweep.localCenter.x,f=this.m_localAnchor1.y-c.m_sweep.localCenter.y,g=b.col1.x*e+b.col2.x*f;f=b.col1.y*e+b.col2.y*f,e=g,b=d.m_xf.R;var h=this.m_localAnchor2.x-d.m_sweep.localCenter.x,i=this.m_localAnchor2.y-d.m_sweep.localCenter.y;g=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=g;var j=c.m_linearVelocity.x+-c.m_angularVelocity*f,k=c.m_linearVelocity.y+c.m_angularVelocity*e,l=d.m_linearVelocity.x+-d.m_angularVelocity*i,m=d.m_linearVelocity.y+d.m_angularVelocity*h,n=this.m_u.x*(l-j)+this.m_u.y*(m-k),o=-this.m_mass*(n+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=o;var p=o*this.m_u.x,q=o*this.m_u.y;c.m_linearVelocity.x-=c.m_invMass*p,c.m_linearVelocity.y-=c.m_invMass*q,c.m_angularVelocity-=c.m_invI*(e*q-f*p),d.m_linearVelocity.x+=d.m_invMass*p,d.m_linearVelocity.y+=d.m_invMass*q,d.m_angularVelocity+=d.m_invI*(h*q-i*p)},g.prototype.SolvePositionConstraints=function(b){void 0===b&&(b=0);var c;if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA,f=this.m_bodyB;c=e.m_xf.R;var g=this.m_localAnchor1.x-e.m_sweep.localCenter.x,h=this.m_localAnchor1.y-e.m_sweep.localCenter.y,i=c.col1.x*g+c.col2.x*h;h=c.col1.y*g+c.col2.y*h,g=i,c=f.m_xf.R;var j=this.m_localAnchor2.x-f.m_sweep.localCenter.x,k=this.m_localAnchor2.y-f.m_sweep.localCenter.y;i=c.col1.x*j+c.col2.x*k,k=c.col1.y*j+c.col2.y*k,j=i;var l=f.m_sweep.c.x+j-e.m_sweep.c.x-g,m=f.m_sweep.c.y+k-e.m_sweep.c.y-h,n=Math.sqrt(l*l+m*m);l/=n,m/=n;var o=n-this.m_length;o=d.Clamp(o,-a.b2_maxLinearCorrection,a.b2_maxLinearCorrection);var p=-this.m_mass*o;this.m_u.Set(l,m);var q=p*this.m_u.x,r=p*this.m_u.y;return e.m_sweep.c.x-=e.m_invMass*q,e.m_sweep.c.y-=e.m_invMass*r,e.m_sweep.a-=e.m_invI*(g*r-h*q),f.m_sweep.c.x+=f.m_invMass*q,f.m_sweep.c.y+=f.m_invMass*r,f.m_sweep.a+=f.m_invI*(j*r-k*q),e.SynchronizeTransform(),f.SynchronizeTransform(),d.Abs(o)<a.b2_linearSlop},Box2D.inherit(h,Box2D.Dynamics.Joints.b2JointDef),h.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,h.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new e,this.localAnchorB=new e},h.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},h.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));var e=d.x-c.x,f=d.y-c.y;this.length=Math.sqrt(e*e+f*f),this.frequencyHz=0,this.dampingRatio=0},Box2D.inherit(i,Box2D.Dynamics.Joints.b2Joint),i.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,i.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new e,this.m_localAnchorB=new e,this.m_linearMass=new b,this.m_linearImpulse=new e},i.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},i.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},i.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)},i.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_angularImpulse},i.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},i.prototype.GetMaxForce=function(){return this.m_maxForce},i.prototype.SetMaxTorque=function(a){void 0===a&&(a=0),this.m_maxTorque=a},i.prototype.GetMaxTorque=function(){return this.m_maxTorque},i.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=a.maxForce,this.m_maxTorque=a.maxTorque},i.prototype.InitVelocityConstraints=function(a){var c,d=0,e=this.m_bodyA,f=this.m_bodyB;c=e.m_xf.R;var g=this.m_localAnchorA.x-e.m_sweep.localCenter.x,h=this.m_localAnchorA.y-e.m_sweep.localCenter.y;d=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=d,c=f.m_xf.R;var i=this.m_localAnchorB.x-f.m_sweep.localCenter.x,j=this.m_localAnchorB.y-f.m_sweep.localCenter.y;d=c.col1.x*i+c.col2.x*j,j=c.col1.y*i+c.col2.y*j,i=d;var k=e.m_invMass,l=f.m_invMass,m=e.m_invI,n=f.m_invI,o=new b;if(o.col1.x=k+l,o.col2.x=0,o.col1.y=0,o.col2.y=k+l,o.col1.x+=m*h*h,o.col2.x+=-m*g*h,o.col1.y+=-m*g*h,o.col2.y+=m*g*g,o.col1.x+=n*j*j,o.col2.x+=-n*i*j,o.col1.y+=-n*i*j,o.col2.y+=n*i*i,o.GetInverse(this.m_linearMass),this.m_angularMass=m+n,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),a.warmStarting){this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio;var p=this.m_linearImpulse;e.m_linearVelocity.x-=k*p.x,e.m_linearVelocity.y-=k*p.y,e.m_angularVelocity-=m*(g*p.y-h*p.x+this.m_angularImpulse),f.m_linearVelocity.x+=l*p.x,f.m_linearVelocity.y+=l*p.y,f.m_angularVelocity+=n*(i*p.y-j*p.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},i.prototype.SolveVelocityConstraints=function(a){var b,c=0,f=this.m_bodyA,g=this.m_bodyB,h=f.m_linearVelocity,i=f.m_angularVelocity,j=g.m_linearVelocity,k=g.m_angularVelocity,l=f.m_invMass,m=g.m_invMass,n=f.m_invI,o=g.m_invI;b=f.m_xf.R;var p=this.m_localAnchorA.x-f.m_sweep.localCenter.x,q=this.m_localAnchorA.y-f.m_sweep.localCenter.y;c=b.col1.x*p+b.col2.x*q,q=b.col1.y*p+b.col2.y*q,p=c,b=g.m_xf.R;var r=this.m_localAnchorB.x-g.m_sweep.localCenter.x,s=this.m_localAnchorB.y-g.m_sweep.localCenter.y;c=b.col1.x*r+b.col2.x*s,s=b.col1.y*r+b.col2.y*s,r=c;var t=0,u=k-i,v=-this.m_angularMass*u,w=this.m_angularImpulse;t=a.dt*this.m_maxTorque,this.m_angularImpulse=d.Clamp(this.m_angularImpulse+v,-t,t),v=this.m_angularImpulse-w,i-=n*v,k+=o*v;var x=j.x-k*s-h.x+i*q,y=j.y+k*r-h.y-i*p,z=d.MulMV(this.m_linearMass,new e(-x,-y)),A=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(z),t=a.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),z=d.SubtractVV(this.m_linearImpulse,A),h.x-=l*z.x,h.y-=l*z.y,i-=n*(p*z.y-q*z.x),j.x+=m*z.x,j.y+=m*z.y,k+=o*(r*z.y-s*z.x),f.m_angularVelocity=i,g.m_angularVelocity=k},i.prototype.SolvePositionConstraints=function(a){return void 0===a&&(a=0),!0},Box2D.inherit(j,Box2D.Dynamics.Joints.b2JointDef),j.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,j.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new e,this.localAnchorB=new e},j.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_frictionJoint,this.maxForce=0,this.maxTorque=0},j.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))},Box2D.inherit(k,Box2D.Dynamics.Joints.b2Joint),k.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,k.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new e,this.m_groundAnchor2=new e,this.m_localAnchor1=new e,this.m_localAnchor2=new e,this.m_J=new m},k.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},k.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},k.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)},k.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d;d=b.col1.y*c+b.col2.y*d,c=e;var f=this.m_impulse*this.m_J.linearB.x,g=this.m_impulse*this.m_J.linearB.y;return a*(this.m_impulse*this.m_J.angularB-c*g+d*f)},k.prototype.GetRatio=function(){return this.m_ratio},k.prototype.SetRatio=function(a){void 0===a&&(a=0),this.m_ratio=a},k.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,a);var b=parseInt(a.joint1.m_type),c=parseInt(a.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var d=0,e=0;this.m_ground1=a.joint1.GetBodyA(),this.m_bodyA=a.joint1.GetBodyB(),b==n.e_revoluteJoint?(this.m_revolute1=a.joint1 instanceof y?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),d=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof u?a.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),d=this.m_prismatic1.GetJointTranslation()),this.m_ground2=a.joint2.GetBodyA(),this.m_bodyB=a.joint2.GetBodyB(),c==n.e_revoluteJoint?(this.m_revolute2=a.joint2 instanceof y?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof u?a.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation()),this.m_ratio=a.ratio,this.m_constant=d+this.m_ratio*e,this.m_impulse=0},k.prototype.InitVelocityConstraints=function(a){var b,c,d=this.m_ground1,e=this.m_ground2,f=this.m_bodyA,g=this.m_bodyB,h=0,i=0,j=0,k=0,l=0,m=0,n=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,n+=f.m_invI):(b=d.m_xf.R,c=this.m_prismatic1.m_localXAxis1,h=b.col1.x*c.x+b.col2.x*c.y,i=b.col1.y*c.x+b.col2.y*c.y,b=f.m_xf.R,j=this.m_localAnchor1.x-f.m_sweep.localCenter.x,k=this.m_localAnchor1.y-f.m_sweep.localCenter.y,m=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=m,l=j*i-k*h,this.m_J.linearA.Set(-h,-i),this.m_J.angularA=-l,n+=f.m_invMass+f.m_invI*l*l),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,n+=this.m_ratio*this.m_ratio*g.m_invI):(b=e.m_xf.R,c=this.m_prismatic2.m_localXAxis1,h=b.col1.x*c.x+b.col2.x*c.y,i=b.col1.y*c.x+b.col2.y*c.y,b=g.m_xf.R,j=this.m_localAnchor2.x-g.m_sweep.localCenter.x,k=this.m_localAnchor2.y-g.m_sweep.localCenter.y,m=b.col1.x*j+b.col2.x*k,k=b.col1.y*j+b.col2.y*k,j=m,l=j*i-k*h,this.m_J.linearB.Set(-this.m_ratio*h,-this.m_ratio*i),this.m_J.angularB=-this.m_ratio*l,n+=this.m_ratio*this.m_ratio*(g.m_invMass+g.m_invI*l*l)),this.m_mass=n>0?1/n:0,a.warmStarting?(f.m_linearVelocity.x+=f.m_invMass*this.m_impulse*this.m_J.linearA.x,f.m_linearVelocity.y+=f.m_invMass*this.m_impulse*this.m_J.linearA.y,f.m_angularVelocity+=f.m_invI*this.m_impulse*this.m_J.angularA,g.m_linearVelocity.x+=g.m_invMass*this.m_impulse*this.m_J.linearB.x,g.m_linearVelocity.y+=g.m_invMass*this.m_impulse*this.m_J.linearB.y,g.m_angularVelocity+=g.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},k.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=this.m_J.Compute(b.m_linearVelocity,b.m_angularVelocity,c.m_linearVelocity,c.m_angularVelocity),e=-this.m_mass*d;this.m_impulse+=e,b.m_linearVelocity.x+=b.m_invMass*e*this.m_J.linearA.x,b.m_linearVelocity.y+=b.m_invMass*e*this.m_J.linearA.y,b.m_angularVelocity+=b.m_invI*e*this.m_J.angularA,c.m_linearVelocity.x+=c.m_invMass*e*this.m_J.linearB.x,c.m_linearVelocity.y+=c.m_invMass*e*this.m_J.linearB.y,c.m_angularVelocity+=c.m_invI*e*this.m_J.angularB},k.prototype.SolvePositionConstraints=function(b){void 0===b&&(b=0);var c=0,d=this.m_bodyA,e=this.m_bodyB,f=0,g=0;f=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),g=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var h=this.m_constant-(f+this.m_ratio*g),i=-this.m_mass*h;return d.m_sweep.c.x+=d.m_invMass*i*this.m_J.linearA.x,d.m_sweep.c.y+=d.m_invMass*i*this.m_J.linearA.y,d.m_sweep.a+=d.m_invI*i*this.m_J.angularA,e.m_sweep.c.x+=e.m_invMass*i*this.m_J.linearB.x,e.m_sweep.c.y+=e.m_invMass*i*this.m_J.linearB.y,e.m_sweep.a+=e.m_invI*i*this.m_J.angularB,d.SynchronizeTransform(),e.SynchronizeTransform(),c<a.b2_linearSlop},Box2D.inherit(l,Box2D.Dynamics.Joints.b2JointDef),l.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,l.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},l.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},m.b2Jacobian=function(){this.linearA=new e,this.linearB=new e},m.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},m.prototype.Set=function(a,b,c,d){void 0===b&&(b=0),void 0===d&&(d=0),this.linearA.SetV(a),this.angularA=b,this.linearB.SetV(c),this.angularB=d},m.prototype.Compute=function(a,b,c,d){return void 0===b&&(b=0),void 0===d&&(d=0),this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d},n.b2Joint=function(){this.m_edgeA=new p,this.m_edgeB=new p,this.m_localCenterA=new e,this.m_localCenterB=new e},n.prototype.GetType=function(){return this.m_type},n.prototype.GetAnchorA=function(){return null},n.prototype.GetAnchorB=function(){return null},n.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),null},n.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},n.prototype.GetBodyA=function(){return this.m_bodyA},n.prototype.GetBodyB=function(){return this.m_bodyB},n.prototype.GetNext=function(){return this.m_next},n.prototype.GetUserData=function(){return this.m_userData},n.prototype.SetUserData=function(a){this.m_userData=a},n.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},n.Create=function(a,b){var c=null;switch(a.type){case n.e_distanceJoint:c=new g(a instanceof h?a:null);break;case n.e_mouseJoint:c=new s(a instanceof t?a:null);break;case n.e_prismaticJoint:c=new u(a instanceof v?a:null);break;case n.e_revoluteJoint:c=new y(a instanceof z?a:null);break;case n.e_pulleyJoint:c=new w(a instanceof x?a:null);break;case n.e_gearJoint:c=new k(a instanceof l?a:null);break;case n.e_lineJoint:c=new q(a instanceof r?a:null);break;case n.e_weldJoint:c=new A(a instanceof B?a:null);break;case n.e_frictionJoint:c=new i(a instanceof j?a:null)}return c},n.Destroy=function(a,b){},n.prototype.b2Joint=function(b){a.b2Assert(b.bodyA!=b.bodyB),this.m_type=b.type,this.m_prev=null,this.m_next=null,this.m_bodyA=b.bodyA,this.m_bodyB=b.bodyB,this.m_collideConnected=b.collideConnected,this.m_islandFlag=!1,this.m_userData=b.userData},n.prototype.InitVelocityConstraints=function(a){},n.prototype.SolveVelocityConstraints=function(a){},n.prototype.FinalizeVelocityConstraints=function(){},n.prototype.SolvePositionConstraints=function(a){return void 0===a&&(a=0),!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),o.b2JointDef=function(){},o.prototype.b2JointDef=function(){this.type=n.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},p.b2JointEdge=function(){},Box2D.inherit(q,Box2D.Dynamics.Joints.b2Joint),q.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,q.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new e,this.m_localAnchor2=new e,this.m_localXAxis1=new e,this.m_localYAxis1=new e,this.m_axis=new e,this.m_perp=new e,this.m_K=new b,this.m_impulse=new e},q.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},q.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},q.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},q.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},q.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1);return g.x*e+g.y*f},q.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity;return m*(-r*o.y)+n*(r*o.x)+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d))},q.prototype.IsLimitEnabled=function(){return this.m_enableLimit},q.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},q.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},q.prototype.GetUpperLimit=function(){return this.m_upperTranslation},q.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},q.prototype.IsMotorEnabled=function(){return this.m_enableMotor},q.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},q.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},q.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},q.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},q.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},q.prototype.GetMotorForce=function(){return this.m_motorImpulse},q.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=n.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},q.prototype.InitVelocityConstraints=function(b){var c,e=this.m_bodyA,f=this.m_bodyB,g=0
;this.m_localCenterA.SetV(e.GetLocalCenter()),this.m_localCenterB.SetV(f.GetLocalCenter());var h=e.GetTransform();f.GetTransform();c=e.m_xf.R;var i=this.m_localAnchor1.x-this.m_localCenterA.x,j=this.m_localAnchor1.y-this.m_localCenterA.y;g=c.col1.x*i+c.col2.x*j,j=c.col1.y*i+c.col2.y*j,i=g,c=f.m_xf.R;var k=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y;g=c.col1.x*k+c.col2.x*l,l=c.col1.y*k+c.col2.y*l,k=g;var m=f.m_sweep.c.x+k-e.m_sweep.c.x-i,o=f.m_sweep.c.y+l-e.m_sweep.c.y-j;this.m_invMassA=e.m_invMass,this.m_invMassB=f.m_invMass,this.m_invIA=e.m_invI,this.m_invIB=f.m_invI,this.m_axis.SetV(d.MulMV(h.R,this.m_localXAxis1)),this.m_a1=(m+i)*this.m_axis.y-(o+j)*this.m_axis.x,this.m_a2=k*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(d.MulMV(h.R,this.m_localYAxis1)),this.m_s1=(m+i)*this.m_perp.y-(o+j)*this.m_perp.x,this.m_s2=k*this.m_perp.y-l*this.m_perp.x;var p=this.m_invMassA,q=this.m_invMassB,r=this.m_invIA,s=this.m_invIB;if(this.m_K.col1.x=p+q+r*this.m_s1*this.m_s1+s*this.m_s2*this.m_s2,this.m_K.col1.y=r*this.m_s1*this.m_a1+s*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=p+q+r*this.m_a1*this.m_a1+s*this.m_a2*this.m_a2,this.m_enableLimit){var t=this.m_axis.x*m+this.m_axis.y*o;d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?this.m_limitState=n.e_equalLimits:t<=this.m_lowerTranslation?this.m_limitState!=n.e_atLowerLimit&&(this.m_limitState=n.e_atLowerLimit,this.m_impulse.y=0):t>=this.m_upperTranslation?this.m_limitState!=n.e_atUpperLimit&&(this.m_limitState=n.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=n.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=n.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),b.warmStarting){this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio;var u=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,v=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,w=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,x=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*u,e.m_linearVelocity.y-=this.m_invMassA*v,e.m_angularVelocity-=this.m_invIA*w,f.m_linearVelocity.x+=this.m_invMassB*u,f.m_linearVelocity.y+=this.m_invMassB*v,f.m_angularVelocity+=this.m_invIB*x}else this.m_impulse.SetZero(),this.m_motorImpulse=0},q.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,f=b.m_linearVelocity,g=b.m_angularVelocity,h=c.m_linearVelocity,i=c.m_angularVelocity,j=0,k=0,l=0,m=0;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var o=this.m_axis.x*(h.x-f.x)+this.m_axis.y*(h.y-f.y)+this.m_a2*i-this.m_a1*g,p=this.m_motorMass*(this.m_motorSpeed-o),q=this.m_motorImpulse,r=a.dt*this.m_maxMotorForce;this.m_motorImpulse=d.Clamp(this.m_motorImpulse+p,-r,r),p=this.m_motorImpulse-q,j=p*this.m_axis.x,k=p*this.m_axis.y,l=p*this.m_a1,m=p*this.m_a2,f.x-=this.m_invMassA*j,f.y-=this.m_invMassA*k,g-=this.m_invIA*l,h.x+=this.m_invMassB*j,h.y+=this.m_invMassB*k,i+=this.m_invIB*m}var s=this.m_perp.x*(h.x-f.x)+this.m_perp.y*(h.y-f.y)+this.m_s2*i-this.m_s1*g;if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var t=this.m_axis.x*(h.x-f.x)+this.m_axis.y*(h.y-f.y)+this.m_a2*i-this.m_a1*g,u=this.m_impulse.Copy(),v=this.m_K.Solve(new e,-s,-t);this.m_impulse.Add(v),this.m_limitState==n.e_atLowerLimit?this.m_impulse.y=d.Max(this.m_impulse.y,0):this.m_limitState==n.e_atUpperLimit&&(this.m_impulse.y=d.Min(this.m_impulse.y,0));var w=-s-(this.m_impulse.y-u.y)*this.m_K.col2.x,x=0;x=0!=this.m_K.col1.x?w/this.m_K.col1.x+u.x:u.x,this.m_impulse.x=x,v.x=this.m_impulse.x-u.x,v.y=this.m_impulse.y-u.y,j=v.x*this.m_perp.x+v.y*this.m_axis.x,k=v.x*this.m_perp.y+v.y*this.m_axis.y,l=v.x*this.m_s1+v.y*this.m_a1,m=v.x*this.m_s2+v.y*this.m_a2,f.x-=this.m_invMassA*j,f.y-=this.m_invMassA*k,g-=this.m_invIA*l,h.x+=this.m_invMassB*j,h.y+=this.m_invMassB*k,i+=this.m_invIB*m}else{var y=0;y=0!=this.m_K.col1.x?-s/this.m_K.col1.x:0,this.m_impulse.x+=y,j=y*this.m_perp.x,k=y*this.m_perp.y,l=y*this.m_s1,m=y*this.m_s2,f.x-=this.m_invMassA*j,f.y-=this.m_invMassA*k,g-=this.m_invIA*l,h.x+=this.m_invMassB*j,h.y+=this.m_invMassB*k,i+=this.m_invIB*m}b.m_linearVelocity.SetV(f),b.m_angularVelocity=g,c.m_linearVelocity.SetV(h),c.m_angularVelocity=i},q.prototype.SolvePositionConstraints=function(c){void 0===c&&(c=0);var f,g=this.m_bodyA,h=this.m_bodyB,i=g.m_sweep.c,j=g.m_sweep.a,k=h.m_sweep.c,l=h.m_sweep.a,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=!1,u=0,v=b.FromAngle(j),w=b.FromAngle(l);f=v;var x=this.m_localAnchor1.x-this.m_localCenterA.x,y=this.m_localAnchor1.y-this.m_localCenterA.y;m=f.col1.x*x+f.col2.x*y,y=f.col1.y*x+f.col2.y*y,x=m,f=w;var z=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;m=f.col1.x*z+f.col2.x*A,A=f.col1.y*z+f.col2.y*A,z=m;var B=k.x+z-i.x-x,C=k.y+A-i.y-y;if(this.m_enableLimit){this.m_axis=d.MulMV(v,this.m_localXAxis1),this.m_a1=(B+x)*this.m_axis.y-(C+y)*this.m_axis.x,this.m_a2=z*this.m_axis.y-A*this.m_axis.x;var D=this.m_axis.x*B+this.m_axis.y*C;d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?(u=d.Clamp(D,-a.b2_maxLinearCorrection,a.b2_maxLinearCorrection),r=d.Abs(D),t=!0):D<=this.m_lowerTranslation?(u=d.Clamp(D-this.m_lowerTranslation+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),r=this.m_lowerTranslation-D,t=!0):D>=this.m_upperTranslation&&(u=d.Clamp(D-this.m_upperTranslation+a.b2_linearSlop,0,a.b2_maxLinearCorrection),r=D-this.m_upperTranslation,t=!0)}this.m_perp=d.MulMV(v,this.m_localYAxis1),this.m_s1=(B+x)*this.m_perp.y-(C+y)*this.m_perp.x,this.m_s2=z*this.m_perp.y-A*this.m_perp.x;var E=new e,F=this.m_perp.x*B+this.m_perp.y*C;if(r=d.Max(r,d.Abs(F)),s=0,t)n=this.m_invMassA,o=this.m_invMassB,p=this.m_invIA,q=this.m_invIB,this.m_K.col1.x=n+o+p*this.m_s1*this.m_s1+q*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1*this.m_a1+q*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=n+o+p*this.m_a1*this.m_a1+q*this.m_a2*this.m_a2,this.m_K.Solve(E,-F,-u);else{n=this.m_invMassA,o=this.m_invMassB,p=this.m_invIA,q=this.m_invIB;var G=n+o+p*this.m_s1*this.m_s1+q*this.m_s2*this.m_s2,H=0;H=0!=G?-F/G:0,E.x=H,E.y=0}var I=E.x*this.m_perp.x+E.y*this.m_axis.x,J=E.x*this.m_perp.y+E.y*this.m_axis.y,K=E.x*this.m_s1+E.y*this.m_a1,L=E.x*this.m_s2+E.y*this.m_a2;return i.x-=this.m_invMassA*I,i.y-=this.m_invMassA*J,j-=this.m_invIA*K,k.x+=this.m_invMassB*I,k.y+=this.m_invMassB*J,l+=this.m_invIB*L,g.m_sweep.a=j,h.m_sweep.a=l,g.SynchronizeTransform(),h.SynchronizeTransform(),r<=a.b2_linearSlop&&s<=a.b2_angularSlop},Box2D.inherit(r,Box2D.Dynamics.Joints.b2JointDef),r.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,r.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new e,this.localAnchorB=new e,this.localAxisA=new e},r.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},r.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d)},Box2D.inherit(s,Box2D.Dynamics.Joints.b2Joint),s.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,s.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new b,this.K1=new b,this.K2=new b,this.m_localAnchor=new e,this.m_target=new e,this.m_impulse=new e,this.m_mass=new b,this.m_C=new e},s.prototype.GetAnchorA=function(){return this.m_target},s.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},s.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*this.m_impulse.x,a*this.m_impulse.y)},s.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},s.prototype.GetTarget=function(){return this.m_target},s.prototype.SetTarget=function(a){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_target=a},s.prototype.GetMaxForce=function(){return this.m_maxForce},s.prototype.SetMaxForce=function(a){void 0===a&&(a=0),this.m_maxForce=a},s.prototype.GetFrequency=function(){return this.m_frequencyHz},s.prototype.SetFrequency=function(a){void 0===a&&(a=0),this.m_frequencyHz=a},s.prototype.GetDampingRatio=function(){return this.m_dampingRatio},s.prototype.SetDampingRatio=function(a){void 0===a&&(a=0),this.m_dampingRatio=a},s.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a),this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y,this.m_localAnchor.y=b*d.col2.x+c*d.col2.y,this.m_maxForce=a.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=a.frequencyHz,this.m_dampingRatio=a.dampingRatio,this.m_beta=0,this.m_gamma=0},s.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=2*c*this.m_dampingRatio*d,f=c*d*d;this.m_gamma=a.dt*(e+a.dt*f),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_beta=a.dt*f*this.m_gamma;var g;g=b.m_xf.R;var h=this.m_localAnchor.x-b.m_sweep.localCenter.x,i=this.m_localAnchor.y-b.m_sweep.localCenter.y,j=g.col1.x*h+g.col2.x*i;i=g.col1.y*h+g.col2.y*i,h=j;var k=b.m_invMass,l=b.m_invI;this.K1.col1.x=k,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=k,this.K2.col1.x=l*i*i,this.K2.col2.x=-l*h*i,this.K2.col1.y=-l*h*i,this.K2.col2.y=l*h*h,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=b.m_sweep.c.x+h-this.m_target.x,this.m_C.y=b.m_sweep.c.y+i-this.m_target.y,b.m_angularVelocity*=.98,this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,b.m_linearVelocity.x+=k*this.m_impulse.x,b.m_linearVelocity.y+=k*this.m_impulse.y,b.m_angularVelocity+=l*(h*this.m_impulse.y-i*this.m_impulse.x)},s.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyB,d=0,e=0;b=c.m_xf.R;var f=this.m_localAnchor.x-c.m_sweep.localCenter.x,g=this.m_localAnchor.y-c.m_sweep.localCenter.y;d=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=d;var h=c.m_linearVelocity.x+-c.m_angularVelocity*g,i=c.m_linearVelocity.y+c.m_angularVelocity*f;b=this.m_mass,d=h+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,e=i+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var j=-(b.col1.x*d+b.col2.x*e),k=-(b.col1.y*d+b.col2.y*e),l=this.m_impulse.x,m=this.m_impulse.y;this.m_impulse.x+=j,this.m_impulse.y+=k;var n=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>n*n&&this.m_impulse.Multiply(n/this.m_impulse.Length()),j=this.m_impulse.x-l,k=this.m_impulse.y-m,c.m_linearVelocity.x+=c.m_invMass*j,c.m_linearVelocity.y+=c.m_invMass*k,c.m_angularVelocity+=c.m_invI*(f*k-g*j)},s.prototype.SolvePositionConstraints=function(a){return void 0===a&&(a=0),!0},Box2D.inherit(t,Box2D.Dynamics.Joints.b2JointDef),t.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,t.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new e},t.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(u,Box2D.Dynamics.Joints.b2Joint),u.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,u.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new e,this.m_localAnchor2=new e,this.m_localXAxis1=new e,this.m_localYAxis1=new e,this.m_axis=new e,this.m_perp=new e,this.m_K=new c,this.m_impulse=new f},u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},u.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},u.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.y},u.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),e=d.x-c.x,f=d.y-c.y,g=a.GetWorldVector(this.m_localXAxis1);return g.x*e+g.y*f},u.prototype.GetJointSpeed=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*d+a.col2.x*e;e=a.col1.y*d+a.col2.y*e,d=f,a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y;f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f;var i=b.m_sweep.c.x+d,j=b.m_sweep.c.y+e,k=c.m_sweep.c.x+g,l=c.m_sweep.c.y+h,m=k-i,n=l-j,o=b.GetWorldVector(this.m_localXAxis1),p=b.m_linearVelocity,q=c.m_linearVelocity,r=b.m_angularVelocity,s=c.m_angularVelocity;return m*(-r*o.y)+n*(r*o.x)+(o.x*(q.x+-s*h-p.x- -r*e)+o.y*(q.y+s*g-p.y-r*d))},u.prototype.IsLimitEnabled=function(){return this.m_enableLimit},u.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=a},u.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},u.prototype.GetUpperLimit=function(){return this.m_upperTranslation},u.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=a,this.m_upperTranslation=b},u.prototype.IsMotorEnabled=function(){return this.m_enableMotor},u.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=a},u.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},u.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},u.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=a},u.prototype.GetMotorForce=function(){return this.m_motorImpulse},u.prototype.b2PrismaticJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_localXAxis1.SetV(a.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=a.lowerTranslation,this.m_upperTranslation=a.upperTranslation,this.m_maxMotorForce=a.maxMotorForce,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=n.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},u.prototype.InitVelocityConstraints=function(b){var c,e=this.m_bodyA,f=this.m_bodyB,g=0;this.m_localCenterA.SetV(e.GetLocalCenter()),this.m_localCenterB.SetV(f.GetLocalCenter());var h=e.GetTransform();f.GetTransform();c=e.m_xf.R;var i=this.m_localAnchor1.x-this.m_localCenterA.x,j=this.m_localAnchor1.y-this.m_localCenterA.y;g=c.col1.x*i+c.col2.x*j,j=c.col1.y*i+c.col2.y*j,i=g,c=f.m_xf.R;var k=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y;g=c.col1.x*k+c.col2.x*l,l=c.col1.y*k+c.col2.y*l,k=g;var m=f.m_sweep.c.x+k-e.m_sweep.c.x-i,o=f.m_sweep.c.y+l-e.m_sweep.c.y-j;this.m_invMassA=e.m_invMass,this.m_invMassB=f.m_invMass,this.m_invIA=e.m_invI,this.m_invIB=f.m_invI,this.m_axis.SetV(d.MulMV(h.R,this.m_localXAxis1)),this.m_a1=(m+i)*this.m_axis.y-(o+j)*this.m_axis.x,this.m_a2=k*this.m_axis.y-l*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(d.MulMV(h.R,this.m_localYAxis1)),this.m_s1=(m+i)*this.m_perp.y-(o+j)*this.m_perp.x,this.m_s2=k*this.m_perp.y-l*this.m_perp.x;var p=this.m_invMassA,q=this.m_invMassB,r=this.m_invIA,s=this.m_invIB;if(this.m_K.col1.x=p+q+r*this.m_s1*this.m_s1+s*this.m_s2*this.m_s2,this.m_K.col1.y=r*this.m_s1+s*this.m_s2,this.m_K.col1.z=r*this.m_s1*this.m_a1+s*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=r+s,this.m_K.col2.z=r*this.m_a1+s*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+q+r*this.m_a1*this.m_a1+s*this.m_a2*this.m_a2,this.m_enableLimit){var t=this.m_axis.x*m+this.m_axis.y*o;d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?this.m_limitState=n.e_equalLimits:t<=this.m_lowerTranslation?this.m_limitState!=n.e_atLowerLimit&&(this.m_limitState=n.e_atLowerLimit,this.m_impulse.z=0):t>=this.m_upperTranslation?this.m_limitState!=n.e_atUpperLimit&&(this.m_limitState=n.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=n.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=n.e_inactiveLimit;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),b.warmStarting){this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio;var u=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,v=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,w=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,x=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;e.m_linearVelocity.x-=this.m_invMassA*u,e.m_linearVelocity.y-=this.m_invMassA*v,e.m_angularVelocity-=this.m_invIA*w,f.m_linearVelocity.x+=this.m_invMassB*u,f.m_linearVelocity.y+=this.m_invMassB*v,f.m_angularVelocity+=this.m_invIB*x}else this.m_impulse.SetZero(),this.m_motorImpulse=0},u.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,g=b.m_linearVelocity,h=b.m_angularVelocity,i=c.m_linearVelocity,j=c.m_angularVelocity,k=0,l=0,m=0,o=0;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var p=this.m_axis.x*(i.x-g.x)+this.m_axis.y*(i.y-g.y)+this.m_a2*j-this.m_a1*h,q=this.m_motorMass*(this.m_motorSpeed-p),r=this.m_motorImpulse,s=a.dt*this.m_maxMotorForce;this.m_motorImpulse=d.Clamp(this.m_motorImpulse+q,-s,s),q=this.m_motorImpulse-r,k=q*this.m_axis.x,l=q*this.m_axis.y,m=q*this.m_a1,o=q*this.m_a2,g.x-=this.m_invMassA*k,g.y-=this.m_invMassA*l,h-=this.m_invIA*m,i.x+=this.m_invMassB*k,i.y+=this.m_invMassB*l,j+=this.m_invIB*o}var t=this.m_perp.x*(i.x-g.x)+this.m_perp.y*(i.y-g.y)+this.m_s2*j-this.m_s1*h,u=j-h;if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var v=this.m_axis.x*(i.x-g.x)+this.m_axis.y*(i.y-g.y)+this.m_a2*j-this.m_a1*h,w=this.m_impulse.Copy(),x=this.m_K.Solve33(new f,-t,-u,-v);this.m_impulse.Add(x),this.m_limitState==n.e_atLowerLimit?this.m_impulse.z=d.Max(this.m_impulse.z,0):this.m_limitState==n.e_atUpperLimit&&(this.m_impulse.z=d.Min(this.m_impulse.z,0));var y=-t-(this.m_impulse.z-w.z)*this.m_K.col3.x,z=-u-(this.m_impulse.z-w.z)*this.m_K.col3.y,A=this.m_K.Solve22(new e,y,z);A.x+=w.x,A.y+=w.y,this.m_impulse.x=A.x,this.m_impulse.y=A.y,x.x=this.m_impulse.x-w.x,x.y=this.m_impulse.y-w.y,x.z=this.m_impulse.z-w.z,k=x.x*this.m_perp.x+x.z*this.m_axis.x,l=x.x*this.m_perp.y+x.z*this.m_axis.y,m=x.x*this.m_s1+x.y+x.z*this.m_a1,o=x.x*this.m_s2+x.y+x.z*this.m_a2,g.x-=this.m_invMassA*k,g.y-=this.m_invMassA*l,h-=this.m_invIA*m,i.x+=this.m_invMassB*k,i.y+=this.m_invMassB*l,j+=this.m_invIB*o}else{var B=this.m_K.Solve22(new e,-t,-u);this.m_impulse.x+=B.x,this.m_impulse.y+=B.y,k=B.x*this.m_perp.x,l=B.x*this.m_perp.y,m=B.x*this.m_s1+B.y,o=B.x*this.m_s2+B.y,g.x-=this.m_invMassA*k,g.y-=this.m_invMassA*l,h-=this.m_invIA*m,i.x+=this.m_invMassB*k,i.y+=this.m_invMassB*l,j+=this.m_invIB*o}b.m_linearVelocity.SetV(g),b.m_angularVelocity=h,c.m_linearVelocity.SetV(i),c.m_angularVelocity=j},u.prototype.SolvePositionConstraints=function(c){void 0===c&&(c=0);var g,h=this.m_bodyA,i=this.m_bodyB,j=h.m_sweep.c,k=h.m_sweep.a,l=i.m_sweep.c,m=i.m_sweep.a,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=!1,v=0,w=b.FromAngle(k),x=b.FromAngle(m);g=w;var y=this.m_localAnchor1.x-this.m_localCenterA.x,z=this.m_localAnchor1.y-this.m_localCenterA.y;n=g.col1.x*y+g.col2.x*z,z=g.col1.y*y+g.col2.y*z,y=n,g=x;var A=this.m_localAnchor2.x-this.m_localCenterB.x,B=this.m_localAnchor2.y-this.m_localCenterB.y;n=g.col1.x*A+g.col2.x*B,B=g.col1.y*A+g.col2.y*B,A=n;var C=l.x+A-j.x-y,D=l.y+B-j.y-z;if(this.m_enableLimit){this.m_axis=d.MulMV(w,this.m_localXAxis1),this.m_a1=(C+y)*this.m_axis.y-(D+z)*this.m_axis.x,this.m_a2=A*this.m_axis.y-B*this.m_axis.x;var E=this.m_axis.x*C+this.m_axis.y*D;d.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*a.b2_linearSlop?(v=d.Clamp(E,-a.b2_maxLinearCorrection,a.b2_maxLinearCorrection),s=d.Abs(E),u=!0):E<=this.m_lowerTranslation?(v=d.Clamp(E-this.m_lowerTranslation+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),s=this.m_lowerTranslation-E,u=!0):E>=this.m_upperTranslation&&(v=d.Clamp(E-this.m_upperTranslation+a.b2_linearSlop,0,a.b2_maxLinearCorrection),s=E-this.m_upperTranslation,u=!0)}this.m_perp=d.MulMV(w,this.m_localYAxis1),this.m_s1=(C+y)*this.m_perp.y-(D+z)*this.m_perp.x,this.m_s2=A*this.m_perp.y-B*this.m_perp.x;var F=new f,G=this.m_perp.x*C+this.m_perp.y*D,H=m-k-this.m_refAngle;if(s=d.Max(s,d.Abs(G)),t=d.Abs(H),u)o=this.m_invMassA,p=this.m_invMassB,q=this.m_invIA,r=this.m_invIB,this.m_K.col1.x=o+p+q*this.m_s1*this.m_s1+r*this.m_s2*this.m_s2,this.m_K.col1.y=q*this.m_s1+r*this.m_s2,this.m_K.col1.z=q*this.m_s1*this.m_a1+r*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=q+r,this.m_K.col2.z=q*this.m_a1+r*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=o+p+q*this.m_a1*this.m_a1+r*this.m_a2*this.m_a2,this.m_K.Solve33(F,-G,-H,-v);else{o=this.m_invMassA,p=this.m_invMassB,q=this.m_invIA,r=this.m_invIB;var I=o+p+q*this.m_s1*this.m_s1+r*this.m_s2*this.m_s2,J=q*this.m_s1+r*this.m_s2,K=q+r;this.m_K.col1.Set(I,J,0),this.m_K.col2.Set(J,K,0);var L=this.m_K.Solve22(new e,-G,-H);F.x=L.x,F.y=L.y,F.z=0}var M=F.x*this.m_perp.x+F.z*this.m_axis.x,N=F.x*this.m_perp.y+F.z*this.m_axis.y,O=F.x*this.m_s1+F.y+F.z*this.m_a1,P=F.x*this.m_s2+F.y+F.z*this.m_a2;return j.x-=this.m_invMassA*M,j.y-=this.m_invMassA*N,k-=this.m_invIA*O,l.x+=this.m_invMassB*M,l.y+=this.m_invMassB*N,m+=this.m_invIB*P,h.m_sweep.a=k,i.m_sweep.a=m,h.SynchronizeTransform(),i.SynchronizeTransform(),s<=a.b2_linearSlop&&t<=a.b2_angularSlop},Box2D.inherit(v,Box2D.Dynamics.Joints.b2JointDef),v.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,v.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new e,this.localAnchorB=new e,this.localAxisA=new e},v.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},v.prototype.Initialize=function(a,b,c,d){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.localAxisA=this.bodyA.GetLocalVector(d),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new e,this.m_groundAnchor2=new e,this.m_localAnchor1=new e,this.m_localAnchor2=new e,this.m_u1=new e,this.m_u2=new e},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)},w.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),0},w.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor1),a},w.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();return a.Add(this.m_groundAnchor2),a},w.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},w.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,d=a.x-b,e=a.y-c;return Math.sqrt(d*d+e*e)},w.prototype.GetRatio=function(){return this.m_ratio},w.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,a);this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_ratio=a.ratio,this.m_constant=a.lengthA+this.m_ratio*a.lengthB,this.m_maxLength1=d.Min(a.maxLengthA,this.m_constant-this.m_ratio*w.b2_minPulleyLength),this.m_maxLength2=d.Min(a.maxLengthB,(this.m_constant-w.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},w.prototype.InitVelocityConstraints=function(b){var c,d=this.m_bodyA,e=this.m_bodyB;c=d.m_xf.R;var f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y,h=c.col1.x*f+c.col2.x*g;g=c.col1.y*f+c.col2.y*g,f=h,c=e.m_xf.R;var i=this.m_localAnchor2.x-e.m_sweep.localCenter.x,j=this.m_localAnchor2.y-e.m_sweep.localCenter.y;h=c.col1.x*i+c.col2.x*j,j=c.col1.y*i+c.col2.y*j,i=h;var k=d.m_sweep.c.x+f,l=d.m_sweep.c.y+g,m=e.m_sweep.c.x+i,o=e.m_sweep.c.y+j,p=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,q=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,s=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(k-p,l-q),this.m_u2.Set(m-r,o-s);var t=this.m_u1.Length(),u=this.m_u2.Length();t>a.b2_linearSlop?this.m_u1.Multiply(1/t):this.m_u1.SetZero(),u>a.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),this.m_constant-t-this.m_ratio*u>0?(this.m_state=n.e_inactiveLimit,this.m_impulse=0):this.m_state=n.e_atUpperLimit,t<this.m_maxLength1?(this.m_limitState1=n.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=n.e_atUpperLimit,u<this.m_maxLength2?(this.m_limitState2=n.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=n.e_atUpperLimit;var v=f*this.m_u1.y-g*this.m_u1.x,w=i*this.m_u2.y-j*this.m_u2.x;if(this.m_limitMass1=d.m_invMass+d.m_invI*v*v,this.m_limitMass2=e.m_invMass+e.m_invI*w*w,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,b.warmStarting){this.m_impulse*=b.dtRatio,this.m_limitImpulse1*=b.dtRatio,this.m_limitImpulse2*=b.dtRatio;var x=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,y=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,z=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,A=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;d.m_linearVelocity.x+=d.m_invMass*x,d.m_linearVelocity.y+=d.m_invMass*y,d.m_angularVelocity+=d.m_invI*(f*y-g*x),e.m_linearVelocity.x+=e.m_invMass*z,e.m_linearVelocity.y+=e.m_invMass*A,e.m_angularVelocity+=e.m_invI*(i*A-j*z)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},w.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,e=this.m_bodyB;b=c.m_xf.R;var f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,g=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=b.col1.x*f+b.col2.x*g;g=b.col1.y*f+b.col2.y*g,f=h,b=e.m_xf.R;var i=this.m_localAnchor2.x-e.m_sweep.localCenter.x,j=this.m_localAnchor2.y-e.m_sweep.localCenter.y;h=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=h;var k=0,l=0,m=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0;this.m_state==n.e_atUpperLimit&&(k=c.m_linearVelocity.x+-c.m_angularVelocity*g,l=c.m_linearVelocity.y+c.m_angularVelocity*f,m=e.m_linearVelocity.x+-e.m_angularVelocity*j,o=e.m_linearVelocity.y+e.m_angularVelocity*i,t=-(this.m_u1.x*k+this.m_u1.y*l)-this.m_ratio*(this.m_u2.x*m+this.m_u2.y*o),u=this.m_pulleyMass*-t,v=this.m_impulse,this.m_impulse=d.Max(0,this.m_impulse+u),u=this.m_impulse-v,p=-u*this.m_u1.x,q=-u*this.m_u1.y,r=-this.m_ratio*u*this.m_u2.x,s=-this.m_ratio*u*this.m_u2.y,c.m_linearVelocity.x+=c.m_invMass*p,c.m_linearVelocity.y+=c.m_invMass*q,c.m_angularVelocity+=c.m_invI*(f*q-g*p),e.m_linearVelocity.x+=e.m_invMass*r,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(i*s-j*r)),this.m_limitState1==n.e_atUpperLimit&&(k=c.m_linearVelocity.x+-c.m_angularVelocity*g,l=c.m_linearVelocity.y+c.m_angularVelocity*f,t=-(this.m_u1.x*k+this.m_u1.y*l),u=-this.m_limitMass1*t,v=this.m_limitImpulse1,this.m_limitImpulse1=d.Max(0,this.m_limitImpulse1+u),u=this.m_limitImpulse1-v,p=-u*this.m_u1.x,q=-u*this.m_u1.y,c.m_linearVelocity.x+=c.m_invMass*p,c.m_linearVelocity.y+=c.m_invMass*q,c.m_angularVelocity+=c.m_invI*(f*q-g*p)),this.m_limitState2==n.e_atUpperLimit&&(m=e.m_linearVelocity.x+-e.m_angularVelocity*j,o=e.m_linearVelocity.y+e.m_angularVelocity*i,t=-(this.m_u2.x*m+this.m_u2.y*o),u=-this.m_limitMass2*t,v=this.m_limitImpulse2,this.m_limitImpulse2=d.Max(0,this.m_limitImpulse2+u),u=this.m_limitImpulse2-v,r=-u*this.m_u2.x,s=-u*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*r,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(i*s-j*r))},w.prototype.SolvePositionConstraints=function(b){void 0===b&&(b=0);var c,e=this.m_bodyA,f=this.m_bodyB,g=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,i=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,j=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,k=0,l=0,m=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0;return this.m_state==n.e_atUpperLimit&&(c=e.m_xf.R,k=this.m_localAnchor1.x-e.m_sweep.localCenter.x,l=this.m_localAnchor1.y-e.m_sweep.localCenter.y,x=c.col1.x*k+c.col2.x*l,l=c.col1.y*k+c.col2.y*l,k=x,c=f.m_xf.R,m=this.m_localAnchor2.x-f.m_sweep.localCenter.x,o=this.m_localAnchor2.y-f.m_sweep.localCenter.y,x=c.col1.x*m+c.col2.x*o,o=c.col1.y*m+c.col2.y*o,m=x,p=e.m_sweep.c.x+k,q=e.m_sweep.c.y+l,r=f.m_sweep.c.x+m,s=f.m_sweep.c.y+o,this.m_u1.Set(p-g,q-h),this.m_u2.Set(r-i,s-j),t=this.m_u1.Length(),u=this.m_u2.Length(),t>a.b2_linearSlop?this.m_u1.Multiply(1/t):this.m_u1.SetZero(),u>a.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),v=this.m_constant-t-this.m_ratio*u,y=d.Max(y,-v),v=d.Clamp(v+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),w=-this.m_pulleyMass*v,p=-w*this.m_u1.x,q=-w*this.m_u1.y,r=-this.m_ratio*w*this.m_u2.x,s=-this.m_ratio*w*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*p,e.m_sweep.c.y+=e.m_invMass*q,e.m_sweep.a+=e.m_invI*(k*q-l*p),f.m_sweep.c.x+=f.m_invMass*r,f.m_sweep.c.y+=f.m_invMass*s,f.m_sweep.a+=f.m_invI*(m*s-o*r),e.SynchronizeTransform(),f.SynchronizeTransform()),this.m_limitState1==n.e_atUpperLimit&&(c=e.m_xf.R,k=this.m_localAnchor1.x-e.m_sweep.localCenter.x,l=this.m_localAnchor1.y-e.m_sweep.localCenter.y,x=c.col1.x*k+c.col2.x*l,l=c.col1.y*k+c.col2.y*l,k=x,p=e.m_sweep.c.x+k,q=e.m_sweep.c.y+l,this.m_u1.Set(p-g,q-h),t=this.m_u1.Length(),
t>a.b2_linearSlop?(this.m_u1.x*=1/t,this.m_u1.y*=1/t):this.m_u1.SetZero(),v=this.m_maxLength1-t,y=d.Max(y,-v),v=d.Clamp(v+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),w=-this.m_limitMass1*v,p=-w*this.m_u1.x,q=-w*this.m_u1.y,e.m_sweep.c.x+=e.m_invMass*p,e.m_sweep.c.y+=e.m_invMass*q,e.m_sweep.a+=e.m_invI*(k*q-l*p),e.SynchronizeTransform()),this.m_limitState2==n.e_atUpperLimit&&(c=f.m_xf.R,m=this.m_localAnchor2.x-f.m_sweep.localCenter.x,o=this.m_localAnchor2.y-f.m_sweep.localCenter.y,x=c.col1.x*m+c.col2.x*o,o=c.col1.y*m+c.col2.y*o,m=x,r=f.m_sweep.c.x+m,s=f.m_sweep.c.y+o,this.m_u2.Set(r-i,s-j),u=this.m_u2.Length(),u>a.b2_linearSlop?(this.m_u2.x*=1/u,this.m_u2.y*=1/u):this.m_u2.SetZero(),v=this.m_maxLength2-u,y=d.Max(y,-v),v=d.Clamp(v+a.b2_linearSlop,-a.b2_maxLinearCorrection,0),w=-this.m_limitMass2*v,r=-w*this.m_u2.x,s=-w*this.m_u2.y,f.m_sweep.c.x+=f.m_invMass*r,f.m_sweep.c.y+=f.m_invMass*s,f.m_sweep.a+=f.m_invI*(m*s-o*r),f.SynchronizeTransform()),y<a.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new e,this.groundAnchorB=new e,this.localAnchorA=new e,this.localAnchorB=new e},x.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},x.prototype.Initialize=function(a,b,c,d,e,f,g){void 0===g&&(g=0),this.bodyA=a,this.bodyB=b,this.groundAnchorA.SetV(c),this.groundAnchorB.SetV(d),this.localAnchorA=this.bodyA.GetLocalPoint(e),this.localAnchorB=this.bodyB.GetLocalPoint(f);var h=e.x-c.x,i=e.y-c.y;this.lengthA=Math.sqrt(h*h+i*i);var j=f.x-d.x,k=f.y-d.y;this.lengthB=Math.sqrt(j*j+k*k),this.ratio=g;var l=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=l-this.ratio*w.b2_minPulleyLength,this.maxLengthB=(l-w.b2_minPulleyLength)/this.ratio},Box2D.inherit(y,Box2D.Dynamics.Joints.b2Joint),y.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,y.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new b,this.K1=new b,this.K2=new b,this.K3=new b,this.impulse3=new f,this.impulse2=new e,this.reduced=new e,this.m_localAnchor1=new e,this.m_localAnchor2=new e,this.m_impulse=new f,this.m_mass=new c},y.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},y.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},y.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*this.m_impulse.x,a*this.m_impulse.y)},y.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.z},y.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},y.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},y.prototype.IsLimitEnabled=function(){return this.m_enableLimit};y.prototype.EnableLimit=function(a){this.m_enableLimit=a},y.prototype.GetLowerLimit=function(){return this.m_lowerAngle},y.prototype.GetUpperLimit=function(){return this.m_upperAngle},y.prototype.SetLimits=function(a,b){void 0===a&&(a=0),void 0===b&&(b=0),this.m_lowerAngle=a,this.m_upperAngle=b},y.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},y.prototype.EnableMotor=function(a){this.m_enableMotor=a},y.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=a},y.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},y.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0),this.m_maxMotorTorque=a},y.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},y.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a),this.m_localAnchor1.SetV(a.localAnchorA),this.m_localAnchor2.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=a.lowerAngle,this.m_upperAngle=a.upperAngle,this.m_maxMotorTorque=a.maxMotorTorque,this.m_motorSpeed=a.motorSpeed,this.m_enableLimit=a.enableLimit,this.m_enableMotor=a.enableMotor,this.m_limitState=n.e_inactiveLimit},y.prototype.InitVelocityConstraints=function(b){var c,e=this.m_bodyA,f=this.m_bodyB,g=0;this.m_enableMotor||this.m_enableLimit,c=e.m_xf.R;var h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y;g=c.col1.x*h+c.col2.x*i,i=c.col1.y*h+c.col2.y*i,h=g,c=f.m_xf.R;var j=this.m_localAnchor2.x-f.m_sweep.localCenter.x,k=this.m_localAnchor2.y-f.m_sweep.localCenter.y;g=c.col1.x*j+c.col2.x*k,k=c.col1.y*j+c.col2.y*k,j=g;var l=e.m_invMass,m=f.m_invMass,o=e.m_invI,p=f.m_invI;if(this.m_mass.col1.x=l+m+i*i*o+k*k*p,this.m_mass.col2.x=-i*h*o-k*j*p,this.m_mass.col3.x=-i*o-k*p,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=l+m+h*h*o+j*j*p,this.m_mass.col3.y=h*o+j*p,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=o+p,this.m_motorMass=1/(o+p),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var q=f.m_sweep.a-e.m_sweep.a-this.m_referenceAngle;d.Abs(this.m_upperAngle-this.m_lowerAngle)<2*a.b2_angularSlop?this.m_limitState=n.e_equalLimits:q<=this.m_lowerAngle?(this.m_limitState!=n.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=n.e_atLowerLimit):q>=this.m_upperAngle?(this.m_limitState!=n.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=n.e_atUpperLimit):(this.m_limitState=n.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=n.e_inactiveLimit;if(b.warmStarting){this.m_impulse.x*=b.dtRatio,this.m_impulse.y*=b.dtRatio,this.m_motorImpulse*=b.dtRatio;var r=this.m_impulse.x,s=this.m_impulse.y;e.m_linearVelocity.x-=l*r,e.m_linearVelocity.y-=l*s,e.m_angularVelocity-=o*(h*s-i*r+this.m_motorImpulse+this.m_impulse.z),f.m_linearVelocity.x+=m*r,f.m_linearVelocity.y+=m*s,f.m_angularVelocity+=p*(j*s-k*r+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},y.prototype.SolveVelocityConstraints=function(a){var b,c=this.m_bodyA,e=this.m_bodyB,f=0,g=0,h=0,i=0,j=0,k=c.m_linearVelocity,l=c.m_angularVelocity,m=e.m_linearVelocity,o=e.m_angularVelocity,p=c.m_invMass,q=e.m_invMass,r=c.m_invI,s=e.m_invI;if(this.m_enableMotor&&this.m_limitState!=n.e_equalLimits){var t=o-l-this.m_motorSpeed,u=this.m_motorMass*-t,v=this.m_motorImpulse,w=a.dt*this.m_maxMotorTorque;this.m_motorImpulse=d.Clamp(this.m_motorImpulse+u,-w,w),u=this.m_motorImpulse-v,l-=r*u,o+=s*u}if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){b=c.m_xf.R,g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=f,b=e.m_xf.R,i=this.m_localAnchor2.x-e.m_sweep.localCenter.x,j=this.m_localAnchor2.y-e.m_sweep.localCenter.y,f=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=f;var x=m.x+-o*j-k.x- -l*h,y=m.y+o*i-k.y-l*g,z=o-l;this.m_mass.Solve33(this.impulse3,-x,-y,-z),this.m_limitState==n.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==n.e_atLowerLimit?this.m_impulse.z+this.impulse3.z<0&&(this.m_mass.Solve22(this.reduced,-x,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0):this.m_limitState==n.e_atUpperLimit&&this.m_impulse.z+this.impulse3.z>0&&(this.m_mass.Solve22(this.reduced,-x,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0),k.x-=p*this.impulse3.x,k.y-=p*this.impulse3.y,l-=r*(g*this.impulse3.y-h*this.impulse3.x+this.impulse3.z),m.x+=q*this.impulse3.x,m.y+=q*this.impulse3.y,o+=s*(i*this.impulse3.y-j*this.impulse3.x+this.impulse3.z)}else{b=c.m_xf.R,g=this.m_localAnchor1.x-c.m_sweep.localCenter.x,h=this.m_localAnchor1.y-c.m_sweep.localCenter.y,f=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=f,b=e.m_xf.R,i=this.m_localAnchor2.x-e.m_sweep.localCenter.x,j=this.m_localAnchor2.y-e.m_sweep.localCenter.y,f=b.col1.x*i+b.col2.x*j,j=b.col1.y*i+b.col2.y*j,i=f;var A=m.x+-o*j-k.x- -l*h,B=m.y+o*i-k.y-l*g;this.m_mass.Solve22(this.impulse2,-A,-B),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,k.x-=p*this.impulse2.x,k.y-=p*this.impulse2.y,l-=r*(g*this.impulse2.y-h*this.impulse2.x),m.x+=q*this.impulse2.x,m.y+=q*this.impulse2.y,o+=s*(i*this.impulse2.y-j*this.impulse2.x)}c.m_linearVelocity.SetV(k),c.m_angularVelocity=l,e.m_linearVelocity.SetV(m),e.m_angularVelocity=o},y.prototype.SolvePositionConstraints=function(b){void 0===b&&(b=0);var c,e=0,f=this.m_bodyA,g=this.m_bodyB,h=0,i=0,j=0,k=0,l=0;if(this.m_enableLimit&&this.m_limitState!=n.e_inactiveLimit){var m=g.m_sweep.a-f.m_sweep.a-this.m_referenceAngle,o=0;this.m_limitState==n.e_equalLimits?(e=d.Clamp(m-this.m_lowerAngle,-a.b2_maxAngularCorrection,a.b2_maxAngularCorrection),o=-this.m_motorMass*e,h=d.Abs(e)):this.m_limitState==n.e_atLowerLimit?(e=m-this.m_lowerAngle,h=-e,e=d.Clamp(e+a.b2_angularSlop,-a.b2_maxAngularCorrection,0),o=-this.m_motorMass*e):this.m_limitState==n.e_atUpperLimit&&(e=m-this.m_upperAngle,h=e,e=d.Clamp(e-a.b2_angularSlop,0,a.b2_maxAngularCorrection),o=-this.m_motorMass*e),f.m_sweep.a-=f.m_invI*o,g.m_sweep.a+=g.m_invI*o,f.SynchronizeTransform(),g.SynchronizeTransform()}c=f.m_xf.R;var p=this.m_localAnchor1.x-f.m_sweep.localCenter.x,q=this.m_localAnchor1.y-f.m_sweep.localCenter.y;j=c.col1.x*p+c.col2.x*q,q=c.col1.y*p+c.col2.y*q,p=j,c=g.m_xf.R;var r=this.m_localAnchor2.x-g.m_sweep.localCenter.x,s=this.m_localAnchor2.y-g.m_sweep.localCenter.y;j=c.col1.x*r+c.col2.x*s,s=c.col1.y*r+c.col2.y*s,r=j;var t=g.m_sweep.c.x+r-f.m_sweep.c.x-p,u=g.m_sweep.c.y+s-f.m_sweep.c.y-q,v=t*t+u*u,w=Math.sqrt(v);i=w;var x=f.m_invMass,z=g.m_invMass,A=f.m_invI,B=g.m_invI,C=10*a.b2_linearSlop;if(v>C*C){var D=x+z,E=1/D;k=E*-t,l=E*-u;var F=.5;f.m_sweep.c.x-=F*x*k,f.m_sweep.c.y-=F*x*l,g.m_sweep.c.x+=F*z*k,g.m_sweep.c.y+=F*z*l,t=g.m_sweep.c.x+r-f.m_sweep.c.x-p,u=g.m_sweep.c.y+s-f.m_sweep.c.y-q}return this.K1.col1.x=x+z,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=x+z,this.K2.col1.x=A*q*q,this.K2.col2.x=-A*p*q,this.K2.col1.y=-A*p*q,this.K2.col2.y=A*p*p,this.K3.col1.x=B*s*s,this.K3.col2.x=-B*r*s,this.K3.col1.y=-B*r*s,this.K3.col2.y=B*r*r,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(y.tImpulse,-t,-u),k=y.tImpulse.x,l=y.tImpulse.y,f.m_sweep.c.x-=f.m_invMass*k,f.m_sweep.c.y-=f.m_invMass*l,f.m_sweep.a-=f.m_invI*(p*l-q*k),g.m_sweep.c.x+=g.m_invMass*k,g.m_sweep.c.y+=g.m_invMass*l,g.m_sweep.a+=g.m_invI*(r*l-s*k),f.SynchronizeTransform(),g.SynchronizeTransform(),i<=a.b2_linearSlop&&h<=a.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new e}),Box2D.inherit(z,Box2D.Dynamics.Joints.b2JointDef),z.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,z.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new e,this.localAnchorB=new e},z.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},z.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA=this.bodyA.GetLocalPoint(c),this.localAnchorB=this.bodyB.GetLocalPoint(c),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(A,Box2D.Dynamics.Joints.b2Joint),A.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,A.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new e,this.m_localAnchorB=new e,this.m_impulse=new f,this.m_mass=new c},A.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},A.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},A.prototype.GetReactionForce=function(a){return void 0===a&&(a=0),new e(a*this.m_impulse.x,a*this.m_impulse.y)},A.prototype.GetReactionTorque=function(a){return void 0===a&&(a=0),a*this.m_impulse.z},A.prototype.b2WeldJoint=function(a){this.__super.b2Joint.call(this,a),this.m_localAnchorA.SetV(a.localAnchorA),this.m_localAnchorB.SetV(a.localAnchorB),this.m_referenceAngle=a.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new c},A.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var f=this.m_localAnchorA.x-d.m_sweep.localCenter.x,g=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c,b=e.m_xf.R;var h=this.m_localAnchorB.x-e.m_sweep.localCenter.x,i=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*h+b.col2.x*i,i=b.col1.y*h+b.col2.y*i,h=c;var j=d.m_invMass,k=e.m_invMass,l=d.m_invI,m=e.m_invI;this.m_mass.col1.x=j+k+g*g*l+i*i*m,this.m_mass.col2.x=-g*f*l-i*h*m,this.m_mass.col3.x=-g*l-i*m,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=j+k+f*f*l+h*h*m,this.m_mass.col3.y=f*l+h*m,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=l+m,a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=j*this.m_impulse.x,d.m_linearVelocity.y-=j*this.m_impulse.y,d.m_angularVelocity-=l*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=k*this.m_impulse.x,e.m_linearVelocity.y+=k*this.m_impulse.y,e.m_angularVelocity+=m*(h*this.m_impulse.y-i*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},A.prototype.SolveVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB,g=d.m_linearVelocity,h=d.m_angularVelocity,i=e.m_linearVelocity,j=e.m_angularVelocity,k=d.m_invMass,l=e.m_invMass,m=d.m_invI,n=e.m_invI;b=d.m_xf.R;var o=this.m_localAnchorA.x-d.m_sweep.localCenter.x,p=this.m_localAnchorA.y-d.m_sweep.localCenter.y;c=b.col1.x*o+b.col2.x*p,p=b.col1.y*o+b.col2.y*p,o=c,b=e.m_xf.R;var q=this.m_localAnchorB.x-e.m_sweep.localCenter.x,r=this.m_localAnchorB.y-e.m_sweep.localCenter.y;c=b.col1.x*q+b.col2.x*r,r=b.col1.y*q+b.col2.y*r,q=c;var s=i.x-j*r-g.x+h*p,t=i.y+j*q-g.y-h*o,u=j-h,v=new f;this.m_mass.Solve33(v,-s,-t,-u),this.m_impulse.Add(v),g.x-=k*v.x,g.y-=k*v.y,h-=m*(o*v.y-p*v.x+v.z),i.x+=l*v.x,i.y+=l*v.y,j+=n*(q*v.y-r*v.x+v.z),d.m_angularVelocity=h,e.m_angularVelocity=j},A.prototype.SolvePositionConstraints=function(b){void 0===b&&(b=0);var c,e=0,g=this.m_bodyA,h=this.m_bodyB;c=g.m_xf.R;var i=this.m_localAnchorA.x-g.m_sweep.localCenter.x,j=this.m_localAnchorA.y-g.m_sweep.localCenter.y;e=c.col1.x*i+c.col2.x*j,j=c.col1.y*i+c.col2.y*j,i=e,c=h.m_xf.R;var k=this.m_localAnchorB.x-h.m_sweep.localCenter.x,l=this.m_localAnchorB.y-h.m_sweep.localCenter.y;e=c.col1.x*k+c.col2.x*l,l=c.col1.y*k+c.col2.y*l,k=e;var m=g.m_invMass,n=h.m_invMass,o=g.m_invI,p=h.m_invI,q=h.m_sweep.c.x+k-g.m_sweep.c.x-i,r=h.m_sweep.c.y+l-g.m_sweep.c.y-j,s=h.m_sweep.a-g.m_sweep.a-this.m_referenceAngle,t=10*a.b2_linearSlop,u=Math.sqrt(q*q+r*r),v=d.Abs(s);u>t&&(o*=1,p*=1),this.m_mass.col1.x=m+n+j*j*o+l*l*p,this.m_mass.col2.x=-j*i*o-l*k*p,this.m_mass.col3.x=-j*o-l*p,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=m+n+i*i*o+k*k*p,this.m_mass.col3.y=i*o+k*p,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=o+p;var w=new f;return this.m_mass.Solve33(w,-q,-r,-s),g.m_sweep.c.x-=m*w.x,g.m_sweep.c.y-=m*w.y,g.m_sweep.a-=o*(i*w.y-j*w.x+w.z),h.m_sweep.c.x+=n*w.x,h.m_sweep.c.y+=n*w.y,h.m_sweep.a+=p*(k*w.y-l*w.x+w.z),g.SynchronizeTransform(),h.SynchronizeTransform(),u<=a.b2_linearSlop&&v<=a.b2_angularSlop},Box2D.inherit(B,Box2D.Dynamics.Joints.b2JointDef),B.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,B.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new e,this.localAnchorB=new e},B.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=n.e_weldJoint,this.referenceAngle=0},B.prototype.Initialize=function(a,b,c){this.bodyA=a,this.bodyB=b,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var a=Box2D.Dynamics.b2DebugDraw;a.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}}},a.prototype._color=function(a,b){return"rgba("+((16711680&a)>>16)+","+((65280&a)>>8)+","+(255&a)+","+b+")"},a.prototype.b2DebugDraw=function(){this.m_drawFlags=0},a.prototype.SetFlags=function(a){void 0===a&&(a=0),this.m_drawFlags=a},a.prototype.GetFlags=function(){return this.m_drawFlags},a.prototype.AppendFlags=function(a){void 0===a&&(a=0),this.m_drawFlags|=a},a.prototype.ClearFlags=function(a){void 0===a&&(a=0),this.m_drawFlags&=~a},a.prototype.SetSprite=function(a){this.m_ctx=a},a.prototype.GetSprite=function(){return this.m_ctx},a.prototype.SetDrawScale=function(a){void 0===a&&(a=0),this.m_drawScale=a},a.prototype.GetDrawScale=function(){return this.m_drawScale},a.prototype.SetLineThickness=function(a){void 0===a&&(a=0),this.m_lineThickness=a,this.m_ctx.strokeWidth=a},a.prototype.GetLineThickness=function(){return this.m_lineThickness},a.prototype.SetAlpha=function(a){void 0===a&&(a=0),this.m_alpha=a},a.prototype.GetAlpha=function(){return this.m_alpha},a.prototype.SetFillAlpha=function(a){void 0===a&&(a=0),this.m_fillAlpha=a},a.prototype.GetFillAlpha=function(){return this.m_fillAlpha},a.prototype.SetXFormScale=function(a){void 0===a&&(a=0),this.m_xformScale=a},a.prototype.GetXFormScale=function(){return this.m_xformScale},a.prototype.DrawPolygon=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.moveTo(a[0].x*e,a[0].y*e);for(var f=1;f<b;f++)d.lineTo(a[f].x*e,a[f].y*e);d.lineTo(a[0].x*e,a[0].y*e),d.closePath(),d.stroke()}},a.prototype.DrawSolidPolygon=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.fillStyle=this._color(c.color,this.m_fillAlpha),d.moveTo(a[0].x*e,a[0].y*e);for(var f=1;f<b;f++)d.lineTo(a[f].x*e,a[f].y*e);d.lineTo(a[0].x*e,a[0].y*e),d.closePath(),d.fill(),d.stroke()}},a.prototype.DrawCircle=function(a,b,c){if(b){var d=this.m_ctx,e=this.m_drawScale;d.beginPath(),d.strokeStyle=this._color(c.color,this.m_alpha),d.arc(a.x*e,a.y*e,b*e,0,2*Math.PI,!0),d.closePath(),d.stroke()}},a.prototype.DrawSolidCircle=function(a,b,c,d){if(b){var e=this.m_ctx,f=this.m_drawScale,g=a.x*f,h=a.y*f;e.moveTo(0,0),e.beginPath(),e.strokeStyle=this._color(d.color,this.m_alpha),e.fillStyle=this._color(d.color,this.m_fillAlpha),e.arc(g,h,b*f,0,2*Math.PI,!0),e.moveTo(g,h),e.lineTo((a.x+c.x*b)*f,(a.y+c.y*b)*f),e.closePath(),e.fill(),e.stroke()}},a.prototype.DrawSegment=function(a,b,c){var d=this.m_ctx,e=this.m_drawScale;d.strokeStyle=this._color(c.color,this.m_alpha),d.beginPath(),d.moveTo(a.x*e,a.y*e),d.lineTo(b.x*e,b.y*e),d.closePath(),d.stroke()},a.prototype.DrawTransform=function(a){var b=this.m_ctx,c=this.m_drawScale;b.beginPath(),b.strokeStyle=this._color(16711680,this.m_alpha),b.moveTo(a.position.x*c,a.position.y*c),b.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*c,(a.position.y+this.m_xformScale*a.R.col1.y)*c),b.strokeStyle=this._color(65280,this.m_alpha),b.moveTo(a.position.x*c,a.position.y*c),b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*c,(a.position.y+this.m_xformScale*a.R.col2.y)*c),b.closePath(),b.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.constructor=d,d.extend=arguments.callee,d}}(),Stratiscape=function(a){this.inverseScaleRatio=1,this.layers=[],this.layersByName={},this.container=document.getElementById(a.containerId);var b=this.container.innerHTML;if(!document.createElement("canvas").getContext)return this.canvasSupported=!1,void(a.canvasNotSupportedCallback&&a.canvasNotSupportedCallback());this.canvasSupported=!0,a.layers.sort(this.layerSortFunction);for(var c in a.layers){var d=a.layers[c];d.zIndex>=0?Stratiscape.Global.layerNextZIndex<=d.zIndex&&(Stratiscape.Global.layerNextZIndex=d.zIndex+1):d.zIndex=Stratiscape.Global.layerNextZIndex++;var e="lyr_"+d.name+d.zIndex,f="";d.backgroundColor&&(f="background-color:"+d.backgroundColor+";"),b+='<canvas id="'+e+'" width="'+d.width+'" height="'+d.height+'" style="position:absolute;left:'+d.x+"px;top:"+d.y+"px;z-index:"+d.zIndex+";"+f+'"></canvas>'}this.container.innerHTML=b;for(var c in a.layers){var d=a.layers[c],e="lyr_"+d.name+d.zIndex,g=null;if(d.mouseHitId){var h=this;g=document.getElementById(d.mouseHitId),d.clickCallback&&(g.layerConfig=d,Stratiscape.Global.onEvent(g,"click",function(a){var b=h.getScaledCursorPosition(a);(a.srcElement||a.target).layerConfig.clickCallback(b)})),d.dblclickCallback&&(g.layerConfig=d,Stratiscape.Global.onEvent(g,"dblclick",function(a){var b=h.getScaledCursorPosition(a);(a.srcElement||a.target).layerConfig.dblclickCallback(b)}))}var i=new Stratiscape.Layer(e,d.name,d.x,d.y,d.width,d.height,d.zIndex,g);this.layers.push(i),this.layersByName[i.name]=i}},Stratiscape.prototype.getScaledCursorPosition=function(a){var b=Stratiscape.Global.getCursorPosition(a);return this.inverseScaleRatio&&(b.x*=this.inverseScaleRatio,b.y*=this.inverseScaleRatio),b},Stratiscape.Global={layerNextZIndex:1},Stratiscape.Global.getCursorPosition=function(a){var b={x:null,y:null};void 0!=a.pageX&&void 0!=a.pageY?(b.x=a.pageX,b.y=a.pageY):(b.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,b.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);var c=a.srcElement||a.target;do{b.x-=c.offsetLeft||0,b.y-=c.offsetTop||0,c=c.offsetParent}while(c);return b},Stratiscape.Global.onEvent=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},Stratiscape.Global.scaleElement=function(a,b,c){a&&(a.style.width=(a.width||a.clientWidth)*b.widthScale+"px",a.style.height=(a.height||a.clientHeight)*b.heightScale+"px",c||(0!=a.offsetLeft&&(a.style.left=a.offsetLeft*b.widthScale+"px"),0!=a.offsetTop&&(a.style.top=a.offsetTop*b.heightScale+"px")))},Stratiscape.prototype.scaleLayers=function(a){var b={widthScale:1,heightScale:1},c=window.innerWidth,d=window.innerHeight,e=c/d,f=a.mainWidth/a.mainHeight,g=1,h=a.ratioTolerance||.02;if(e<f-h||e>f+h){var i=c/(a.mainWidth+(a.paddingWidth||0)),j=d/(a.mainHeight+(a.paddingHeight||0)),g=Math.min(i,j);b={widthScale:g,heightScale:g};for(var k in this.layers){var l=document.StratiscapeDraw.layers[k];Stratiscape.Global.scaleElement(l.canvas,b),l.mouseHitElm&&Stratiscape.Global.scaleElement(l.mouseHitElm,b)}if(a.additionalElementIds)for(var k in a.additionalElementIds)Stratiscape.Global.scaleElement(document.getElementById(a.additionalElementIds[k]),b,!0);this.inverseScaleRatio=1/g}return b},Stratiscape.prototype.getLayer=function(a){return this.layersByName[a]?this.layersByName[a]:null},Stratiscape.prototype.draw=function(){for(var a in this.layers)this.layers[a].needsDisplay&&this.layers[a].draw()},Stratiscape.prototype.layerSortFunction=function(a,b){return a.zIndex>b.zIndex?1:a.zIndex<b.zIndex?-1:0},Stratiscape.Layer=function(a,b,c,d,e,f,g,h){this.name=b,this.x=c,this.y=d,this.width=e,this.height=f,this.zIndex=g,this.children=[],this.needsDisplay=!1,this.canvas=document.getElementById(a),this.ctx=this.canvas.getContext("2d"),this.mouseHitElm=null,h&&(this.mouseHitElm=h)},Stratiscape.Layer.prototype.draw=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var a in this.children)"function"==typeof this.children[a].draw&&this.children[a].draw(this.ctx);this.needsDisplay=!1},Stratiscape.Layer.prototype.isInBounds=function(a,b){return this.x<=a&&this.y<=b&&this.x+this.width>=a&&this.y+this.height>=b},Stratiscape.Layer.prototype.addChild=function(a){a.layer=this,this.children.push(a),this.needsDisplay=!0},Stratiscape.Layer.prototype.removeChild=function(a){var b=this.children.indexOf(a);-1!=b&&(a.layer=null,this.children.splice(b,1),this.needsDisplay=!0)},Stratiscape.Layer.prototype.clear=function(){for(var a in this.children)this.children[a].layer=null;this.children=[],this.needsDisplay=!0},Stratiscape.DrawnObject=Class.extend({init:function(){this.x=0,this.y=0,this.layer=null},draw:function(a){},isInBounds:function(a,b){return!1}}),SfxInterface=function(a){this.Volume=1,this.muted=!1,this.fileNames=a,this.audioObjects={};for(var b in a){this.audioObjects[a[b]]=[];for(var c=0;c<3;c++)this.audioObjects[a[b]].push(this.createAudioObject(a[b]))}},SfxInterface.prototype.toggleMute=function(){this.muted=!this.muted;for(var a in this.audioObjects)for(var b=0;b<this.audioObjects[a].length;b++)this.audioObjects[a][b].muted=this.muted},SfxInterface.prototype.setVolume=function(a,b){this.Volume=a;var c=this.audioObjects;b&&(c={},c[b]=this.audioObjects[b]);for(var d in c)for(var e=0;e<this.audioObjects[d].length;e++)this.audioObjects[d][e].volume=this.Volume},SfxInterface.prototype.setVolumeAt=function(a,b){this.setVolume(b,this.fileNames[a])},SfxInterface.prototype.playFileAt=function(a){this.playFile(this.fileNames[a])},SfxInterface.prototype.playFile=function(a){for(var b=this.audioObjects[a],c=0;c<b.length;c++)if(0==b[c].currentTime||b[c].ended){b[c].play();break}},SfxInterface.prototype.createAudioObject=function(a){var b=new Audio;return b.src=a,b.loop=!1,b.controls=!1,b.autobuffer=!0,b.preload="auto",b.addEventListener("ended",function(a){},!1),b.load(),b},function(){var a=this,b=a.jQuery,c=a._,d=null,e=null;a.ResponsiveWindowEvent={getInstance:function(){return null===d&&(d=new e),d}},e=function(){this.config={portrait_query:"(max-device-width: 480px)",landscape_query:"screen and (max-width: 480px)",maxNarrowWidth:480,maxWideWidth:768,maxSmallDesktopWideWidth:960},this._$body=b("body"),this._initialized=!1},e.prototype.activate=function(){this._initialized||this._initialize()},e.prototype.isExtraWide=function(){return window.innerWidth>this.config.maxSmallDesktopWideWidth},e.prototype.isSmallDesktopWide=function(){return window.innerWidth>this.config.maxWideWidth&&window.innerWidth<=this.config.maxSmallDesktopWideWidth},e.prototype.isWide=function(){return window.innerWidth>this.config.maxNarrowWidth&&window.innerWidth<=this.config.maxWideWidth},e.prototype.isNarrow=function(){return window.innerWidth<=this.config.maxNarrowWidth},e.prototype._initialize=function(){this._initialized=!0,this.isIOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent),this.meta=b("meta[name=viewport]")[0],this._attachOrientationChange(),this._updateViewport();var a,d=b(window);this.isNarrow()?(a="small",d.trigger("becometonarrow"),d.trigger("narrow")):this.isWide()?(a="large",d.trigger("becometowide"),d.trigger("widen")):this.isSmallDesktopWide()?(a="smalldesktoplarge",d.trigger("becometosmalldesktopwide"),d.trigger("smalldesktopwiden")):(a="extralarge",d.trigger("becometoextrawide"),d.trigger("extrawiden")),d.on("resize",c.debounce(function(){this.isNarrow()?(d.trigger("resizewhennarrow"),"small"!==a&&(a="small",d.trigger("becometonarrow"),d.trigger("narrow"))):this.isWide()?(d.trigger("resizewhenwide"),"large"!==a&&(a="large",d.trigger("becometowide"),d.trigger("widen"))):this.isSmallDesktopWide()?(d.trigger("resizewhensmalldesktopwide"),"smalldesktoplarge"!==a&&(a="smalldesktoplarge",d.trigger("becometosmalldesktopwide"),d.trigger("smalldesktopwiden"))):(d.trigger("resizewhenextrawide"),"extralarge"!==a&&(a="extralarge",d.trigger("becometoextrawide"),d.trigger("extrawiden")))},100).bind(this))},e.prototype._attachOrientationChange=function(){var a=c.bind(this._handleOrientationChange,this);window.addEventListener&&window.addEventListener("orientationchange",a)},e.prototype._handleOrientationChange=function(){this.orientation=!this.orientation,this.isIOS?this._updateViewport():setTimeout(c.bind(this._updateViewport,this),500)},e.prototype._updateViewport=function(){this.isMobileDevice()?this.meta:this.meta&&this.isIOS},e.prototype.isMobileDevice=function(){return 0!==window.orientation&&this.isIOS?Modernizr.mq(this.config.landscape_query):Modernizr.mq(this.config.portrait_query)}}.call(this),function(a){"use strict";a.NR.resolve("SDM.Core.Enums").OptimumLoginEnums={cardNumberValidationResults:{CANNOT_VALIDATE:"cannot-validate",INCOMPLETE:"incomplete",INCOMPLETE_SUBMITTING:"incomplete-submitting",INVALID_CREDENTIALS:"invalid-credentials",INVALID_FORMAT:"invalid-format",INVALID_MOD10:"invalid-mod10",VALID:"valid"},passwordValidationStates:{EMPTY_SUBMITTING:"empty-submitting",INVALID_CREDENTIALS:"invalid-credentials",VALID:"valid"},reCaptchaValidationStates:{INCOMPLETE:"incomplete",SERVER_INVALID:"server-invalid",VALID:"valid"}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Core.Components"),d=b.resolve("SDM.Core.Enums"),e=b.resolve("SDM.Core.Services"),f=c.OptimumMod10Validation,g=d.OptimumLoginEnums,h={cardNumberLength:9},i=e.OptimumLoginService={cardNumberFieldHasDisplayError:function(a){return g.cardNumberValidationResults.INCOMPLETE_SUBMITTING===a||g.cardNumberValidationResults.INVALID_CREDENTIALS===a||g.cardNumberValidationResults.INVALID_FORMAT===a||g.cardNumberValidationResults.INVALID_MOD10===a},getDifferenceInMinutes:function(a,b){return Math.ceil((a-b)/i.minutesToMilliSeconds(1))},getBrowserLockEndTime:function(a,b){return a+i.minutesToMilliSeconds(b)},incrementLoginLockStateTries:function(a,b){return{NumberOfTries:a.NumberOfTries+1,Time:b}},minutesToMilliSeconds:function(a){return 60*a*1e3},validateCardNumber:function(a,b){if(b=b||{},Boolean(b.isMasked))return g.cardNumberValidationResults.VALID;var c=Boolean(b.isSubmitting);return/^\d*$/.test(a)?a.length<h.cardNumberLength?c?g.cardNumberValidationResults.INCOMPLETE_SUBMITTING:g.cardNumberValidationResults.INCOMPLETE:f(a)?g.cardNumberValidationResults.VALID:g.cardNumberValidationResults.INVALID_MOD10:g.cardNumberValidationResults.INVALID_FORMAT},validatePassword:function(a,b){return b=b||{},Boolean(b.isSubmitting)&&_.isEmpty(a)?g.passwordValidationStates.EMPTY_SUBMITTING:g.passwordValidationStates.VALID},validateReCaptchaResponse:function(a,b){return b=b||{},Boolean(b.isResetting)?g.reCaptchaValidationStates.VALID:_.isEmpty(a)?g.reCaptchaValidationStates.INCOMPLETE:g.reCaptchaValidationStates.VALID}}}(this),function(a){var b,c=a.jQuery,d=a._,e=this.SDM||(this.SDM={}),f=a.NR||(a.NR={}),g=f.resolve("SDM.Core.Utils"),h="6Lcq9SMUAAAAAHkzfuKtutMTFrg1C79_Tm09YfZi",i=null,j=function(){if(null!==i)return i.promise();var a=document.createElement("script");return i=new c.Deferred,a.type="text/javascript",a.src="https://www.google.com/recaptcha/api.js?onload=recaptchaOnLoadCallback&render=explicit&hl="+e.Util.getShortLanguageCode(),document.body.appendChild(a),i.promise()};a.recaptchaOnLoadCallback=function(){i.resolve&&i.resolve()},b=g.ReCaptcha=function(){this.widgetId=null},
b.prototype.render=function(a,b,e){if(!(a instanceof c))throw new Error("First arg must be a jQuery-wrapped DOM element.");if(arguments.length>1&&!d.isFunction(b))throw new Error("`callback` must be a function.");return this.widgetId=grecaptcha.render(a.get(0),{sitekey:h,callback:b,"expired-callback":e})},b.prototype.getResponse=function(){if(d.isNull(this.widgetId))throw new Error("`getResponse` cannot be invoked before reCaptcha is rendered.");return grecaptcha.getResponse(this.widgetId)},b.prototype.reset=function(){if(d.isNull(this.widgetId))throw new Error("`reset` cannot be invoked before reCaptcha is rendered.");return grecaptcha.reset(this.widgetId)},g.ReCaptchaFactory={getReCaptchaAsync:function(){return j().then(function(){return new b})},isReCaptcha:function(a){return a instanceof b}}}(this),function(){var a=this,b=a._,c=a.jQuery,d=a.SDM||(a.SDM={}),e={},f=a.ResponsiveWindowEvent,g=null,h=!1,i=null,j=d.Util=function(a){var b={lang_code:"",regiion:"",phone_number_reg_exp:/^[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4}$/im,postal_code_reg_exp:/(^([0-9]{5})$)|(^[ABCEGHJKLMNPRSTVXYabceghjklmnprstvxy]{1}\d{1}[A-Za-z]{1} *\d{1}[A-Za-z]{1}\d{1}$)/,email_reg_exp:/^(([abcdefg.hijklmnopqrstuvwxyz!#$%&'*/=?^_+-`{|}~0123456789]+))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,cookies:{postal_code:"sdm-postal-code",province:"sdm-province"},google_api_clientID:"gme-shoppersdrugmart"};e=c.extend(!0,b,a||{}),g=f.getInstance(),h=/(iPad|iPhone|iPod)/g.test(navigator.userAgent)};j.getFullLanguageCode=function(){return e.lang_code},j.getShortLanguageCode=function(){return e.lang_code.substring(0,2)},j.isPhx=function(){return"qc"===e.region},j.getUsersIP=function(){return e.user_ip},j.getValueFromCookie=function(a){var b=document.cookie,c=b.indexOf(" "+a+"=");if(-1===c&&(c=b.indexOf(a+"=")),-1===c)b=null;else{c=b.indexOf("=",c)+1;var d=b.indexOf(";",c);-1===d&&(d=b.length),b=unescape(b.substring(c,d))}return b},j.saveCookie=function(a,b,c,d){document.cookie=c&&d?a+"="+b+";Domain="+c+";expires="+d+"; path=/":c?a+"="+b+";Domain="+c+"; path=/":d?a+"="+b+";expires="+d+"; path=/":a+"="+b+"; path=/"},j.getUrlVars=function(){var a,c={},d=window.location.href,e=d.indexOf("#"),f=d.indexOf("?"),g="";e>0&&e>f?g=d.slice(f+1,e).split("&"):f>0&&(g=d.slice(f+1).split("&")),e>0&&e<f?(a=d.slice(e+1,f),c.hash=a):e>0&&(a=d.slice(e+1),c.hash=a),b.each(g,function(a,b){var c=decodeURIComponent(a.replace(/\+/g," "));g[b]=c});for(var h="",i=0;i<g.length;i++)h=g[i].split("="),c[h[0]]=h[1];return c},j.setUrlVars=function(a){var b="";b=-1===window.location.href.indexOf("?")?window.location.href:window.location.href.slice(0,window.location.href.indexOf("?"));var d=c.param(a),e=b;e+=""===d?"":"?"+d,history.pushState&&window.history.pushState("sdm-phm-svc",null,decodeURIComponent(e))},j.properCase=function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},j.validatePhoneNumber=function(a){return e.phone_number_reg_exp.test(a)},j.validatePostalCode=function(a){return e.postal_code_reg_exp.test(a)},j.validateEmail=function(a){return e.email_reg_exp.test(a)},j.getMobileHeaderBarHeight=function(){return c("[data-wg-hds-mobile-header-bar]").height()},j.getHeaderBarHeight=function(){return c("[data-wg-hds-header-bar]").height()},j.getCampaignHeaderHeight=function(){return c("[data-wg-hds-campaign-header]").height()},j.getScrollOffset=function(){return j.isWindowNarrow()?j.getMobileHeaderBarHeight():j.getHeaderBarHeight()+j.getCampaignHeaderHeight()},j.isWindowNarrow=function(){return g.isNarrow()},j.isWindowWide=function(){return g.isWide()},j.isWindowSmallDesktopWide=function(){return g.isSmallDesktopWide()},j.isWindowExtraWide=function(){return g.isExtraWide()},j.loadImage=function(a){var b=c.Deferred(),d=new Image;return d.onload=function(){b.resolve()},d.onerror=function(){b.resolve()},d.src=a,b.promise()},j.ajax=function(a,b){if(window.XDomainRequest){var d=c.Deferred();b.data.timestamp=c.now();var e=new window.XDomainRequest;return e.open("get",a+"?"+c.param(b.data)),e.onload=function(){var a=c.parseJSON(e.responseText);d.resolve(a)},e.onprogress=function(){},e.send(),d.promise()}return c.ajax(a,b)},j.activateResizeEvent=function(){g.activate()},j.getScrollPos=function(){return a.document.documentElement.scrollTop+a.document.body.scrollTop===a.document.documentElement.scrollTop?a.document.documentElement.scrollTop:a.document.body.scrollTop},j._googleMapsApiDeferred=null,j.googleMapReady=function(){this._googleMapsApiDeferred.resolve(a.google)},j.loadGoogleMapsApi=function(b,c){return!!a.google||this.loadGoogleMapsApiV2(b,c)},j.loadGoogleMapsApiV2=function(a,b){if(this._googleMapsApiDeferred)return this._googleMapsApiDeferred.promise();this._googleMapsApiDeferred=new c.Deferred;var d=document.createElement("script");d.type="text/javascript";var f=a?"key="+a:"client="+e.google_api_clientID,g="channel="+e.region;return b=b?"libraries="+b:"",d.src="https://maps.googleapis.com/maps/api/js?"+f+"&"+g+(b?"&"+b:"")+"&region=CA&callback=SDM.Util.googleMapReady",document.body.appendChild(d),this._googleMapsApiDeferred.promise()},j.getProvinceId=function(d){return c.when(this.loadGoogleMapsApiV2()).then(function(){if(!a.google.maps.Geocoder)throw new Error("Geocoder unavailable");var e=new a.google.maps.Geocoder,f=new c.Deferred,g=null;return e.geocode({location:d},function(a,c){"OK"!==c?f.reject("status not OK"):a.length?(g=b.find(a[0].address_components||[],function(a){return b.contains(a.types||[],"administrative_area_level_1")}),f.resolve(((g||{}).short_name||"").toLowerCase())):f.resolve("")}),f.promise()})},j.loadYoutubeVideoApi=function(){if(!b.isNull(i))return i;i=c.Deferred();var a=c("<script />");return a.attr("src","https://www.youtube.com/iframe_api"),document.body.appendChild(a.get(0)),window.onYouTubeIframeAPIReady=i.resolve,i},j.loadPinterestApi=function(){return this.pinterest_api_load_promise||(this.pinterest_api_load_promise=c.getScript("//assets.pinterest.com/js/pinit_main.js"))},j.isIOS=function(){return h},j.isMobileDevice=function(){return 0===window.orientation?Modernizr.mq("(max-device-width: 480px)"):Modernizr.mq("screen and (max-width: 480px)")},j.prepareLoadToWinOffersLoadedUrl=function(a){return b.isString(a)?a.indexOf("offersloaded")>=0?a:("/"!==a.slice(-1)&&(a+="/"),a+="offersloaded"):a},j.detectIEVersion=function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(b>0)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(a.indexOf("Trident/")>0){var c=a.indexOf("rv:");return parseInt(a.substring(c+3,a.indexOf(".",c)),10)}var d=a.indexOf("Edge/");return d>0?parseInt(a.substring(d+5,a.indexOf(".",d)),10):-1},j.scrollTo$ElementAsync=function(a,d,e){var f=e||0,g=a.offset().top-f,h="."+b.uniqueId("_event"),i=c("html, body"),j=c(window),k=new c.Deferred;return g-=this.isWindowExtraWide()?this.getHeaderBarHeight():this.getMobileHeaderBarHeight(),j.one("mousewheel"+h,function(){i.stop(),k.resolve()}),i.stop().animate({scrollTop:g},d,function(){j.off(h),k.resolve()}),k.promise()},j.updateLanguageToggleHref=function(a){c("[data-sydicated-language-toggle]").attr("href",a)},j.parseAgilityUrl=function(a){if(!a)return null;try{var b=a.match(/href="([^"]*)"/i);if(!b||!b.length)return null;var c=a.match(/^<[^>]*>([^<]*)<\/a>$/i);if(!c||!c.length)return null;var d=a.match(/target="([^"]*)"/i);return{href:b[1],target:d&&d.length?d[1]:"",text:c[1]}}catch(b){return console.error("Could not parse URL:",a,b),null}},j.convertStringToSlug=function(a){return a?a.toLowerCase().replace(/ +/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-"):""},j.isObject=function(a){return a&&"object"==typeof a&&!Array.isArray(a)},j.mergeObjects=function(a,b){var c=Object.assign({},a);return j.isObject(a)&&j.isObject(b)&&Object.keys(b).forEach(function(d){var e={};e[d]=b[d],j.isObject(b[d])&&d in a?c[d]=j.mergeObjects(a[d],b[d]):Object.assign(c,e)}),c}}.call(this),function(a){"use strict";var b=a.jQuery,c={},d=a.SDM||(a.SDM={}),e=d.Subscription=function(a,d){d=d||{};var e={isEmailSubscribedUrl:"/isSubscribed",signupUrl:"/subscribe"};c=b.extend(!0,{},e,d)};e.isEmailSubscribed=function(a){var d=new b.Deferred;return b.ajax({cache:!1,contentType:"application/x-www-form-urlencoded",type:"POST",url:c.isEmailSubscribedUrl,data:{email:a}}).done(function(a){d.resolve(a)}).fail(function(a){d.reject(a)}),d.promise()},e.signup=function(a,d){var e=new b.Deferred;return console.log(a),console.log(d),b.ajax({cache:!1,contentType:"application/x-www-form-urlencoded",type:"POST",url:c.signupUrl,data:{email:a,casl:d}}).done(function(a){console.log(a),"True"===a?e.resolve(a):e.reject(a)}).fail(function(a){console.log(a),e.reject(a)}),e.promise()}}(this),function(){var a=this,b=a._,c=a.jQuery,d=a.SDM||(a.SDM={}),e={postal_code:null,province:null,is_preferred:!1},f=null,g=d.GeoLocation=function(a){return f=new _GeoLocation(a),f.deferred.promise()};g.getUsersProvince=function(){return e.province},g.getUsersPostalCode=function(){return e.postal_code},g.isPreferredSet=function(){return e.is_preferred},g.setPreferedLocation=function(a){f._savePreferedLocation(a,!0)},_GeoLocation=function(a){var b={domain:"/",is_initialized:!1,geo_info_url:"WebServices/AjaxService.asmx/GetGeoInfoByIP",preferred_location_cookie:"sdm-preferred-location",default_location_cookie:"sdm-location"};this.config=c.extend(!0,b,a||{}),this.deferred=new c.Deferred,this._initialize()},_GeoLocation.prototype._initialize=function(){if(!this.config.is_initialized){var a=d.Util.getValueFromCookie(this.config.preferred_location_cookie);if(a)a=JSON.parse(a),this._saveValues(a,!0);else{var b=d.Util.getValueFromCookie(this.config.default_location_cookie);b?(b=JSON.parse(b),this._saveValues(b,!1)):this._fetchUsersGeoLocation()}this.config.is_initialized=!0}},_GeoLocation.prototype._fetchUsersGeoLocation=function(){var a=b(this._saveFetchedLocation).bind(this);c.ajax({type:"POST",url:this.config.domain+this.config.geo_info_url,data:"{'ipAddress':'"+d.Util.getUsersIP()+"','langCode':'"+d.Util.getFullLanguageCode()+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:a})},_GeoLocation.prototype._saveValues=function(a,b){e.postal_code=a.postal_code,e.province=a.province,e.is_preferred=b,this.deferred.resolve()},_GeoLocation.prototype._saveFetchedLocation=function(a){var b={postal_code:a.d.PostalCode,province:a.d.Province};d.Util.saveCookie(this.config.default_location_cookie,JSON.stringify(b)),this._saveValues(b,!1)},_GeoLocation.prototype._savePreferedLocation=function(a){this._saveValues(a,!0),d.Util.saveCookie(this.config.preferred_location_cookie,JSON.stringify(a))}}.call(this),function(a){var b=a._,c=a.moment,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Utils");a.DataLayer={"page-section1":"pc-optimum"};var f=a._satellite||{track:function(){throw new Error("Global _satellite object does not exist.")}},g={ADD_OFFER_TO_LIST:"add-offer-to-list",CLICK_DONT_SHOW_OFFER_AGAIN:"click-dont-show-offer-again",CLICK_SAVE_OFFER_FOR_NEXT_WEEK:"click-save-offer-for-next-week",CUSTOM_LINK:"customlink",DONT_SHOW_OFFER_AGAIN:"dont-show-offer-again",LOAD_OFFERS_SUCCESS:"load-offers-success",LOGGED_IN:"logged-in",LOGGED_OUT:"logged-out",LOGIN_SUCCESS:"login-success",LOGOUT:"logout",PAGE_VIEW:"pageview",REMOVE_OFFER_FROM_LIST:"remove-offer-from-list",SAVE_OFFER_FOR_NEXT_WEEK:"save-offer-for-next-week",VIEW_OFFER_DETAILS:"view-offer-details"},h=function(d,e){var g=c();g.locale("en");var h={"day-of-week":g.format("dddd").toLowerCase(),"hour-of-day":Number(g.format("H")),"utc-timestamp":g.format()};a.DataLayer=b.extend({},a.DataLayer,h,e||{}),console.log("before track:",d,a.DataLayer);try{f.track(d)}catch(a){console.error(a.message)}console.log("after track customlink:",d,a.DataLayer)},i=e.SiteTypes={DESKTOP:"desktop",MOBILE:"mobile"};e.OmnitureUtil={setCustomerWalletId:function(c){return a.DataLayer=b.extend({},a.DataLayer,{"customer-wallet-id":c}),e.OmnitureUtil},setLoginStatus:function(c){return a.DataLayer=b.extend({},a.DataLayer,{"login-status":c?g.LOGGED_IN:g.LOGGED_OUT}),e.OmnitureUtil},setOptimumClaimed:function(c){return a.DataLayer=b.extend({},a.DataLayer,{"optimum-claimed":c?"yes":"no"}),e.OmnitureUtil},setPageLanguage:function(c){return a.DataLayer=b.extend({},a.DataLayer,{"page-language":c}),e.OmnitureUtil},setPageName:function(c){return a.DataLayer=b.extend({},a.DataLayer,{"page-name":c}),e.OmnitureUtil},setSiteType:function(c){if(-1===b.indexOf(b.values(i),c))throw new Error("Invalid `site_type`.");return a.DataLayer=b.extend({},a.DataLayer,{"site-type":c}),e.OmnitureUtil},trackPageView:function(a){return b.isEmpty(a)||e.OmnitureUtil.setPageName(a),h(g.PAGE_VIEW),e.OmnitureUtil},trackLoadOffersSuccess:function(a,b){return h(g.CUSTOM_LINK,{"link-name":g.LOAD_OFFERS_SUCCESS,"offers-per-status":a,"offers-per-template":b}),e.OmnitureUtil},trackAddOfferToList:function(a,b,c){return h(g.CUSTOM_LINK,{"link-name":g.ADD_OFFER_TO_LIST,"offer-template-number":a,"offer-status":b,"offer-name":c}),e.OmnitureUtil},trackRemoveOfferFromList:function(a,b,c){return h(g.CUSTOM_LINK,{"link-name":g.REMOVE_OFFER_FROM_LIST,"offer-template-number":a,"offer-status":b,"offer-name":c}),e.OmnitureUtil},trackClickDontShowOfferAgain:function(a,b,c){return h(g.CUSTOM_LINK,{"link-name":g.CLICK_DONT_SHOW_OFFER_AGAIN,"offer-template-number":a,"offer-status":b,"offer-name":c}),e.OmnitureUtil},trackConfirmDontShowOfferAgain:function(a,b,c){return h(g.CUSTOM_LINK,{"link-name":g.DONT_SHOW_OFFER_AGAIN,"offer-template-number":a,"offer-status":b,"offer-name":c}),e.OmnitureUtil},trackClickSaveOfferForNextWeek:function(a,b,c){return h(g.CUSTOM_LINK,{"link-name":g.CLICK_SAVE_OFFER_FOR_NEXT_WEEK,"offer-template-number":a,"offer-status":b,"offer-name":c}),e.OmnitureUtil},trackConfirmSaveOfferForNextWeek:function(a,b,c){return h(g.CUSTOM_LINK,{"link-name":g.SAVE_OFFER_FOR_NEXT_WEEK,"offer-template-number":a,"offer-status":b,"offer-name":c}),e.OmnitureUtil},trackLoginSuccess:function(){return h(g.CUSTOM_LINK,{"link-name":g.LOGIN_SUCCESS}),e.OmnitureUtil},trackLogout:function(){return h(g.CUSTOM_LINK,{"link-name":g.LOGOUT}),e.OmnitureUtil},trackViewOfferDetails:function(a,b,c){return h(g.CUSTOM_LINK,{"link-name":g.VIEW_OFFER_DETAILS,"offer-template-number":a,"offer-status":b,"offer-name":c}),e.OmnitureUtil}}}(this),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").BlogPost=b.Model.extend({defaults:{description:"",description_short:"",small_image:{},large_image:{},path:"",title:""},initialize:function(){this.preload_small_image=null,this.preload_large_image=null},isSmallImagePreloaded:function(){return this._isImageLoaded.call(this,this.preload_small_image)},isLargeImagePreloaded:function(){return this._isImageLoaded.call(this,this.preload_large_image)},parse:function(a){var b=this.path_prefix||"/";return{id:a.FriendlyUrlName,description:a.Content,description_short:this._stripOuterTags(a.Summary),date:this._parseDate(a.PublicationDate),small_image:this._parseImage(a.ListingImage),large_image:this._parseImage(a.HeroImage),path:b+(a.FriendlyUrlName||"").toLowerCase(),title:a.Title}},_parseDate:function(a){if(!a)return"";a.length>10&&(a=a.substring(0,10));var b=a.split("-");if(b.length<3)return"";var c=new Date(b[0],b[1]-1,b[2]);return isNaN(c.getTime())?"":c.format("%b %r %Y")},_isImageLoaded:function(a){return!_.isNull(a)&&"resolved"===a.promise().state()},_parseImage:function(a){return a&&a.URL?{alt:a.Label||"",src:a.URL||""}:null},_stripOuterTags:function(a){return a.replace(/^<(?:div|p)[^>]*?>([^<]*?)<\/(?:div|p)>$/gi,"$1")},_preloadImage:function(a,b){if(!_.isNull(b))return b.promise();var c,d;return b=new $.Deferred,_.isNull(a)?b.reject():(c=new Image,c.src=a.src,d=$(c),c.onerror=function(){b.reject()},d.one("load",function(){b.resolve(d)})),b.promise()},preloadSmallImage:function(){return this._preloadImage.call(this,this.get("small_image"),this.preload_small_image)},preloadLargeImage:function(){return this._preloadImage.call(this,this.get("large_image"),this.preload_large_image)}})}(this),function(a){"use strict";var b=a.Backbone,c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Components.Blog"),e=d.BlogPost;d.BlogPostCollection=b.Collection.extend({model:e,initialize:function(a,b){b=b||{},this.url=b.url||_.noop},parse:function(a){return a.Articles},fetch:function(a){return b.Collection.prototype.fetch.call(this,a)}})}(this),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").BlogHeader=b.Model.extend({defaults:{is_categories_visible:!1},toggleIsCategoriesVisible:function(){var a=this.get("is_categories_visible");this.set("is_categories_visible",!a)}})}(this),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").Category=b.Model.extend({idAttribute:"category_id"})}(this),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").Pagination=b.Model.extend({defaults:{num_results_per_page:10,num_total_results:0,page_num:1},getNumTotalPages:function(){var a=this.get("num_total_results"),b=this.get("num_results_per_page");return 0===b?1:Math.max(Math.ceil(a/b),1)},incrementPage:function(){var a=this.get("page_num");a!==this.getNumTotalPages()&&this.set("page_num",a+1)},decrementPage:function(){var a=this.get("page_num");1!==a&&this.set("page_num",a-1)},hasNext:function(){return this.get("page_num")<this.getNumTotalPages()},hasPrev:function(){return this.get("page_num")>1}})}(this),function(a){"use strict";var b=a.Backbone,c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Components.Blog"),e=d.Category;d.CategoryCollection=b.Collection.extend({model:e})}(this),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").SortTypeCollection=b.Collection.extend({model:b.Model,getDefault:function(){return this.findWhere({is_default:!0})||this.first()}})}(this),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").Router=b.Router.extend({routes:{search:"search","*category":"category"}})}(this),function(a){"use strict";var b=a.Backbone,c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Components.Blog"),e=d.BlogPost,f=d.Category,g=d.CategoryCollection,h=d.Pagination,i=d.SortTypeCollection,j=a.localStorage;d.BlogListing=b.Model.extend({defaults:{category_id:null,has_fetched:!1,homepage_title:"",sort_type:null,search_term:null,sticky_post:null},initialize:function(a){var b,c="BEAUTY_BLOG.sort-type";this.destination_id=a.destination_id||"",this.featuredcontent_id=a.featuredcontent_id||"",this.categories=a.categories||new g([]),this.set("pagination_model",a.pagination_model||new h),this.set("posts",a.posts||new BlogPostCollection([])),this.set("sort_types",a.sort_types||new i([])),this.defaults.sort_type=this.get("sort_types").getDefault().get("type"),j&&(b=j.getItem(c))&&this.set("sort_type",b),this.on("change:category_id change:search_term change:sort_type",function(a,b,c){c.is_reset||this.fetchPosts()},this),this.listenTo(this.getPaginationModel(),"change:page_num",function(a,b,c){c.is_reset||this.fetchPosts()}),this.on("change:sort_type",function(a,b){j&&j.setItem(c,b)})},getActiveCategory:function(){return this.categories.get(this.get("category_id"))||null},getNullCategory:function(){return new f({category_id:null,path:"/",title:this.get("homepage_title")})},getPaginationModel:function(){return this.get("pagination_model")},getPosts:function(){return this.get("posts")},getStickyPost:function(){return this.get("sticky_post")},getSortType:function(){return this.get("sort_type")},resetCategoryId:function(){this.set("category_id",this.defaults.category_id,{is_reset:!0})},resetPageNum:function(){this.getPaginationModel().set("page_num",this.getPaginationModel().defaults.page_num,{is_reset:!0})},resetSearchTerm:function(){this.set("search_term",this.defaults.search_term,{is_reset:!0})},resetSortType:function(){this.set("sort_type",this.defaults.sort_type,{is_reset:!0})},setCategoryId:function(a){this.resetPageNum(),this.resetSearchTerm(),this.set("category_id",a),this.hasChanged()||this.get("has_fetched")||this.fetchPosts(),this.trigger("set-category-id",this,a)},setSearchTerm:function(a){this.resetCategoryId(),this.resetPageNum(),this.resetSortType(),this.set("search_term",a),this.trigger("set-search-term",this,a)},setSortType:function(a){a!==this.getSortType()&&(this.resetPageNum(),this.set("sort_type",a),this.trigger("set-sort-type",this,a))},fetchPosts:function(){var a=_.bind(function(a,b){this.getPaginationModel().set("num_total_results",b.TotalResults),this.set("sticky_post",b.FeaturedArticle?new e(b.FeaturedArticle,{parse:!0}):null)},this),b={CategoryId:this.get("category_id"),DestinationId:this.destination_id,FeaturedContentID:this.featuredcontent_id,Resnum:this.getPaginationModel().get("num_results_per_page"),Page:this.getPaginationModel().get("page_num"),SearchTerm:this.get("search_term"),Desc:"desc"===this.get("sort_type")};this.set("has_fetched",!0),this.getPosts().fetch({data:b,reset:!0,success:a})}})}(this),function(a){"use strict";var b=a._,c=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").BlogHeaderView=c.View.extend({initialize:function(a){this.config=b.result(a,"config",{}),this.listenTo(this.model,"change:is_categories_visible",this.updateCategoriesVisibility),this.elements={$categories_toggle_btn:this.$(this.config.selectors.categories_toggle_btn),$categories:this.$(this.config.selectors.categories),$search:this.$(this.config.selectors.search)},this.events=this.events||{},this.events["click "+this.config.selectors.categories_toggle_btn]="onCategoriesToggleBtnClick",this.events["focus "+this.config.selectors.search_term_input]="onSearchInputFocus",this.events["blur "+this.config.selectors.search_form]="onSearchFormBlur",this.delegateEvents()},onCategoriesToggleBtnClick:function(a){this.model.toggleIsCategoriesVisible(),a.preventDefault()},onSearchInputFocus:function(){this.elements.$search.toggleClass(this.config.classes.search_term_input_expanded,!0)},onSearchFormBlur:function(){this.elements.$search.toggleClass(this.config.classes.search_term_input_expanded,!1)},updateCategoriesVisibility:function(){var a=this.model.get("is_categories_visible");this.elements.$categories.slideToggle(a),this.elements.$categories_toggle_btn.toggleClass(this.config.classes.active_categories_toggle_btn,a)}})}(this),function(a){"use strict";var b=a._,c=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").CategoriesView=c.View.extend({initialize:function(a){this.config=b.result(a,"config",{}),this.listenTo(this.model,"change:category_id",this.render,this),this.events=this.events||{},this.events["click "+this.config.selectors.category_btn]="onCategoryClick",this.events["click "+this.config.selectors.clear_category_btn]="onClearClick",this.delegateEvents()},render:function(){var a=this.model.get("category_id");return b.each(this.$(this.config.selectors.category_btn),function(b){var c=$(b),d=c.data(this.config.data_attributes.category_id)===a;c.toggleClass(this.config.classes.active_category_item,d)},this),this.$(this.config.selectors.clear_category_btn).toggleClass(this.config.classes.active_category_item,b.isNull(a)),this},onCategoryClick:function(a){var b=$(a.currentTarget),c=b.data(this.config.data_attributes.category_id);this.model.setCategoryId(c),a.preventDefault()},onClearClick:function(a){this.model.setCategoryId(null),a.preventDefault()}})}(this),function(a){"use strict";var b=a._,c=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").PaginationView=c.View.extend({initialize:function(a){this.config=b.result(a,"config",{}),this.template=a.template||b.noop,this.listenTo(this.model,"change:num_total_results",this.render),this.listenTo(this.model,"change:page_num",this.render),this.events=this.events||{},this.events["click "+this.config.selectors.pagination_btn]="onPaginationBtnClick",this.events["click "+this.config.selectors.pagination_btn_next]="onNextBtnClick",this.events["click "+this.config.selectors.pagination_btn_prev]="onPrevBtnClick",this.delegateEvents()},render:function(){var a=this.model.getNumTotalPages(),c=this.model.get("page_num"),d=b.range(1,a+1);return d=b.map(d,function(b){return 1===b?b:b===a?b:b===c?b:b<=Math.max(c-2,1)+4&&b>=Math.min(c+2,a)-4?b:null}),d=b.filter(d,function(a,c){return b.isNumber(a)||b.isNumber(d[c-1])}),this.$el.html(this.template({active_page_num:c,btns:d,has_next:this.model.hasNext(),has_prev:this.model.hasPrev()})),this},onPaginationBtnClick:function(a){var b=$(a.currentTarget),c=b.data(this.config.data_attributes.pagination_btn_num);this.model.set("page_num",c),a.preventDefault()},onNextBtnClick:function(a){this.model.incrementPage(),a.preventDefault()},onPrevBtnClick:function(a){this.model.decrementPage(),a.preventDefault()}})}(this),function(a){"use strict";var b=a.jQuery,c=a.Backbone,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Components.Blog"),f=e.BlogPostCollection;e.PostsView=c.View.extend({initialize:function(a){this.template=a.template||_.noop,this.config=_.result(a,"config",{}),this.loading_html=a.loading_html||"",this.no_results_html=a.no_results_html||"",this.no_server_html=a.no_server_html||"",this.listenTo(this.collection,"error",this.renderError),this.listenTo(this.collection,"request",this.showLoading),this.listenTo(this.collection,"reset",this.render)},render:function(){return this.$el.fadeOut(this.config.speeds.fade_out,_.bind(function(){var a=new f;this.$el.empty(),this.collection.size()>0?this.collection.forEach(function(b){var c=b.isSmallImagePreloaded(),d=_.extend({},b.toJSON(),{is_image_loaded:c});c||a.add(b),this.$el.append(this.template(d))},this):_.isNull(this.model.getStickyPost())&&this.showNoResultsMessage(),this.$el.fadeIn(this.config.speeds.fade_in,_.bind(this._onFadeInDone,this,a))},this)),this},renderError:function(){this.$el.html(this.no_server_html)},showLoading:function(){this.$el.html(this.loading_html)},showNoResultsMessage:function(){this.$el.html(this.no_results_html)},_onFadeInDone:function(a){a.forEach(function(a){b.when(a.preloadSmallImage()).done(_.bind(this._onImagePreloadDone,this,a)).fail(_.bind(this._onImagePreloadFail,this,a))},this)},_onImagePreloadDone:function(a,b){var c="[data-"+this.config.data_attributes.post_id+'="'+a.id+'"]';b.addClass(this.config.classes.post_image),b.hide(),this.$(c).find(this.config.selectors.post_loading).replaceWith(b),b.fadeIn(this.config.speeds.fade_in)},_onImagePreloadFail:function(a){var b="[data-"+this.config.data_attributes.post_id+'="'+a.id+'"]';this.$(b).find(this.config.selectors.post_loading).fadeOut(this.config.speeds.fade_out)}})}(this),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").SearchView=b.View.extend({initialize:function(a){this.config=_.result(a,"config",{}),this.listenTo(this.model,"change:search_term",this.render),this.elements={$search_term_input:this.$(this.config.selectors.search_term_input)},this.events=this.events||{},this.events["submit "+this.config.selectors.search_form]="onFormSubmit",this.delegateEvents()},render:function(){var a=this.model.get("search_term");return this.elements.$search_term_input.val(a),this},onFormSubmit:function(a){var b=this.$(this.config.selectors.search_term_input),c=b.val();this.model.setSearchTerm(c),a.preventDefault()}})}(this),function(a){"use strict";var b=a._,c=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").SearchStatusView=c.View.extend({initialize:function(a){this.config=b.result(a,"config",{}),this.template=a.template||b.noop,this.listenTo(this.model,"change:search_term",this.render),this.events=this.events||{},this.events["click "+this.config.selectors.search_clear_btn]="onClearSearchClick",this.delegateEvents()},render:function(){var a=this.model.get("search_term");return a?this.$el.html(this.template({search_term:a})):this.$el.empty(),this},onClearSearchClick:function(a){this.model.setSearchTerm(null),a.preventDefault()}})}(window),function(a){"use strict";var b=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").SortView=b.View.extend({initialize:function(a){this.config=_.result(a,"config",{}),this.listenTo(this.model,"change:sort_type",this.render),this.events=this.events||{},this.events["click "+this.config.selectors.sort_btn]="onSortTypeClick",this.delegateEvents()},render:function(){var a=this.model.get("sort_type");return _.each(this.$(this.config.selectors.sort_btn),function(b){var c=$(b),d=c.data(this.config.data_attributes.sort_btn_type)===a;c.toggleClass(this.config.classes.active_sort_item,d)},this),this},onSortTypeClick:function(a){var b=$(a.currentTarget),c=b.data(this.config.data_attributes.sort_btn_type);b.hasClass(this.config.classes.active_sort_item)||this.model.setSortType(c),a.preventDefault()}})}(this),function(a){"use strict";var b=a.jQuery,c=a._,d=a.Backbone;(a.NR||(a.NR={})).resolve("SDM.Core.Components.Blog").StickyPostView=d.View.extend({initialize:function(a){this.config=c.result(a,"config",{}),this.template=a.template||c.noop,this.listenTo(this.model,"change:sticky_post",this.render)},render:function(){var a=this.model.get("sticky_post");if(c.isNull(a))this.empty();else{var d=a.isLargeImagePreloaded(),e=c.extend({},a.toJSON(),{is_large_image_preloaded:d});this.$el.hide(),d||b.when(a.preloadLargeImage()).done(c.bind(this._onLargeImagePreloadDone,this)).fail(c.bind(this._onLargeImagePreloadFail,this)),this.$el.html(this.template(e)),this.$el.fadeIn(this.config.speeds.fade_in)}return this},empty:function(){this.$el.empty()},_onLargeImagePreloadDone:function(a){a.hide(),this.$(this.config.selectors.sticky_post_image_loading).replaceWith(a),a.fadeIn(this.config.speeds.fade_in)},_onLargeImagePreloadFail:function(){this.$(this.config.selectors.sticky_post_image_loading).fadeOut(this.config.speeds.fade_out)}})}(this),function(a){"use strict";var b=a.jQuery,c=a.Backbone,d=a.TweenLite,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Components.Blog"),g=f.BlogHeader,h=f.BlogHeaderView,i=f.CategoriesView,j=f.PaginationView,k=f.PostsView,l=f.SearchView,m=f.SearchStatusView,n=f.SortView,o=f.StickyPostView;f.BlogListingView=c.View.extend({initialize:function(a){var b=this.model.get("posts");this.config=_.result(a,"config",{}),this.categories_view=new i({el:this.$(this.config.selectors.categories).get(0),config:this.config,model:this.model}),this.pagination_view=new j({el:this.$(this.config.selectors.pagination).get(0),config:this.config,model:this.model.get("pagination_model"),template:_.template(this.$(this.config.selectors.pagination_template).html())}),this.posts_view=new k({collection:b,model:this.model,el:this.$(this.config.selectors.posts).get(0),template:_.template(this.$(this.config.selectors.post_template).html()),loading_html:this.$(this.config.selectors.posts_loading_template).html(),no_results_html:this.$(this.config.selectors.no_results_template).html(),no_server_html:this.$(this.config.selectors.no_server_template).html(),config:this.config}),this.search_view=new l({el:this.$(this.config.selectors.search).get(0),config:this.config,model:this.model}),this.sort_view=new n({el:this.$(this.config.selectors.sort_types).get(0),config:this.config,model:this.model}),this.sticky_post_view=new o({el:this.$(this.config.selectors.sticky_post).get(0),config:this.config,model:this.model,template:_.template(this.$(this.config.selectors.sticky_post_template).html())}),this.blog_header_view=new h({el:this.$(this.config.selectors.header).get(0),model:new g,config:this.config}),this.search_status_view=new m({el:this.$(this.config.selectors.search_status).get(0),config:this.config,model:this.model,template:_.template(this.$(this.config.selectors.search_status_template).html())}),this.listenTo(this.model,"change:category_id",this.renderTitle),this.elements={$body:this.$(this.config.selectors.body),$categories_toggle_btn:this.$(this.config.selectors.categories_toggle_btn),$title:this.$(this.config.selectors.title)},
this.listenTo(b,"request",this._onPostsRequest),this.events=this.events||{},this.events["click "+this.config.selectors.categories_toggle_btn]="onCategoriesToggleBtnClick",this.delegateEvents()},render:function(){return this.categories_view.render(),this.sort_view.render(),this.renderTitle(),this.model.get("search_term")&&(this.search_view.render(),this.search_status_view.render()),this},renderTitle:function(){var a=this.model.getActiveCategory(),b=a?a.get("title"):this.model.get("homepage_title");return this.elements.$title.text(b),this},_onPostsRequest:function(){var a,c=70;this.sticky_post_view.empty(),a=this.elements.$body.offset().top-c,d.to(b("body, html"),this.config.speeds.scroll_duration,{scrollTop:a})}})}(this),function(a){(a.NR||(a.NR={})).resolve("SDM.Core.Components.BrooklynAuth").ErrorCodes={NETWORK_ERROR:"network-error",SERVER_ERROR:"server-error"}}(this),function(a){"use strict";var b=a.jQuery,c=a._,d=a.NR||(a.NR={}),e=d.resolve("SDM"),f=d.resolve("SDM.Core.Components.BrooklynAuth"),g=d.resolve("SDM.Core.Components.BrooklynAuth.Settings"),h=f.ErrorCodes,i=((a.location.hostname||"").indexOf("pharmaprix"),"showSdmConvertPopup");f.Repository={getUserEmail:function(){var a=new b.Deferred,d=g.protegrityDomain.replace("{{LANG}}",e.Util.getShortLanguageCode());return b.ajax({cache:!1,xhrFields:{withCredentials:!0},dataType:"json",crossDomain:!0,headers:{"X-Requested-With":"XMLHttpRequest"},type:"GET",url:d}).done(function(b){c.isEmpty(b.Email)?a.reject(h.SERVER_ERROR):a.resolve(b.Email)}).fail(function(b,c,d){console.log(d||c),a.reject(h.NETWORK_ERROR)}),a},hasViewedConvertPopUp:function(){return!c.isEmpty(localStorage.getItem(i))},setHasViewedConvertPopUp:function(){localStorage.setItem(i,!0)},getRefreshedPointsAsync:function(){var a=new b.Deferred;return b.ajax({cache:!1,xhrFields:{withCredentials:!0},dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"},type:"GET",url:"/Brooklyn/RefreshBrooklynPoints"}).done(function(b){c.isNumber(b)&&b>-1?a.resolve(b):a.reject(h.SERVER_ERROR)}).fail(function(b,c,d){console.log(d||c),a.reject(h.NETWORK_ERROR)}),a.promise()},getOktaConfigurationAsync:function(){var a=new b.Deferred;return b.ajax({cache:!1,dataType:"json",type:"GET",url:"/brooklyn/oktaconfiguration"}).done(function(b){a.resolve(b)}).fail(function(){a.reject(h.NETWORK_ERROR)}),a.promise()}}}(this),function(){this.NR.resolve("SDM.Core.Components.OptimumResponseCodes").Codes={Success:"901",Error:"902",ErrorFatal:"903",UnAuthorized:"904",ReAuthenticate:"905",InvalidField:"906",AccountInactive:"907",AccountLocked:"908",InvalidPassword:"909",Redirect:"910",PasswordReset:"911",InvalidCardNumber:"001",PasswordDoesNotExist:"002",LoginUserLocked:"003",ValidateSuccess:"101",ValidateFail:"102",ValidateLocked:"103",ActivateSuccess:"104",JoinSuccess:"201",TransferSuccess:"301",AddOrRemove:"401"}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Components"),f=d.resolve("SDM.QuickSearchFrequencyDelay"),g=e.Autocomplete=function(a,b){var d={namespace:"autocomplete",min_length:1,show_loading:!1,show_no_result_message:!1,submit_on_enter:!1,input:"[data-widget-autocomplete-input]",template:"[data-widget-autocomplete-template]",loading_template:"",no_result_template:"",fetch_error_html:"",container:"[data-widget-autocomplete-container]",result_list:"[data-widget-autocomplete-list]",result_item:"[data-widget-autocomplete-item]",open_class:"open",selected_class:"selected",on_chose_callback:null,on_select_callback:null,on_chose_clicked_callback:null,fetch_callback:null,focus_callback:null,exit_callback:null,can_fetch_data:null};this.$module=a||c(window),this.config=c.extend(!0,d,b||{}),this._initialize()};g.prototype._initialize=function(){this._setInstanceVars(),this._bindStartEvents()},g.prototype._setInstanceVars=function(){this.$input=this.$module.find(this.config.input),this.$container=this.$module.find(this.config.container)},g.prototype._bindStartEvents=function(){var a=b(this._onInput).bind(this),c=b(this._onFocus).bind(this),d=b(this._choseClicked).bind(this),e=b(this._onBlur).bind(this),f=b(this._stopEnter).bind(this);this.$container.off("click."+this.config.namespace).on("click."+this.config.namespace,this.config.result_item,d),this.$input.off("keyup."+this.config.namespace).on("keyup."+this.config.namespace,a),this.config.submit_on_enter||this.$input.off("keydown."+this.config.namespace).on("keydown."+this.config.namespace,f),this.$input.off("focus."+this.config.namespace).on("focus."+this.config.namespace,a),this.$input.off("blur."+this.config.namespace).on("blur."+this.config.namespace,e),this.$input.off("focus."+this.config.namespace+"start").on("focus."+this.config.namespace+"start",c)},g.prototype._onInput=function(a){switch(a.keyCode){case 13:a.preventDefault(),this._choseSelected(),a.stopPropagation();break;case 38:a.preventDefault(),this._selectPrevious();break;case 40:a.preventDefault(),this._selectNext();break;case 9:this._isOpen()&&this._choseSelected();break;case 27:this._closeAutocomplete();break;default:this._searchOnInput()}},g.prototype._searchOnInput=function(){clearTimeout(this.timeoutSearchOnInput),this.timeoutSearchOnInput=setTimeout(function(){(this.search_term=this.$input.val(),this.search_term.length>=this.config.min_length)?(!b.isFunction(this.config.can_fetch_data)||this.config.can_fetch_data(event,this.search_term))&&this._fetchData():this._closeAutocomplete()}.bind(this),f)},g.prototype._stopEnter=function(a){switch(a.keyCode){case 13:a.preventDefault(),a.stopPropagation()}},g.prototype._onFocus=function(){var a=this.config.focus_callback;b.isFunction(a)&&a.call(this)},g.prototype._onBlur=function(){if(!this._isOpen()){var a=this.config.exit_callback;b.isFunction(a)&&a.call(this)}},g.prototype._fetchData=function(){this.config.show_loading&&this._showLoading();var a=this.config.fetch_callback;if(b.isFunction(a)){var d=a.call(this,this.search_term),e=b(this._renderAutocomplete).bind(this);c.when(d).done(e).fail(b.bind(this._showFetchErrorMessage,this))}},g.prototype._showLoading=function(){var a=b.template(c(this.config.loading_template).html()),d=a();this.$container.html(d),this._openAutocomplete()},g.prototype._showNoResultMessage=function(){var a=b.template(c(this.config.no_result_template)),d=a();this.$container.html(d),this._openAutocomplete()},g.prototype._showFetchErrorMessage=function(){b.isEmpty(this.config.fetch_error_html)||this.$container.html(this.config.fetch_error_html)},g.prototype._renderAutocomplete=function(a){if(a){var d=b.template(c(this.config.template).html()),e=d(a);this.$container.html(e),this._openAutocomplete()}else this.config.show_no_result_message?this._showNoResultMessage():this._closeAutocomplete()},g.prototype._openAutocomplete=function(){var a=this.config.open_class;this._isOpen()||(this.$container.addClass(a),this._bindExitEvent())},g.prototype._closeAutocomplete=function(){var a=this.config.open_class;this._isOpen()&&(this.$container.removeClass(a),this._removeExitEvent())},g.prototype._bindExitEvent=function(){c(window).on("click."+this.config.namespace,b.bind(function(a){if(0===this.$module.find(a.target).length){this._closeAutocomplete();var c=this.config.exit_callback;b.isFunction(c)&&c.call(this)}},this))},g.prototype._removeExitEvent=function(){c(window).off("click."+this.config.namespace)},g.prototype._choseSelected=function(){var a=this._getSelectedItem();if(a.length>0){var c=this.config.on_chose_callback;b.isFunction(c)&&c.call(this,a)}this._closeAutocomplete()},g.prototype._choseClicked=function(a){var d=c(a.currentTarget),e=this.config.on_chose_callback,f=this.config.on_chose_clicked_callback;b.isFunction(e)&&e.call(this,d),b.isFunction(f)&&f.call(this,d),this._closeAutocomplete()},g.prototype._selectNext=function(){var a=this._getSelectedItem(),b=null;a.length>0?(b=a.nextAll(this.config.result_item).first(),b.length>0&&(this._unSelectItem(a),this._selectItem(b))):(b=this.$container.find(this.config.result_item).first(),this._selectItem(b))},g.prototype._selectPrevious=function(){var a=this._getSelectedItem(),b=null;a.length>0&&(b=a.prevAll(this.config.result_item).first(),this._unSelectItem(a),this._selectItem(b))},g.prototype._selectItem=function(a){a.addClass(this.config.selected_class);var c=this.config.on_select_callback;b.isFunction(c)?c.call(this,a,this.search_term):a.length>0?this.$input.val(a.text().trim()):this.$input.val(this.search_term)},g.prototype._unSelectItem=function(a){a.removeClass(this.config.selected_class)},g.prototype._getSelectedItem=function(){return this.$container.find(this.config.result_item).filter("."+this.config.selected_class)},g.prototype._isOpen=function(){var a=this.config.open_class;return this.$container.hasClass(a)},g.prototype.close=function(){this._closeAutocomplete()},g.prototype.open=function(){this._openAutocomplete()},g.prototype.isEmpty=function(){return 0===this.$container.find(this.config.result_item).length}}.call(this),function(){this.formatNumber=function(a,b){var c=/\B(?=(\d{3})+(?!\d))/g,d={en:",",fr:" "};return a.toString().replace(c,d[b]||"")}}.call(this),function(){this.NR.resolve("SDM.Core.Components").OptimumMod10Validation=function(a){for(var b=a.split(""),c=parseInt(b[a.length-1],10),d=9,e=0,f=0;f<a.length-1;f++)e+=parseInt(b[f],10)*d--;e=e.toString();var g=parseInt(e.charAt(e.length-1),10);return 0!==g&&(g=10-g),g===c}}.call(this),function(){var a=this,b=a._,c=(a.jQuery,a.Backbone),d=a.NR,e=d.resolve("SDM.Core.Components.Coupon"),f={UNLOADED:"unloaded",LOADED:"loaded",REDEEMED:"redeemed"},g={LOADING_START:"loading-start",LOADING_COMPLETE:"loading-complete",LOADING_FAIL:"loading-fail",UNLOADING_START:"unloading-start",UNLOADING_COMPLETE:"unloading-complete",UNLOADING_FAIL:"unloading-fail",LOADING_ERROR:"loading-error",UNLOADING_ERROR:"unloading-error"},h=e.CouponModel=c.Model.extend({idAttribute:"CouponId",initialize:function(){this.language=SDM.Util.getShortLanguageCode(),this.on("change:_load_status",this._onLoadStatusChanged,this),this.on("change:_load_progress_status",this._onLoadProgressStatusChanged,this),this.expiry_date_format="fr"===this.language?"%r %b":"%b %r",this.flash_date_format="fr"===this.language?"%a. %r %b":"%a, %b %r",this.preview_date_format="fr"===this.language?"%r %B":"%B %r",this.long_date_format="fr"===this.language?"%A %r %B":"%A, %B %r"},set:function(a,d){return void 0===a.isFlash||b(a.isFlash).isBoolean()||(a.isFlash="true"===a.isFlash),void 0===a.Popularity||b(a.Popularity).isNumber()||(a.Popularity=parseInt(a.Popularity,10)),void 0===a.DollarValue||b(a.DollarValue).isNumber()||(a.DollarValue=parseFloat(a.DollarValue)),void 0===a.CouponId||b(a.CouponId).isNumber()||(a.CouponId=parseInt(a.CouponId,10)),void 0===a.PosStartDate||a.PosStartDate instanceof Date||(a.PosStartDate=new Date(a.PosStartDate)),void 0===a.PosEndDate||a.PosEndDate instanceof Date||(a.PosEndDate=new Date(a.PosEndDate)),void 0===a.DisplayStartDate||a.DisplayStartDate instanceof Date||(a.DisplayStartDate=new Date(a.DisplayStartDate)),void 0===a.DisplayEndDate||a.DisplayEndDate instanceof Date||(a.DisplayEndDate=new Date(a.DisplayEndDate)),void 0===a.RewardDateAvailable||a.RewardDateAvailable instanceof Date||(a.RewardDateAvailable=new Date(a.RewardDateAvailable)),void 0===a.EligibleSpend||b(a.EligibleSpend).isNumber()||(a.EligibleSpend=parseFloat(a.EligibleSpend)),void 0===a.RequiredSpend||b(a.RequiredSpend).isNumber()||(a.RequiredSpend=parseFloat(a.RequiredSpend)),void 0!==a.Savings&&(a.SavingsAmount=parseFloat(a.Savings.SavingsAmount),a.SavingsAmount=b(a.SavingsAmount).isNaN()?0:a.SavingsAmount,a.SavingsType=a.Savings.SavingsType,a.SavingsText=a.Savings.SavingsText,delete a.Savings),void 0!==a.Tag&&(a.TagBgColor=a.Tag.BgColor,a.TagFgColor=a.Tag.FgColor,a.TagName=a.Tag.Name,delete a.Tag),a.ContinuityOptInAnimated=!1,c.Model.prototype.set.call(this,a,d)},_onLoadStatusChanged:function(){this.isLoaded()?this.trigger("_loaded",this):this.isUnloaded()&&this.trigger("_unloaded",this)},_onLoadProgressStatusChanged:function(){this.get("_load_progress_status")===g.LOADING_START?this.trigger("_loading_start",this):this.get("_load_progress_status")===g.LOADING_COMPLETE?this.trigger("_loading_complete",this):this.get("_load_progress_status")===g.LOADING_FAIL?this.trigger("_loading_fail",this):this.get("_load_progress_status")===g.UNLOADING_START?this.trigger("_unloading_start",this):this.get("_load_progress_status")===g.UNLOADING_COMPLETE?this.trigger("_unloading_complete",this):this.get("_load_progress_status")===g.UNLOADING_FAIL&&this.trigger("_unloading_fail",this)},getId:function(){return this.id},getShortDescription:function(){return this.get("ShortDescription")},getRequirementDescription:function(){return this.isContinuityOptIn()&&"fr"===this.language?this.get("RequirementDescription").replace(/(\d+)\s\$/g,"$1&nbsp;$"):this.get("RequirementDescription")},getOfferType:function(){return this.getSavingsText()},getBrands:function(){return this.get("Brands")},getCategories:function(){return this.get("Categories")},getDollarValue:function(){return this.get("DollarValue")},getPopularity:function(){return this.get("Popularity")},getRelevance:function(){return this.get("Relevance")},getImage:function(){return this.get("Image")},getPosStartDate:function(){return this.get("PosStartDate")},getPosEndDate:function(){return this.get("PosEndDate")},getPosEndDateTimeStamp:function(){return this.getPosEndDate().getTime()},getDisplayStartDate:function(){return this.get("DisplayStartDate")},getDisplayEndDate:function(){return this.get("DisplayEndDate")},getExpiryDate:function(){return this.isContinuityOptIn()?this.getDisplayEndDate().format(this.expiry_date_format,this.language):this.getPosEndDate().format(this.expiry_date_format,this.language)},getPreviewStartDate:function(){return this.getPosStartDate().format(this.preview_date_format,this.language)},getPreviewEndDate:function(){return this.getPosEndDate().format(this.preview_date_format,this.language)},getFlashStartDate:function(){return this.getPosStartDate().format(this.flash_date_format,this.language)},getFlashEndDate:function(){var a=(this.language,"%i%p"),b="fr"===this.language?"-":" - ",c=this.getPosStartDate(),d=this.getPosEndDate();return c.format(a,this.language)+b+d.format(a,this.language)},getValidFromDate:function(){return this.getPosStartDate().format(this.long_date_format,this.language)},getValidToDate:function(){return this.isContinuityOptIn()?this.getDisplayEndDate().format(this.long_date_format,this.language):this.getPosEndDate().format(this.long_date_format,this.language)},getLegal:function(){return this.get("LongDescription")},getCouponColor:function(){return this.get("CouponColor")},getSavingsAmount:function(){return this.get("SavingsAmount")},getSavingsType:function(){return this.get("SavingsType")},getSavingsText:function(){return this.get("SavingsText")},getTagBgColor:function(){return this.get("TagBgColor")},getTagFgColor:function(){return this.get("TagFgColor")},getTagName:function(){return this.get("TagName")},getContinuityOptInProgress:function(){var a=Math.floor(this.get("EligibleSpend")/this.get("RequiredSpend")*100);return Math.min(a,100)},getContinuityOptInRemainingAmount:function(){return this.get("RemainingAmount")},getContinuityOptInRewardDateAvailable:function(){var a=new Date(this.getDisplayEndDate().getTime());return a.setDate(a.getDate()+1),a.format(this.expiry_date_format,this.language)},setLoadStatus:function(a){this.set("_load_status",a)},setLoadProgressStatus:function(a){this.set("_load_progress_status",a)},hasDetail:function(){return!!this.getShortDescription()},hasContinuityOptInDetails:function(){return Boolean(b.isDate(this.get("RewardDateAvailable"))&&!b.isEmpty(this.get("RemainingAmount"))&&b.isNumber(this.get("EligibleSpend"))&&b.isNumber(this.get("RequiredSpend")))},hasTag:function(){return this.getTagBgColor()&&this.getTagFgColor()&&this.getTagName()},isUnloaded:function(){return this.get("_load_status")===f.UNLOADED},isLoaded:function(){return this.get("_load_status")===f.LOADED},isRedeemed:function(){return this.get("_load_status")===f.REDEEMED},isReward:function(){return this.get("IsReward")},isExclusive:function(){return this.get("IsExclusive")},isFlash:function(){return this.get("IsFlash")},isFeatured:function(){return this.get("Featured")},isPreview:function(){var a=new Date(this.getDisplayStartDate().getTime()),b=new Date,c=new Date(this.getPosStartDate().getTime());return a.setHours(0,0,0,0),b.setHours(0,0,0,0),c.setHours(0,0,0,0),a.getTime()<=b.getTime()&&b.getTime()<c.getTime()&&!this.isFlash()},isContinuityOptIn:function(){return this.get("IsContinuityOptIn")},isContinuityReward:function(){return this.get("IsReward")},hasContinuityOptInAnimated:function(){return this.get("ContinuityOptInAnimated")},setContinuityOptInAnimated:function(a){this.set("ContinuityOptInAnimated",a)},onLoaded:function(a,b){this.on("_loaded",a,b)},onUnloaded:function(a,b){this.on("_unloaded",a,b)},onLoadingStart:function(a,b){this.on("_loading_start",a,b)},onLoadingComplete:function(a,b){this.on("_loading_complete",a,b)},onLoadingFail:function(a,b){this.on("_loading_fail",a,b)},onUnloadingStart:function(a,b){this.on("_unloading_start",a,b)},onUnloadingComplete:function(a,b){this.on("_unloading_complete",a,b)},onUnloadingFail:function(a,b){this.on("_unloading_fail",a,b)},offLoaded:function(a,b){this.off("_loaded",a,b)},offUnloaded:function(a,b){this.off("_unloaded",a,b)},offLoadingStart:function(a,b){this.off("_loading_start",a,b)},offLoadingComplete:function(a,b){this.off("_loading_complete",a,b)},offLoadingFail:function(a,b){this.off("_loading_fail",a,b)},offUnloadingStart:function(a,b){this.off("_unloading_start",a,b)},offUnloadingComplete:function(a,b){this.off("_unloading_complete",a,b)},offUnloadingFail:function(a,b){this.off("_unloading_fail",a,b)},onImageChanged:function(a,b){this.on("change:Image",a,b)},getViewModel:function(){var a={isPreview:this.isPreview(),isFlash:this.isFlash(),isLoaded:this.isLoaded(),isRedeemed:this.isRedeemed(),isContinuityOptIn:this.isContinuityOptIn(),isContinuityReward:this.isContinuityReward(),hasContinuityOptInAnimated:this.hasContinuityOptInAnimated(),hasContinuityOptInDetails:this.hasContinuityOptInDetails(),hasTag:this.hasTag(),expiryDate:this.getExpiryDate(),previewStartDate:this.getPreviewStartDate(),previewEndDate:this.getPreviewEndDate(),flashStartDate:this.getFlashStartDate(),flashEndDate:this.getFlashEndDate(),validFromDate:this.getValidFromDate(),validToDate:this.getValidToDate(),tagName:this.getTagName(),tagBgColor:this.getTagBgColor(),tagFgColor:this.getTagFgColor(),couponImage:this.getImage(),couponColor:this.getCouponColor(),couponShortDescription:this.getShortDescription(),couponRequirementDescription:this.getRequirementDescription(),couponLegal:this.getLegal()};return this.hasContinuityOptInDetails()&&(a.continuityOptInProgress=this.getContinuityOptInProgress(),a.continuityOptInRemainingAmount=this.getContinuityOptInRemainingAmount(),a.continuityOptInRewardDateAvailable=this.getContinuityOptInRewardDateAvailable()),a}});h.LOAD_STATUS=f,h.LOAD_PROGRESS_STATUS=g}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR,e=d.resolve("SDM.Core.Components.Coupon"),f=d.resolve("SDM.Core.Components"),g=d.resolve("SDM.Core.Components.EventHub"),h=f.OptimumResponseCodes,i=e.CouponModel,j=c(c("[data-widget-coupon-list-csrf-token]").html()).val(),k={_getSimpleDataAjaxOptions:function(a){var b={UTCMinutesOffset:(new Date).getTimezoneMinuteOffset()};return{type:"GET",url:"//"+document.location.host+"/"+a+"/optimum/getallcoupons?"+c.param(b),cache:!1,dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"}}},_getDetailDataFetchOptions:function(a,b){var d={Ids:a.join(","),UTCMinutesOffset:(new Date).getTimezoneMinuteOffset()};return{type:"GET",url:"//"+document.location.host+"/"+b+"/optimum/getcoupondetails?"+c.param(d),cache:!1,dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"}}},_getCouponFetchOptions:function(a,b){return{cache:!1,data:{id:a},dataType:"json",headers:{__RequestVerificationToken:j,"X-Requested-With":"XMLHttpRequest"},type:"POST",url:"//"+document.location.host+"/"+b+"/optimum/getcouponbyid"}},_getContinuityOptInDetailsFetchOptions:function(a){return{cache:!1,dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"},type:"GET",url:"//"+document.location.host+"/"+a+"/optimum/getcontinuityoffer"}},load:function(a,d){var e={Ids:a.join(","),UTCMinutesOffset:(new Date).getTimezoneMinuteOffset()},f="//"+document.location.host+"/"+d+"/optimum/addtocard";return c.ajax({type:"POST",data:e,dataType:"json",cache:!1,headers:{__RequestVerificationToken:j,"X-Requested-With":"XMLHttpRequest"},url:f}).then(b(function(a){switch(a.Code){case h.Codes.UnAuthorized:window.location=a.Msg;break;default:return g.fire("COUPON_LOADED"),a.CouponIDs?b(a.CouponIDs.split(",")).map(function(a){return parseInt(a,10)}):[]}}).bind(this)).promise()},unload:function(a,d){var e={Ids:a.join(","),UTCMinutesOffset:(new Date).getTimezoneMinuteOffset()},f="//"+document.location.host+"/"+d+"/optimum/removefromcard";return c.ajax({type:"POST",data:e,dataType:"json",cache:!1,headers:{__RequestVerificationToken:j,"X-Requested-With":"XMLHttpRequest"},url:f}).promise().then(b(function(a){switch(a.Code){case h.Codes.UnAuthorized:window.location=a.Msg;break;default:return a.CouponIDs?b(a.CouponIDs.split(",")).map(function(a){return parseInt(a,10)}):[]}}).bind(this))},fetchSimpleData:function(a){return c.ajax(this._getSimpleDataAjaxOptions(a))},fetchDetails:function(a,b){return c.ajax(this._getDetailDataFetchOptions(a,b))},fetchCoupon:function(a,b){return c.ajax(this._getCouponFetchOptions(a,b))},fetchContinuityOptInDetails:function(a){return c.ajax(this._getContinuityOptInDetailsFetchOptions(a))}};e.CouponGateway={_simpleDataDeferred:null,_detailsDeferred:{},_cachedSimpleData:null,_cachedDetails:{},_parseCouponList:function(a){var c=[],d=0,e=a.AllCoupons||[],f=a.LoadedCoupons||[],g=a.RedeemedCoupons||[],h=function(a){var b=a.getDay(),c=(b+1)%7,d=new Date(a.getFullYear(),a.getMonth(),a.getDate());return d.setDate(d.getDate()-c),d},j=function(a){if(!a.IsContinuityOptIn)return!0;if(b.isEmpty(a.DisplayEndDate))return!1;var c=new Date;return new Date(a.DisplayEndDate).getTime()>=c.getTime()},k=function(a,c){return!b.isEmpty(a.PosStartDate)&&new Date(a.PosStartDate).getTime()>=c.getTime()},l=h(new Date);b.each(b.filter(e,j),function(a){a._load_status=i.LOAD_STATUS.UNLOADED,a.Relevance=d,c.push(a),d+=1}),b.each(b.filter(f,j),function(a){a._load_status=i.LOAD_STATUS.LOADED,a.Relevance=d,c.push(a),d+=1}),b.each(b.filter(g,j),function(a){a._load_status=i.LOAD_STATUS.REDEEMED,a.Relevance=d,c.push(a),d+=1});var m=b.reduce(c,function(a,b){return a.TotalCoupons+=1,b._load_status===i.LOAD_STATUS.UNLOADED?(a.AllCoupons+=1,k(b,l)&&(a.NewCoupons+=1,b.IsExclusive&&(a.NewExclusive+=1))):b._load_status===i.LOAD_STATUS.LOADED?a.LoadedCoupons+=1:(b._load_status=i.LOAD_STATUS.REDEEMED)&&(a.RedeemedCoupons+=1),a},{AllCoupons:0,LoadedCoupons:0,RedeemedCoupons:0,TotalCoupons:0,NewCoupons:0,NewExclusive:0});return{Coupons:c,CouponCounts:m}},load:function(a,c){return b(a).each(function(a){a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.LOADING_START)}),k.load(b(a).map(function(a){return a.getId()}),c).done(b(function(c){b(a).each(function(a){b(c).contains(a.getId())?(a.setLoadStatus(i.LOAD_STATUS.LOADED),a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.LOADING_COMPLETE)):a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.LOADING_FAIL)})}).bind(this)).fail(b(function(){b(a).each(function(a){a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.UNLOADING_FAIL)})}).bind(this))},unload:function(a,c){return b(a).each(function(a){a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.UNLOADING_START)}),k.unload(b(a).map(function(a){return a.getId()}),c).done(b(function(c){b(a).each(function(a){b(c).contains(a.getId())?(a.setLoadStatus(i.LOAD_STATUS.UNLOADED),a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.UNLOADING_COMPLETE)):a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.UNLOADING_FAIL)})}).bind(this)).fail(b(function(){b(a).each(function(a){a.setLoadProgressStatus(i.LOAD_PROGRESS_STATUS.UNLOADING_FAIL)})}).bind(this))},fetchSimpleData:function(a){return this._simpleDataDeferred?this._cachedSimpleData&&this._simpleDataDeferred.resolve(this._cachedSimpleData):(this._simpleDataDeferred=c.Deferred(),k.fetchSimpleData(a).then(b(this._parseCouponList).bind(this)).done(b(function(a){this._cachedSimpleData=a,this._simpleDataDeferred.resolve(this._cachedSimpleData)}).bind(this)).fail(b(function(){this._simpleDataDeferred.reject(),this._simpleDataDeferred=null}).bind(this))),this._simpleDataDeferred.promise()},fetchDetails:function(a,c){return k.fetchDetails(b(a).map(function(a){return a.getId()}),c)},fetchContinuityOptInDetails:function(a){return k.fetchContinuityOptInDetails(a)},fetchCoupon:function(a,b){return k.fetchCoupon(a,b).then(function(a){var c=new i(a);return c.isContinuityOptIn()?k.fetchContinuityOptInDetails(b).then(function(a){return a&&a.CouponId&&Number(a.CouponId)===c.getId()&&c.set(a),c}):c})}}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=a.NR,f=e.resolve("SDM.Core.Components.Coupon"),g=f.CouponModel,h=f.CouponGateway;f.CouponCollection=d.Collection.extend({model:g,initialize:function(){this._language=SDM.Util.getShortLanguageCode(),this.onListSet(this._attachOnLoadAndOnUnloadEventListeners,this),this.onCouponsRemoved(this._detachOnLoadAndOnUnloadEventListeners,this)},_attachOnLoadAndOnUnloadEventListeners:function(a){a=a instanceof d.Collection?a:b([a]),a.each(function(a){a.onLoaded(function(){this.trigger("_coupon-loaded",a)},this),a.onUnloaded(function(a){this.trigger("_coupon-unloaded",a)},this)},this)},_detachOnLoadAndOnUnloadEventListeners:function(a){a=a instanceof d.Collection?a:b([a]),a.each(function(a){a.offLoaded(null,this),a.offUnloaded(null,this)},this)},_getCouponsWithNoDetail:function(){return this.reject(function(a){return a.hasDetail()},this)},_getContinuityOptInsWithNoDetails:function(){return this.filter(function(a){return a.isLoaded()&&a.isContinuityOptIn()&&!a.hasContinuityOptInDetails()},this)},_updateListWithDetails:function(a){return this.set(a,{remove:!1,add:!1}),this},setList:function(a,b){return this.reset(a,b)},removeCoupons:function(a,b){return this.remove(a,b)},onListSet:function(a,b){return this.on("reset",a,b)},onListUpdatedWithDetails:function(a,b){return this.on("_update-list-with-detail",a,b)},onCouponsRemoved:function(a,b){return this.on("remove",a,b)},onCouponRemoveComplete:function(a,b){return this.on("_remove-complete",a,b)},onCouponLoaded:function(a,b){return this.on("_coupon-loaded",a,b)},onCouponUnloaded:function(a,b){return this.on("_coupon-unloaded",a,b)},onFailToFetchDetail:function(a,b){return this.on("_fail-to-fetch-detail",a,b)},loadToCard:function(a){return h.load([this.get(a)],this._language)},loadAllToCard:function(){return h.load(this.filter(function(a){return a.isUnloaded()}),this._language)},unloadToCard:function(a){return h.unload([this.get(a)],this._language)},unloadAllToCard:function(){return h.unload(this.filter(function(a){return a.isLoaded()}),this._language)},fetchDetails:function(){var a=this._getCouponsWithNoDetail(),d=this._getContinuityOptInsWithNoDetails(),e=new c.Deferred,f=new c.Deferred;a.length>0?h.fetchDetails(a,this._language).done(b(function(a){this._updateListWithDetails(a),e.resolve()}).bind(this)).fail(b(function(){e.reject()}).bind(this)):e.resolve(),d.length>0?h.fetchContinuityOptInDetails(this._language).done(b(function(a){b.isEmpty(a)||this._updateListWithDetails(a)}).bind(this)).always(b(function(){f.resolve()}).bind(this)):f.resolve(),c.when(e,f).done(b.bind(function(){this.trigger("_update-list-with-detail")},this)).fail(b.bind(function(){this.trigger("_fail-to-fetch-detail")},this))},areAllCouponsLoaded:function(){return this.every(function(a){return a.isLoaded()})},getIds:function(){return this.map(function(a){return a.getId()}).join(",")},removeComplete:function(){this.trigger("_remove-complete")}})}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=a.NR,f=e.resolve("SDM.Core.Components.Coupon"),g=f.CouponGateway,h=f.CouponCollection,i=(f.CouponModel,null),j=c(c("[data-widget-coupon-list-csrf-token]").html()).val(),k=null;f.CardModel={getInstance:function(){return null===k&&(k=new i),k}},i=d.Model.extend({initialize:function(){if(!j)throw new Error("The card model needs CSRF token.");this._language=SDM.Util.getShortLanguageCode(),this._collection=new h,this._isSimpleDataReady=!1},url:function(){throw new Error("Url method is forbidden.")},fetch:function(){throw new Error("Fetch method is forbidden.")},getAllCoupons:function(){return this._collection},getAllAvailableCoupons:function(){return new h(this._collection.filter(function(a){return a.isUnloaded()},this))},getExclusiveCoupons:function(){var a=this.getAllAvailableCoupons();return new h(a.filter(function(a){return a.isExclusive()},this))},getLoadedCoupons:function(){return new h(this._collection.filter(function(a){return a.isLoaded()},this))},getRedeemedCoupons:function(){return new h(this._collection.filter(function(a){return a.isRedeemed()},this))},getExclusiveContinuityOptInCoupons:function(){return new h(this._collection.filter(function(a){return a.isContinuityOptIn()&&a.isExclusive()},this))},getContinuityOptInCoupons:function(){return new h(this._collection.filter(function(a){return a.isContinuityOptIn()},this))},getAllAvailableRewardCoupons:function(){return new h(this.getAllAvailableCoupons().filter(function(a){return a.isReward()}))},getNewCouponsCounts:function(){return this._TotalNewCoupons},getNewExclusiveCounts:function(){return this._TotalNewExclusive},onSimpleDataReady:function(a,b){return this._isSimpleDataReady?a.call(b||this):this.on("_simple-data-ready",a,b),this},onFailToFetchSimpleData:function(a,b){return this.on("_fail-to-fetch-simple-data",a,b)},fetchSimpleData:function(){return g.fetchSimpleData(this._language).done(b(function(a){this._isSimpleDataReady||(this._collection.setList(a.Coupons),this._TotalNewCoupons=a.CouponCounts.NewCoupons,this._TotalNewExclusive=a.CouponCounts.NewExclusive,this._isSimpleDataReady=!0,this.trigger("_simple-data-ready"))}).bind(this)).fail(b(function(){this._isSimpleDataReady||this.trigger("_fail-to-fetch-simple-data")}).bind(this))}})}.call(this),function(){var a=this,b=this._,c=a.jQuery,d="coupon-view",e=a.Backbone,f=a.NR,g=f.resolve("SDM.Core.Components.Coupon"),h=f.resolve("SDM.Core.Components.PopUp"),i=null,j={loadButtonContainer:"[data-wg-ct-load-button-container]",removeButtonContainer:"[data-wg-ct-remove-button-container]",redeemedButtonContainer:"[data-wg-ct-redeemed-button-container]",loadButton:"[data-wg-ct-load-button]",viewButton:"[data-wg-ct-view-button]",removeButton:"[data-wg-ct-remove-button]",loadMessage:"[data-wg-ct-load-message]",removeMessage:"[data-wg-ct-remove-message]",errorMessage:"[data-wg-ct-error-message]",loading:"[data-wg-ct-loading]",loadButtonOnDetail:"[data-wg-pcct-load-button-on-detail]",removeButtonOnDetail:"[data-wg-pcct-remove-button-on-detail]",progress:"[data-wg-ct-progress]",progress_bar:"[data-wg-ct-progress-bar]",spent_percent:"[data-wg-ct-spent-percent]"},k={couponContainer:c("[data-widget-coupon-container-template]"),detailModalContent:c("[data-widget-popup-coupon-content-template]"),couponLoading:c("[data-widget-coupon-loading-template]"),coupon:c("[data-widget-coupon-template]")},l={id:"data-wg-ct-id",analyticsTag:"data-wg-ci-analytics-tag",analyticsLabel:"data-wg-ci-analytics-label"},m={continuity_opt_in:"wg-cpi-continuity-opt-in",hero:"wg-cpi-hero",progress_started:"wg-cpi-progress-started"},n=!1;b(k).every(function(a){return a.length>0})&&(k=b.object(b(k).keys(),b(k).map(function(a){return b(a.html()).template()})),i=new h,n=!0),g.CouponView=e.View.extend({initialize:function(){if(this.animating=null,!n)return void console.log("Coupon View couldn't find templates.")
;this.setElement(k.couponContainer({coupon:this.model})),this.model.onLoadingStart(this._onLoadingStart,this),this.model.onLoadingComplete(this._onLoadingComplete,this),this.model.onLoadingFail(this._onLoadingFail,this),this.model.onUnloadingStart(this._onUnloadingStart,this),this.model.onUnloadingComplete(this._onUnloadingComplete,this),this.model.onUnloadingFail(this._onUnloadingFail,this),this.analyticsTag=this.$el.attr(l.analyticsTag),this.isAnimating=!1},stopListening:function(){this.model.offLoadingStart(this._onLoadingStart,this),this.model.offLoadingComplete(this._onLoadingComplete,this),this.model.offLoadingFail(this._onLoadingFail,this),this.model.offUnloadingStart(this._onUnloadingStart,this),this.model.offUnloadingComplete(this._onUnloadingComplete,this),this.model.offUnloadingFail(this._onUnloadingFail,this),e.View.prototype.stopListening.call(this)},_onLoadingStart:function(){this._detailRendered&&(this.buttonsDisabled=!0,this.isAnimating=!0,this.$loading.show())},_onLoadingComplete:function(){this._detailRendered&&(this.$loading.hide(),this._showLoadToCardAnimation().done(b(function(){this.buttonsDisabled=!1,this.isAnimating=!1,this.trigger("_animationComplete")}).bind(this)))},_onLoadingFail:function(){this._detailRendered&&(this.$loading.hide(),this._showErrorOccurredAnimation().done(b(function(){this.buttonsDisabled=!1,this.isAnimating=!1,this.trigger("_animationComplete")}).bind(this)))},_onUnloadingStart:function(){this._detailRendered&&(this.buttonsDisabled=!0,this.isAnimating=!0,this.$loading.show())},_onUnloadingComplete:function(){this._detailRendered&&(this.$loading.hide(),this._showRemoveFromCardAnimation().done(b(function(){this.buttonsDisabled=!1,this.isAnimating=!1,this.trigger("_animationComplete")}).bind(this)))},_onUnloadingFail:function(){this._detailRendered&&(this.$loading.hide(),this._showErrorOccurredAnimation().done(b(function(){this.buttonsDisabled=!1,this.isAnimating=!1,this.trigger("_animationComplete")}).bind(this)))},_renderLoading:function(){return this.$el.html(k.couponLoading()),this.buttonsDisabled=!0,this._detailRendered=!1,this},_renderDetail:function(){return this.$el.html(k.coupon(this.model.getViewModel())),this.buttonsDisabled=!1,this._assignElements(),this._initializeElements(),this._setEventListeners(),this.adjustTextAreaSize(),this._detailRendered=!0,this.model.isContinuityOptIn()&&this.model.hasContinuityOptInDetails()&&this._renderContinuityOptInDetail(),this},_renderContinuityOptInDetail:function(){var a=this.model.getContinuityOptInProgress();this.model.hasContinuityOptInAnimated()||c({percent:0}).delay(1e3).animate({percent:a},{duration:1e3,step:b.bind(this._updateContinuityOptInProgressBar,this)}).promise().done(b.bind(function(){this._updateContinuityOptInProgressBar(a),this.model.setContinuityOptInAnimated(!0)},this))},_updateContinuityOptInProgressBar:function(a){this.$continuityProgressSpent.html(Math.floor(a)),a>0&&this.$continuityProgressContainer.addClass(m.progress_started),this.$continuityProgressBar.width(a+"%")},_adjustTextAreaSize:function(){this.$("[data-ml-text-overflow]").css("height",""),this.$("[data-ml-text-overflow]").mlTextOverflow()},_adjustAmountTextAreaSize:function(){this.$(".wg-cpi-amount span").css("height",""),this.$(".wg-cpi-amount span").mlTextOverflow()},_removeAdjustmentOfAmountTextAreaSize:function(){this.$(".wg-cpi-amount span").css("height",""),this.$(".wg-cpi-amount span").css("max-height","")},_assignElements:function(){this.$loadButtonContainer=this.$(j.loadButtonContainer),this.$removeButtonContainer=this.$(j.removeButtonContainer),this.$redeemedButtonContainer=this.$(j.redeemedButtonContainer),this.$loadButton=this.$(j.loadButton),this.$viewButton=this.$(j.viewButton),this.$removeButton=this.$(j.removeButton),this.$loadMessage=this.$(j.loadMessage),this.$removeMessage=this.$(j.removeMessage),this.$errorMessage=this.$(j.errorMessage),this.$loading=this.$(j.loading),this.$continuityProgressContainer=this.$(j.progress),this.$continuityProgressBar=this.$(j.progress_bar),this.$continuityProgressSpent=this.$(j.spent_percent)},_initializeElements:function(){this.$loadButtonContainer.toggle(this.model.isUnloaded()),this.$removeButtonContainer.toggle(this.model.isLoaded()),this.$redeemedButtonContainer.hide(this.model.isRedeemed()),this.$loadMessage.hide(),this.$removeMessage.hide(),this.$errorMessage.hide(),this.$loading.hide()},_setEventListeners:function(){this.$loadButton.on("click."+d,b(this._onClickLoadButton).bind(this)),this.$viewButton.on("click."+d,b(this._onClickViewButton).bind(this)),this.$removeButton.on("click."+d,b(this._onClickRemoveButton).bind(this))},_onClickLoadButton:function(a){c(a.currentTarget);this.trigger("_clickLoadButton",a,this)},_onClickRemoveButton:function(a){c(a.currentTarget);this.trigger("_clickRemoveButton",a,this)},_onClickViewButton:function(a){c(a.currentTarget);this._showUpDetailModal()},_showLoadToCardAnimation:function(){return c({}).queue(b(function(a){this._fadeInLoadMessage().done(a)}).bind(this)).promise()},_showRemoveFromCardAnimation:function(){return c({}).queue(b(function(a){this._fadeInRemoveMessage().done(a)}).bind(this)).promise()},_showErrorOccurredAnimation:function(){return c({}).queue(b(function(a){this._fadeInErrorMessage().done(a)}).bind(this)).delay(1e3).queue(b(function(a){this._fadeOutErrorMessage().done(a)}).bind(this)).promise()},_fadeInLoadMessage:function(){return this.$loadMessage.stop().fadeIn(400).promise()},_fadeOutLoadMessage:function(){return this.$loadMessage.stop().fadeOut(400).promise()},_fadeInRemoveMessage:function(){return this.$removeMessage.stop().fadeIn(400).promise()},_fadeOutRemoveMessage:function(){return this.$removeMessage.stop().fadeOut(400).promise()},_fadeInErrorMessage:function(){return this.$errorMessage.stop().fadeIn(400).promise()},_fadeOutErrorMessage:function(){return this.$errorMessage.stop().fadeOut(400).promise()},_showUpDetailModal:function(){var a=c(k.detailModalContent(this.model.getViewModel()));a.find(j.loadButtonOnDetail).on("click."+d,b(function(a){i.close(),this._onClickLoadButton(a)}).bind(this)),a.find(j.removeButtonOnDetail).on("click."+d,b(function(a){i.close(),this._onClickRemoveButton(a)}).bind(this)),i.open(a),i.onOpenCompleted(function(){c(".widget-coupon-detail-modal .wg-cpi-description").mlTextOverflow()})},getId:function(){return parseInt(this.$el.attr(l.id),10)},fadeOutContainer:function(){var a=new c.Deferred;return this.isAnimating?this.on("_animationComplete",function(){this.$el.fadeOut(500).promise().done(function(){a.resolve()})},this):this.$el.fadeOut(500).promise().done(function(){a.resolve()}),a},onClickLoadButton:function(a,b){return this.on("_clickLoadButton",a,b)},onClickRemoveButton:function(a,b){return this.on("_clickRemoveButton",a,b)},adjustTextAreaSize:function(){return this._adjustTextAreaSize(),this.$el.hasClass(m.featured)||this._adjustAmountTextAreaSize(),this},renderLoading:function(){return this._renderLoading()},renderDetail:function(){return this._renderDetail()},addHeroClass:function(){return this.$el.addClass(m.hero),this._removeAdjustmentOfAmountTextAreaSize(),this},addContinuityOptInClass:function(){return this.$el.addClass(m.continuity_opt_in),this}})}.call(this),function(){var a=this,b=this._,c=a.jQuery,d=a.Backbone,e=a.NR,f=e.resolve("SDM.Core.Components.Coupon"),g=f.CouponView,h={container:c("[data-widget-coupon-list-container-template]"),list:c("[data-widget-coupon-list-template]"),listItem:c("[data-widget-coupon-list-item-template]"),loading:c("[data-widget-coupon-list-loading-template]"),noResult:c("[data-widget-coupon-list-no-result-template]"),error:c("[data-widget-coupon-list-error-template]")},i=!1;b(h).every(function(a){return a.length>0})&&(h=b.object(b(h).keys(),b(h).map(function(a){return b(a.html()).template()})),i=!0),f.CouponListView=d.View.extend({initialize:function(a){if(h=c.extend(!0,h,a.templates||{}),!i)return void console.log("Coupon List View couldn't find templates.");this.collection=this.model,this.setElement(h.container()),this.$list=c(h.list()),this.$loading=c(h.loading()),this.$noResult=this.options.$noResult?this.options.$noResult:c(h.noResult()),this.getNoResultsHtml=a.getNoResultsHtml||null,this.$error=c(h.error()),this.couponViews={},this.collection.onListSet(this._renderList,this),this.collection.onListUpdatedWithDetails(this._renderCouponDetails,this),this.collection.onCouponsRemoved(this._removeCouponFromList,this),this.collection.onFailToFetchDetail(this._renderErrorMessage,this),this._renderLoading()},_renderLoading:function(){return this.$el.html(this.$loading),this},_renderList:function(){if(b.isObject(this.couponViews)&&b.each(this.couponViews,function(a){a.stopListening()}),this.model.size()>0)this.$el.html(this.$list),this.$list.empty(),this.couponViews=this._createViewItems(this.model),this.model.each(function(a){this._addCouponViewTo$list(a),this._initializeCouponView(a),a.hasDetail()&&this.couponViews[a.getId()].renderDetail()},this);else{var a=b.isFunction(this.getNoResultsHtml)?this.getNoResultsHtml():this.$noResult;this.$el.html(a),this.couponViews={}}return this},_renderCouponDetails:function(){b(this.couponViews).each(function(a){a.renderDetail()},this)},_renderErrorMessage:function(){return this.$el.html(this.$error),this},_removeCouponFromList:function(a){a=b(a).isArray()?a:[a];var d=[];return b(a).each(function(a){var b=this.couponViews[a.getId()];b&&d.push(b.fadeOutContainer())},this),c.when.apply(c,d).done(b.bind(function(){this.model.removeComplete(a)},this)),this},_createViewItems:function(a){return b.object(a.map(function(a){return a.getId()}),a.map(function(a){return new g({model:a})}))},_addCouponViewTo$list:function(a){var b=this._get$CouponListItemContainer(),c=this.couponViews[a.getId()];return this._add$ListItemTo$List(this.$list,b,c,a),this},_initializeCouponView:function(a){var c=this.couponViews[a.getId()];return c.renderLoading(),c.onClickLoadButton(b(function(a,b){this.collection.loadToCard(b.getId())}).bind(this)),c.onClickRemoveButton(b(function(a,b){this.collection.unloadToCard(b.getId())}).bind(this)),this},_add$ListItemTo$List:function(a,b,c,d){b.html(c.el),a.append(b)},_get$CouponListItemContainer:function(){return c(h.listItem())},adjustTextAreaSizeViewItems:function(){return b(this.couponViews).each(function(a){a.adjustTextAreaSize()},this),this},renderErrorMessage:function(){return this._renderErrorMessage()},overrideAddItemViewMethod:function(a){this._add$ListItemTo$List=a},getItemView:function(a){return this.couponViews[a]}})}.call(this),function(){var a=this,b=this._,c=a.Backbone;a.NR.resolve("SDM.Core.Components").FlyerModel=c.Model.extend({config:{price_saving_regex:/<PriceSavings>(.*)<\/PriceSavings>/i},defaults:{IsLoaded:!1},set:function(a,d){if(void 0===a.CouponId||b(a.CouponId).isNumber()||(a.CouponId=parseInt(a.CouponId,10)),void 0===a.PosStartDate||a.PosStartDate instanceof Date||(a.PosStartDate=new Date(a.PosStartDate)),void 0===a.PosEndDate||a.PosEndDate instanceof Date||(a.PosEndDate=new Date(a.PosEndDate)),void 0===a.DisplayStartDate||a.DisplayStartDate instanceof Date||(a.DisplayStartDate=new Date(a.DisplayStartDate)),void 0===a.DisplayEndDate||a.DisplayEndDate instanceof Date||(a.DisplayEndDate=new Date(a.DisplayEndDate)),void 0===a.PosStartDate||a.PosStartDate instanceof Date||(a.PosStartDate=new Date(a.PosStartDate)),void 0===a.PosEndDate||a.PosEndDate instanceof Date||(a.PosEndDate=new Date(a.PosEndDate)),void 0!==a.LongDescriptionHeader){var e=this.config.price_saving_regex.exec(a.LongDescriptionHeader);e=null!==e?e[1]:"",a.PriceSavings=$.trim(e)}return c.Model.prototype.set.call(this,a,d)},idAttribute:"CouponId",getId:function(){return this.id},getProductName:function(){return this.get("RequirementDescription")},getPrice:function(){return this.get("ShortDescription")},getOfferType:function(){return this.get("OfferTypes")},getBrands:function(){return this.get("Brands")},getCategories:function(){return this.get("Categories")},getPosStartDate:function(){return this.get("PosStartDate")},getPosEndDate:function(){return this.get("PosEndDate")},getPosStartTimeStamp:function(){return this.getPosStartDate().getTime()},getPosEndTimeStamp:function(){return this.getPosEndDate().getTime()},getPosDateRange:function(){var a=Math.abs(this.getPosEndDate().getTime()-this.getPosStartDate().getTime());return Math.ceil(a/864e5)},getImage:function(){return this.get("Image")},getBadge:function(){return this.get("Badge")},getLongDescriptionHeader:function(){return this.get("LongDescriptionHeader")},getPriceSavings:function(){return this.get("PriceSavings")},showPriceSavings:function(){var a=this.getPriceSavings().toLowerCase(),c=this.getPrice().toLowerCase();return!(!a||b.isEqual(a,"n/a")||b.isEqual(a,c))},hasBadge:function(){return!!this.get("Badge")},hasDetail:function(){return!!this.getProductName()},hasRangeLessThanFlyer:function(){return this.get("RangeLessThanFlyer")},isLoaded:function(){return this.get("IsLoaded")},setRangeLessThanFlyer:function(a){this.set("RangeLessThanFlyer",a)}})}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=a.NR,f=e.resolve("SDM.Core.Components"),g=f.FlyerModel;f.FlyerCollection=d.Collection.extend({defaults:{initialSetting:!1,_isSimpleDataReady:!1},model:g,initialize:function(){this.language=SDM.Util.getShortLanguageCode(),this.on("_simpleDataReady",this.updateEffectiveDates)},isSimpleDataReady:function(){return this._isSimpleDataReady},onSimpleDataReady:function(a,b){this.isSimpleDataReady()?a.call(b||this):this.on("_simpleDataReady",a,b)},setList:function(a,b){return this.reset(a,b)},removeFlyers:function(a,b){return this.remove(a,b)},onListSet:function(a,b){return this.on("reset",a,b)},onFetchError:function(a,b){return this.on("error-fetch",a,b)},onFlyersRemoved:function(a,b){return this.on("remove",a,b)},getIdsWithNoDetail:function(){var a=[];return this.each(function(b){b.hasDetail()||a.push(b.getId())}),a},flyerSimpleListURL:function(){var a={coupons:!1,UTCMinutesOffset:(new Date).getTimezoneMinuteOffset()};return"//"+document.location.host+"/"+this.language+"/optimum/getallcoupons?"+c.param(a)},flyerDetailListURL:function(){var a={Ids:this.getIdsWithNoDetail().join(","),coupons:!1,UTCMinutesOffset:(new Date).getTimezoneMinuteOffset()};return"//"+document.location.host+"/"+this.language+"/optimum/getcoupondetails?"+c.param(a)},fetchSimple:function(){var a="http:"===location.protocol,c={cache:!1,crossDomain:a,xhrFields:{withCredentials:!0},headers:{"X-Requested-With":"XMLHttpRequest"}};return this.fetchURL=this.flyerSimpleListURL,d.Collection.prototype.fetch.call(this,c).done(b(function(){this.trigger("_simpleDataReady")}).bind(this))},fetchDetails:function(){var a="http:"===location.protocol,b={remove:!1,add:!1,cache:!1,crossDomain:a,xhrFields:{withCredentials:!0},headers:{"X-Requested-With":"XMLHttpRequest"}};return this.fetchURL=this.flyerDetailListURL,this.getIdsWithNoDetail().length>0&&d.Collection.prototype.fetch.call(this,b),this},url:function(){return this.fetchURL()},updateEffectiveDates:function(){if(this.length>0){this.effectiveStartDate=b.min(this.models,function(a){return a.getPosStartTimeStamp()}).getPosStartDate(),this.effectiveEndDate=b.max(this.models,function(a){return a.getPosEndTimeStamp()}).getPosEndDate();var a=Math.abs(this.effectiveEndDate.getTime()-this.effectiveStartDate.getTime()),c=Math.ceil(a/864e5);this.effectiveDateRange=c,this.each(function(a){a.getPosDateRange()<this.effectiveDateRange?a.setRangeLessThanFlyer(!0):a.setRangeLessThanFlyer(!1)},this)}},getEffectiveStartDate:function(){return this.effectiveStartDate},getEffectiveEndDate:function(){return this.effectiveEndDate},getEffectiveDateRange:function(){return this.effectiveDateRange},getEffectiveDates:function(){var a=this.getEffectiveStartDate(),b=this.getEffectiveEndDate();if(a&&b){var c=b.getFullYear()>a.getFullYear(),d="";return d=c?"%A, %b %r %Y":"%A, %b %r",a=a.format(d,this.language),b=b.format(d,this.language),{effectiveStartDate:a,effectiveEndDate:b}}return null},getIds:function(){return this.map(function(a){return a.getId()}).join(",")}})}.call(this),function(){var a=this,b=this._,c=a.jQuery,d=a.Backbone,e=a.NR,f=e.resolve("SDM.Core.Components"),g={flyerContainer:c("[data-widget-flyer-container-template]"),flyerLoading:c("[data-widget-flyer-loading-template]"),flyer:c("[data-widget-flyer-template]")},h=!1;b(g).every(function(a){return a.length>0})&&(g=b.object(b(g).keys(),b(g).map(function(a){return b(a.html()).template()})),h=!0),f.FlyerView=d.View.extend({initialize:function(){if(!h)return void console.log("Flyer View couldn't find templates.");this.setElement(g.flyerContainer({flyer:this.model})),this._render(),this.model.on("change",this._onChange,this),this.model.on("adjust-text-area-size",this.adjustTextAreaSize,this)},_onChange:function(){this._render()},_render:function(){return this.model.hasDetail()?(this.$el.html(g.flyer({flyer:this.model})),this.adjustTextAreaSize()):this.$el.html(g.flyerLoading()),this},adjustTextAreaSize:function(){this.$("[data-ml-text-overflow]").css("height","").mlTextOverflow()}})}.call(this),function(){var a=this,b=this._,c=a.jQuery,d=a.Backbone,e=a.NR,f=e.resolve("SDM.Core.Components"),g=f.FlyerView,h={container:c("[data-widget-flyer-list-container-template]"),list:c("[data-widget-flyer-list-template]"),listItem:c("[data-widget-flyer-list-item-template]"),loading:c("[data-widget-flyer-list-loading-template]"),noResult:c("[data-widget-flyer-list-no-result-template]"),fetchErrorMessage:c("[data-widget-flyer-list-error-template]")},i=!1;b(h).every(function(a){return a.length>0})&&(h=b.object(b(h).keys(),b(h).map(function(a){return b(a.html()).template()})),i=!0),f.FlyerListView=d.View.extend({initialize:function(){if(!i)return void console.log("Flyer List View couldn't find templates.");this.setElement(h.container()),this.$list=c(h.list()),this.$loading=c(h.loading()),this.$noResult=c(h.noResult()),this.$fetchErrorMessage=c(h.fetchErrorMessage()),this._showLoading(),this.model.onSimpleDataReady(this._onReady,this),this.model.onFlyersRemoved(this._onReady,this),this.model.onListSet(this._onReady,this),this.model.onFetchError(this._showFetchError,this)},_onReady:function(){return this.model.size()>0?(this._showList(),this._renderList()):this._showNoResult(),this},_showFetchError:function(){this.$el.html(this.$fetchErrorMessage)},_showList:function(){this.$el.html(this.$list)},_showLoading:function(){this.$el.html(this.$loading)},_showNoResult:function(){this.$el.html(this.$noResult)},_renderList:function(){this.$list.empty(),this.model.each(b(function(a){this._addFlyer(a)}).bind(this))},_addFlyer:function(a){var b=new g({model:a}),d=c(h.listItem()),e=this.$list.children().length;this.trigger("_onAddedItem",d,e),this.$list.append(d),d.html(b.el),a.trigger("adjust-text-area-size")},onAddedItem:function(a,b){this.on("_onAddedItem",a,b)},adjustTextAreaSize:function(){this.model.each(b(function(a){a.trigger("adjust-text-area-size")}).bind(this))}})}.call(this),function(){var a=this,b=this._,c=a.jQuery,d="coupon-view",e=a.Backbone,f=a.NR,g=f.resolve("SDM.Core.Components"),h={numberList:"[data-wg-pt-pagination-list]",nextButton:"[data-wg-pt-next-button]",prevButton:"[data-wg-pt-prev-button]",numberButton:"[data-wg-plt-number-button]"},i={container:c("[data-widget-pagination-template]"),numberItem:c("[data-widget-pagination-number-list-item-template]"),omissionItem:c("[data-widget-pagination-number-list-omission-item-template]")},j=!1;b(i).every(function(a){return a.length>0})&&(i=b.object(b(i).keys(),b(i).map(function(a){return b(a.html()).template()})),j=!0),g.PaginationView=e.View.extend({initialize:function(){if(!j)return void console.log("Pagination View couldn't find templates.");this.setElement(i.container()),this.findElements(),this.setViewEvents(),this.renderList(),this.model.onChangeNumberOfPages(this.onModelChangeNumberOfPages,this),this.model.onChangeCurrentPage(this.onModelChangeCurrentPage,this)},onModelChangeNumberOfPages:function(){this.renderList(),this.updateToggleButtons()},onModelChangeCurrentPage:function(){this.renderList(),this.updateToggleButtons()},findElements:function(){this.$numberList=this.$el.find(h.numberList),this.$nextButton=this.$el.find(h.nextButton),this.$prevButton=this.$el.find(h.prevButton)},setViewEvents:function(){this.$nextButton.on("click."+d,b(this.onClickNextButton).bind(this)),this.$prevButton.on("click."+d,b(this.onClickPrevButton).bind(this)),this.$el.on("click."+d,h.numberButton,b(this.onClickNumberButton).bind(this))},renderList:function(){return this.$numberList.empty(),b(this.model.getPaginationArray()).each(b(function(a){b(a.number).isNumber()?this.$numberList.append(i.numberItem({number:a.number,isCurrent:a.isCurrent})):this.$numberList.append(i.omissionItem())}).bind(this)),this},updateToggleButtons:function(){return 1===this.model.getCurrentPage()||this.model.getNumberOfPages()<=1?this.$prevButton.css("display","none"):this.$prevButton.css("display",""),this.model.getCurrentPage()===this.model.getNumberOfPages()||this.model.getNumberOfPages()<=1?this.$nextButton.css("display","none"):this.$nextButton.css("display",""),this},show$el:function(){this.$el.show()},hide$el:function(){this.$el.hide()},onClickNextButton:function(){this.model.setCurrentPage(this.model.getCurrentPage()+1)},onClickPrevButton:function(){this.model.setCurrentPage(this.model.getCurrentPage()-1)},onClickNumberButton:function(a){var b=parseInt(c(a.currentTarget).attr("data-wg-plt-number-button"));this.model.setCurrentPage(b)}})}.call(this),function(){var a=this,b=this._,c=(a.jQuery,a.Backbone);a.NR.resolve("SDM.Core.Components").PaginationModel=c.Model.extend({defaults:{_numberOfPages:20,_currentPage:10,_visibleRange:3},getNumberOfPages:function(){return this.get("_numberOfPages")},getCurrentPage:function(){return this.get("_currentPage")},getVisibleRange:function(){return this.get("_visibleRange")},getPaginationArray:function(){var a=[],c=this.getNumberOfPages(),d=this.getCurrentPage(),e=this.getVisibleRange(),f=d-Math.floor(e/2),g=d+Math.floor(e/2),h=0,i=0,j=!1;return f<1&&(i=1-f),c<g&&(h=g-c),f=Math.max(f-h,1),g=Math.min(g+i,c),b(c).times(function(b){var e=b+1,h=1!==e&&(e<f||g<e)&&e!==c;if(j&&h)return void(j=h);j=h,a.push({number:h?null:e,isCurrent:e===d})}),a},setNumberOfPages:function(a,b){return this.set({_numberOfPages:a},b)},setCurrentPage:function(a,b){return a=Math.min(a,this.getNumberOfPages()),a=Math.max(a,1),this.set("_currentPage",a,b)},onChangeNumberOfPages:function(a,b){return this.on("change:_numberOfPages",a,b)},onChangeCurrentPage:function(a,b){return this.on("change:_currentPage",a,b)}})}.call(this),function(){var a=this,b=a.jQuery,c=a._,d=a.PopThat.Slide,e=a.NR,f=e.resolve("SDM.Core.Components"),g=e.resolve("SDM.Util"),h=f.PopUp=d.extend();h.prototype._extendDefaults=function(){return this.NAME="sdm-popup",{animation:{open:250,close:150},templates:{background:'<div class="widget-popup-background"><div class="wg-ppb-coloured-cover"></div></div>',popthat:'<div class="widget-popup-body"></div>',modal:'<div class="wg-ppb-modal"></div>',close:'<div class="wg-ppb-close-button-container"><button aria-label="'+("fr"==g.getShortLanguageCode()?"ferme":"Close")+'" class="widget-close-button"></button></div>',content:'<div class="wg-ppb-content"></div>'},events:{triggers:{open_completed:"open-completed",close_completed:"close-completed"}}}},h.prototype.addClassToContainer=function(a){return this.$popthat.addClass(a)},h.prototype.removeClassFromContainer=function(a){return this.$popthat.removeClass(a)},h.prototype.reposition=function(){var a=d.prototype.reposition.apply(this,arguments);return this.$popthat.trigger(this.NAME+"-repositioned"),a},h.prototype.onOpenCompleted=function(a){this.$popthat.on("open-completed",a)},h.prototype.onCloseCompleted=function(a){this.$popthat.on("close-completed",a)},h.prototype.offCloseCompleted=function(a){this.$popthat.off("close-completed",a)},h.prototype.onRepositioned=function(a){this.$popthat.on(this.NAME+"-repositioned",a)},h.prototype.silentlyReposition=function(a){this._animateModal(a,{reposition:c.bind(function(a,b,d){var e={top:d.top,left:d.left,width:d.innerwidth,height:d.innerheight},f=this.config.animation.open,g=c.bind(function(){b.css({overflow:"visible"})},this);b.stop().animate(e,f,g)},this)})},h.prototype._injectBackground=function(){var a=b('[role="main"]');a.length||(a=b("body")),this.$background=b(this.templates.background()).appendTo(a)},h.prototype._injectPopThat=function(){var a=b('[role="main"]');a.length||(a=b("body")),this.$popthat=b(this.templates.popthat()),this.config.id&&this.$popthat.prop("id",this.config.id),this._bindPopThat(),this.$popthat.appendTo(a)},h.prototype.isOpen=function(){return Boolean(this.$modal&&this.$modal.length)}}.call(this),function(){var a=this,b=a.Backbone;a.NR.resolve("SDM.Core.Components").ResultNumbersView=b.View.extend({initialize:function(){this.$start=this.options.$start,this.$end=this.options.$end,this.$sum=this.options.$sum,this.model.onChangeStart(this.onModelChangeStart,this),this.model.onChangeEnd(this.onModelChangeEnd,this),this.model.onChangeSum(this.onModelChangeSum,this)},onModelChangeStart:function(){this.$start.html(this.model.getStart())},onModelChangeEnd:function(){this.$end.html(this.model.getEnd())},onModelChangeSum:function(){this.$sum.html(this.model.getSum())}})}.call(this),function(){var a=this,b=a.Backbone;a.NR.resolve("SDM.Core.Components").ResultNumbersModel=b.Model.extend({defaults:{_start:0,_end:0,_sum:0},update:function(a,b,c){this.set("_start",Math.min(c,a*(b-1)+1)),this.set("_end",Math.min(c,a*b)),this.set("_sum",c)},getStart:function(){return this.get("_start")},getEnd:function(){return this.get("_end")},getSum:function(){return this.get("_sum")},onChangeStart:function(a,b){this.on("change:_start",a,b)},onChangeEnd:function(a,b){this.on("change:_end",a,b)},onChangeSum:function(a,b){this.on("change:_sum",a,b)}})}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR,e=d.resolve("SDM.Core.Components"),f=e.TabGroup=function(a,b){var d={selectors:{container:"[data-widget-tab-group]",button:"[data-wg-tbg-button]",content:"[data-wg-tbg-content]"},attributes:{button:"data-wg-tbg-button",content:"data-wg-tbg-content",buttonActiveClass:"data-wg-tbg-button-active",contentActiveClass:"data-wg-tbg-content-active"},classnames:{buttonDefault:"active",contentDefault:"active"}};this.config=c.extend(!0,d,b||{}),this._initialize(a)};f.prototype._initialize=function(a){this._$element=a=a.is(this.config.selectors.container)?a:a.find(this.config.selectors.container),a.length>0&&(this._buttonActiveClass=a.attr(this.config.attributes.buttonActiveClass)||this.config.classnames.buttonDefault,this._containerActiveClass=a.attr(this.config.attributes.contentActiveClass)||this.config.classnames.contentDefault,this._$buttons=a.find(this.config.selectors.button),this._$contents=a.find(this.config.selectors.content),this._callbacks={_click:[],_switch:[]},this._setEventListener())},f.prototype._setEventListener=function(){this._$buttons.on("click.tabgroup",b(this._onClickButton).bind(this))},f.prototype._onClickButton=function(a){var b=c(a.currentTarget).attr(this.config.attributes.button);this._updateTab(b,!1)},f.prototype._updateTab=function(a,c){var d=this._$buttons.filter("["+this.config.attributes.button+'="'+a+'"]'),e=this._$contents.filter("["+this.config.attributes.content+'="'+a+'"]'),f=this._getIdsOfCurrentActiveButtons();this._$buttons.removeClass(this._buttonActiveClass),d.addClass(this._buttonActiveClass),this._$contents.removeClass(this._containerActiveClass),e.addClass(this._containerActiveClass),c||this._fireCallbacks("_click",a,d,e,this._$element),c||b(f).contains(a)||this._fireCallbacks("_switch",a,d,e,this._$element)},f.prototype._getIdsOfCurrentActiveButtons=function(){return b(this._getActive$Buttons()).map(b(function(a){return c(a).attr(this.config.attributes.button)}).bind(this))},f.prototype._getActive$Buttons=function(){return this._$buttons.filter(b(function(a,b){return c(b).hasClass(this._buttonActiveClass)}).bind(this))},f.prototype._fireCallbacks=function(a){var c=this._callbacks[a],d=arguments.length>0?Array.prototype.slice.call(arguments,1):[];c&&b(c).each(b(function(a){a.apply(this,d)}).bind(this))},f.prototype.onClickButton=function(a){return b.isObject(this._callbacks)&&this._callbacks._click.push(a),this},f.prototype.onSwitch=function(a){return b.isObject(this._callbacks)&&this._callbacks._switch.push(a),this},f.prototype.goToTab=function(a,b){return this._updateTab(a,b),this}}.call(this),function(){var a=this,b=a.jQuery,c=a._,d=NR.resolve("SDM.Core.Components"),e=d.VimeoVideoPlayer=function(a){var c={$container:null,event_handlers:{}};this.config=b.extend(!0,c,a||{}),this._initialize()};e.fn=e.prototype,e.fn._initialize=function(){if(!1===c.isObject(this.config.event_handlers))throw new Error("Event hanlders must be an object.");if(this.vimeo_id=null,this.is_ready=b.Deferred(),this.$container=this.config.$container,0==!!this.$container.attr("id"))return console.log("Vimeo player container must have an id attribute."),null;this.vimeo_id=this.config.vimeo_id,this.event_handlers={},c.each(this.config.event_handlers,function(a,b){this._setEventHandler(b,a)},this),this.player=null},e.fn._create=function(){var a=this.$container.attr("id")+"-iframe",d="//player.vimeo.com/video/"+this.vimeo_id+"?api=1&player_id="+a;this.$iframe?this.$iframe.attr("src",d):this.$iframe=this.$iframe||b("<iframe></iframe>",{id:a,src:d}),this.$container.append(this.$iframe),this.player=$f(this.$iframe[0]),this.player.addEvent("ready",c(function(a){this.is_ready.resolve(),this.player.addEvent("play",c(function(){this._fire("play")}).bind(this)),this.player.addEvent("pause",c(function(){this._fire("pause")}).bind(this)),this.player.addEvent("finish",c(function(){this._fire("finish")}).bind(this)),this._fire("ready")}).bind(this))},e.fn._isReady=function(){return"resolved"===this.is_ready.state()},e.fn._fire=function(a){if(!1===c.isString(a))throw new Error("An event id is required.");if(!0===c.has(this.event_handlers,a))for(var b=this.event_handlers[a],d=0,e=b.length;d<e;d+=1)!0===c.isFunction(b[d])&&b[d].call(this,this)},e.fn._setEventHandler=function(a,b){!1===c.has(this.event_handlers,a)&&(this.event_handlers[a]=[]),this.event_handlers[a].push(b)},e.fn.on=function(a,b){if(!1===c.isString(a))throw new Error("An event id is required.");if(!1===c.isFunction(b))throw new Error("A handler function is required.");return this._setEventHandler(a,b),this},e.fn.off=function(a,b){if(!1===c.isUndefined(a)&&!1===c.isString(a))throw new Error("Event id must be a string.");if(!1===c.isUndefined(b)&&!1===c.isFunction(b))throw new Error("Handler must be a function.");if(!1===c.isUndefined(b)){if(!1===c.has(this.event_handlers,a))return this;var d=this.event_handlers[a].indexOf(b);d>-1&&this.event_handlers[a].splice(d,1)}else!1===c.isUndefined(a)?!0===c.has(this.event_handlers,a)&&(this.event_handlers[a]=[]):this.event_handlers={};return this},e.fn._loadFroogaloopApi=function(){return c.isUndefined(this.froogaloop_api_promise)&&(this.froogaloop_api_promise=b.getScript("/static/core/vendors/froogaloop/froogaloop.js")),this.froogaloop_api_promise},e.fn.create=function(a){if(!0===c.isUndefined(a))throw new Error("A vimeo id is required.");return this.vimeo_id=a,b.when(this._loadFroogaloopApi()).then(c(this._create).bind(this)).fail(function(){console.log("Failed to load Froogaloop API.")}),this.is_ready},e.fn.play=function(){if(!1!==this._isReady())return this.player.api("play"),this},e.fn.pause=function(){if(!1!==this._isReady())return this.player.api("pause"),this},e.fn.destroy=function(){if(!1!==this._isReady()){try{this.$iframe.removeAttr("src"),this.$container.empty()}catch(a){}return this.player=null,this.is_ready=b.Deferred(),null}},e.fn.load=function(a){return this.vimeo_id=a,this.destroy(),this.create(a)},e.fn.loadAndPlay=function(a){this.vimeo_id=a,this.destroy()
;var d=this.create(a);return b.when(d).then(c(this.play).bind(this)),d},e.fn.hasPlayer=function(){return!1===c.isNull(this.player)}}.call(this),function(){var a=this,b=a.jQuery,c=a._,d=NR.resolve("SDM.Core.Components"),e=function(b){a.onYouTubeIframeAPIReady=b},f=null,g=d.YoutubeVideoPlayer=function(a){var c={is_mobile:!1,$container:null,event_handlers:{}};this.config=b.extend(!0,c,a||{}),this._initialize()};g.fn=g.prototype,g.fn._initialize=function(){if(!1===c.isObject(this.config.event_handlers))throw new Error("Event hanlders must be an object.");if(this.youtube_id=null,this.is_ready=b.Deferred(),this.$container=this.config.$container,0==!!this.$container.attr("id"))return console.log("Youtube player container must have an id attribute."),null;this.event_handlers={},c.each(this.config.event_handlers,function(a,b){this._setEventHandler(b,a)},this),this.player=null},g.fn._create=function(){f=a.YT;var d=this.$container.attr("id"),e=d+"-innercontainer",g=b("<div></div>",{id:e});this.$container.empty().append(g),this.player=new f.Player(e,{videoId:this.youtube_id,playerVars:{wmode:"opaque",controls:this.config.is_mobile?0:1,rel:0},events:{onReady:c(function(){this.is_ready.resolve(),this._fire("ready")}).bind(this),onStateChange:c(function(a){f.PlayerState.ENDED===a.data?this._fire("finish"):f.PlayerState.PLAYING===a.data?this._fire("play"):f.PlayerState.PAUSED===a.data&&this._fire("pause")}).bind(this)}})},g.fn._isReady=function(){return"resolved"===this.is_ready.state()},g.fn._fire=function(a){if(!1===c.isString(a))throw new Error("An event id is required.");if(!0===c.has(this.event_handlers,a))for(var b=this.event_handlers[a],d=0,e=b.length;d<e;d+=1)!0===c.isFunction(b[d])&&b[d].call(this,this)},g.fn._setEventHandler=function(a,b){!1===c.has(this.event_handlers,a)&&(this.event_handlers[a]=[]),this.event_handlers[a].push(b)},g.fn.on=function(a,b){if(!1===c.isString(a))throw new Error("An event id is required.");if(!1===c.isFunction(b))throw new Error("A handler function is required.");return this._setEventHandler(a,b),this},g.fn.off=function(a,b){if(!1===c.isUndefined(a)&&!1===c.isString(a))throw new Error("Event id must be a string.");if(!1===c.isUndefined(b)&&!1===c.isFunction(b))throw new Error("Handler must be a function.");if(!1===c.isUndefined(b)){if(!1===c.has(this.event_handlers,a))return this;var d=this.event_handlers[a].indexOf(b);d>-1&&this.event_handlers[a].splice(d,1)}else!1===c.isUndefined(a)?!0===c.has(this.event_handlers,a)&&(this.event_handlers[a]=[]):this.event_handlers={};return this},g.fn._loadYoutubeIframeApi=function(){if(c.isUndefined(this.youtube_iframe_api_promise)){var d=this;d.youtube_iframe_api_promise=new b.Deferred,b.getScript("https://www.youtube.com/iframe_api"),e(function(){d.youtube_iframe_api_promise.resolve(),a.isYouTubeIframeAPIReady=!0})}return this.youtube_iframe_api_promise},g.fn.create=function(d){if(!0===c.isUndefined(d))throw new Error("A youtube id is required.");return this.youtube_id=d,b.when(a.isYouTubeIframeAPIReady||this._loadYoutubeIframeApi()).then(c(this._create).bind(this)).fail(function(){console.log("Failed to load Youtube API.")}),this.is_ready},g.fn.play=function(){if(!1!==this._isReady())return this.player.playVideo(),this},g.fn.pause=function(){if(!1!==this._isReady())return this.player.pauseVideo(),this},g.fn.destroy=function(){if(!1!==this._isReady())return this.player.stopVideo(),this.$container.empty(),this.player=null,this.is_ready=b.Deferred(),null},g.fn.load=function(a){if(!1!==this._isReady())return this.youtube_id=a,this.player.cueVideoById(this.youtube_id),this.is_ready},g.fn.loadAndPlay=function(a){if(!1!==this._isReady())return this.youtube_id=a,this.player.loadVideoById(this.youtube_id),this.is_ready},g.fn.hasPlayer=function(){return!1===c.isNull(this.player)}}.call(this),function(){var a=this,b=a.jQuery,c=a._,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Components"),f=d.resolve("SDM.Core.Components.VimeoVideoPlayer"),g=d.resolve("SDM.Core.Components.YoutubeVideoPlayer"),h=e.VideoPlayer=function(a){var c={$container:null,event_handlers:{}};this.config=b.extend(!0,c,a||{}),this._initialize()};h.fn=h.prototype,h.type={YOUTUBE:0,VIMEO:1},h.fn._initialize=function(){if(!0===c.isNull(this.config.$container))throw new Error("A container element (jQuery object) must be set at construction.");this.current_type=null,this.apis={}},h.fn.getCurrentApi=function(){return!0===c.isNull(this.current_type)?null:this._getApi(this.current_type)},h.fn._getApi=function(a){if(!1===c.has(this.apis,a))if(h.type.YOUTUBE===a)this.apis[a]=new g(this.config);else{if(h.type.VIMEO!==a)throw new Error("Unknown type.");this.apis[a]=new f(this.config)}return this.apis[a]},h.fn.load=function(a,d,e){if(!0===c.isUndefined(d))throw new Error("A video id is required.");if(!1===c.isUndefined(e)&&!1===c.isFunction(e))throw new Error("Callback must be a function.");var f,g=this._getApi(a);a!==this.current_type&&!1===c.isNull(this.getCurrentApi())&&this.getCurrentApi().destroy(),this.current_type=a,f=!1===g.hasPlayer()?g.create(d):g.load(d),!0===c.isFunction(e)&&b.when(f).then(b.proxy(e,this))},h.fn.loadAndPlay=function(a,b){this.load(a,b,function(){this.play()})},h.fn.play=function(){var a=this.getCurrentApi();if(console.log(a),!0===c.isNull(a))throw new Error("Could not get current player.");return a.play.call(a)},h.fn.pause=function(){var a=this.getCurrentApi();if(!0===c.isNull(a))throw new Error("Could not get current player.");return a.pause.call(a)},h.fn.destroy=function(){var a=this.getCurrentApi();if(!0===c.isNull(a))throw new Error("Could not get current player.");return a.destroy.call(a)}}.call(this),function(){var a=this,b=a.jQuery,c=a._,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Components"),f=d.resolve("SDM.Core.Components.VideoPlayer"),g=d.resolve("SDM.Util"),h=e.VideoPanel=function(a,c){var d="fr"==g.getShortLanguageCode()?"ferme":"Close",e={attributes:{video_player_container:"data-wg-vp-video-player-container",video_player_id:"data-wg-vp-video-player-id",youtube_id:"data-wg-vp-youtube-id",vimeo_id:"data-wg-vp-vimeo-id"},classes:{panel_has_open_modal:"wg-vp-panel-has-open-modal",pc_video_container_class:"",mobile_video_container_class:""},selectors:{container:"[data-widget-video-panel]",button_play:"[data-wg-vp-play]",button_stop:"[data-wg-vp-stop]",is_panel_mobile:"[data-wg-vp-mobile]"},templates:{modal_pc:'<div class="widget-video-panel-modal" data-wg-vp-modal><div class="wg-vpm-player-placeholder" <%= video_player_container_attr %> id="<%= video_player_id %>"></div></div>',modal_mobile:'<div class="widget-video-panel-modal-mobile" data-wg-vp-modal><div class="wg-vpmm-iframe-wrapper"><div class="wg-vpmm-iframe-wrapper-inner"><div <%= video_player_container_attr %> id="<%= video_player_id %>"></div></div></div></div>',close_button:'<button aria-label="'+d+'" class="widget-video-panel-modal-close-button" data-wg-vp-stop type="button"></button>'}};this.config=b.extend(!0,e,{},c||{}),this._setInstanceVars(a),this._initialize()};h.prototype._setInstanceVars=function(a){this.$container=a.$container,this.$closeButtonContainer=a.$closeButtonContainer,this.$modalContainer=!c.isUndefined(a.$modalContainer)&&a.$modalContainer.length?a.$modalContainer:a.$container,this._subscribers={},this._is_mobile=this.$container.length&&this.$container.is(this.config.selectors.is_panel_mobile),this._is_modal_open=!1},h.prototype._initialize=function(){if(!this.$container.is(this.config.selectors.container))return console.log("A carousel video panel container has to have attribute "+this.config.selectors.container+"."),void console.log(this.$container[0]);this.video_player_id=this.$container.attr(this.config.attributes.video_player_id);var a=this.$container.attr(this.config.attributes.youtube_id),d=this.$container.attr(this.config.attributes.vimeo_id);if(c.isUndefined(this.video_player_id))return console.log("A carousel video panel container must have a "+this.config.attributes.video_player_id+" attribute."),void console.log(this.$container[0]);if(c.isUndefined(a)&&c.isUndefined(d))return console.log("A carousel video panel container must have either "+this.config.attributes.youtube_id+" attribute or "+this.config.attributes.vimeo_id+" attribute."),void console.log(this.$container[0]);try{this.mobile_modal_template=c.template(this.config.templates.modal_mobile)}catch(a){return void console.log("Invalid mobile modal template.")}try{this.pc_modal_template=c.template(this.config.templates.modal_pc)}catch(a){return void console.log("Invalid pc modal template.")}if(!(this.$closeButtonContainer&&this.$closeButtonContainer.length>0))return void console.log("No close button container found.");var e=c.template(this.config.templates.close_button)();this.$closeButtonContainer.append(e),!0===this.$container.is("["+this.config.attributes.youtube_id+"]")?(this.video_type=f.type.YOUTUBE,this.video_id=a):!0===this.$container.is("["+this.config.attributes.vimeo_id+"]")&&(this.video_type=f.type.VIMEO,this.video_id=d);var g=this._is_mobile?this.mobile_modal_template:this.pc_modal_template;this.$modal=b(g({video_player_container_attr:this.config.attributes.video_player_container,video_player_id:this.video_player_id}));var h=this.$modal.find("["+this.config.attributes.video_player_container+"]");this.$modalContainer.append(this.$modal),this.videoPlayer=new f({$container:h,is_mobile:this._is_mobile,event_handlers:{pause:c(this._onVideoPause).bind(this),finish:c(this._onVideoFinish).bind(this)}}),this.bindClickPlayButtonEvent()},h.prototype._fire=function(a){if(!0===c.has(this._subscribers,a)){var b=Array.prototype.slice.call(arguments,1);c.each(this._subscribers[a],c(function(a){a.apply(this,b)}).bind(this))}},h.prototype._hide=function(){this._is_modal_open=!1,this.$container.removeClass(this.config.classes.panel_has_open_modal),this.videoPlayer.destroy(),this._fire("modal.close")},h.prototype._show=function(){this._is_modal_open=!0,this._fire("modal.open"),this.$container.addClass(this.config.classes.panel_has_open_modal),this.bindClickStopButtonEvent(),SDM.Util.isWindowWide()?this.videoPlayer.loadAndPlay(this.video_type,this.video_id):this.videoPlayer.load(this.video_type,this.video_id)},h.prototype.isModalOpen=function(){return this._is_modal_open},h.prototype.bindClickPlayButtonEvent=function(){this.$container.off("click",this.config.selectors.button_play).on("click",this.config.selectors.button_play,c(function(a){a.preventDefault(),this._show()}).bind(this))},h.prototype.bindClickStopButtonEvent=function(){this.$closeButtonContainer.off("click",this.config.selectors.button_stop).on("click",this.config.selectors.button_stop,c(function(a){a.preventDefault(),this._hide()}).bind(this))},h.prototype._onVideoPause=function(){!0===this._is_mobile&&this.video_type===f.type.VIMEO&&this._hide()},h.prototype._onVideoFinish=function(){this._hide()},h.prototype.on=function(a,b){return!1===c.has(this._subscribers,a)&&(this._subscribers[a]=[]),this._subscribers[a].push(b),this},h.prototype.off=function(a,b){if(!0===c.has(this._subscribers,a)){var d=c.indexOf(this._subscribers[a],b);d>-1&&this._subscribers[a].splice(d,1)}return this},h.prototype.closeModal=function(){!1!==this.isModalOpen()&&this._hide()},h.prototype.getId=function(){return this.video_player_id}}.call(this),function(){var a=this,b=a.jQuery,c=a._,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Components"),f=d.resolve("SDM.Core.Components.VideoPlayer"),g=e.VideoPanelDeeplink=function(a,c){var d={attributes:{video_player_container:"data-wg-vp-video-player-container",video_player_id:"data-wg-vp-video-player-id",youtube_id:"data-wg-vp-youtube-id",vimeo_id:"data-wg-vp-vimeo-id"},classes:{panel_has_open_modal:"wg-vp-panel-has-open-modal",pc_video_container_class:"",mobile_video_container_class:""},selectors:{container:"[data-widget-video-panel]",button_play:"[data-wg-vp-play]",button_stop:"[data-wg-vp-stop]",is_panel_mobile:"[data-wg-vp-mobile]"},templates:{modal_pc:'<div class="widget-video-panel-modal" data-wg-vp-modal><div class="wg-vpm-player-placeholder" <%= video_player_container_attr %> id="<%= video_player_id %>"></div></div>',modal_mobile:'<div class="widget-video-panel-modal-mobile" data-wg-vp-modal><div class="wg-vpmm-iframe-wrapper"><div class="wg-vpmm-iframe-wrapper-inner"><div <%= video_player_container_attr %> id="<%= video_player_id %>"></div></div></div></div>',close_button:'<span class="widget-video-panel-modal-close-button" data-wg-vp-stop></span>'}};this.config=b.extend(!0,d,{},c||{}),this._setInstanceVars(a),this._initialize()};g.prototype._setInstanceVars=function(a){this.$container=a.$container,this.$closeButtonContainer=a.$closeButtonContainer,this.$modalContainer=!c.isUndefined(a.$modalContainer)&&a.$modalContainer.length?a.$modalContainer:a.$container,this._subscribers={},this._is_modal_open=!1,this._hide=function(a){var d=this;if(this._is_modal_open=!1,b(".wg-gt__tile-video-modal-popup").removeClass(this.config.classes.panel_has_open_modal),this.videoPlayer.destroy(),this._fire("modal.close"),b(".wg-gt__tile-video-modal-container").velocity({top:"100%"},300),setTimeout(c.bind(function(){b(document.body).css("position","relative"),b(document.body).css("top",""),b(document.body).css("width",""),window.scrollTo(0,d.modalScrollY)},this),0),setTimeout(c.bind(function(){b(".widget-video-panel-modal").remove()},this),300),history.pushState&&!a){var e=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.pushState({path:e},"",e)}}},g.prototype._initialize=function(){if(this.video_player_id=this.$container.ID,"youtube"===this.$container.VideoType&&(this.video_id=this.$container.URL,this.video_type=f.type.YOUTUBE),"vimeo"===this.$container.VideoType&&(this.video_id=this.$container.URL,this.video_type=f.type.VIMEO),c.isUndefined(this.video_player_id))return console.log("A carousel video panel container must have a "+this.config.attributes.video_player_id+" attribute."),void console.log(this.$container[0]);try{this.mobile_modal_template=c.template(this.config.templates.modal_mobile)}catch(a){return void console.log("Invalid mobile modal template.")}try{this.pc_modal_template=c.template(this.config.templates.modal_pc)}catch(a){return void console.log("Invalid pc modal template.")}if(!(this.$closeButtonContainer&&this.$closeButtonContainer.length>0))return void console.log("No close button container found.");var a=c.template(this.config.templates.close_button)();this.$closeButtonContainer.append(a);var d=this._is_mobile?this.mobile_modal_template:this.pc_modal_template;this.$modal=b(d({video_player_container_attr:this.config.attributes.video_player_container,video_player_id:this.video_player_id}));var e=this.$modal.find("["+this.config.attributes.video_player_container+"]");this.$modalContainer.append(this.$modal),this.videoPlayer=new f({$container:e,is_mobile:this._is_mobile,event_handlers:{pause:c(this._onVideoPause).bind(this),finish:c(this._onVideoFinish).bind(this)}}),this._show()},g.prototype._fire=function(a){if(!0===c.has(this._subscribers,a)){var b=Array.prototype.slice.call(arguments,1);c.each(this._subscribers[a],c(function(a){a.apply(this,b)}).bind(this))}},g.prototype._show=function(){this._is_modal_open=!0,this._fire("modal.open"),this.modalScrollY=window.scrollY,b(".wg-gt__tile-video-modal-popup").addClass(this.config.classes.panel_has_open_modal),this.bindClickStopButtonEvent(),SDM.Util.isWindowWide()?this.videoPlayer.loadAndPlay(this.video_type,this.video_id):this.videoPlayer.load(this.video_type,this.video_id)},g.prototype.isModalOpen=function(){return this._is_modal_open},g.prototype.bindClickPlayButtonEvent=function(){this.$container.off("click",this.config.selectors.button_play).on("click",this.config.selectors.button_play,c(function(a){a.preventDefault(),this._show()}).bind(this))},g.prototype.bindClickStopButtonEvent=function(){this.$closeButtonContainer.off("click",this.config.selectors.button_stop).on("click",this.config.selectors.button_stop,c(function(a){a.preventDefault()}).bind(this))},g.prototype._onVideoPause=function(){!0===this._is_mobile&&this.video_type===f.type.VIMEO&&this._hide(!1)},g.prototype._onVideoFinish=function(){this._hide(!1)},g.prototype.on=function(a,b){return!1===c.has(this._subscribers,a)&&(this._subscribers[a]=[]),this._subscribers[a].push(b),this},g.prototype.off=function(a,b){if(!0===c.has(this._subscribers,a)){var d=c.indexOf(this._subscribers[a],b);d>-1&&this._subscribers[a].splice(d,1)}return this},g.prototype.closeModal=function(){!1!==this.isModalOpen()&&this._hide(!1)},g.prototype.getId=function(){return this.video_player_id}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR||(a.NR={}),e=a.CarouselView,f=a.CarouselModel,g=a.CarouselViewAnimations,h=d.resolve("SDM.Core.Components"),i=h.SliderCarouselController=function(a,b){var d={toggle_at_once:null,circulate:!1,swipe:{min_move_x:5}};this.config=c.extend(!0,d,{},b||{}),this._setInstanceVars(a)};i.prototype._setInstanceVars=function(a){this.view=new e({$container:a.$container}),this.model=new f({number_of_panels:this.view.getPanelSize()}),this.no_duration_animation=g.slide(0),this.callbacks={}},i.prototype._fire=function(a,c){c=b(c).isArray()?c:[],this.callbacks[a]&&b(this.callbacks[a]).each(function(a){a.apply({},c)})},i.prototype.off=function(a){this.callbacks[a]&&(this.callbacks[a]=[])},i.prototype.on=function(a,b){this.callbacks[a]&&this.callbacks[a].push(b)},i.prototype.bindModelEvents=function(){this.model.on("changeIndex",b(function(){this.updateToggleButtonVisibility(),this.updatePaginationButtonActiveClass(),this.animateCarousel()}).bind(this))},i.prototype.bindViewEvents=function(){this.view.off("clickNextButton"),this.view.on("clickNextButton",b(function(){this.goToNext()}).bind(this)),this.view.off("clickPreviousButton"),this.view.on("clickPreviousButton",b(function(){this.goToPrevious()}).bind(this)),this.view.off("clickPaginationButton"),this.view.on("clickPaginationButton",b(function(a){this.model.setIndex(a.index)}).bind(this)),this.view.off("resize"),this.view.on("resize",b(function(){var a=this.view.$container.find(this.view.selectors.panel).eq(this.getCurrentIndex());0!==a.length&&(c(this.view.selectors.panel_container,this.view.$container)[0].style.left="-"+a.position().left+"px")}).bind(this)),this.view.off("swipePanelContainer"),this.view.on("swipePanelContainer",b(function(a,b,c){this.config.swipe.min_move_x<=b?(this.goToNext(),a.preventDefault()):b<=-this.config.swipe.min_move_x&&(this.goToPrevious(),a.preventDefault())}).bind(this))},i.prototype.goToNext=function(){null!==this.model.getIndexOfNextBreakPoint(this.config.circulate)&&(this.config.toggle_at_once?this.model.setIndex(this.model.getAdvancedIndex(this.config.toggle_at_once,!1)):this.model.setIndex(this.model.getIndexOfNextBreakPoint(this.config.circulate)))},i.prototype.goToPrevious=function(){null!==this.model.getIndexOfPreviousBreakPoint(this.config.circulate)&&(this.config.toggle_at_once?this.model.setIndex(this.model.getEarlierIndex(this.config.toggle_at_once,!1)):this.model.setIndex(this.model.getIndexOfPreviousBreakPoint(this.config.circulate)))},i.prototype.updateToggleButtonVisibility=function(){null!==this.model.getIndexOfNextBreakPoint(this.config.circulate)?this.view.showNextButton():this.view.hideNextButton(),null!==this.model.getIndexOfPreviousBreakPoint(this.config.circulate)?this.view.showPreviousButton():this.view.hidePreviousButton()},i.prototype.getCurrentIndex=function(){return this.model.getCurrentIndex()},i.prototype.updatePaginationButtonActiveClass=function(){this.view.activatePaginationButton(this.model.getCurrentIndex())},i.prototype.updatePaginationButtonVisibility=function(){this.view.showAndHidePaginationButtonByFilterCallback(b(function(a){return this.model.size()>this.model.number_of_visible&&this.model.isBreakPointIndex(a)}).bind(this))},i.prototype.animateCarousel=function(){this.view.animate(this.model.getCurrentIndex())},i.prototype.setModelIndexSilently=function(a){var b=this.view.getAnimation();this.view.setAnimation(this.no_duration_animation),this.model.setIndex(a),this.model.isValidIndex(a)&&this.view.animate(a),this.view.setAnimation(b)},i.prototype.setToggleAtOnce=function(a){this.config.toggle_at_once=a},i.prototype.setPanelWidth=function(a){this.view.setPanelWidth(a)},i.prototype.removePanelWidth=function(){this.view.removePanelWidth()},i.prototype.setNumberOfVisible=function(a){this.model.setNumberOfVisible(a)},i.prototype.getCarouselWidth=function(){return this.view.getCarouselWidth()},i.prototype.setAnimation=function(a){this.view.setAnimation(a)},i.prototype.renderPanels=function(a){this.view.renderPanels(a)},i.prototype.renderPaginationButtons=function(a){this.view.renderPaginationButtons(a)},i.prototype.setNumberOfPanels=function(a){this.model.setNumberOfPanels(a)},i.prototype.hideMainContainer=function(){this.view.hidePanelContainer(),this.view.makePaginationButtonContainerInvisible(),this.view.hideNextButton(),this.view.hidePreviousButton()},i.prototype.showMainContainer=function(){this.view.showPanelContainer(),this.view.makePaginationButtonContainerVisible()}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Components"),f="slider-carousel",g=a.CarouselViewAnimations,h=e.SliderCarouselController,i=e.VideoPanel,j=null;j=e.SliderCarousel=function(a,b){var d={selectors:{carousel_container:"[data-wg-scrs-carousel-container]",video_panel:"[data-widget-video-panel]",video_container:"[data-wg-scrs-video-container]",close_button_container:"[data-wg-scrs-video-close-button-container]",text_overflow:"[data-ml-text-overflow]"},attributes:{pc_visible:"wg-scrs-number-visible-pc",tablet_visible:"wg-scrs-number-visible-tablet",mob_visible:"wg-scrs-number-visible-mob",pc_toggle_at_once:"wg-scrs-toggle-at-once-pc",tablet_toggle_at_once:"wg-scrs-toggle-at-once-tablet",mob_toggle_at_once:"wg-scrs-toggle-at-once-mob",circulate:"wg-scrs-circulate"},setting:{pc:{animation_duration:500,number_of_visible:3,toggle_at_once:!1},tablet:{animation_duration:500,number_of_visible:2,toggle_at_once:!1},mob:{animation_duration:500,number_of_visible:1,toggle_at_once:!1}}};this.config=c.extend(!0,d,b||{}),this._setInstanceVars(a),this._initialize(),this._initializeDesktopVideoPanels()},j.prototype._setInstanceVars=function(a){this.$container=a.find(this.config.selectors.carousel_container),this.videoPanels={},this.$module=a,this.controller=new h({$container:this.$container},{circulate:a.data(this.config.attributes.circulate)}),this.pc_animation=g.slide(this.config.setting.pc.animation_duration),this.tablet_animation=g.slide(this.config.setting.tablet.animation_duration),this.mob_animation=g.slide(this.config.setting.mob.animation_duration),this.config.setting.pc.number_of_visible=parseInt(a.data(this.config.attributes.pc_visible),10)||this.config.setting.pc.number_of_visible,this.config.setting.tablet.number_of_visible=parseInt(a.data(this.config.attributes.tablet_visible),10)||this.config.setting.tablet.number_of_visible,this.config.setting.mob.number_of_visible=parseFloat(a.data(this.config.attributes.mob_visible),10)||this.config.setting.mob.number_of_visible,this.config.setting.pc.toggle_at_once=parseInt(a.data(this.config.attributes.pc_toggle_at_once),10)||this.config.setting.pc.toggle_at_once,this.config.setting.tablet.toggle_at_once=parseInt(a.data(this.config.attributes.tablet_toggle_at_once),10)||this.config.setting.tablet.toggle_at_once,this.config.setting.mob.toggle_at_once=parseInt(a.data(this.config.attributes.mob_toggle_at_once),10)||this.config.setting.mob.toggle_at_once},j.prototype._initialize=function(){this.controller.bindViewEvents(),this.controller.bindModelEvents(),this._updateMode(),this._bindResizeEvents()},j.prototype._initializeDesktopVideoPanels=function(){var a=this.$module.find(this.config.selectors.video_panel);b.each(a,b(function(a){var d=c(a),e=new i({$modalContainer:d.find(this.config.selectors.video_container),$container:d,$closeButtonContainer:d.find(this.config.selectors.close_button_container)});e.on("modal.open",b(function(){this._closeAllVideosBut(e.getId())}).bind(this)),this.videoPanels[e.getId()]=e}).bind(this)),this.controller.model.on("changeIndex",b(function(){b.each(this.videoPanels,function(a){a.closeModal()})}).bind(this))},j.prototype._updateTextOverflows=function(){this.$container.find(this.config.selectors.text_overflow).mlTextOverflow()},j.prototype._updateMode=function(){SDM.Util.isWindowNarrow()?this._switchModeToMobile():SDM.Util.isWindowWide()?this._switchModeToTablet():this._switchModeToPC()},j.prototype._closeAllVideosBut=function(a){b.each(this.videoPanels,function(b,c){c!==a&&b.closeModal()})},j.prototype._switchModeToPC=function(){this.controller.setNumberOfVisible(this.config.setting.pc.number_of_visible),this.controller.setAnimation(this.pc_animation),this.controller.setModelIndexSilently(0),this._removeMobPanelWidth(),this.controller.updateToggleButtonVisibility(),this.controller.updatePaginationButtonVisibility(),this.controller.updatePaginationButtonActiveClass(),this.controller.setToggleAtOnce(this.config.setting.pc.toggle_at_once),setTimeout(b.bind(this._updateTextOverflows,this),0)},j.prototype._switchModeToTablet=function(){this.controller.setNumberOfVisible(this.config.setting.tablet.number_of_visible),this.controller.setAnimation(this.tablet_animation),this.controller.setModelIndexSilently(0),this._removeMobPanelWidth(),this.controller.updateToggleButtonVisibility(),this.controller.updatePaginationButtonVisibility(),this.controller.updatePaginationButtonActiveClass(),this.controller.setToggleAtOnce(this.config.setting.tablet.toggle_at_once),setTimeout(b.bind(this._updateTextOverflows,this),0)},j.prototype._switchModeToMobile=function(){this.controller.setNumberOfVisible(this.config.setting.mob.number_of_visible),this.controller.setAnimation(this.mob_animation),this.controller.setModelIndexSilently(0),this._setMobPanelWidth(),this.controller.updateToggleButtonVisibility(),this.controller.updatePaginationButtonVisibility(),this.controller.updatePaginationButtonActiveClass(),this.controller.setToggleAtOnce(this.config.setting.mob.toggle_at_once),setTimeout(b.bind(this._updateTextOverflows,this),0)},j.prototype._setMobPanelWidth=function(){var a=this.$container.width(),b=Math.floor(a/this.config.setting.mob.number_of_visible);b<=0||this.controller.setPanelWidth(b)},j.prototype._removeMobPanelWidth=function(){this.controller.removePanelWidth()},j.prototype._bindResizeEvents=function(){c(window).on("becometoextrawide."+f,b(function(){this._switchModeToPC()}).bind(this)),c(window).on("becometowide."+f,b(function(){this._switchModeToTablet()}).bind(this)),c(window).on("becometonarrow."+f,b(function(){this._switchModeToMobile()}).bind(this)),c(window).on("resizewhennarrow."+f,b(function(){this._setMobPanelWidth(),this.controller.setModelIndexSilently(this.controller.getCurrentIndex())}).bind(this))},j.prototype.renderPanels=function(a){this.controller.renderPanels(a)},j.prototype.renderPaginationButtons=function(a){this.controller.renderPaginationButtons(a)},j.prototype.setNumberOfPanels=function(a){this.controller.setNumberOfPanels(a),this._updateMode()},j.prototype.hideMainContainer=function(){this.controller.hideMainContainer()},j.prototype.showMainContainer=function(){this.controller.showMainContainer()},j.prototype.updateMode=function(){this._updateMode()}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR||(a.NR={}),e=a.CarouselView,f=a.CarouselModel,g=a.CarouselViewAnimations,h=d.resolve("SDM.Core.Components"),i=d.resolve("SDM.Core.Components.SliderCarousel"),j=d.resolve("SDM.Core.Components.VideoPanel"),k=null;k=h.HeroCarousel=function(a,b){var d={number_of_visible:1,rotate_duration:6e3,animation_duration:1e3,selectors:{pc_carousel:"[data-wg-hcrs-pc-carousel]",mobile_carousel:"[data-wg-hcrs-mobile-carousel]",panel:"[data-wg-crs-panel]",video_panel:"[data-widget-video-panel]",video_container:"[data-wg-hcp-video-container]",close_button_container:"[data-wg-hcp-video-close-button-container]"},data:{seenSlides:[]}};this.config=c.extend(!0,d,b||{}),this.videoPanels=[],this._setInstanceVars(a),this._initialize(),this._initializeDesktopVideoPanels()},k.prototype._setInstanceVars=function(a){this.view=new e({$container:a.find(this.config.selectors.pc_carousel)}),this.model=new f({number_of_panels:this.view.getPanelSize()}),this.mobile_carousel=new i(a.find(this.config.selectors.mobile_carousel)),this.autoRotationIntervalId=null,c(window).on("becometonarrow.sdm-hero-carousel",b(function(){this._switchModeToMobile()}).bind(this))},k.prototype._initialize=function(){if(this.view.setAnimation(g.fade(this.config.animation_duration)),this.view.makeContainerVisible(),this.model.setNumberOfVisible(this.config.number_of_visible),this._bindViewEvents(),this._bindModelEvents(),this._animateCarousel(),this._updateToggleButtonVisibility(),this._updatePaginationButtonActiveClass(),this._startAutoRotation(),window.location.href.includes("home")){for(var a=this.view.$container.find(this.config.selectors.panel),b=a.length,c=this;b--;)a[b].addEventListener("click",function(){var a=this.getAttribute("data-index");c._slideClick(a)}),a[b].addEventListener("auxclick",function(){var a=this.getAttribute("data-index");c._slideClick(a)});null===sessionStorage.getItem("seenAllSlides")?this._isElementInView(a[0])&&(dataLayer.push({event:"slide_impression","slide.position":0,"slide.image_url":document.body.querySelector('.wg-hcp-panel[data-index="0"] .wg-hcp-lnk-image').src}),sessionStorage.setItem("seenAllSlides",[0]),this.config.seenSlides=sessionStorage.getItem("seenAllSlides")):this.config.seenSlides=sessionStorage.getItem("seenAllSlides")}},k.prototype._initializeDesktopVideoPanels=function(){var a=this.view.$container.find(this.config.selectors.video_panel);b.each(a,function(a){var d=c(a),e=new j({$modalContainer:d.find(this.config.selectors.video_container),$container:d,$closeButtonContainer:this.view.$container.find(this.config.selectors.close_button_container)});e.on("modal.open",b(function(){this._stopAutoRotation()}).bind(this)),this.videoPanels.push(e)},this)},k.prototype._switchModeToMobile=function(){b.each(this.videoPanels,function(a){a.closeModal()},this)},k.prototype._updateToggleButtonVisibility=function(){this.view.showNextButton(),this.view.showPreviousButton()},k.prototype._updatePaginationButtonActiveClass=function(){this.view.activatePaginationButton(this.model.getCurrentIndex())},k.prototype._slideClick=function(a){window.location.href.includes("home")&&dataLayer.push({event:"slide_click","slide.position":a,"slide.image_url":document.body.querySelector('.wg-hcp-panel[data-index="'+a+'"] .wg-hcp-lnk-image').src})},k.prototype._isElementInView=function(a){var b=a.getBoundingClientRect(),c=b.top,d=b.top+b.height;return c>=0&&d<=Math.min(document.documentElement.clientHeight,window.innerHeight||0)},k.prototype._sendSlideToAnalytics=function(){if(window.location.href.includes("home")){var a=this.view.$container.find(this.config.selectors.panel);this._isElementInView(a[this.model.getCurrentIndex()])&&this.config.data.seenSlides.length<a.length&&-1===this.config.data.seenSlides.indexOf(this.model.getCurrentIndex())&&(this.config.data.seenSlides.push(this.model.getCurrentIndex()),dataLayer.push({event:"slide_impression","slide.position":this.model.getCurrentIndex(),"slide.image_url":document.body.querySelector('.wg-hcp-panel[data-index="'+this.model.getCurrentIndex()+'"] .wg-hcp-lnk-image').src}),sessionStorage.setItem("seenAllSlides",JSON.stringify(this.config.data.seenSlides)))}},k.prototype._animateCarousel=function(){this._sendSlideToAnalytics(),this.view.animate(this.model.getCurrentIndex())},k.prototype._startAutoRotation=function(){this.autoRotationIntervalId=setInterval(b(function(){this.model.setIndex(this.model.getIndexOfNextBreakPoint(!0))}).bind(this),this.config.rotate_duration)},k.prototype._stopAutoRotation=function(){clearInterval(this.autoRotationIntervalId)},
k.prototype._bindModelEvents=function(){this.model.on("changeIndex",b(function(){this._updateToggleButtonVisibility(),this._updatePaginationButtonActiveClass(),this._animateCarousel()}).bind(this))},k.prototype._bindViewEvents=function(){this.view.on("clickNextButton",b(function(){dataLayer.push({event:"slide_next"}),this._stopAutoRotation(),this.model.setIndex(this.model.getAdvancedIndex(1,!0))}).bind(this)),this.view.on("clickPreviousButton",b(function(){dataLayer.push({event:"slide_previous"}),this._stopAutoRotation(),this.model.setIndex(this.model.getEarlierIndex(1,!0))}).bind(this)),this.view.on("clickPaginationButton",b(function(a){dataLayer.push({event:"slide_pagination","pagination.position":this.model.getCurrentIndex()}),this._stopAutoRotation(),this.model.setIndex(a.index)}).bind(this))}}.call(this),function(){var a=this,b=a._,c=a.jQuery;(a.NR.resolve("SDM.Core.Components").PharmacyServicesQAB=function(a,b,d){var e={province_select:"[data-psqab-province-select]"};this.config=c.extend(!0,e,d||{}),this._initialize(a,b)}).prototype._initialize=function(a,d){var e=a.find(this.config.province_select),f=b(e.find("option")).map(function(a){return c(a).val()});d&&b(f).contains(d)&&e.val(d)}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Components");f.ArticleSummaryModel=d.Model.extend({}),f.ArticleSummaryCollection=d.Collection.extend({model:f.ArticleSummaryModel,parameters:{categoryId:1,currentPage:1,limit:18,offset:0,tag:1,rootUrl:"",destinationID:"",tagID:"",articleIDs:""},totalResults:0,url:function(){return this.urlRoot+"?"+(this.parameters.categoryId?"categoryID="+this.parameters.categoryId:"")+"&Page="+this.parameters.currentPage+"&ItemsPerPage="+this.parameters.limit+"&offset="+this.parameters.offset+"&tag="+this.parameters.tag+"&RootUrl="+this.parameters.rootUrl+"&destinationID="+this.parameters.destinationID+"&tagID="+this.parameters.tagID+"&articleIDs="+this.parameters.articleIDs+(this.parameters.truncateLimit?"&truncateLimit="+this.parameters.truncateLimit:"")},fetch:function(a){return a=a||{},a.reset=!0,this.totalResults=0,d.Collection.prototype.fetch.call(this,a).done(b(function(){this.trigger("finish-loading")}).bind(this)).fail(b(function(){this.trigger("fail-loading")}).bind(this)).always(b(function(){this.trigger("finish-fetching")}).bind(this))},parse:function(a){return this.totalResults=a.TotalResults,a.Articles},setCategoryId:function(a){return this.parameters.categoryId=a,this},setCurrentPage:function(a){return this.parameters.currentPage=a,this},setLimit:function(a){return this.parameters.limit=a,this},setOffset:function(a){return this.parameters.offset=a,this},setTag:function(a){return this.parameters.tag=a,this},setDestinationID:function(a){return this.parameters.destinationID=a,this},setTagID:function(a){return this.parameters.tagID=a,this},setArticleIDs:function(a){return this.parameters.articleIDs=a,this},setDetailPageUrlRoot:function(a){return this.parameters.rootUrl=a,this},setJsonResourceUrlRoot:function(a){return this.urlRoot=a,this},setTruncateLimit:function(a){return this.parameters.truncateLimit=a,this},getCurrentPage:function(){return this.parameters.currentPage},getTotalPages:function(){return Math.ceil(this.totalResults/this.parameters.limit)},getLoadedResultCount:function(){return Math.min(this.parameters.currentPage*this.parameters.limit,this.totalResults)},getTotalResultCount:function(){return this.totalResults},getLimit:function(){return this.parameters.limit}}),f.ArticleSummaryListingView=d.View.extend({defaults:{collection:null},config:{selectors:{container:"[data-widget-article-list]",headerContainer:"[data-wg-artl-header-container]",listContainer:"[data-wg-artl-list-container]",itemCollectionTemplate:"[data-wg-alst-item-collection-template]",headerTemplate:"[data-wg-alst-header-template]",loadingContainer:"[data-wg-asl-loading-container]",errorMessageContainer:"[data-wg-asl-error-message-container]",searchResultContainer:"[data-wg-asl-search-result-container]",loadMoreButton:"[data-wg-asl-more]",contentContainers:"[data-wg-asl-content-container]"}},initialize:function(){if(this.$container=this.options.$container.is(this.config.selectors.container)?this.options.$container:this.options.$container.find(this.config.selectors.container),0===this.$container.length)return void console.log("The $container is not valid.");this.$listContainer=this.$container.find(this.config.selectors.listContainer),this.$headerContainer=this.$container.find(this.config.selectors.headerContainer),this.itemCollectionTemplate=b(this.$container.find(this.config.selectors.itemCollectionTemplate).html()).template(),this.headerTemplate=b(this.$container.find(this.config.selectors.headerTemplate).html()).template(),this.$loadingContainer=c(this.$container.find(this.config.selectors.loadingContainer)),this.$errorMessageContainer=c(this.$container.find(this.config.selectors.errorMessageContainer)),this.$searchResultContainer=c(this.$container.find(this.config.selectors.searchResultContainer)),this.$loadMoreButton=c(this.$container.find(this.config.selectors.loadMoreButton)),this.$contentContainers=c(this.$container.find(this.config.selectors.contentContainers)),this.collection.on("reset",this.renderList,this),this.collection.on("fail-loading",this.renderErrorMessage,this),this.collection.on("finish-fetching",this.resetContainerVisibility,this),this.$el=this.$container,this.$loadingContainer.addClass("wg-asl-content-container--visible")},events:{"click .wg-asl-more":"loadMoreHandler","click .wg-asl-display-num":"changeDisplayNum"},loadMoreHandler:function(a){a.preventDefault(),this.$loadMoreButton.addClass("wg-asl-more--loading"),this.$loadMoreButton.prop("disabled",!0),this.collection.setCurrentPage(this.collection.getCurrentPage()+1).fetch()},changeDisplayNum:function(a){a.preventDefault(),this.$contentContainers.removeClass("wg-asl-content-container--visible"),this.$loadingContainer.addClass("wg-asl-content-container--visible"),this.$listContainer.html(""),this.collection.setLimit(c(a.currentTarget).data("wg-asl-display-num")),this.collection.setCurrentPage(1).fetch()},showLoading:function(){this.$contentContainers.removeClass("wg-asl-content-container--visible"),this.$loadingContainer.addClass("wg-asl-content-container--visible")},clearResults:function(){this.$listContainer.html("")},resetContainerVisibility:function(){this.$loadingContainer.removeClass("wg-asl-content-container--visible"),this.$loadMoreButton.removeClass("wg-asl-more--loading"),this.$loadMoreButton.prop("disabled",!1)},renderErrorMessage:function(){this.$contentContainers.removeClass("wg-asl-content-container--visible"),this.$errorMessageContainer.addClass("wg-asl-content-container--visible")},renderList:function(){return this.$contentContainers.removeClass("wg-asl-content-container--visible"),this.$searchResultContainer.addClass("wg-asl-content-container--visible"),this.$headerContainer.html(this.headerTemplate({loadedResultCount:this.collection.getLoadedResultCount(),totalResultCount:this.collection.getTotalResultCount(),limit:this.collection.getLimit(),currentPage:this.collection.getCurrentPage()})),this.$listContainer.append(this.itemCollectionTemplate({articles:this.collection.toJSON()})),this.collection.getLoadedResultCount()===this.collection.getTotalResultCount()?this.$loadMoreButton.addClass("wg-asl-more--hide"):this.$loadMoreButton.removeClass("wg-asl-more--hide"),this}})}.call(this),function(){function a(a,b){this.$item=a,this.config=b}var b=this,c=b._,d=b.Backbone;b.NR.resolve("SDM.Core.Components").CollapsibleButtonList=d.View.extend({config:{selectors:{container:"[data-widget-collapsible-button-list]",title:"[data-wg-clbl-title]",list:"[data-wg-clbl-list]",item:"[data-wg-clbl-item]",nano:"[data-wg-clbl-nano]",nanoContent:"[data-wg-clbl-nano-content]"},attributes:{itemName:"data-wg-clbl-item",buttonName:"data-wg-clbl-button",containerCollapsedClass:"data-wg-clbl-container-active-class",itemActiveClass:"data-wg-clbl-item-active-class",buttonActiveClass:"data-wg-clbl-button-active-class"},classnames:{containerCollapsedClass:"wg-clbl-collapsed",itemActiveClass:"wg-clbl-active",buttonActiveClass:"wg-clbl-active"}},initialize:function(){var b=this.options.$container.is(this.config.selectors.container)?this.options.$container:this.options.$container.find(this.config.selectors.container);if(0===b.length)return void console.log("The $container is not valid.");this.setElement(b),this.$items=this.$el.find(this.config.selectors.item),this.$list=this.$el.find(this.config.selectors.list),this.$title=this.$el.find(this.config.selectors.title),this.$nano=this.$el.find(this.config.selectors.nano),this.$nanoContent=this.$el.find(this.config.selectors.nanoContent),this.config.classnames.containerCollapsedClass=this.$el.attr(this.config.attributes.containerCollapsedClass)||this.config.classnames.containerCollapsedClass,this.config.classnames.itemActiveClass=this.$el.attr(this.config.attributes.itemActiveClass)||this.config.classnames.itemActiveClass,this.items=c(this.$items).map(c(function(b){return new a($(b),this.config)}).bind(this)),this._setEventListeners(),this._initializeNanoScroller()},_setEventListeners:function(){this.$title.on("click.collapsible-button-list",this._onClickTitle.bind(this))},_onClickTitle:function(){this.toggle()},_initializeNanoScroller:function(){this.$nano.nanoScroller({contentClass:this.$nanoContent.attr("class"),preventPageScrolling:!0,alwaysVisible:!0})},reinitializeScroller:function(){this._initializeNanoScroller()},toggle:function(){this.$el.hasClass(this.config.classnames.containerCollapsedClass)?this.open():this.collapse()},collapse:function(){this.$el.addClass(this.config.classnames.containerCollapsedClass)},open:function(){this.$el.removeClass(this.config.classnames.containerCollapsedClass),this._initializeNanoScroller()},getItems:function(){return this.items},findItemByName:function(a){return c(this.items).find(function(b){return b.getName()===a})},addItem:function(b){var c=$(b);this.items.push(new a(c,this.config)),this.$list.append(c)},emptyList:function(){this.items=[],this.$list.empty()}}),a.prototype.addActiveClass=function(){this.$item.addClass(this.config.classnames.itemActiveClass)},a.prototype.removeActiveClass=function(){this.$item.removeClass(this.config.classnames.itemActiveClass)},a.prototype.getName=function(){return this.$item.attr(this.config.attributes.itemName)}}.call(this),function(){function a(a){this.zooms=null,this._initialize(a)}function b(a,b){this._initialize(a,b)}function c(a,b){this._$image=a,this._source=b,this._isLoaded=!1,this._onStartLoadingEventHandler=function(){},this._$image.on("load._"+j,e(function(){this._isLoaded=!0}).bind(this))}var d=this,e=d._,f=d.jQuery,g=d.NR,h=g.resolve("SDM"),i=g.resolve("SDM.Core.Components"),j="zoom",k=f(d);i.Zoom=function(b){var c={namespace:"zoom",zoom:"data-zoom",normalFrame:"data-zoom-normal-frame",largeFrame:"data-zoom-large-frame",normalImage:"data-zoom-normal-image",largeImage:"data-zoom-large-image",largeImagePaddingRate:.1,zoomInSpeed:300,zoomOutSpeed:100,zoomOutLabel:"data-zoom-label-on-zoom-out-state",zoomInLabel:"data-zoom-label-on-zoom-in-state",loading:"data-zoom-loading"};return new a(f.extend(!0,c,b||{}))},a.prototype._initialize=function(a){this.zooms=[];var c=f("["+a.zoom+"]");e(c).each(e.bind(function(c){var d=f(c);this.zooms.push(new b(d,a))},this))},b.prototype._initialize=function(a,b){this.namespace=b.namespace,this.$element=a,this.$normalFrame=a.find("["+b.normalFrame+"]"),this.$largeFrame=a.find("["+b.largeFrame+"]");var d=a.find("["+b.normalImage+"]"),f=d.attr(b.normalImage);this.normalImage=new c(d,f);var g=a.find("["+b.largeImage+"]"),i=g.attr(b.largeImage);this.largeImage=new c(g,i),this.offsetX=null,this.offsetY=null,this.scaleX=null,this.scaleY=null,this.zoomInSpeed=b.zoomInSpeed,this.zoomOutSpeed=b.zoomOutSpeed,this.paddingRate=b.largeImagePaddingRate,this.$labelOnZoomOutState=a.find("["+b.zoomOutLabel+"]"),this.$labelOnZoomInState=a.find("["+b.zoomInLabel+"]"),this.$loading=a.find("["+b.loading+"]"),this.eventAction=this.$element.data("zoom-event-action"),this.eventCategory=this.$element.data("zoom-event-category"),this.eventLabel=this.$element.data("zoom-event-label"),this.$labelOnZoomOutState.hide(),h.Util.isMobileDevice()||this._bindMouseEvents(),this.$normalFrame.css({opacity:1}),this.$largeFrame.css({opacity:0}),this.normalImage.setOnFinishLoadingEventHandler(e(function(){this.$loading.hide()}).bind(this)),this.largeImage.setOnFinishLoadingEventHandler(e(function(){this._calculateSizes(),this.$loading.hide(),this._fadeInLargeImage()}).bind(this)),this.$loading.show(),this.normalImage.load(),k.on("becometowide."+this.namespace,e.bind(this._bindMouseEvents,this)),k.on("becometonarrow."+this.namespace,e.bind(this._unbindMouseEvents,this))},b.prototype._bindMouseEvents=function(){this.$element.on("mouseenter."+this.namespace,e(this._onMouseEnter).bind(this)),this.$element.on("mouseleave."+this.namespace,e(this._onMouseLeave).bind(this)),this.$element.on("mousemove."+this.namespace,e(this._onMouseMove).bind(this)),this.$labelOnZoomOutState.show()},b.prototype._unbindMouseEvents=function(){this.$element.off("mouseenter."+this.namespace),this.$element.off("mouseleave."+this.namespace),this.$element.off("mousemove."+this.namespace),this.$labelOnZoomOutState.hide()},b.prototype._onMouseEnter=function(){this.normalImage.isLoaded()&&this.largeImage.isLoaded()?this._calculateSizes():this.normalImage.isLoaded()&&(this.largeImage.load(),this.$loading.show()),this._fadeOutNormalImage(),this.$labelOnZoomInState.show(),this.$labelOnZoomOutState.hide()},b.prototype._onMouseLeave=function(){this.normalImage.isLoaded()&&this.$loading.hide(),this._fadeInNormalImage(),this.$labelOnZoomInState.hide(),this.$labelOnZoomOutState.show()},b.prototype._onMouseMove=function(a){this.normalImage.isLoaded()&&this.largeImage.isLoaded()&&this._positionLargeImageFrame(a.pageX,a.pageY)},b.prototype._positionLargeImageFrame=function(a,b){var c=a-this.offsetX,d=b-this.offsetY,e=c*this.scaleX,f=d*this.scaleY;this.$largeFrame.css({top:-f,left:-e})},b.prototype._calculateSizes=function(){var a=this.$element.offset(),b=this.$normalFrame.width(),c=this.$normalFrame.height(),d=this.largeImage.getWidth(),e=this.largeImage.getHeight(),f=d>b?d+this.paddingRate*d*2:b,g=e>c?e+this.paddingRate*e*2:c;this.$largeFrame.width(f),this.$largeFrame.height(g),this.offsetX=a.left,this.offsetY=a.top,this.scaleX=(f-b)/b,this.scaleY=(g-c)/c},b.prototype._fadeOutNormalImage=function(){this.$normalFrame.stop(!0,!0).animate({opacity:0},this.zoomOutSpeed)},b.prototype._fadeInNormalImage=function(){this.$normalFrame.stop(!0,!0).animate({opacity:1},this.zoomOutSpeed)},b.prototype._fadeInLargeImage=function(){this.$largeFrame.stop(!0,!0).animate({opacity:1},this.zoomOutSpeed)},c.prototype.load=function(){this._$image.attr("src",this._source+"?"+(new Date).getTime()),this._onStartLoadingEventHandler(this._$image)},c.prototype.setOnStartLoadingEventHandler=function(a){this._onStartLoadingEventHandler=a},c.prototype.setOnFinishLoadingEventHandler=function(a){this._$image.off("load."+j),this._$image.on("load."+j,a)},c.prototype.isLoaded=function(){return this._isLoaded},c.prototype.getWidth=function(){return this._$image.width()},c.prototype.getHeight=function(){return this._$image.height()}}.call(this),function(){var a=this,b=this._,c=a.jQuery,d=a.NR,e=d.resolve("SDM.Core.Components.EventHub");e.EVENTS={TAB_SWITCHED:"TAB_SWITCHED",HEADER_TOOL_CLICKED:"HEADER_TOOL_CLICKED",CLOSE_MOBILE_SBU:"CLOSE_MOBILE_SBU",CLOSE_MOBILE_CAMPAIGN_NAV:"CLOSE_MOBILE_CAMPAIGN_NAV",OPEN_MOBILE_CAMPAIGN_NAV:"OPEN_MOBILE_CAMPAIGN_NAV",USER_INFO_UPDATED:"USER_INFO_UPDATED",ADD_MANAGED_POPUP:"ADD_MANAGED_POPUP",CANCEL_ALL_MANAGED_POPUPS:"CANCEL_ALL_MANAGED_POPUPS",COUPON_LOADED:"COUPON_LOADED",BROOKLYN_OFFERS_ERROR:"BROOKLYN_OFFERS_ERROR",MOBILE_NAV_TOGGLE_CLICK:"MOBILE_NAV_TOGGLE_CLICK",MOBILE_NAV_CLOSE_BUSINESS_UNIT:"MOBILE_NAV_CLOSE_BUSINESS_UNIT",MOBILE_NAV_CLOSE_SUB_BUSINESS_UNIT:"MOBILE_NAV_CLOSE_SUB_BUSINESS_UNIT"},e.ArgumentChekers={TAB_SWITCHED:function(a){return 1===a.length&&"string"==typeof a[0].tabId&&a[0].$button instanceof c&&a[0].$content instanceof c},HEADER_TOOL_CLICKED:function(a){return 2===a.length&&"string"==typeof a[0]&&a[1]instanceof c},CLOSE_MOBILE_SBU:function(a){return 0===a.length},CLOSE_MOBILE_CAMPAIGN_NAV:function(a){return 0===a.length},OPEN_MOBILE_CAMPAIGN_NAV:function(a){return 0===a.length},USER_INFO_UPDATED:function(a){return 0===a.length},ADD_MANAGED_POPUP:function(a){return b.isFunction(a[0].openPopUp)},COUPON_LOADED:function(a){return 0===a.length},BROOKLYN_OFFERS_ERROR:function(a){return 1===a.length&&b.isString(a[0])}}}.call(this),function(){var a=this,b=a._,c=a.Backbone,d=a.NR,e=d.resolve("SDM.Core.Components.EventHub"),f=b.extend({},c.Events);e.subscribe=function(a,b,c){e.EVENTS[a]&&f.on(a,b,c)},e.unsubscribe=function(a,b,c){f.off(a,b,c)},e.fire=function(a){var b,c=e.ArgumentChekers[a];if(e.EVENTS[a]){if(b=Array.prototype.slice.call(arguments,1),c&&!c(b))throw new TypeError("The arguments for "+a+" event are incorrect.");b.unshift(a),f.trigger.apply(f,b)}}}.call(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=a.jQuery,e=b.resolve("SDM.Util");c.Geolocation={data:function(){return{isGeolocationLoading:!1,geolocationCoordinate:{lat:null,lng:null},postalCode:null,provinceCode:null}},methods:{requestCurrentGeolocationPosition:function(b){if(!navigator.geolocation)return void console.log("Geolocation not supported.");this.isGeolocationLoading=!0,navigator.geolocation.getCurrentPosition(function(c){var f={lat:c.coords.latitude,lng:c.coords.longitude};this.geolocationCoordinate=f,"function"==typeof b&&b(),d.when(e.loadGoogleMapsApi()).then(function(){this.geocoder=new a.google.maps.Geocoder,this.geocoder.geocode({location:f},function(b,c){if(c===a.google.maps.GeocoderStatus.OK&&b&&b.length>0)for(var d=b[0],e=d.address_components,f=0;f<e.length;f++)for(var g=0;g<e[f].types.length;g++)"administrative_area_level_1"===e[f].types[g]&&(this.provinceCode=e[f].short_name),"postal_code"===e[f].types[g]&&(this.postalCode=e[f].short_name);this.isGeolocationLoading=!1}.bind(this))}.bind(this))}.bind(this),function(a){console.log(a),"function"==typeof b&&b(),this.isGeolocationLoading=!1}.bind(this))}},mounted:function(){SubscriptionData.IsGeolocationEnabled&&this.requestCurrentGeolocationPosition()}}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Mixins").LockFocus={data:function(){return{focusableElements:'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]'}},methods:{onKeyDownLockFocusWithinComponent:function(a){if("Tab"===a.key||9===a.keyCode){var b=this.$el.querySelectorAll(this.focusableElements),c=this.$el.querySelectorAll(this.focusableElements)[0],d=b[b.length-1];a.shiftKey?document.activeElement===c&&(d.focus(),a.preventDefault()):document.activeElement===d&&(c.focus(),a.preventDefault())}},focusOnFirstElement:function(){this.$el.querySelectorAll(this.focusableElements)[0].focus()}},mounted:function(){}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=a.$,e=b.resolve("SDM.Util");c.PCOLogin={computed:{isPCOLoading:function(){return this.isPCOGetLoginLinkLoading||this.isPCOGetUserDataLoading}},data:function(){return{pcoFirstName:"",pcoMemberId:"",pcoPointsBalance:0,pcoPointsValue:0,isPCOLoggedIn:!1,isPCOGetLoginLinkLoading:!1,isPCOGetUserDataLoading:!1,pcoLogoutUrl:"/Brooklyn/Logout",pcoLoginUrl:""}},methods:{getLoginLink:function(){this.isPCOGetLoginLinkLoading=!0,d.ajax({method:"GET",url:"/brooklyn/getloginlink"}).done(function(a){this.pcoLoginUrl=a}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isPCOGetLoginLinkLoading=!1}.bind(this))},getUserData:function(){console.log("Get User Data"),this.isPCOGetUserDataLoading=!0,d.ajax({contentType:"application/json",method:"GET",url:"/brooklyn/getpcouserdata",dataType:"json"}).done(function(a){console.log(a),a.FirstName&&a.MemberId&&(this.isPCOLoggedIn=!0,this.pcoFirstName=a.FirstName,this.pcoMemberId=a.MemberId,this.pcoPointsBalance=a.PointsBalance,this.pcoPointsValue=a.PointsValue)}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isPCOGetUserDataLoading=!1}.bind(this))},pcoLogout:function(){window.location.href=this.pcoLogoutUrl},pcoLogin:function(){window.location.href=this.pcoLoginUrl},pcoLoginWithRedirect:function(a){e.saveCookie("BMrdr",a),this.pcoLogin()},pcoLoginWithRedirectToCurrentUrl:function(){e.saveCookie("BMrdr",window.location.href),this.pcoLogin()}},mounted:function(){this.getUserData(),this.getLoginLink()}}}(this),function(a){"use strict";var b=a.NR,c=a._;b.resolve("SDM.Vue.Mixins").Responsive={computed:{isMobile:function(){return this.screenWidth<=this.maxWidthMobile},isMobileLarge:function(){return this.screenWidth>this.maxWidthMobile&&this.screenWidth<=this.maxWidthMobileLarge},isTablet:function(){return this.screenWidth>this.maxWidthMobileLarge&&this.screenWidth<=this.maxWidthTablet},isDesktop:function(){return this.screenWidth>this.maxWidthTablet&&this.screenWidth<=this.maxWidthDesktop},isDesktopLarge:function(){return this.screenWidth>this.maxWidthDesktop}},data:function(){return{screenWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),maxWidthMobile:480,maxWidthMobileLarge:640,maxWidthTablet:768,maxWidthDesktop:960}},methods:{onResponsiveResize:function(){this.screenWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0)}},mounted:function(){window.addEventListener("resize",c.debounce(this.onResponsiveResize,100))}}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Stores").Donation={actions:{setActivePanel:function(a,b){a.commit("setActivePanel",b)},setMoneyAmount:function(a,b){a.commit("setMoneyAmount",b)},setPcOptimumAmount:function(a,b){a.commit("setPcOptimumAmount",b)},setAddress:function(a,b){a.commit("setAddress",b)}},mutations:{setActivePanel:function(a,b){a.activePanel=b},setMoneyAmount:function(a,b){a.moneyAmount=b},setPcOptimumAmount:function(a,b){a.pcOptimumAmount=b},setAddress:function(a,b){a.address=b}},namespaced:!0,state:function(){return{activePanel:"",moneyAmount:"",panels:{introduction:"introduction",points:"points",money:"money",pcoptimum:"pcoptimum",confirmation:"confirmation",payer:"payer",completion:"completion"},pcOptimumAmount:"",address:{firstName:"",lastName:"",email:"",address1:"",address2:"",city:"",province:"",postalCode:""}}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Stores"),d=b.resolve("SDM.Util");c.StoreSelector={actions:{setCurrentPaginationNumber:function(a,b){a.commit("setCurrentPaginationNumber",b)},setInventories:function(a,b){a.commit("setInventories",b)},setIsStoreSelectorLoading:function(a,b){a.commit("setIsStoreSelectorLoading",b)},setPopUp:function(a,b){a.commit("setPopUp",b)},setPostalCode:function(a,b){a.commit("setPostalCode",b)},setProductImageUrl:function(a,b){a.commit("setProductImageUrl",b)},setProductHeading:function(a,b){a.commit("setProductHeading",b)},setProductSubheading:function(a,b){a.commit("setProductSubheading",b)},setProductUpc:function(a,b){a.commit("setProductUpc",b)},setSelectedStore:function(a,b){a.commit("setSelectedStore",b)},showPopUp:function(a){a.state.popUp&&a.state.popUp.showPopUp()},setStores:function(a,b){a.commit("setStores",b)}},getters:{selectedProduct:function(a){return""===a.productImageUrl&&""===a.productHeading&&""===a.productSubheading&&""===a.productUpc?null:{imageUrl:a.productImageUrl,heading:a.productHeading,subheading:a.productSubheading,upc:a.productUpc}}},mutations:{setInventories:function(a,b){a.inventories=d.mergeObjects(a.inventories,b)},setCurrentPaginationNumber:function(a,b){a.currentPaginationNumber=b},setIsStoreSelectorLoading:function(a,b){a.isStoreSelectorLoading=b},setPopUp:function(a,b){a.popUp=b},setPostalCode:function(a,b){a.postalCode=b},setProductImageUrl:function(a,b){a.productImageUrl=b},setProductHeading:function(a,b){a.productHeading=b},setProductSubheading:function(a,b){a.productSubheading=b},setProductUpc:function(a,b){a.productUpc=b},setSelectedStore:function(a,b){a.selectedStore=b},setStores:function(a,b){a.stores=b}},namespaced:!0,state:function(){return{currentPaginationNumber:1,inventories:{},isStoreSelectorLoading:!1,popUp:null,postalCode:"",productImageUrl:"",productHeading:"",productSubheading:"",productUpc:"",selectedStore:null,stores:[]}}}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Stores").ProvinceSelector={actions:{setUserProvinceId:function(a,b){a.commit("setUserProvinceId",b)}},getters:{},mutations:{setUserProvinceId:function(a,b){a.userProvinceId=b}},namespaced:!0,state:function(){return{userProvinceId:""}}}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Stores").FindInStore={actions:{setActiveProductListingIndex:function(a,b){a.commit("setActiveProductListingIndex",b)},setListingQuery:function(a,b){a.commit("setListingQuery",b)},setSearchQuery:function(a,b){a.commit("setSearchQuery",b)}},mutations:{setActiveProductListingIndex:function(a,b){a.activeProductListingIndex=b},setListingQuery:function(a,b){a.listingQuery=b},setSearchQuery:function(a,b){a.searchQuery=b}},namespaced:!0,state:function(){return{activeProductListingIndex:1,listingQuery:"",searchQuery:""}}}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Stores").ElasticSearch={actions:{elasticSearch:function(a,b){return a.commit("setElasticQuery",b),a.commit("setIsElasticSearchLoading",!0),new Promise(function(b,c){$.ajax({contentType:"application/json",data:JSON.stringify(a.getters.elasticSearchOptions),dataType:"json",headers:{authorization:"Bearer "+a.state.elasticKey},method:"POST",url:a.getters.elasticEndpoint+"/search"}).done(function(c){c&&(a.commit("setElasticSearchInfo",c.meta),a.commit("setElasticSearchResults",c.results),a.commit("setIsElasticSearchLoading",!0),c.meta&&a.commit("setElasticSearchTotalPage",Math.min(c.meta.page.total_pages,100))),b(c)}.bind(this)).fail(function(a){console.log(a),c(a)}).always(function(){a.commit("setIsElasticSearchLoading",!1)}.bind(this))})},setElasticEndpointBase:function(a,b){a.commit("setElasticEndpointBase",b)},setElasticEngineName:function(a,b){a.commit("setElasticEngineName",b)},setElasticKey:function(a,b){a.commit("setElasticKey",b)},setElasticSearchCurrentPage:function(a,b){a.commit("setElasticSearchCurrentPage",b)},setElasticSearchResultsPerPage:function(a,b){a.commit("setElasticSearchResultsPerPage",b)}},getters:{elasticEndpoint:function(a){return a.elasticEndpointBase+"/api/as/v1/engines/"+a.elasticEngineName},elasticSearchOptions:function(a){return{query:a.elasticQuery,page:{size:a.elasticSearchResultsPerPage,current:a.elasticSearchCurrentPage}}}},mutations:{setElasticEndpointBase:function(a,b){a.elasticEndpointBase=b},setElasticEngineName:function(a,b){a.elasticEngineName=b},setElasticKey:function(a,b){a.elasticKey=b},setIsElasticSearchLoading:function(a,b){a.isElasticSearchLoading=b},setElasticSearchCurrentPage:function(a,b){a.elasticSearchCurrentPage=b},setElasticSearchTotalPage:function(a,b){a.elasticSearchTotalPage=b},setElasticSearchInfo:function(a,b){a.elasticSearchInfo=b},setElasticSearchResults:function(a,b){a.elasticSearchResults=b},setElasticQuery:function(a,b){a.elasticQuery=b},setElasticSearchResultsPerPage:function(a,b){a.elasticSearchResultsPerPage=b}},namespaced:!0,state:function(){return{elasticSearchCurrentPage:1,elasticSearchTotalPage:0,elasticSearchInfo:null,elasticSearchResults:null,isElasticSearchLoading:!1,elasticSearchResultsPerPage:10,elasticEndpointBase:"",elasticEngineName:"",elasticKey:"",elasticQuery:""}}}}(this),function(){Vue.directive("click-outside",{bind:function(a,b,c){a.event=function(d){document.body.contains(d.target)&&!a.contains(d.target)&&c.context[b.expression](d)},setTimeout(function(){document.body.addEventListener("click",a.event)},0)},unbind:function(a){document.body.removeEventListener("click",a.event)}})}(),function(a){"use strict";a.NR.resolve("SDM.Vue.Widgets").Tablist={data:function(){return{focusableElementsQuery:'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]'}},methods:{onKeyDown:function(a){if(!(this.selectedTabIndex<0||this.selectedTabIndex>=this.tabsLength)){var b=this.selectedTabIndex-1%this.tabsLength,c=this.selectedTabIndex+1%this.tabsLength;switch(a.key){case"ArrowLeft":this.$emit("setSelectedTabIndex",b),a.preventDefault();break;case"ArrowRight":this.$emit("setSelectedTabIndex",c),a.preventDefault();break;case"Home":this.$emit("setSelectedTabIndex",0),a.preventDefault();break;case"End":this.$emit("setSelectedTabIndex",this.tabsLength-1),a.preventDefault();break;default:return}Vue.nextTick(function(){this.$refs.tablist.querySelectorAll('[role="tab"]')[this.selectedTabIndex].focus()}.bind(this))}},toggleTabIndex:function(){Vue.nextTick(function(){for(var a=0;a<this.tabsLength;a++){var b=this.$refs.tablist,c=b.querySelectorAll('[role="tab"]'),d=c[a];this.selectedTabIndex<0||this.selectedTabIndex>=this.tabsLength?d.tabIndex=0:this.selectedTabIndex===a?(d.tabIndex=0,d.focus()):d.tabIndex=-1}}.bind(this))}},model:{prop:"selectedTabIndex",event:"setSelectedTabIndex"},mounted:function(){this.toggleTabIndex()},props:{tabsLength:{type:Number,default:0},selectedTabIndex:{type:Number,default:-1}},template:"#vue-widget-tablist",watch:{selectedTabIndex:function(a){(a>=0||a<this.tabsLength)&&this.toggleTabIndex()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=b.resolve("SDM.Vue.Widgets");d.ProductCarousel={computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{isControlsInsetOnDevice:function(){return this.isDesktop||this.isDesktopLarge?this.isControlsInset.desktop:this.isTablet?this.isControlsInset.tablet:!(!this.isMobile&&!this.isMobileLarge)&&this.isControlsInset.mobile},isPaginationVisibleOnDevice:function(){return this.isDesktop||this.isDesktopLarge?this.isPaginationVisible.desktop:this.isTablet?this.isPaginationVisible.tablet:!(!this.isMobile&&!this.isMobileLarge)&&this.isPaginationVisible.mobile}}),data:function(){return{}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setProductImageUrl","setProductHeading","setProductUpc"]),{initializeCarousel:function(){$(this.$refs.carousel).length>0&&(this.$refs.carousel.hasOwnProperty("slick")&&$(this.$refs.carousel).slick("unslick"),$(this.$refs.carousel).slick({arrows:0!==this.slides.length&&this.isArrowsVisible.desktop,autoplay:this.isAutoplay.desktop,autoplaySpeed:5e3,dots:0!==this.slides.length&&this.isPaginationVisible.desktop,infinite:!1,lazyLoad:"ondemand",responsive:[{breakpoint:this.breakpoints.tablet,settings:{arrows:0!==this.slides.length&&this.isArrowsVisible.tablet,autoplay:this.isAutoplay.tablet,dots:0!==this.slides.length&&this.isPaginationVisible.tablet,slidesToShow:this.slidesToShow.tablet}},{breakpoint:this.breakpoints.mobile,settings:{arrows:0!==this.slides.length&&this.isArrowsVisible.mobile,autoplay:this.isAutoplay.mobile,dots:0!==this.slides.length&&this.isPaginationVisible.mobile,slidesToShow:this.slidesToShow.mobile}}],slidesToScroll:1,slidesToShow:this.slidesToShow.desktop,swipeToSlide:!0}))},checkAvailability:function(a){this.setProductImageUrl(a.image?a.image.url:""),this.setProductHeading(a.title),this.setProductUpc(a.id),this.popUp.showPopUp()}}),components:{"product-tile":d.ProductTile},mixins:[c.Responsive],mounted:function(){this.initializeCarousel()},props:{slides:{type:Array,default:[]},isArrowsVisible:{type:Object,default:function(){return{desktop:!0,tablet:!0,mobile:!0}}},isAutoplay:{type:Object,default:function(){return{desktop:!1,tablet:!1,mobile:!1}}},isControlsInset:{type:Object,default:function(){return{desktop:!1,tablet:!1,
mobile:!1}}},isPaginationVisible:{type:Object,default:function(){return{desktop:!1,tablet:!1,mobile:!1}}},slidesToShow:{type:Object,default:function(){return{desktop:3,tablet:2,mobile:1}}},breakpoints:{type:Object,default:function(){return{tablet:769,mobile:480}}}},template:"#vue-widget-product-carousel",updated:function(){this.initializeCarousel()},watch:{}}}(this,this.jQuery),function(a,b){"use strict";var c=a.NR,d=c.resolve("SDM.Vue.Widgets"),e=c.resolve("SDM.Util"),f=a.moment,g=a.uuidv4,h=c.resolve("SDM.Data.Donation");d.Donation={computed:Object.assign({},Vuex.mapState("donation",["activePanel","moneyAmount","panels","pcOptimumAmount","address"]),{activeStepNumber:function(){if(!0===h.IsLinkOut)switch(this.activePanel){case this.panels.introduction:return 1;case this.panels.points:case this.panels.money:case this.panels.pcoptimum:return 2;case this.panels.confirmation:case this.panels.completion:return 3}else switch(this.activePanel){case this.panels.introduction:case this.panels.points:case this.panels.money:case this.panels.pcoptimum:return 1;case this.panels.address:return 2;case this.panels.confirmation:return 3;case this.panels.completion:return this.selectedDonationType===this.donationTypes.points?2:4}},moneyAmountValue:{get:function(){return this.moneyAmount},set:function(a){this.setMoneyAmount(a)}},numberOfSteps:function(){if(!0===h.IsLinkOut)switch(this.activePanel){case this.panels.introduction:return 0;case this.panels.points:case this.panels.money:case this.panels.pcoptimum:case this.panels.confirmation:return 3;case this.panels.completion:return 4}else switch(this.activePanel){case this.panels.introduction:return 0;case this.panels.points:return 2;case this.panels.money:return 4;case this.panels.pcoptimum:return 2;case this.panels.address:case this.panels.confirmation:return 4;case this.panels.completion:return this.selectedDonationType===this.donationTypes.points?2:4}},isMoneyAmountValid:function(){var a=/^\d*(\.\d{1,2})?$/;return""!==this.moneyAmount&&this.moneyAmount>=parseFloat(h.MinimumMoneyAmount)&&this.moneyAmount.search(a)>=0},isPCOptimumAmountValid:function(){var a=/^[1-9]\d*$/;return""!==this.pcOptimumAmount&&this.pcOptimumAmount>=parseFloat(h.MinimumPointAmount)&&this.pcOptimumAmount.search(a)>=0},pcOptimumAmountValue:{get:function(){return this.pcOptimumAmount},set:function(a){this.setPcOptimumAmount(a)}},addressValue:{get:function(){return this.address},set:function(a){this.setAddress(a)}}}),data:function(){return{donationTypes:{money:"money",points:"points"},formDateTime:f().utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",formReferenceNumber:g(),formTransactionUUID:g(),isLoaderVisible:!1,isPCOptimumErrorVisible:!1,selectedDonationType:"",signature:""}},methods:Object.assign({},Vuex.mapActions("donation",["setActivePanel","setMoneyAmount","setPcOptimumAmount"]),{clearUrlParams:function(){var a="";a=-1===window.location.href.indexOf("?")?window.location.href:window.location.href.slice(0,window.location.href.indexOf("?")),history.pushState&&window.history.pushState("",null,a)},donatePCOptimumPoints:function(){this.isLoaderVisible=!0,b.ajax({context:this,data:{points:this.pcOptimumAmount},method:"POST",url:"/Brooklyn/Donate"}).done(function(a,c){if("success"===c&&"202"===a)this.setActivePanel(this.panels.completion);else{this.isPCOptimumErrorVisible=!0;var d=this.$refs.pcoPointsAmount;e.scrollTo$ElementAsync(b(d),500,this.scrollTopOffset+20),console.log("ERROR:"+a)}}).fail(function(a){this.isPCOptimumErrorVisible=!0;var c=this.$refs.pcoPointsAmount;e.scrollTo$ElementAsync(b(c),500,this.scrollTopOffset+20),console.log(a)}).always(function(){this.isLoaderVisible=!1})},getFormDataAsObject:function(a){for(var c=b(a).serializeArray(),d={},e=0;e<c.length;e++)d[c[e].name]=c[e].value;return d},getFrontStreamUrl:function(){var a=document.createElement("iframe");a.name="iframe_payment",a.id="iframe_payment",a.className="vue-widget-donation__iframe",a.src=this.signature,this.$refs.iframePaymentContainer.firstChild&&this.$refs.iframePaymentContainer.removeChild(this.$refs.iframePaymentContainer.firstChild),this.$refs.iframePaymentContainer.appendChild(a),this.isLoaderVisible=!0,b.ajax({contentType:"application/x-www-form-urlencoded",context:this,data:{donor:JSON.stringify(this.addressValue),amount:this.moneyAmountValue,languagePreference:"en-ca"===e.getFullLanguageCode()?"en-CA":"fr-CA"},headers:{__RequestVerificationToken:h.VerificationToken},method:"POST",url:"/LoveYou/getFrontStreamUrl"}).done(function(b,c){"success"===c?(this.signature=b,Vue.nextTick(function(){a.src=this.signature}.bind(this))):console.log("ERROR:"+response)}).fail(function(a){console.log(a)}).always(function(){this.isLoaderVisible=!1})},initializeData:function(){this.setPcOptimumAmount(""),this.setMoneyAmount(""),this.selectedDonationType="",this.signature="",this.isPCOptimumErrorVisible=!1},submitAddress:function(){this.$refs["form-address"].checkValidity()?(this.setActivePanel(this.panels.confirmation),this.scrollToTop(),Vue.nextTick(function(){this.getFrontStreamUrl()}.bind(this))):(this.$refs["form-address"].reportValidity(),Vue.nextTick(function(){var a=this.$refs["form-address"].querySelectorAll(":invalid")[0];e.scrollTo$ElementAsync(b(a),500,this.scrollTopOffset+20)}.bind(this)))},scrollToTop:function(){e.scrollTo$ElementAsync(b(this.$el),500,this.scrollTopOffset)}}),mounted:function(){if(this.setActivePanel(this.panels.introduction),h.IsLoggedIn){var a=e.getUrlVars();!a||"points"!==a.type&&"money"!==a.type||(this.selectedDonationType=a.type,this.setActivePanel(a.type),this.scrollToTop(),this.clearUrlParams())}window.addEventListener?window.addEventListener("message",function(a){h.FrontStreamUrl.includes(a.origin)&&("userCancelled"===a.data?this.setActivePanel(this.panels.address):this.setActivePanel(this.panels.completion),this.scrollToTop())}.bind(this)):window.attachEvent&&window.attachEvent("onmessage",function(a){h.FrontStreamUrl.includes(a.origin)&&("userCancelled"===a.data?this.setActivePanel(this.panels.address):this.setActivePanel(this.panels.completion),this.scrollToTop())}.bind(this))},props:{scrollTopOffset:{type:Number,default:0}},template:"#vue-widget-donation"}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Util");d.Navigation={computed:{},data:function(){return{isNavActive:!1}},methods:{toggleNav:function(){this.isNavActive=!this.isNavActive,this.isNavActive?(document.body.style.overflow="hidden",e.scrollTo$ElementAsync($(this.$el),500)):document.body.style.overflow="visible"},toggleNavOff:function(){this.isNavActive=!1,document.body.style.overflow="visible"},isAbsoluteUrlActive:function(a){return new URL(a,window.location.origin).pathname===window.location.pathname},onKeyDown:function(a){this.isDesktop||this.isDesktopLarge||!this.isNavActive||this.onKeyDownLockFocusWithinComponent(a)},onResize:function(){this.isNavActive=!1,document.body.style.overflow="visible"}},mixins:[c.Responsive,c.LockFocus],mounted:function(){},props:{menuLabel:{type:String,default:""},menuOpenLabel:{type:String,default:""},menuCloseLabel:{type:String,default:""},links:{type:Array,default:[]}},template:"#vue-widget-navigation",watch:{isDesktop:function(){this.isNavActive=!1,document.body.style.overflow="visible"},isDesktopLarge:function(){this.isNavActive=!1,document.body.style.overflow="visible"}}}}(this,this.jQuery),function(a,b){"use strict";var c=a.NR,d=c.resolve("SDM.Vue.Mixins");c.resolve("SDM.Vue.Widgets").PopUp={computed:{isContentVisible:function(){return!this.isOnCloseUnmountContent||this.isPopUpVisible}},data:function(){return{isPopUpVisible:!1}},methods:{hidePopUp:function(){this.isPopUpVisible=!1;var a=b(this.$refs.content);b(document.body).css("overflow","auto"),a.velocity({top:"100%"},300),this.$root.$emit("pop-up-closed")},showPopUp:function(){this.isPopUpVisible=!0,Vue.nextTick(function(){var a=b(this.$refs.content),c=500;a.velocity({top:"0%"},c,[210,19]),setTimeout(function(){b(document.body).css("overflow","hidden"),this.focusOnFirstElement()}.bind(this),c)}.bind(this))},initListeners:function(){var a=this;this.$root.$on("pop-up-closed-footer",function(){a.hidePopUp()})}},mixins:[d.LockFocus],mounted:function(){this.initListeners()},props:{isOnCloseUnmountContent:{type:Boolean,default:!0},ariaLabels:{type:Object,default:function(){return{en:"Store Selector",fr:"Slecteur de magasin"}}}},template:"#vue-widget-pop-up",watch:{}}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Util"),e=a.$;c.FindInStoreListing={computed:Object.assign({},Vuex.mapState("elasticSearch",["elasticSearchResults","elasticSearchCurrentPage","elasticSearchTotalPage"]),Vuex.mapState("findInStore",["activeProductListingIndex","listingQuery"]),Vuex.mapState("storeSelector",["popUp","selectedStore"]),{paginationPages:function(){for(var a=Math.max(1,Math.min(this.elasticSearchCurrentPage-this.paginationRange,this.elasticSearchTotalPage-2*this.paginationRange)),b=Math.min(this.elasticSearchTotalPage,Math.max(this.elasticSearchCurrentPage+this.paginationRange,a+2*this.paginationRange)),c=[],d=a;d<=b;d++)c.push(d);return c}}),data:function(){return{isListingLoading:!1,paginationRange:3,products:[],productsPerPage:16,powerReviewArray:[]}},methods:Object.assign({},Vuex.mapActions("elasticSearch",["elasticSearch","setElasticSearchCurrentPage","setElasticSearchResultsPerPage"]),Vuex.mapActions("findInStore",["setActiveProductListingIndex","setSelectedProduct"]),Vuex.mapActions("storeSelector",["setInventories","setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc"]),{convertStringToSlug:function(a){return d.convertStringToSlug(a)},focusOnFirstElement:function(){if(this.$el){var a='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]',b=this.$el.querySelectorAll(a)[0];b&&b.focus()}},getProductInventoryFromSelectedStore:function(a){var b=JSON.parse(a.localinventory.raw),c=b?b[this.selectedStore.id]:0;return c||0},goToProductPage:function(a){this.setActiveProductListingIndex(a),this.setElasticSearchCurrentPage(a),this.setElasticSearchResultsPerPage(this.productsPerPage),this.isListingLoading=!0,this.elasticSearch(this.listingQuery).then(function(a){a&&(this.products=this.elasticSearchResults,d.scrollTo$ElementAsync(e(this.$refs.products),500),this.isListingLoading=!1,this.focusOnFirstElement())}.bind(this))},loadMoreProducts:function(a){this.setActiveProductListingIndex(this.activeProductListingIndex+1),this.setElasticSearchCurrentPage(this.elasticSearchCurrentPage+1),this.setElasticSearchResultsPerPage(this.productsPerPage),this.isListingLoading=!0,this.elasticSearch(this.listingQuery).then(function(b){b&&(this.products=this.products.concat(this.elasticSearchResults),d.scrollTo$ElementAsync(e(a.target),500),this.isListingLoading=!1,Vue.nextTick(function(){var a=this.$el.querySelectorAll(".vue-widget-find-in-store-listing__product");a[a.length-this.productsPerPage].focus()}.bind(this)))}.bind(this))},storeSelectorInventoryTransformer:function(a){var b={};if(!a.upc.raw)return[];var c=JSON.parse(a.localinventory.raw);return Object.keys(c).map(function(d){b[d]={},b[d][a.upc.raw]=c[d]}.bind(this)),b},showStoreSelector:function(a){this.setInventories(this.storeSelectorInventoryTransformer(a)),this.setProductImageUrl(a.imageurl.raw),this.setProductHeading(a.title.raw),this.setProductUpc(a.upc.raw),this.popUp.showPopUp()}}),mounted:function(){""!==this.listingQuery&&(this.setElasticSearchResultsPerPage(this.productsPerPage),this.isListingLoading=!0,this.elasticSearch(this.listingQuery).then(function(a){a&&(this.products=this.elasticSearchResults,this.isListingLoading=!1,this.focusOnFirstElement(),setTimeout(function(){d.scrollTo$ElementAsync(e(this.$refs.products),500)}.bind(this),this.mountedAutoScrollDelayMs))}.bind(this)))},name:"FindInStoreListing",props:{productBasePath:{type:String,default:"/product/"},mountedAutoScrollDelayMs:{type:Number,default:0},powerReviewsApiKey:{type:String},powerReviewsMerchantId:{type:String},powerReviewsMerchantGroupId:{type:String},powerReviewsLocale:{type:String}},template:"#vue-widget-find-in-store-listing",watch:{listingQuery:function(a){""!==a&&(this.products=[],this.setElasticSearchCurrentPage(1),this.setElasticSearchResultsPerPage(this.productsPerPage),this.isListingLoading=!0,this.elasticSearch(a).then(function(a){a&&(this.products=this.elasticSearchResults,d.scrollTo$ElementAsync(e(this.$refs.products),500),this.isListingLoading=!1,this.focusOnFirstElement())}.bind(this)))},products:function(a){this.powerReviewsApiKey&&this.powerReviewsMerchantId&&this.powerReviewsMerchantGroupId&&this.powerReviewsLocale&&(this.$refs.powerreviewsSnippet&&this.$refs.powerreviewsSnippet.forEach(function(a){a.innerHTML=""}),this.powerReviewArray=[],a.forEach(function(a){this.powerReviewArray.push({api_key:this.powerReviewsApiKey,locale:this.powerReviewsLocale,merchant_group_id:this.powerReviewsMerchantGroupId,merchant_id:this.powerReviewsMerchantId,page_id:a.upc.raw,components:{CategorySnippet:"powerreviews-snippet-"+a.upc.raw}})}.bind(this)),Vue.nextTick(function(){pwr("render",this.powerReviewArray)}.bind(this)))}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Util"),e=a.$;c.FindInStoreProduct={components:{tablist:c.Tablist},computed:Object.assign({},Vuex.mapState("storeSelector",["currentPaginationNumber","isStoreSelectorLoading","popUp","stores","selectedStore"]),Vuex.mapState("elasticSearch",["elasticSearchResults","isElasticSearchLoading"]),{isLoading:function(){return this.isStoreSelectorLoading&&0===this.storesNearby.length||this.isElasticSearchLoading},productInventory:function(){return JSON.parse(this.product.localinventory.raw)},storeSelectorInventories:function(){var a={};return this.product.upc.raw?(Object.keys(this.productInventory).map(function(b){a[b]={},a[b][this.product.upc.raw]=this.productInventory[b]}.bind(this)),a):[]}}),data:function(){return{storesNearby:[],product:null,selectedTabIndex:[],isTablistExpanded:!1,tablistEnum:{hours:0,map:1}}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setInventories","setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc"]),Vuex.mapActions("elasticSearch",["elasticSearch","setElasticEndpointBase","setElasticEngineName","setElasticKey","setElasticSearchResultsPerPage","setElasticSearchCurrentPage"]),{showStoreSelector:function(){this.setInventories(this.storeSelectorInventories),this.setProductImageUrl(this.product.imageurl?this.product.imageurl.raw:""),this.setProductHeading(this.product.title?this.product.title.raw:""),this.setProductUpc(this.product.upc?this.product.upc.raw:""),this.popUp.showPopUp()},initializeMaps:function(){Vue.nextTick(function(){if(this.$refs.map&&this.$refs.map.length>0)for(var b=0;b<this.$refs.map.length;b++){var c=new a.google.maps.Map(this.$refs.map[b],{center:{lat:this.storesNearby[b+1].latitude,lng:this.storesNearby[b+1].longitude},minZoom:10,maxZoom:17,zoom:15});new google.maps.Marker({position:{lat:this.storesNearby[b+1].latitude,lng:this.storesNearby[b+1].longitude},map:c,label:this.storesNearby[b+1].title,icon:{scaledSize:new google.maps.Size(30,43),url:"/static/core/images/icon-pin.png"}})}}.bind(this))},searchProduct:function(){this.setElasticEndpointBase(this.elasticEndpointBase),this.setElasticEngineName(this.elasticEngineName),this.setElasticKey(this.elasticKey),"product"===this.$route.name&&(this.setElasticSearchResultsPerPage(1),this.setElasticSearchCurrentPage(1),this.elasticSearch(this.$route.params.upc).then(function(a){if(a){var b=this.elasticSearchResults.find(function(a){return a.upc.raw===this.$route.params.upc}.bind(this));this.product=b,setTimeout(function(){d.scrollTo$ElementAsync(e(this.$refs.product),500),this.updateStoresNearby()}.bind(this),this.mountedAutoScrollDelayMs)}}.bind(this)))},updateStoresNearby:function(){if(1===this.currentPaginationNumber){this.storesNearby=this.stores;for(var a=0;a<this.stores.length;a++)this.selectedTabIndex[a]=-1;e.when(SDM.Util.loadGoogleMapsApi()).then(this.initializeMaps)}}}),mounted:function(){this.searchProduct()},name:"FindInStoreProduct",props:{elasticEndpointBase:{type:String,required:!0},elasticEngineName:{type:String,required:!0},elasticKey:{type:String,required:!0},mountedAutoScrollDelayMs:{type:Number,default:0},isCompactStyle:{type:Boolean,default:!1}},template:"#vue-widget-find-in-store-product",watch:{stores:function(){this.updateStoresNearby()},selectedProduct:function(){if(this.$refs.productContent){this.$refs.product.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]')[0].focus()}},$route:function(){this.searchProduct()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Util");c.FindInStoreSearch={computed:Object.assign({},Vuex.mapState("findInStore",["searchQuery"]),Vuex.mapState("elasticSearch",["isElasticSearchLoading","elasticSearchResults","elasticSearchCurrentPage","elasticSearchTotalPage"]),{query:{get:function(){return this.searchQuery},set:function(a){this.setSearchQuery(a)}}}),data:function(){return{isSearchActive:!1,products:[],timeoutSearchFunction:null}},methods:Object.assign({},Vuex.mapActions("findInStore",["setActiveProductListingIndex","setListingQuery","setSearchQuery"]),Vuex.mapActions("elasticSearch",["elasticSearch","setElasticEndpointBase","setElasticEngineName","setElasticKey","setElasticSearchCurrentPage","setElasticSearchResultsPerPage"]),{convertStringToSlug:function(a){return d.convertStringToSlug(a)},goToListing:function(){"listing"!==this.$route.name&&""!==this.query&&this.$router.push({name:"listing"}),this.setActiveProductListingIndex(1),this.setListingQuery(this.query),this.isSearchActive=!1},loadMoreProducts:function(){this.elasticSearchCurrentPage<this.elasticSearchTotalPage&&""!==this.query&&(this.setElasticSearchCurrentPage(this.elasticSearchCurrentPage+1),this.setElasticSearchResultsPerPage(10),this.elasticSearch(this.query).then(function(a){a&&(this.products=this.products.concat(this.elasticSearchResults))}.bind(this)))},onSearchInputFocus:function(){this.isSearchActive=!0,0===this.products.length&&this.search()},onSearchInputBlur:function(){this.isSearchActive=!1},search:function(){this.isSearchActive=!0,this.products=[],this.setElasticSearchCurrentPage(1),this.setElasticSearchResultsPerPage(10),""!==this.query&&this.elasticSearch(this.query).then(function(a){a&&(this.products=[],this.setElasticSearchCurrentPage(1),this.products=this.products.concat(this.elasticSearchResults))}.bind(this))},onSearchKeyup:function(a){clearTimeout(this.timeoutSearchFunction),13!==(a.keyCode?a.keyCode:a.which)&&(this.timeoutSearchFunction=setTimeout(this.search,this.searchDelay))}}),mounted:function(){this.setElasticEndpointBase(this.elasticEndpointBase),this.setElasticEngineName(this.elasticEngineName),this.setElasticKey(this.elasticKey)},name:"FindInStoreSearch",props:{elasticEndpointBase:{type:String,required:!0},elasticEngineName:{type:String,required:!0},elasticKey:{type:String,required:!0},productBasePath:{type:String,default:"/product/"},searchDelay:{type:Number,default:300}},template:"#vue-widget-find-in-store-search"}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Widgets").ProductTile={computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{}),data:function(){return{isImageLoading:!0}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setProductImageUrl","setProductHeading","setProductUpc"]),{checkAvailability:function(){this.setProductImageUrl(this.product.image?this.product.image.src:""),this.setProductHeading(this.product.title),this.setProductUpc(this.product.id),this.popUp.showPopUp()},onImageLoaded:function(){this.isImageLoading=!1}}),mounted:function(){this.isImageLoading=!0},props:{cta:{type:Object,default:null},inventory:{type:Object,default:null},isInventoryDisabled:{type:Boolean,default:!1},product:{type:Object,default:null}},template:"#vue-widget-product-tile",watch:{product:function(){this.isImageLoading=!0}}}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=a.Vue;c.SearchWithAutocomplete=d.component("search-with-autocomplete",{computed:{isDropDownOpen:function(){return this.hasFocus&&(this.isLoading||this.suggestions.length>0)}},created:function(){this.dropDownElId=this.uniqueIdPrefix+"_DropDown",this.query=this.initialValue},data:function(){return{cachedQuery:"",hasFocus:!1,selectedIndex:-1,query:""}},methods:{clearSuggestions:function(){this.selectedIndex=-1,this.$emit("clear")},decrementSelectedIndex:function(){if(!(this.isLoading||this.suggestions.length<=0)){var a=this.selectedIndex-1;a<-1&&(a=this.suggestions.length-1),this.selectedIndex=a}},focus:function(){this.$refs.input.focus()},incrementSelectedIndex:function(){if(!(this.isLoading||this.suggestions.length<=0)){var a=this.selectedIndex+1;a>this.suggestions.length-1&&(a=-1),this.selectedIndex=a}},makeLinkElId:function(a){return this.uniqueIdPrefix+"_Link_"+String(a)},onFocusChange:function(){setTimeout(_.bind(function(){var a=document.activeElement,b=_.some(this.$el.querySelectorAll("*"),function(b){return b===a});this.setHasFocus(b)},this),50)},onInput:function(){this.selectedIndex=-1,this.cachedQuery=null,this.query.length>2?this.$emit("fetch",this.query):this.clearSuggestions()},onLinkFocus:function(a){this.selectedIndex=a,this.onFocusChange()},onSubmit:function(a){this.query||a.preventDefault();var b=null;this.cachedQuery=this.query,this.selectedIndex>-1&&(b=(this.$refs.suggestionLinks||[])[this.selectedIndex])&&(a.preventDefault(),b.click()),this.clearSuggestions(),this.$emit("submit",a)},setHasFocus:function(a){this.hasFocus=a,this.cachedQuery=this.query}},props:{dropDownClass:{default:"",required:!1,type:String},dropDownTitle:{default:"",required:!1,type:String},formClass:{default:"",required:!1,type:String},initialValue:{default:"",required:!1,type:String},inputClass:{default:"",required:!1,type:String},isLoading:{default:!1,required:!1,type:Boolean},placeholder:{default:"",required:!1,type:String},submitLabel:{default:"",required:!0,type:String},suggestions:{default:function(){return[]},required:!0,type:Array},uniqueIdPrefix:{default:"",required:!0,type:String}},template:"#SearchWithAutocompleteTemplate",watch:{selectedIndex:function(){-1===this.selectedIndex?(this.query=this.cachedQuery||this.query,this.cachedQuery=null):(this.cachedQuery=this.cachedQuery||this.query,this.query=this.suggestions[this.selectedIndex].title)}}})}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Util"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Vue.Stores");d.StoreSelectorModal={components:{"pop-up":d.PopUp},computed:Object.assign({},Vuex.mapGetters("storeSelector",["selectedProduct"]),Vuex.mapState("storeSelector",["currentPaginationNumber","inventories","isStoreSelectorLoading","popUp","postalCode","selectedStore","stores"]),{firstPaginationNumber:function(){return Math.max(1,Math.min(this.currentPaginationNumber-1,this.maxPaginationNumber-2))},secondPaginationNumber:function(){return this.firstPaginationNumber+1},thirdPaginationNumber:function(){return this.firstPaginationNumber+2},maxPaginationNumber:function(){return this.stores.length>0?Math.ceil(this.searchResultCount/this.storesPerPage):1},postalCodeInput:{get:function(){return this.postalCode},set:function(a){this.setPostalCode(a)}},sortedStoreIdsByAvailability:function(){if(!this.selectedProduct)return[];var a={};for(var b in this.inventories)if(this.inventories.hasOwnProperty(b)){var c=this.inventories[b][this.selectedProduct.upc];c&&(a[b]=c)}return Object.keys(a).sort(function(b,c){return a[b]-a[c]})}}),data:function(){return{isRadiusDropdownActive:!1,isStoreSearchEmptyResult:!1,isStoreSearchInvalidPostalCode:!1,isStoreSelectorPopUpVisible:!1,lastSelectedProduct:null,radiusList:[3,5,10,20],searchLatitude:0,searchLongitude:0,selectedRadius:3,searchResultCount:0,storesPerPage:5}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setCurrentPaginationNumber","setIsStoreSelectorLoading","setPopUp","setPostalCode","setSelectedStore","setStores"]),{initGeolocation:function(){var a=this.requrestGeolocation();$.when(a).then(_.bind(function(a){if(a){this.searchLatitude=a.lat,this.searchLongitude=a.lng;var b={latitude:this.searchLatitude,longitude:this.searchLongitude,radius:"3",unit:"km",lookup:"nearby",rpp:"5",isConsolePreorder:this.isConsolePreorder};this.setIsStoreSelectorLoading(!0),$.when(this.getStores(b)).done(_.bind(function(a){if(a){var b=JSON.parse(a);""===this.postalCodeInput&&b.results.length>0&&(this.postalCodeInput=b.results[0].postalCode,this.setSelectedStore(b.results[0]),sessionStorage.setItem("selected_store_latlng",JSON.stringify({lat:b.results[0].latitude,lng:b.results[0].longitude})),this.setStores(b.results),this.searchResultCount=b.count)}},this)).fail(function(a){console.log(a)}).always(function(){this.setIsStoreSelectorLoading(!1)}.bind(this))}},this))},requrestGeolocation:function(){var a=$.Deferred(),b=JSON.parse(sessionStorage.getItem("selected_store_latlng"));return b?a.resolve(b):navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a.resolve({lat:b.coords.latitude,lng:b.coords.longitude})},function(b){console.log(b),a.resolve(null)}):a.resolve(null),a.promise()},onPostalCodeSubmit:function(){this.isRadiusDropdownActive=!1,this.setIsStoreSelectorLoading(!0),c.validatePostalCode(this.postalCodeInput)?(this.isStoreSearchEmptyResult=!1,this.isStoreSearchInvalidPostalCode=!1,$.when(c.loadGoogleMapsApi()).then(_.bind(function(){this.geocoder=new a.google.maps.Geocoder,this.geocoder.geocode({address:this.postalCodeInput},_.bind(this.geocoderCallback,this))},this))):(this.isStoreSearchInvalidPostalCode=!0,this.setIsStoreSelectorLoading(!1))},geocoderCallback:function(b,c){if(c===a.google.maps.GeocoderStatus.OK){var d=b[0].geometry.location;this.setCurrentPaginationNumber(1),this.searchLatitude=d.lat(),this.searchLongitude=d.lng();var e={latitude:d.lat(),longitude:d.lng(),radius:this.selectedRadius,unit:"km",lookup:"nearby",rpp:this.storesPerPage,productId:this.selectedProduct?this.selectedProduct.upc:null,isConsolePreorder:this.isConsolePreorder};this.setIsStoreSelectorLoading(!0),$.when(this.getStores(e)).done(_.bind(function(a){if(a){var b=JSON.parse(a);b.results.length>0?(this.setStores(b.results),this.searchResultCount=b.count):this.isStoreSearchEmptyResult=!0,this.setIsStoreSelectorLoading(!1),this.lastSelectedProduct=this.selectedProduct}},this)).fail(function(a){console.log(a)}).always(function(){this.setIsStoreSelectorLoading(!1)}.bind(this))}else this.isStoreSearchEmptyResult=!0,this.setIsStoreSelectorLoading(!1)},getInventoryFromStoreNumber:function(a){return this.inventories&&this.inventories[a]&&this.inventories[a][this.selectedProduct.upc]?this.inventories[a][this.selectedProduct.upc]:0},getUrlParametersAsObject:function(a){return JSON.parse('{"'+decodeURI(a).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')},getStores:function(a){return $.ajax({method:"GET",url:"/"+c.getShortLanguageCode()+"/store/getstores",data:a})},getStoresByIds:function(){$.ajax({method:"GET",url:"/"+c.getShortLanguageCode()+"/store/getstoresbyids",data:{storeids:this.sortedStoreIdsByAvailability.slice((this.currentPaginationNumber-1)*this.storesPerPage,this.storesPerPage).join(",")}}).done(_.bind(function(a){console.log(a)},this)).fail(function(a){console.log(a)})},goToPage:function(a){this.setIsStoreSelectorLoading(!0);var b={latitude:this.searchLatitude,longitude:this.searchLongitude,radius:this.selectedRadius,unit:"km",lookup:"nearby",rpp:this.storesPerPage,page:a,productId:this.selectedProduct?this.selectedProduct.upc:null,isConsolePreorder:this.isConsolePreorder};$.when(this.getStores(b)).done(_.bind(function(a){if(a){var b=JSON.parse(a);b.results.length>0?(this.setStores(b.results),this.searchResultCount=b.count):this.isStoreSearchEmptyResult=!0,this.setIsStoreSelectorLoading(!1),this.lastSelectedProduct=this.selectedProduct}},this)).fail(function(a){console.log(a)}).always(function(){this.setIsStoreSelectorLoading(!1)}.bind(this)),this.setCurrentPaginationNumber(a)},registerStoreModule:function(){this.$store.hasModule("storeSelector")||this.$store.registerModule("storeSelector",e.StoreSelector)},selectStore:function(a){this.setSelectedStore(a),sessionStorage.setItem("selected_store_latlng",JSON.stringify({lat:a.latitude,lng:a.longitude})),this.postalCodeInput=a.postalCode,this.popUp.hidePopUp(),this.onPostalCodeSubmit()},setSelectedRadius:function(a){this.selectedRadius=a},sortByDistance:function(){this.setCurrentPaginationNumber(1),this.isSortByInventory=!1,this.onPostalCodeSubmit()},sortByAvailability:function(){this.setCurrentPaginationNumber(1),this.isSortByInventory=!0,this.onPostalCodeSubmit()}}),mounted:function(){this.registerStoreModule(),this.setPopUp(this.$refs.popUpStoreSelector),this.initGeolocation(),""!==this.postalCodeInput&&this.onPostalCodeSubmit()},props:{isConsolePreorder:{type:Boolean,default:!1}},template:"#vue-widget-store-selector-modal",watch:{selectedProduct:function(){this.selectedProduct!==this.lastSelectedProduct&&""!==this.postalCodeInput&&this.onPostalCodeSubmit()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Mixins");c.StoreSelector={components:{"store-selector-modal":c.StoreSelectorModal},computed:Object.assign({},Vuex.mapState("storeSelector",["popUp","selectedStore"]),{}),data:function(){return{isStoreInfoVisible:!1}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc","setSelectedStore"]),{hideStoreInfo:function(){this.isStoreInfoVisible=!1},onSelectStoreClick:function(){this.setProductImageUrl(""),this.setProductHeading(""),this.setProductSubheading(""),this.setProductUpc(""),this.popUp.showPopUp()},registerStoreModule:function(){this.$store.hasModule("storeSelector")||this.$store.registerModule("storeSelector",d.StoreSelector)}}),mixins:[e.Responsive],mounted:function(){this.registerStoreModule()},props:{colorPrimary:{type:String,default:""},colorSecondary:{type:String,default:""},isMinimalOnMobile:{type:Boolean,default:!1},icon:{type:String,default:"/static/core/images/icon-pin-small.png"}},template:"#vue-widget-store-selector"}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Util");c.ProvinceSelector={created:function(){document.addEventListener("click",function(a){this.$refs.refProvinceSelector&&!this.$refs.refProvinceSelector.contains(a.target)&&(this.isProvinceSelectorActive=!1)}.bind(this))},components:{},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),data:function(){return{isProvinceSelectorActive:!1}},methods:Object.assign({},Vuex.mapActions("provinceSelector",["setUserProvinceId"]),{registerStoreModule:function(){this.$store.hasModule("provinceSelector")||this.$store.registerModule("provinceSelector",d.provinceSelector)},selectUserProvinceId:function(a){f.saveCookie("user-province-id",a),this.isProvinceSelectorActive=!1,this.model.provinceSelectorSettings&&this.model.provinceSelectorSettings.refreshPageOnSelect?location.reload(!0):this.setUserProvinceId(a)}}),mixins:[e.Responsive],mounted:function(){if(this.registerStoreModule(),this.model.provinces){var a=JSON.parse(f.getValueFromCookie("sdm-location")),b=a&&a.province?a.province:"",c=f.getValueFromCookie("user-province-id");this.setUserProvinceId((c||b).toUpperCase())
;var d=-1!==this.model.provinces.findIndex(function(a){return a.abbreviation.toUpperCase()===this.userProvinceId.toUpperCase()}.bind(this)),e=-1!==this.model.provinces.findIndex(function(a){return"ON"===a.abbreviation.toUpperCase()}.bind(this)),g=-1!==this.model.provinces.findIndex(function(a){return"QC"===a.abbreviation.toUpperCase()}.bind(this));d||(f.isPhx()&&g?this.setUserProvinceId("QC"):!f.isPhx()&&e?this.setUserProvinceId("ON"):this.setUserProvinceId(this.provinces[0].abbreviation.toUpperCase())),c||this.setUserProvinceId(this.userProvinceId)}},props:{model:{type:Object,required:!0}},template:"#vue-widget-province-selector"}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Widgets"),f=b.resolve("SDM.Data.Apple");c.Apple=function(){var a=new Vuex.Store({modules:{storeSelector:d.StoreSelector}}),b={methods:{findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c)return a[d];return null}}},c=function(a){return a?("#"+a).replace(/#+/g,"#"):null},g={190199246850:_.map(f.AirPodsProRivers||[],function(a){return{additionalHtml:a.AdditionalHtml||null,body:a.BodyHtml,colorBgLeft:c(a.ColorBgLeftHex||"fff"),colorBgRight:c(a.ColorBgRightHex),colorFg:c(a.ColorBaseTextHex||"1d1d1f"),colorHeading:c(a.ColorHeadingOverrideHex),hasPadding:a.IsPadded,heading:a.Heading||"",isHeadingTop:a.IsHeadingAbove,isImageFull:a.IsImageFullSize,isImageRight:a.IsImageRight,isImageTop:a.IsImageAtTop,isImageWide:a.IsImageWide,imageAlt:a.Image?a.Image.Label||"":"",imageUrl:a.Image?a.Image.URL:null,subheading:a.Subheading||""}})};Vue.component("apple-hero",{template:"#module-apple-hero-template",props:{},data:function(){return{tabsContent:f.Tabs}},mounted:function(){},methods:{beforeEnter:function(a){a.style.opacity=0,a.style.position="absolute",a.style.top=0},enter:function(a,b){TweenLite.set(a,{position:"relative",delay:.5}),TweenLite.to(a,.5,{opacity:1,delay:.3,onComplete:b})},leave:function(a,b){TweenLite.to(a,.5,{opacity:0,onComplete:b})}}}),Vue.component("apple-navigation",{template:"#module-apple-navigation-template",props:{},data:function(){return{isMenuOpen:!1,navigationContainer:"",tabsContent:f.Tabs}},mounted:function(){this.navigationContainer=document.querySelector(".module-apple-navigation__list-container"),window.addEventListener("resize",this.onWindowResize)},methods:{onMobileMenuButtonClick:function(){this.isMenuOpen=!this.isMenuOpen,this.isMenuOpen?(TweenLite.set(this.navigationContainer,{height:"auto"}),TweenLite.from(this.navigationContainer,.3,{height:0})):TweenLite.to(this.navigationContainer,.3,{height:"62px"})},onWindowResize:function(){window.innerWidth>640?(this.isMenuOpen=!1,TweenLite.to(this.navigationContainer,.3,{height:"68px"})):(this.isMenuOpen=!1,TweenLite.to(this.navigationContainer,.3,{height:"62px"}))}},watch:{$route:function(){this.isMenuOpen=!1,window.innerWidth<641&&TweenLite.to(this.navigationContainer,.3,{height:"59px"})}}});var h={template:"#module-apple-home-template",mounted:function(){this.$el.style.opacity=0,TweenLite.to(this.$el,.5,{opacity:1,delay:.6})}},i={template:"#module-apple-products-grid-template",mixins:[b],props:{discoverMore:String},data:function(){return{productsArrayData:[],productsArray:[]}},mounted:function(){this.productsArrayData=this.findObjectByKey(f.Tabs,"TabFriendlyUrlName",this.$route.fullPath.split("/")[1]).Products,this.initProductsArrayData()},methods:Object.assign({},Vuex.mapActions("storeSelector",["setInventories","setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc"]),{initProductsArrayData:function(){for(var a=0;a<this.productsArrayData.length;a++){var b={};b.id=this.productsArrayData[a].UpcStripped,b.link="/"+this.$route.path.split("/")[1]+"/"+this.productsArrayData[a].Upc,b.title=this.productsArrayData[a].Content.Title,this.productsArrayData[a].Assets?(b.imageSrc=this.productsArrayData[a].Assets[0].Url,b.imageAltText=b.title):(b.imageSrc="",b.imageAltText=""),b.upc=this.productsArrayData[a].UpcStripped,this.productsArray.push(b)}if(this.discoverMore){for(var c=0;c<this.productsArray.length;c++)if(this.productsArray[c].upc.toString().toLowerCase()===this.$route.params.productId){this.productsArray.splice(c,1);break}this.productsArray=this.productsArray.sort(function(){return Math.random()-.5}).slice(0,4)}},checkAvailability:function(a){this.setProductImageUrl(a.imageSrc),this.setProductHeading(a.title),this.setProductUpc(a.upc),this.popUp.showPopUp()},onImageLoaded:function(){this.isImageLoading=!1}}),computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]))},j={template:"#module-apple-product-details-template",mixins:[b],data:function(){return{backLinkUrl:"",backLinkLabel:"",currentImage:"",currentImageIndex:0,productBuyNowLink:"",productData:{},productDetailsData:{},productImages:[],productSubTitle:"",productTitle:"",productUpc:"",product:{},riverContents:{}}},mounted:function(){this.productDetailsData=this.findObjectByKey(f.Tabs,"TabFriendlyUrlName",this.$route.fullPath.split("/")[1]),this.productData=this.findObjectByKey(this.productDetailsData.Products,"Upc",this.$route.params.productId),this.backLinkUrl="/"+this.productDetailsData.TabFriendlyUrlName,this.backLinkLabel=this.productDetailsData.TabTitle;var a=this.$route.params.productId||null;this.riverContents=g[a]||[],this.productData.Assets.length>0&&(this.productImages=this.productData.Assets),this.initProductData()},methods:Object.assign({},Vuex.mapActions("storeSelector",["setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc"]),{initProductData:function(){this.productImages.length>0?(this.currentImage=this.productImages[this.currentImageIndex],this.product.imageSrc=this.productImages[0].Url):(this.currentImage="",this.product.imageSrc=""),this.product.id=this.productData.UpcStripped,this.product.title=this.productData.Content.Title,this.product.subTitle=this.productData.Content.SupplementTitleText,this.product.upc=this.productData.UpcStripped,this.productBuyNowLink=this.productData.BuyNowLink,this.product.description=this.productData.Content.Description},thumbnailClick:function(a){this.currentImageIndex=a,this.currentImage=this.productImages[this.currentImageIndex]},checkAvailability:function(a){this.setProductImageUrl(a.imageSrc),this.setProductHeading(a.title),this.setProductUpc(a.upc),this.popUp.showPopUp()}}),computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]))};Vue.component("products-grid",i),Vue.component("product-details",j),Vue.component("store-selector",e.StoreSelector);for(var k=[{path:"/",components:{mainContent:h}}],l=0;l<f.Tabs.length;l++){var m={template:"#module-apple-"+f.Tabs[l].TabFriendlyUrlName+"-template"};k.push({path:"/"+f.Tabs[l].TabFriendlyUrlName,components:{mainContent:m}}),k.push({path:"/"+f.Tabs[l].TabFriendlyUrlName+"/:productId",components:{mainContent:j}})}var n=new VueRouter({base:document.querySelector("[data-module-apple-base]").dataset.moduleAppleBase,mode:"history",routes:k});new Vue({el:"#module-apple",router:n,store:a,mounted:function(){this.setInventories(DataApple.Inventories.Stores)},methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"})),watch:{$route:function(){$("html, body").animate({scrollTop:0})}}})}}(this),function(a){"use strict";var b=a.Vue,c=a.jQuery,d=a._,e=a.NR,f=e.resolve("SDM.Core.Modules"),g=e.resolve("SDM.ConditionSearch.Data"),h=e.resolve("SDM.Vue.Widgets"),i=e.resolve("SDM.Util"),j=h.SearchWithAutocomplete,k=5;f.ConditionSearch=function(a){new b({name:"ConditionSearch",components:{searchWithAutocomplete:j},computed:{filteredConditions:function(){return this.filterChar?this.conditionsByChar[this.filterChar]||[]:[]},previewFilteredConditions:function(){return this.filteredConditions.length?d.first(this.filteredConditions,k):[]},isShowViewAllFeaturedConditionsButton:function(){return Boolean(this.filterChar)&&!this.isShowFilteredConditions&&this.conditionsByChar[this.filterChar].length>k}},created:function(){var a=97,b=a+26;this.debouncedFetchSuggestions=d.debounce(this.fetchSuggestions,500),this.conditionsByChar=d.reduce(g.Conditions,function(a,b){return a[b.key]=b.conditions,a},{}),this.filterChars=d.map(d.range(a,b),function(a){return String.fromCodePoint(a)})},data:function(){return{currentSuggestionsRequest:null,filterChar:null,isLoadingSuggestions:!1,isShowFilteredConditions:!1,searchSuggestions:[]}},el:a.get(0),methods:{cancelSuggestionsRequest:function(){this.currentRequest&&this.currentRequest.abort&&(this.currentRequest.abort(),this.isLoadingSuggestions=!1)},fetchSuggestions:function(a){a.length&&(this.cancelSuggestionsRequest(),this.isLoadingSuggestions=!0,this.currentRequest=c.ajax({type:"GET",url:"/"+i.getShortLanguageCode()+"/search/getstructuredsearch",data:{numRes:15,query:a,type:"Condition"},success:d.bind(function(a){this.isLoadingSuggestions=!1,this.searchSuggestions=d.map(a.StructuredResult[0].Result.records.page,function(a){return{title:a.title,url:a.url}})},this)}))},onClearSearch:function(){this.searchSuggestions=[],this.cancelSuggestionsRequest()},setFilterChar:function(a){this.isShowFilteredConditions=!1,this.filterChar=a},showFilteredConditions:function(){this.isShowFilteredConditions=!0}}})}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Data.ConsolePreorderBanner");c.ConsolePreorderBanner=function(){new Vue({data:function(){return{isLoading:!0,isSoldOut:!0}},el:"#module-console-preorder-banner",mounted:function(){this.isLoading=!0,$.ajax({contentType:"application/json",data:JSON.stringify({Brand:d.Brand}),dataType:"json",headers:{__RequestVerificationToken:d.VerificationToken},method:"POST",url:"/consolepreorder/GetPreorderStock"}).done(function(a){var b=a;Object.keys(b).forEach(function(a){b[a]&&(this.isSoldOut=!1)}.bind(this))}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isLoading=!1}.bind(this))}})}}(this),function(a){a.NR.resolve("SDM.Vue.Modules.ConsolePreorder.VueComponents").ProgressBar={name:"ProgressBar",props:{currentStep:{type:Number,default:1},totalSteps:{type:Number,default:4}},template:"#module-console-preorder-progress-bar"}}(this),function(a,b){var c=a.NR,d=c.resolve("SDM.Vue.Modules.ConsolePreorder.VueComponents"),e=c.resolve("SDM.Util"),f=c.resolve("SDM.Vue.Widgets"),g=c.resolve("SDM.Data.ConsolePreorder");d.Reservation={components:{"pop-up":f.PopUp,"progress-bar":d.ProgressBar,"store-selector-modal":f.StoreSelectorModal},computed:Object.assign({},Vuex.mapState("storeSelector",["popUp","postalCode","selectedStore"]),{cartLength:function(){return Object.keys(this.cart).length},postalCodeInput:{get:function(){return this.postalCode},set:function(a){this.setPostalCode(a)}},totalProductPrice:function(){var a=0,b=e.getShortLanguageCode(),c=Object.keys(this.cart);for(var d in c){var f=c[d];a+=parseFloat(this.cart[f])}var g=a.toFixed(2).split("."),h=g[0],i=g[1];return"en"===b?"$"+(h=h.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))+"."+i:"fr"===b?(h=h.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 "))+","+i+" $":void 0}}),data:function(){return{cart:{},cartOutOfStock:{},consentConsole:!1,consentNewsletter:!1,currentStep:1,email:"",firstName:"",isLoading:!1,isNotificationSubscribed:!1,lastName:"",selectedConsole:"",selectedProductDetailKey:"",selectedProductNotificationKey:"",stockAvailability:{},totalSteps:4}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setPostalCode"]),{checkConsoleConsent:function(){this.consentConsole?this.$refs.formConsoleConsent.setCustomValidity(""):this.$refs.formConsoleConsent.setCustomValidity(g.ConsentCheckboxErrorMessage)},checkEmail:function(){e.validateEmail(this.email)?(this.$refs.formEmail&&this.$refs.formEmail.setCustomValidity(""),this.$refs.formStockNotificationEmail&&this.$refs.formStockNotificationEmail.setCustomValidity(""),this.$refs.formProductNotificationEmail&&this.$refs.formProductNotificationEmail.setCustomValidity("")):(this.$refs.formEmail&&this.$refs.formEmail.setCustomValidity(g.EmailErrorMessage),this.$refs.formStockNotificationEmail&&this.$refs.formStockNotificationEmail.setCustomValidity(g.EmailErrorMessage),this.$refs.formProductNotificationEmail&&this.$refs.formProductNotificationEmail.setCustomValidity(g.EmailErrorMessage))},checkFirstName:function(){""===this.firstName?this.$refs.formFirstName.setCustomValidity(g.FirstNameErrorMessage):this.$refs.formFirstName.setCustomValidity("")},checkLastName:function(){""===this.lastName?this.$refs.formLastName.setCustomValidity(g.LastNameErrorMessage):this.$refs.formLastName.setCustomValidity("")},checkPostalCode:function(){return e.validatePostalCode(this.postalCodeInput)?(this.$refs.formPostalCode.setCustomValidity(""),!0):(this.$refs.formPostalCode.setCustomValidity(g.PostalCodeErrorMessage),!1)},closeUsedEmailPopUp:function(){this.$refs.popUpUsedEmail.hidePopUp()},getStockStatus:function(){b.ajax({contentType:"application/json",data:JSON.stringify({Brand:g.Brand}),dataType:"json",headers:{__RequestVerificationToken:g.VerificationToken},method:"POST",url:"/consolepreorder/GetPreorderStock"}).done(function(a){this.stockAvailability=a}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isLoading=!1}.bind(this))},goBack:function(){1===this.currentStep?this.$router.go(-1):this.currentStep-=1,e.scrollTo$ElementAsync(b(this.$refs.reservation),500)},proceedFromStepOne:function(){this.currentStep+=1,e.scrollTo$ElementAsync(b(this.$refs.reservation),500)},proceedFromStepTwo:function(){this.$refs.popUpStock.hidePopUp(),this.checkConsoleConsent(),this.checkEmail(),this.checkFirstName(),this.checkLastName(),this.$refs.formPickup.checkValidity()?(this.consentNewsletter&&this.subscribeNewsletter(),this.sendPreorder()):this.$refs.formPickup.reportValidity()},searchStore:function(){this.$refs.formStoreSelector&&!this.$refs.formStoreSelector.checkValidity()?this.$refs.formStoreSelector.reportValidity():(this.popUp.showPopUp(),this.$refs.storeSelectorModal.onPostalCodeSubmit())},sendPreorder:function(){this.isLoading=!0;var a={Brand:g.Brand,Email:this.email,FirstName:this.firstName,LastName:this.lastName,CASLValue:g.CASLValue,LangCode:e.getFullLanguageCode(),IsSDM:g.IsSDM,SdmPromotion:this.consentNewsletter,StoreID:this.selectedStore.storeNumber};Object.keys(this.cart).forEach(function(b){a[b]=!0}),b.ajax({contentType:"application/json",data:JSON.stringify(a),dataType:"json",headers:{__RequestVerificationToken:g.VerificationToken},method:"POST",url:"/consolepreorder/preorder"}).done(function(a){"OK"===a.Status&&"Queued"===a.Message?(this.currentStep+=1,e.scrollTo$ElementAsync(b(this.$refs.reservation),500)):"FAIL"===a.Status&&"Confirmed"===a.Message?this.$refs.popUpUsedEmail.showPopUp():"FAIL"===a.Status&&"PendingValidation"===a.Message?this.$refs.popUpPendingEmail.showPopUp():"FAIL"===a.Status&&"OutOfStock"===a.Message&&(this.cartOutOfStock=[],Object.keys(this.cart).forEach(function(b){!1===a.Stock[b]&&(this.selectedConsole===b&&(this.selectedConsole=""),this.$set(this.cartOutOfStock,b,this.cart[b]),this.$delete(this.cart,b))}.bind(this)),this.stockAvailability=a.Stock,this.isNotificationSubscribed=!1,this.$refs.popUpStock.showPopUp(),0===this.cartLength&&this.goBack())}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isLoading=!1}.bind(this))},showProductDetail:function(a){this.selectedProductDetailKey=a,this.$refs.popUpProductDetail.showPopUp()},showProductNotification:function(a){this.isNotificationSubscribed=!1,this.selectedProductNotificationKey=a,this.$refs.popUpProductNotification.showPopUp()},subscribeNewsletter:function(){b.ajax({context:this,cache:!1,contentType:"application/x-www-form-urlencoded",type:"POST",url:"/subscribe",data:{email:this.email,casl:""},headers:{__RequestVerificationToken:g.VerificationToken}}).done(function(a){"True"!==a&&console.log(err)}).fail(function(a){console.log(a)})},subscribeNotification:function(a){this.isLoading=!0;var c={Brand:g.Brand,Email:this.email,CASLValue:g.CASLValue,LangCode:e.getFullLanguageCode(),IsSDM:g.IsSDM};a.forEach(function(a){c[a]=!0}),b.ajax({contentType:"application/json",data:JSON.stringify(c),dataType:"json",headers:{__RequestVerificationToken:g.VerificationToken},method:"POST",url:"/consolepreorder/subscribe"}).done(function(a){"OK"===a.Status&&"Queued"===a.Message&&(this.isNotificationSubscribed=!0)}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isLoading=!1}.bind(this))},subscribeOutOfStockCart:function(){if(this.$refs.formStockNotification&&!this.$refs.formStockNotification.checkValidity())this.$refs.formStockNotification.reportValidity();else{var a=Object.keys(this.cartOutOfStock);this.subscribeNotification(a)}},subscribeProductNotification:function(){if(this.$refs.formProductNotification&&!this.$refs.formProductNotification.checkValidity())this.$refs.formProductNotification.reportValidity();else{var a=[];a.push(selectedProductNotificationKey),this.subscribeNotification(a)}},toggleConsole:function(a,b){""===this.selectedConsole?(this.selectedConsole=a,this.toggleProductInCart(a,b)):this.selectedConsole!==a?(this.toggleProductInCart(this.selectedConsole,this.cart[this.selectedConsole]),this.toggleProductInCart(a,b),this.selectedConsole=a):(this.selectedConsole="",this.toggleProductInCart(a,b))},toggleProductInCart:function(a,b){void 0===this.cart[a]?this.$set(this.cart,a,b):this.$delete(this.cart,a),0===Object.keys(this.cart).length&&1!==this.currentStep&&this.goBack()}}),mounted:function(){this.isLoading=!0,this.getStockStatus();var a=parseInt(g.StockCheckFrequency);a>=0&&setInterval(function(){this.getStockStatus()}.bind(this),a)},name:"Reservation",template:"#module-console-preorder-reservation"}}(this,this.jQuery),function(a){a.NR.resolve("SDM.Vue.Modules.ConsolePreorder.VueComponents").Update={mounted:function(){},name:"Update",template:"#module-console-preorder-update"}}(this),function(a,b){var c=a.NR,d=c.resolve("SDM.Vue.Modules"),e=c.resolve("SDM.Vue.Modules.ConsolePreorder.VueComponents"),f=c.resolve("SDM.Vue.Stores");d.ConsolePreorder=function(){var a=new Vuex.Store({modules:{storeSelector:f.StoreSelector,consolePreorder:{}}}),c=new VueRouter({base:b("#module-console-preorder").data("module-console-preorder-base"),mode:"history",routes:[{component:e.Reservation,name:"reservation",path:"/"},{component:e.Update,name:"update",path:"/update"}]});new Vue({el:"#module-console-preorder",mounted:function(){},router:c,store:a})}}(this,this.jQuery),function(a){a.NR.resolve("SDM.Vue.Modules").FaqSection=function(a){new Vue({data:function(){return{openIndex:-1}},el:a.get(0),methods:{closeItem:function(a,b){function c(){var f=parseInt(a.style.maxHeight,10),g=f+e;e*=.95,a.style.maxHeight=String(Math.max(0,g))+"px",g>0?window.requestAnimationFrame(c):(a.style.maxHeight=String(d)+"px",b())}var d=a.offsetHeight,e=0-a.offsetHeight/15;a.style.maxHeight=d+"px",window.requestAnimationFrame(c)},openItem:function(a,b){function c(){var f=parseInt(a.style.maxHeight,10),g=f+e;e*=.95,a.style.maxHeight=String(g)+"px",g<d?window.requestAnimationFrame(c):(a.style.maxHeight=String(d)+"px",b())}var d=a.offsetHeight,e=a.offsetHeight/15;a.style.maxHeight="0px",window.requestAnimationFrame(c)},toggleItemAt:function(a){a===this.openIndex?this.openIndex=-1:this.openIndex=a}}})}}(this),function(a,b){"use strict";var c=a.NR,d=c.resolve("SDM.Vue.Mixins"),e=c.resolve("SDM.Vue.Modules"),f=c.resolve("SDM.Vue.Stores"),g=c.resolve("SDM.Vue.Widgets"),h=c.resolve("SDM.Util");e.DietitianBookAppointment=function(a){var e=a.data("contentId"),i=c.resolve("SDM.Data.DietitianBookAppointment")[e],j=c.resolve("SDM.Vue.Vuex");j.hasModule("provinceSelector")||j.registerModule("provinceSelector",f.ProvinceSelector),new Vue({created:function(){document.addEventListener("click",function(a){this.$refs.refProvinceSelection&&!this.$refs.refProvinceSelection.contains(a.target)&&(this.isProvinceSelectionActive=!1)}.bind(this))},components:{"pop-up":g.PopUp,"province-selector":g.ProvinceSelector},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{isUserProvinceIdAvailable:function(){return-1!==this.provinces.findIndex(function(a){return a.abbreviation.toUpperCase()===this.userProvinceId}.bind(this))}}),data:function(){return{formEmail:"",formFirstName:"",formLanguage:"",formLastName:"",formPhoneNumber:"",provinces:[],isInvalidSymbolVisible:!1,isLoading:!1,isSubmissionCompleted:!1,isSubmissionFailed:!1}},el:a[0],mixins:[d.Responsive],methods:{checkFormEmail:function(a){h.validateEmail(this.formEmail)?a.target.setCustomValidity(""):a.target.setCustomValidity(i.EmailFormatErrorLabel)},checkFormPhoneNumber:function(a){h.validatePhoneNumber(this.formPhoneNumber)?a.target.setCustomValidity(""):a.target.setCustomValidity(i.PhoneFormatErrorLabel)},handleUrlParam:function(){var a=b(".module-dietitian-book-appointment__pop-up").length>0,c=h.getUrlVars();this.isUserProvinceIdAvailable&&c&&"true"===c.book&&!a&&(delete c.book,h.setUrlVars(c),this.showPopUp())},onBackClick:function(){this.isSubmissionCompleted=!1,this.isSubmissionFailed=!1},onSubmitBookingClick:function(a){this.$refs.formAppointment.checkValidity()?(this.isLoading=!0,b.ajax({data:{FirstName:this.formFirstName,LastName:this.formLastName,PhoneNumber:this.formPhoneNumber,EmailAddress:this.formEmail,Province:this.userProvinceId.toUpperCase(),PreferredLanguage:this.formLanguage,LangCode:i.LanguageCode},headers:{__RequestVerificationToken:i.AntiForgeryToken},method:"POST",url:"/dietitian/SubmitBooking"}).done(function(a){a&&202===a.StatusCode?this.isSubmissionCompleted=!0:this.isSubmissionFailed=!0}.bind(this)).fail(function(a){console.log(a),this.isSubmissionFailed=!0}).always(function(){this.isLoading=!1}.bind(this))):(this.isInvalidSymbolVisible=!0,this.$refs.formAppointment.reportValidity()),a.preventDefault()},onOkClick:function(){this.$refs.popUpBookAppointment.hidePopUp()},showPopUp:function(){this.formEmail="",this.formFirstName="",this.formLanguage="",this.formLastName="",this.formPhoneNumber="",this.isSubmissionCompleted=!1,this.isSubmissionFailed=!1,this.isInvalidSymbolVisible=!1,this.$refs.popUpBookAppointment.showPopUp()}},mounted:function(){this.provinces=i.Provinces.map(function(a){return{abbreviation:a.Abbreviation.toUpperCase(),title:a.Title}}),this.handleUrlParam()},store:j})}}(this,jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Widgets"),f=b.resolve("SDM.Util");c.FindInStore=function(a){var c=a.data("contentId"),g=b.resolve("SDM.Data.FindInStore")[c],h=new Vuex.Store({modules:{elasticSearch:d.ElasticSearch,storeSelector:d.StoreSelector,findInStore:d.FindInStore}}),i=new VueRouter({base:"/"+f.getShortLanguageCode()+"/find-in-store/",mode:"history",routes:[{component:e.FindInStoreListing,name:"listing",path:"/",props:{powerReviewsApiKey:g.PowerReviewsApiKey,powerReviewsMerchantId:g.PowerReviewsMerchantId,powerReviewsMerchantGroupId:g.PowerReviewsMerchantGroupId,powerReviewsLocale:g.PowerReviewsLocale}},{component:e.FindInStoreProduct,name:"product",path:"/product/:titleSlug/:upc",props:{elasticEndpointBase:g.ElasticEndpointBase,elasticEngineName:g.ElasticEngineName,elasticKey:g.ElasticKey,isCompactStyle:g.IsProductDetailsCompactStyle}}]});new Vue({components:{"find-in-store-search":e.FindInStoreSearch,"store-selector":e.StoreSelector},computed:Object.assign({},{}),data:function(){return{}},el:a[0],methods:Object.assign({},{}),mounted:function(){},router:i,store:h})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=b.resolve("SDM.Vue.Modules"),e=b.resolve("SDM.Vue.Widgets"),f=b.resolve("SDM.Vue.Stores");d.LoveYouDonation=function(){var a=new Vuex.Store({modules:{donation:f.Donation}});new Vue({components:{donation:e.Donation},el:"#module-love-you-donation",mixins:[c.Responsive],store:a})}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.P32021.VueComponents").BadgeCta={computed:{},data:function(){return{}},methods:{},mounted:function(){},props:{badge:{type:Object,default:null}},template:"#module-p3-2021-badge-cta",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.P32021.VueComponents").FooterMenu={computed:{},data:function(){return{}},methods:{},mounted:function(){},props:{},template:"#module-p3-2021-footer",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),d=b.resolve("SDM.Util");c.GameSelector={computed:{},data:function(){return{}},methods:Object.assign({},Vuex.mapActions("p32021",["setGameScore","setIsGameCompleted"]),{resetCookie:function(){this.setGameScore(0),this.setIsGameCompleted(!1),d.saveCookie("p32021game","{}")}}),mounted:function(){},props:{heading:{type:String,default:""},productImages:{type:Array,default:function(){return[]}},cta:{type:Object,default:null}},template:"#module-p3-2021-game-selector",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),d=b.resolve("SDM.Data.P32021");c.Game={computed:Object.assign({},Vuex.mapState("p32021",["gameScore","isGameCompleted"]),{}),data:function(){return{gamePieceLayer:null,playfieldLayer:null,productsLayer:null,gameOverLayer:null,indicatorLayer:null,world:null,gamePieces:[],pegs:[],width:480,height:640,scale:40,radiusDisk:.65,colors:[],defaultFillColor:null,specialFillColor:null,defaultStrokeColor:null,specialStrokeColor:null,drawDebugData:!1,addStats:!1,pointTextObject:null,currentPlayerPoints:0,ballsLeftInitial:3,ballsLeft:3,indicatorGamePiece:null,assets:{},target:1,locale:"en",tl:"",Util:{},SfxInterface:"",selectedGoalProduct:0,products:{}}},methods:Object.assign({},Vuex.mapActions("p32021",["setGameScore","setIsGameCompleted"]),{initDropToWinGame:function(){var a=this;this.ballsLeft=this.gameChances,this.setImageAssets(this.products);var b=0,c={containerId:"canvasContainer",layers:[{name:"canvasDropToWinBackground",x:0,y:0,width:480,height:640,zIndex:b++,backgroundColor:"#aa1651"},{name:"canvasDropToWinProducts",x:0,y:0,width:480,height:640,zIndex:b++},{name:"canvasDropToWinPlayfield",x:0,y:0,width:480,height:640,zIndex:b++},{name:"canvasDropToWinGamePieceLayer",x:0,y:0,width:480,height:640,zIndex:b++},{name:"canvasDropToWinBox2dDebug",x:0,y:0,width:480,height:640,zIndex:b++},{name:"canvasDropToWinIndicatorLayer",x:0,y:0,width:480,height:640,zIndex:b++},{name:"canvasDropToWinMouseHit",x:0,y:0,width:480,height:640,zIndex:b++,clickCallback:a.onGameStart,mouseHitId:"canvasMouseHitDetector"}]};if(document.StratiscapeDraw=new Stratiscape(c),document.StratiscapeDraw.canvasSupported){var d=document.StratiscapeDraw.getLayer("canvasDropToWinPlayfield"),e=document.StratiscapeDraw.getLayer("canvasDropToWinGamePieceLayer"),f=document.StratiscapeDraw.getLayer("canvasDropToWinBackground"),g=document.StratiscapeDraw.getLayer("canvasDropToWinBox2dDebug"),h=document.StratiscapeDraw.getLayer("canvasDropToWinProducts"),i=document.StratiscapeDraw.getLayer("canvasDropToWinIndicatorLayer");this.Setup("en",d,e,f,g,h,i)}else $("#canvasContainer").html('<p style="color:red">Bummer! Your browser does not support the HTML 5 Canvas Tag!</p>');this.WinnerText=new this.WinnerText(a.width/2,a.height/2,a.winnerTextUrl),this.indicatorLayer.addChild(a.WinnerText),this.setTarget(a.selectedGoalProduct),this.updateAllImages()},handleKeyDown:function(a){this&&this.$el&&window.document.contains(this.$el)&&32===a.keyCode&&(a.preventDefault(),this.onGameStart())},setScore:function(a){a>=0&&a<=5&&this.setGameScore(this.gameScore+a)},gameOver:function(){this.setIsGameCompleted(!0)},setImageAssets:function(a){this.assets=a},getImageAsset:function(a){return this.assets[a]},Setup:function(a,b,c,d,e,f,g){this.locale=a;var h=this;this.SfxInterface=new SfxInterface(["/static/core/sounds/p3-2021/WoodBlHiExtraPercV1.wav","/static/core/sounds/p3-2021/WoodBlHiExtraPercV2.wav","/static/core/sounds/p3-2021/WoodBlHiExtraPercV3.wav","/static/core/sounds/p3-2021/WoodBlHiOrchPercV1.wav","/static/core/sounds/p3-2021/points.wav","/static/core/sounds/p3-2021/VibraSlapExtraPercV1.wav","/static/core/sounds/p3-2021/highpoints.wav","/static/core/sounds/p3-2021/winner.mp3","/static/core/sounds/p3-2021/ClaveMetamorphic.wav"]),this.SfxInterface.setVolume(.5),this.SfxInterface.setVolumeAt(0,.1),this.SfxInterface.setVolumeAt(1,.1),this.SfxInterface.setVolumeAt(2,.1),this.SfxInterface.setVolumeAt(3,.2),this.colors.push(new h.Util.ColorRGBA(255,255,255,255)),this.colors.push(new h.Util.ColorRGBA(255,255,0,255)),this.colors.push(new h.Util.ColorRGBA(255,165,0,255)),this.colors.push(new h.Util.ColorRGBA(0,0,255,255)),this.colors.push(new h.Util.ColorRGBA(0,128,0,255)),this.colors.push(new h.Util.ColorRGBA(255,0,0,255)),this.colors.push(new h.Util.ColorRGBA(128,0,128,255)),this.defaultFillColor=new h.Util.ColorRGBA(163,23,79,255),this.specialFillColor=new h.Util.ColorRGBA(246,0,255,255),this.defaultStrokeColor=new h.Util.ColorRGBA(251,219,99,255),this.specialStrokeColor=new h.Util.ColorRGBA(22,44,12,255);var i=.1,j=this.width/this.scale,k=this.height/this.scale,l=k-i,m=Box2D.Common.Math.b2Vec2,n=Box2D.Dynamics.b2BodyDef,o=Box2D.Dynamics.b2FixtureDef,p=Box2D.Dynamics.b2World,q=Box2D.Collision.Shapes.b2PolygonShape,r=Box2D.Collision.Shapes.b2CircleShape,s=Box2D.Dynamics.b2DebugDraw,t=new o;t.density=1,t.friction=.1,t.restitution=.1;var u=new n;this.world=new p(new m(0,30),!0),this.playfieldLayer=b,this.gamePieceLayer=c,this.productsLayer=f,this.backgroundLayer=d,this.indicatorLayer=g;var v=new Box2D.Dynamics.b2ContactListener;v.BeginContact=function(a){var b=null,c=null,d=a.m_nodeA.other.GetUserData(),e=a.m_nodeB.other.GetUserData();if(d&&(d instanceof h.GamePiece?c=d:b=d),e&&(e instanceof h.GamePiece?c=e:b=e),b)if(b instanceof h.Peg){var f=new h.Util.ColorRGBA(246,218,106,255);b.highlight(!0,f),c.onHit(),h.SfxInterface.playFileAt(h.Util.NextRandom(0,3))}else h.SfxInterface.playFileAt(8);else if((void 0!==a.m_nodeA.other.pointValue||void 0!==a.m_nodeB.other.pointValue)&&!c.scored){c.body.SetAngularVelocity(0),c.body.SetLinearVelocity({x:0,y:0}),c.body.IsAwake(!1),c.scored=!0;var g=null;g=void 0!==a.m_nodeA.other.pointValue?a.m_nodeA.other:a.m_nodeB.other,h.onScoreEvent(g)}},this.world.SetContactListener(v),u.position.x=0,u.position.y=-.05,t.shape=new Box2D.Collision.Shapes.b2PolygonShape,t.shape.SetAsBox(j,.05),this.world.CreateBody(u).CreateFixture(t),u.position.x=-.7,u.position.y=k/2,t.shape=new Box2D.Collision.Shapes.b2PolygonShape,t.shape.SetAsBox(.05,k/2),this.world.CreateBody(u).CreateFixture(t),u.position.x=j+.7,t.shape=new Box2D.Collision.Shapes.b2PolygonShape,t.shape.SetAsBox(.05,k/2),this.world.CreateBody(u).CreateFixture(t);var w=-.9,x=new o;x.shape=new Box2D.Collision.Shapes.b2PolygonShape,x.density=.1,x.friction=.1,x.restitution=.98,u.position.x=-1.1,u.position.y=w+3.5;var y=[];y.push(new m(1,0)),y.push(new m(2,1)),y.push(new m(1,2)),y.push(new m(0,1)),x.shape.SetAsArray(y,0);var z=this.world.CreateBody(u),A=new this.Polygon(u.position.x,u.position.y,y);z.SetUserData(A),z.CreateFixture(x),b.addChild(A),u.position.x=-1.1,u.position.y=w+9.5,y=[],y.push(new m(1,0)),y.push(new m(2,1)),y.push(new m(1,2)),y.push(new m(0,1)),x.shape.SetAsArray(y,0),z=this.world.CreateBody(u),A=new this.Polygon(u.position.x,u.position.y,y),z.SetUserData(A),z.CreateFixture(x),b.addChild(A),u.position.x=j-.9,u.position.y=w+3.5,y=[],y.push(new m(1,0)),y.push(new m(2,1)),y.push(new m(1,2)),y.push(new m(0,1)),x.shape.SetAsArray(y,0),z=this.world.CreateBody(u),A=new this.Polygon(u.position.x,u.position.y,y),z.SetUserData(A),z.CreateFixture(x),b.addChild(A),u.position.x=j-.9,u.position.y=w+9.5,y=[],y.push(new m(1,0)),y.push(new m(2,1)),y.push(new m(1,2)),y.push(new m(0,1)),x.shape.SetAsArray(y,0),z=this.world.CreateBody(u),A=new this.Polygon(u.position.x,u.position.y,y),z.SetUserData(A),
z.CreateFixture(x),b.addChild(A),this.pegs=[],this.pegArrays=[];var B,C=.15,D=2*C,E=0,F=1,G=.9,H=.1,I=[],J=4,K=2.25,L=w+3,M=j-2,N=M/J;I=[];for(var O=0;O<J;O++)t.density=F,t.friction=G,t.restitution=H,t.shape=new r(C),u.position.x=K+O*N,u.position.y=L,B=new this.Peg(u.position.x,u.position.y,D,D,E),b.addChild(B),this.pegs.push(B),I.push(B),z=this.world.CreateBody(u),z.SetUserData(B),z.CreateFixture(t),B.body=z;this.pegArrays.push(I),J=3,K=3.5,L=w+4.5,I=[];for(var P=0;P<J;P++)t.density=F,t.friction=G,t.restitution=H,t.shape=new r(C),u.position.x=K+P*N,u.position.y=L,B=new this.Peg(u.position.x,u.position.y,D,D,E),b.addChild(B),this.pegs.push(B),I.push(B),z=this.world.CreateBody(u),z.SetUserData(B),z.CreateFixture(t),B.body=z;this.pegArrays.push(I),J=4,K=2.25,L=w+6,I=[];for(var Q=0;Q<J;Q++)t.density=F,t.friction=G,t.restitution=H,t.shape=new r(C),u.position.x=K+Q*N,u.position.y=L,B=new this.Peg(u.position.x,u.position.y,D,D,E),b.addChild(B),this.pegs.push(B),I.push(B),z=this.world.CreateBody(u),z.SetUserData(B),z.CreateFixture(t),B.body=z;this.pegArrays.push(I),J=5,K=1,L=w+7.5,I=[];for(var R=0;R<J;R++)t.density=F,t.friction=G,t.restitution=H,t.shape=new r(C),u.position.x=K+R*N,u.position.y=L,B=new this.Peg(u.position.x,u.position.y,D,D,E),b.addChild(B),this.pegs.push(B),I.push(B),z=this.world.CreateBody(u),z.SetUserData(B),z.CreateFixture(t),B.body=z;this.pegArrays.push(I),J=4,K=2.25,L=w+9,I=[];for(var S=0;S<J;S++)t.density=F,t.friction=G,t.restitution=H,t.shape=new r(C),u.position.x=K+S*N,u.position.y=L,B=new this.Peg(u.position.x,u.position.y,D,D,E),b.addChild(B),this.pegs.push(B),I.push(B),z=this.world.CreateBody(u),z.SetUserData(B),z.CreateFixture(t),B.body=z;this.pegArrays.push(I),J=3,K=3.5,L=w+10.5,I=[];for(var T=0;T<J;T++)t.density=F,t.friction=G,t.restitution=H,t.shape=new r(C),u.position.x=K+T*N,u.position.y=L,B=new this.Peg(u.position.x,u.position.y,D,D,E),b.addChild(B),this.pegs.push(B),I.push(B),z=this.world.CreateBody(u),z.SetUserData(B),z.CreateFixture(t),B.body=z;this.pegArrays.push(I),J=4,K=2.25,L=w+12,I=[];for(var U=0;U<J;U++)t.density=F,t.friction=G,t.restitution=H,t.shape=new r(C),u.position.x=K+U*N,u.position.y=L,B=new this.Peg(u.position.x,u.position.y,D,D,E),b.addChild(B),this.pegs.push(B),I.push(B),z=this.world.CreateBody(u),z.SetUserData(B),z.CreateFixture(t),B.body=z;this.pegArrays.push(I);var V=j/5,W=.1,X=125/this.scale;u.position.x=.05,u.position.y=l-X/2,t.shape=new Box2D.Collision.Shapes.b2PolygonShape,t.shape.SetAsBox(.05,X/2),this.world.CreateBody(u).CreateFixture(t),u.position.x=j-.05,t.shape=new Box2D.Collision.Shapes.b2PolygonShape,t.shape.SetAsBox(.05,X/2),this.world.CreateBody(u).CreateFixture(t);for(var Y=0;Y<4;Y++){t.shape=new q,t.shape.SetAsBox(W,X/2),u.position.x=V+V*Y,u.position.y=l-X/2,z=this.world.CreateBody(u);var Z=new this.Rect(V+V*Y-W,l-X,W,X,new h.Util.ColorRGBA(0,0,0,0),new h.Util.ColorRGBA(0,0,0,0));z.SetUserData(Z),z.CreateFixture(t),b.addChild(Z)}this.detectors=[],t.density=1,t.friction=5,t.restitution=0;var $=[1,2,3,4,5],_=.05;for(Y=0;Y<5;Y++)t.shape=new q,t.shape.SetAsBox(V/2,_),u.position.x=V/2+V*Y,u.position.y=k-_/2,z=this.world.CreateBody(u),z.pointValue=$[Y],z.CreateFixture(t),this.detectors.push(z);if(this.drawDebugData){var aa=new s;aa.SetSprite(e.ctx),aa.SetDrawScale(this.scale),aa.SetFillAlpha(.3),aa.SetLineThickness(1),aa.SetFlags(s.e_shapeBit|s.e_jointBit),this.world.SetDebugDraw(aa)}this.initIndicatorGamePiece(),document.requestAnimFrameId=requestAnimFrame(this.update)},initIndicatorGamePiece:function(){this.productsLayer.clear();var a=new Box2D.Dynamics.b2FixtureDef;a.friction=0,a.density=0,a.restitution=0;var b=new Box2D.Dynamics.b2BodyDef;b.type=Box2D.Dynamics.b2Body.b2_dynamicBody,a.shape=new Box2D.Collision.Shapes.b2CircleShape(this.radiusDisk);var c=this.world.CreateBody(b),d=new this.IndicatorGamePiece(c,2*this.radiusDisk,2*this.radiusDisk);d.body=c,c.SetUserData(d),this.IndicatorGamePiece=d,this.indicatorLayer.addChild(d)},onGameStart:function(){var a=this;if(!(this.ballsLeft>0))return void console.log("GAME OVER");if(this.gamePieceLayer&&0===this.gamePieceLayer.children.length&&0===this.gamePieces.length){this.ballsLeft--,this.IndicatorGamePiece.hide(),this.resetPegs();var b=this.IndicatorGamePiece.x,c=this.IndicatorGamePiece.y,d=new Box2D.Dynamics.b2FixtureDef,e=new Box2D.Dynamics.b2BodyDef;d.friction=.9,d.density=1,d.restitution=.9,e.type=Box2D.Dynamics.b2Body.b2_dynamicBody,d.shape=new Box2D.Collision.Shapes.b2CircleShape(this.radiusDisk),e.position.x=b/this.scale,e.position.y=c/this.scale;var f=this.world.CreateBody(e),g=new this.GamePiece(f,2*this.radiusDisk,2*this.radiusDisk);g.body=f,f.SetUserData(g),f.CreateFixture(d),this.gamePieces.push(g),this.gamePieceLayer.addChild(g);var h=a.Util.NextRandom(5,15)*this.IndicatorGamePiece.dir;g.body.SetAngularVelocity(h)}else console.log("this.onGameStart() - game already in play. ABORTING")},resetPegs:function(){for(var a in this.pegs)this.pegs[a].reset()},resetGame:function(){this.totalScore=0,this.ballsLeft=this.gameChances,this.IndicatorGamePiece.show()},updateAllImages:function(){this.updateBackgroundImage(),this.updateProductImages()},updateProductImages:function(){this.productsLayer&&this.productsLayer.clear();for(var a=this.getImageAsset("productsImageSrc"),b=0;b<a.length;b++){var c=this.detectors[b],d=this.width/this.scale,e=this.height/this.scale,f=.18,g=90,h=136,i=a[b];d=g/this.scale;var j=(d+f)*b,k=e-h/this.scale,l=b===this.target-1,m=new this.PrizeGamePiece(j,k,i,g,h,l);c.prizeGamePiece=m,this.productsLayer.addChild(m)}},updateBackgroundImage:function(){this.createBackgroundImage(this.getImageAsset("backgroundImageSrc"))},createBackgroundImage:function(a){this.bgImage&&this.backgroundLayer.clear(),this.bgImage=new this.BGImage(0,0,a),this.backgroundLayer.addChild(this.bgImage)},onScoreEvent:function(a){var b=a.pointValue,c=!1;b===this.target?(this.SfxInterface.playFileAt(7),this.WinnerText.tween(),c=!0,this.setScore(5)):(this.SfxInterface.playFileAt(5),this.setScore(1));var d=a.prizeGamePiece;if(d?d.onHit():console.log("Qlingo.onScoreEvent() - prizeGamePiece instance not found, aborting onHit() call"),0===this.ballsLeft){var e=1e3;c&&(e=2500);var f=this;setTimeout(function(){f.gameOver()},e)}else this.IndicatorGamePiece.show()},setTarget:function(a){this.target=a},setLocale:function(a){this.locale=a},update:function(){document.requestAnimFrameId=requestAnimFrame(this.update);for(var a=this.gamePieces.length-1;a>=0;a--){var b=this.gamePieces[a];!b.body.IsAwake()&&b.scored&&(this.world.DestroyBody(b.body),this.gamePieces.splice(a,1),b.layer.removeChild(b))}for(var c in this.gamePieceLayer.children)this.gamePieceLayer.children[c].update();for(var d in this.productsLayer.children)this.productsLayer.children[d].update();for(var e in this.indicatorLayer.children)this.indicatorLayer.children[e].update();this.world.Step(1/60,1,1),this.drawDebugData&&this.world.DrawDebugData(),this.world.ClearForces(),document.StratiscapeDraw.draw(),document.stats&&document.stats.update()},initUtils:function(){var a=this;a.BGImage=Stratiscape.DrawnObject.extend({init:function(a,b,c){this.x=a,this.y=b,this.bgWidth=480,this.bgHeight=640,this.productWidth=420,this.productHeight=420,this.productPositionXoffset=60,this.src=c;var d=this;this.bgImageLoaded=!1,this.bgImage=new Image,this.bgImage.onload=function(){d.bgImageLoaded=!0},this.bgImage.src="/static/core/images/p3-2021/gameboard-bg.jpg",this.productImageLoaded=!1,this.productImage=new Image,this.productImage.onload=function(){d.productImageLoaded=!0},this.productImage.src=c},draw:function(a){if(this.bgImageLoaded&&this.productImageLoaded){a.drawImage(this.bgImage,this.x,this.y,this.bgWidth,this.bgHeight);var b=(this.bgWidth-this.productWidth)/2,c=(this.bgHeight-this.productHeight)/2-this.productPositionXoffset;a.drawImage(this.productImage,b,c,this.productWidth,this.productHeight)}else{var d=this;setTimeout(function(){d.draw(a)},20)}}}),a.WinnerText=Stratiscape.DrawnObject.extend({init:function(b,c,d){this.x=b,this.y=c,this.width=800,this.height=200,this.src=d;var e=Math.min(a.width/this.width,a.height/this.height);this.width*=e,this.height*=e,this.defaultWidth=this.width,this.defaultHeight=this.height,this.defaultPositionX=this.x-this.width/2,this.defaultPositionY=this.y-this.height/2;var f=this;this.imageLoaded=!1,this.image=new Image,this.image.onload=function(){f.imageLoaded=!0},this.image.src=this.src,this.hide()},draw:function(a){if(this.imageLoaded){var b=this.x-this.width/2,c=this.y-this.height;a.drawImage(this.image,b,c,this.width,this.height)}else{var d=this;setTimeout(function(){d.draw(a)},20)}},update:function(){},show:function(){this.x=this.defaultPositionX,this.y=this.defaultPositionY},hide:function(){this.y=-this.height},tween:function(){this.show(),this.x=a.width/2,this.y=a.height/2-this.height/2,this.width=0,this.height=0,TweenMax.to(this,1.2,{width:this.defaultWidth,height:this.defaultHeight,ease:Elastic.easeOut}),TweenMax.to(this,.4,{width:0,height:0,delay:1.2,y:a.height,ease:Cubic.easeIn,onComplete:this.tweenComplete,onCompleteParams:[this]})},tweenComplete:function(a){a.hide()}}),a.GamePiece=Stratiscape.DrawnObject.extend({init:function(b,c,d){this.body=b,this.width=c*a.scale,this.height=d*a.scale,this.wRadius=this.width/2,this.hRadius=this.height/2,this.imageLoaded=!1;var e=this;this.image=new Image,this.image.onload=function(){e.imageLoaded=!0},this.image.src="/static/core/images/p3-2021/ball.png"},update:function(){this.rotation=this.body.GetAngle(),this.x=this.body.GetWorldCenter().x*a.scale,this.y=this.body.GetWorldCenter().y*a.scale,this.layer.needsDisplay=!0},draw:function(a){if(a.save(),a.beginPath(),a.arc(this.x,this.y,this.wRadius,0*Math.PI,2*Math.PI),a.fillStyle="#f6c553",a.fill(),this.imageLoaded)a.translate(this.x,this.y),a.rotate(this.rotation),a.translate(-this.width/2,-this.height/2),a.drawImage(this.image,0,0);else{var b=this;setTimeout(function(){b.draw(a)},20)}a.restore()},onHit:function(){var b=new Box2D.Common.Math.b2Vec2(a.Util.NextRandom(10,20),a.Util.NextRandom(10,20)),c=a.Util.NextRandom(0,20)/a.scale;b=new Box2D.Common.Math.b2Vec2(c,0),this.body.ApplyImpulse(b,this.body.GetWorldCenter())}}),a.IndicatorGamePiece=Stratiscape.DrawnObject.extend({init:function(b,c,d){this.name="IndicatorGamePiece",this.body=b,this.posVec2=new Box2D.Common.Math.b2Vec2,this.dir=1,this.dirSpeed=.1,this.isHidden=!1,this.width=c*a.scale,this.height=d*a.scale,this.wRadius=this.width/2,this.hRadius=this.height/2,this.imageLoaded=!1;var e=this;this.image=new Image,this.image.onload=function(){e.imageLoaded=!0},this.image.src="/static/core/images/p3-2021/ball.png",this.x=this.body.GetWorldCenter().x*a.scale,this.y=this.body.GetWorldCenter().y*a.scale,this.show(),this.body.SetAwake(!1)},show:function(){var b=this.width/a.scale;this.posVec2.x=b/2,this.posVec2.y=.9,this.body.SetPosition(this.posVec2),this.dir=1,this.isHidden=!1},hide:function(){var b=this.width/a.scale;this.posVec2.x=b/2,this.posVec2.y=-.9,this.body.SetPosition(this.posVec2),this.isHidden=!0},update:function(){if(!this.isHidden){this.posVec2.x+=this.dirSpeed*this.dir,this.body.SetPosition(this.posVec2);var b=this.width/a.scale,c=a.width/a.scale;(this.body.GetPosition().x>=c-b/2||this.body.GetPosition().x<=b/2)&&(this.dir*=-1)}this.x=this.body.GetWorldCenter().x*a.scale,this.y=this.body.GetWorldCenter().y*a.scale,this.layer.needsDisplay=!0},draw:function(a){if(this.imageLoaded)a.save(),a.translate(this.x,this.y),a.rotate(this.rotation),a.translate(-this.width/2,-this.height/2),a.drawImage(this.image,0,0),a.restore();else{var b=this;setTimeout(function(){b.draw(a)},20)}}}),a.PrizeGamePiece=Stratiscape.DrawnObject.extend({init:function(b,c,d,e,f,g){this.x=b*a.scale,this.y=c*a.scale,this.width=e/a.scale,this.height=f/a.scale,this.productWidth=.9*this.width,this.productHeight=.9*this.width,this.productPositionXoffset=10,this.isTarget=g,this.hit=!1;var h=this,i=new a.Util.ColorRGBA(0,0,0,0);this.rect=new a.Rect(b,c,this.width,this.height,i,i),this.bgImageLoaded=!1,this.bgImage=new Image,this.bgImage.onload=function(){h.bgImageLoaded=!0},this.bgImage.src=!0===this.isTarget?"/static/core/images/p3-2021/prizepiece-target-bg.png":"/static/core/images/p3-2021/prizepiece-bg.png",this.productImageLoaded=!1,this.productImage=new Image,this.productImage.onload=function(){h.productImageLoaded=!0},this.productImage.src=d},draw:function(b){if(this.rect.draw(b),this.bgImageLoaded&&this.productImageLoaded)b.drawImage(this.bgImage,this.x,this.y,this.width*a.scale,this.height*a.scale),b.drawImage(this.productImage,this.x,this.y+this.productPositionXoffset,this.width*a.scale,this.width*a.scale);else{var c=this;setTimeout(function(){c.draw(b)},20)}},update:function(){this.layer.needsDisplay=!0},onHit:function(){var a=this;if(!this.hit){this.hit=!0;var b=this.y;TweenMax.to(a,.1,{y:b-25,yoyo:!0,repeat:3,onComplete:a.tweenComplete,onCompleteParams:[a]})}this.layer.needsDisplay=!0},tweenComplete:function(a){a.hit=!1}}),a.Peg=Stratiscape.DrawnObject.extend({init:function(b,c,d,e){this.x=b*a.scale,this.y=c*a.scale,this.width=d*a.scale,this.height=e*a.scale,this.initialWidth=this.width,this.initialHeight=this.height,this.highlighted=!1,this.type="Peg",this.hit=!1,this.color=a.defaultFillColor},update:function(){this.layer.needsDisplay=!0,this.x=this.body.GetWorldCenter().x*a.scale,this.y=this.body.GetWorldCenter().y*a.scale},onHit:function(){},tweenComplete:function(a){a.hit=!1},highlight:function(a,b){this.highlighted=a,this.color=b,this.layer.needsDisplay=!0},reset:function(){this.highlighted=!1,this.color=a.defaultFillColor,this.layer.needsDisplay=!0},draw:function(a){a.fillStyle=this.color.toString(),a.lineWidth=2,a.beginPath(),a.arc(this.x,this.y,this.width/2,0,2*Math.PI,!0),a.closePath(),a.fill(),a.stroke()}}),a.Rect=Stratiscape.DrawnObject.extend({init:function(b,c,d,e,f,g){this.x=b*a.scale,this.y=c*a.scale,this.width=d*a.scale,this.height=e*a.scale,this.fillColor=f,this.strokeColor=g},draw:function(a){a.fillStyle=this.fillColor.toString(),a.strokeStyle=this.strokeColor.toString(),a.fillRect(this.x,this.y,this.width,this.height),a.strokeRect(this.x,this.y,this.width,this.height)}}),a.Polygon=Stratiscape.DrawnObject.extend({init:function(b,c,d){this.points=[];for(var e=0;e<d.length;e++)this.points.push({x:(d[e].x+b)*a.scale,y:(d[e].y+c)*a.scale})},draw:function(b){b.fillStyle=new a.Util.ColorRGBA(212,25,105,255),b.strokeStyle=new a.Util.ColorRGBA(251,219,99,255),b.lineWidth=8,b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y);for(var c=1;c<this.points.length;c++){var d=this.points[c];b.lineTo(d.x,d.y)}b.closePath(),b.fill(),b.stroke()}}),a.Util={},a.Util.ColorRGBA=function(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d},a.Util.ColorRGBA.prototype.multiply=function(b){return new a.Util.ColorRGBA(Math.floor(this.r*b),Math.floor(this.g*b),Math.floor(this.b*b),this.a)},a.Util.ColorRGBA.prototype.fadeTo=function(b){return this.equals(b)?this:new a.Util.ColorRGBA(this.r>b.r?this.r-1:this.r+1,this.g>b.g?this.g-1:this.g+1,this.b>b.b?this.b-1:this.b+1,this.a>b.a?this.a-1:this.a+1)},a.Util.ColorRGBA.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a},a.Util.ColorRGBA.prototype.toString=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.a+")"},a.Util.NextRandom=function(a,b){return null!==b&&void 0!==b||(b=a,a=0),a<0?b+=Math.abs(a):b-=a,Math.floor(Math.random()*b)+a},a.Util.parseShadow=function(a,b){a=a.split(", ");for(var c=[],d=0,e=a.length;d<e;d++){var f,g=a[d].split(" "),h=g[0].replace(parseFloat(g[0]),"");f="em"===h?{x:b*parseFloat(g[0]),y:b*parseFloat(g[1])}:{x:parseFloat(g[0]),y:parseFloat(g[1])},g[3]?(f.blur=parseFloat(g[2]),f.color=g[3]):(f.blur=0,f.color=g[2]),c.push(f)}return c}}}),mounted:function(){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),this.products.productsImageSrc=[];for(var a=0;a<this.gameProducts.length;a++)this.products.productsImageSrc[a]=this.gameProducts[a].thumbnailSrc,this.gameProducts[a].isSelected&&(this.selectedGoalProduct=a+1,this.products.backgroundImageSrc=this.gameProducts[a].imageSrc);this.initUtils(),this.initDropToWinGame(),window.addEventListener("keydown",this.handleKeyDown)},props:{gameProducts:{type:Array,default:function(){return[]}},gameChances:{type:Number,default:d.GameChances},gameProductScoreWeight:{type:Number,default:d.GameScoreWeight},gameSelectedProductScoreWeight:{type:Number,default:d.GameSelectedScoreWeight},winnerTextUrl:{type:String,default:d.GameWinnerTextImg}},beforeUnmount:function(){window.removeEventListener("keydown",this.handleKeyDown)},template:"#module-p3-2021-game",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Data.P32021");c.Navigation={components:{navigation:d.Navigation},computed:{},data:function(){return{menuLabel:e.MobileMenuLabel,menuOpenLabel:e.MobileMenuOpenLabel,menuCloseLabel:e.MobileMenuCloseLabel,links:[{isAbsolute:!1,label:e.HomeTabLabel,target:"",url:"/"},{isAbsolute:!1,label:e.ProductTabLabel,target:"",url:"/products"},{isAbsolute:!1,label:e.GameTabLabel,target:"",url:"/contest"}]}},methods:{},mounted:function(){"True"!==e.HideTrending&&this.links.push({isAbsolute:!1,label:e.SocialTabLabel,target:"",url:"/trending"})},template:"#module-p3-2021-navigation"}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),d=b.resolve("SDM.Data.P32021"),e=a.$,f=b.resolve("SDM.Util");c.RouteContest={name:"RouteContest",template:"#module-p3-2021-route-contest",components:{"game-selector":c.GameSelector,navigation:c.Navigation},data:function(){return{products:d.Products,currentWeekNumber:0,isWeekSelectorActive:!1,totalNumberOfWeeks:4,weeklyLeaderboards:[]}},mounted:function(){var a=d.WeeklyPrizeSchedule.filter(function(a){return!0===a.CurrentWeek});this.currentWeekNumber=a[0].WeekNumber,this.initLeaderBoard()},methods:{initLeaderBoard:function(){e.ajax({contentType:"application/x-www-form-urlencoded",method:"GET",url:"/sdmapi/innovation/Get2022Leaderboard?lang="+f.getFullLanguageCode(),data:{RoutePath:d.CampaignRoute}}).done(function(a){if(a&&"OK"===a.Status){var b=this;Object.keys(a.Leaderboard).forEach(function(c){var d=a.Leaderboard[c].Upcs.map(function(a){return b.products[a.Upc]});b.weeklyLeaderboards.push(d)})}}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isSubmitBallotLoading=!1}.bind(this))},initWeekSelector:function(){document.addEventListener("click",function(a){this.$refs.refWeekSelector&&!this.$refs.refWeekSelector.contains(a.target)&&(this.isWeekSelectorActive=!1)}.bind(this))},setCurrentWeek:function(a){this.currentWeekNumber=a}},computed:{currentWeekLeaderboard:function(){return this.weeklyLeaderboards[this.currentWeekNumber-1]}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),d=b.resolve("SDM.Vue.Mixins"),e=b.resolve("SDM.Vue.Widgets"),f=b.resolve("SDM.Data.P32021");c.RouteHome={components:{badgeCta:c.BadgeCta,carousel:e.ProductCarousel,navigation:c.Navigation,"store-selector":e.StoreSelector},computed:{bannerCarousel:function(){return this.banners.map(function(a){var b=document.createElement("div");b.innerHTML=a.UrlLink?a.UrlLink.trim():"";var c=b.firstChild;return{backgroundColor:a.BackgroundHexColor,image:{url:this.isDesktop||this.isDesktopLarge?a.ImageDesktop.URL:a.ImageMobile.URL,alt:this.isDesktop||this.isDesktopLarge?a.ImageDesktop.Label:a.ImageMobile.Label},link:{isAbsolute:!0,target:c?c.target:"",url:c?c.href:""}}},this)},bannerCarouselProps:function(){return{slides:this.bannerCarousel,slidesToShow:this.bannerCarouselSlidesToShow,isArrowsVisible:{desktop:!0,tablet:!1,mobile:!1},isAutoplay:{desktop:!0,tablet:!0,mobile:!0},isControlsInset:{desktop:!0,tablet:!0,mobile:!0},isPaginationVisible:{desktop:!0,tablet:!0,mobile:!0}}},badgeCarousels:function(){var a=!1;return this.categories.map(function(b){if(b.IsFeatured){a=!a;var c=b.FeaturedProducts.map(function(a){var b,c=this.products[a];return b=""!==c.BuyNowLink?{isAbsolute:!0,target:"_blank",url:c.BuyNowLink}:{isAbsolute:!1,target:"",url:"/products/detail/"+c.Id},{id:c.Gtin,image:{url:c.Images&&c.Images.length>0?c.Images[0].Url:"",alt:c.Images&&c.Images.length>0&&c.Images[0].ImageAltText?c.Images[0].ImageAltText:c.Title},inventory:{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel,ourStockLabel:f.OurStockLabel},link:b,pwr:{id:"pwr-snippet-"+c.Id,apiKey:f.TrendingSocialApiKey,merchantId:f.TrendingSocialMerchantId,merchantGroupId:f.TrendingSocialMerchantGroupId,locale:f.TrendingSocialLocale},text1:c.OfferShortText,text2:c.Title,text3:"",title:c.Title}},this);return{badge:{heading:b.Title,headline:b.HeadlineText,text:"",cta:{url:"products?categories="+b.CategoryKey,label:f.ExploreLabel,isUrlAbsolute:!1}},slides:c,isBadgeOnLeft:!this.isDesktopLarge||a}}},this)},tileBadges:function(){return this.homeBadges.map(function(a){return{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{label:a.Title,target:a.CTALinkTarget,url:a.CTALink}}},this)}},data:function(){return{banners:f.BannerSlides,bannerCarouselSlidesToShow:{desktop:1,tablet:1,mobile:1},categories:f.Categories,categoryCarouselsSlidesToShow:{desktop:3,tablet:2,mobile:2},homeBadges:f.HomeBadges,isCategoriesActive:!1,products:f.Products}},methods:{hideCategories:function(){this.isCategoriesActive=!1},initPowerReviews:function(){for(var a=[],b=0;this.badgeCarousels.length>b;b++)for(var c=0;this.badgeCarousels[b].slides.length>c;c++){var d={api_key:this.badgeCarousels[b].slides[c].pwr.apiKey,locale:this.badgeCarousels[b].slides[c].pwr.locale,merchant_group_id:this.badgeCarousels[b].slides[c].pwr.merchantGroupId,merchant_id:this.badgeCarousels[b].slides[c].pwr.merchantId,page_id:this.badgeCarousels[b].slides[c].id,components:{CategorySnippet:this.badgeCarousels[b].slides[c].pwr.id}};a.push(d)}pwr("render",a)}},mixins:[d.Responsive],mounted:function(){this.showInventory="False"===f.HideInventory;var a=this;setTimeout(function(){a.initPowerReviews()},2e3)},name:"RouteHome",template:"#module-p3-2021-route-home"}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),f=b.resolve("SDM.Data.P32021"),g=a.$,h=b.resolve("SDM.Util");e.RoutePlay={name:"RoutePlay",template:"#module-p3-2021-route-play",components:{carousel:d.ProductCarousel,navigation:e.Navigation,game:e.Game,"pop-up":d.PopUp},props:{},mixins:[c.PCOLogin],data:function(){return{STATE_PRODUCTS:"stateProducts",STATE_PRODUCT_DETAILS:"stateProductDetail",STATE_FAVOURITES:"stateFavourites",STATE_FAVOURITES_DETAILS:"stateFavouritesDetail",STATE_SUBMIT:"submit",STATE_SUBMIT_DETAILS:"submitDetail",STATE_COMPLETE:"stateProductComplete",activeStep:0,communicationOptIn:!1,currentProductDetail:{},currentState:"",ballotOverlayShow:!1,ballotOverlayAnimIn:!1,hammertime:"",isEmailErrorValdidationVisible:!1,isEmailErrorServerVisible:!1,isEmailSuccessVisible:!1,isEmailSuccessNoOptInVisible:!1,isEmailSuccessOptinSucessVisible:!1,isEmailSuccessOptinFailVisible:!1,isEmailOptinFailVisible:!1,isSubmissionLoadingEmail:!1,isSubmitBallotLoading:!1,products:f.Products,selectedProducts:[],selectedProductsIds:[],submissionEmail:"",totalSteps:0,weekCount:0,currentWeekNumber:0,emailSubmissionErrors:{email:!1},productLeftSelected:!1,productRightSelected:!1,instructionalOverlayShow:!1,currentLang:h.getShortLanguageCode()}},created:function(){var a=f.WeeklyPrizeSchedule.filter(function(a){return!0===a.CurrentWeek});this.currentWeekNumber=a[0].WeekNumber,this.currentState=this.STATE_PRODUCTS},mounted:function(){if(this.totalSteps=this.weeklyProductPairs.length,"/contest/play/1"!==this.$route.path&&"/contest/play/submit"!==this.$route.path&&this.$router.push({path:"/contest/play/1"}),this.activeStep=1,"/contest/play/submit"===this.$route.path&&h.getValueFromCookie("p32022products")){this.selectedProductsIds=JSON.parse(h.getValueFromCookie("p32022products"));for(var a=0;a<this.weeklyProductPairs.length;a++)for(var b=0;b<this.weeklyProductPairs[a].length;b++)this.weeklyProductPairs[a][b].Id===this.selectedProductsIds[a]&&(this.selectedProducts[a]=this.weeklyProductPairs[a][b]);this.currentState=this.STATE_SUBMIT,h.saveCookie("p32022products","")}else"/contest/play/submit"===this.$route.path&&""===h.getValueFromCookie("p32022products")&&this.$router.push({path:"/contest/play/1"});if("/contest/play/1"===this.$route.path){this.enableSwipe(),h.saveCookie("p32022products",""),this.instructionalOverlayShow=!0;var c=this;Vue.nextTick(function(){document.querySelector(".module-p3-2021-route-play__instructional-overlay-favourites-description").focus(),c.trapFocus(document.querySelector(".module-p3-2021-route-play__instructional-overlay"))})}},methods:Object.assign({},Vuex.mapActions("p32021",["setGameScore","setIsGameCompleted"]),{enableSwipe:function(){var a=this;Vue.nextTick(function(){a.hammertime=new Hammer(document.getElementById("module-p3-2021-route-play__products")),a.hammertime.on("swipeleft",function(){a.productTransitionToDetail("left")}),a.hammertime.on("swiperight",function(){a.productTransitionToDetail("right")})})},disableSwipe:function(){this.hammertime.off("swipeleft"),this.hammertime.off("swiperight")},productTransitionToDetail:function(a){this.disableSwipe();var b=this;"left"===a?(this.productLeftSelected=!0,setTimeout(function(){document.querySelector("#module-p3-2021-route-play__product--left").querySelector(".module-p3-2021-route-play__product-upper-content").style.opacity=0,document.querySelector("#module-p3-2021-route-play__product--left").querySelector(".module-p3-2021-route-play__product-image").style.opacity=0},800),setTimeout(function(){b.$router.push({path:"/contest/play/"+b.activeStep+"/1"})},1300)):"right"===a&&(this.productRightSelected=!0,setTimeout(function(){document.querySelector("#module-p3-2021-route-play__product--right").querySelector(".module-p3-2021-route-play__product-upper-content").style.opacity=0,document.querySelector("#module-p3-2021-route-play__product--right").querySelector(".module-p3-2021-route-play__product-image").style.opacity=0},800),setTimeout(function(){b.$router.push({path:"/contest/play/"+b.activeStep+"/2"})},1300))},showProductDetail:function(a){this.currentProductDetail=a,window.scrollTo({top:0,behavior:"smooth"})},confirmSelection:function(a){this.selectProduct(a)},selectProduct:function(a){this.ballotOverlayShow=!0;var b=this;setTimeout(function(){b.ballotOverlayAnimIn=!0},50),setTimeout(function(){if(b.ballotOverlayAnimIn=!1,b.selectedProducts[b.activeStep-1]=a,Number(b.activeStep)!==b.totalSteps){var c=Number(b.activeStep)+1;b.$router.push({path:"/contest/play/"+c})}else b.$router.push({path:"/contest/play/submit"});window.scrollTo({top:0,behavior:"smooth"})},2500),setTimeout(function(){b.ballotOverlayShow=!1},2900)},toggleFavourites:function(){this.currentState!==this.STATE_FAVOURITES?this.currentState=this.STATE_FAVOURITES:this.currentState=this.STATE_PRODUCTS},onRouteChange:function(){"submit"===this.$route.params.step?this.$route.params.product?(this.showProductDetail(this.selectedProducts[this.$route.params.product-1]),this.currentState=this.STATE_SUBMIT_DETAILS):(0===this.selectedProductsIds.length&&(this.selectedProductsIds=this.selectedProducts.map(function(a){return a.Id})),h.saveCookie("p32022products",JSON.stringify(this.selectedProductsIds)),this.currentState=this.STATE_SUBMIT):"favourites"===this.$route.params.step?this.$route.params.product?(this.showProductDetail(this.selectedProducts[this.$route.params.product-1]),this.currentState=this.STATE_FAVOURITES_DETAILS):this.currentState=this.STATE_FAVOURITES:this.$route.params.product?(this.showProductDetail(this.currentProductPair[this.$route.params.product-1]),this.currentState=this.STATE_PRODUCT_DETAILS):(this.activeStep=this.$route.params.step,this.currentProductDetail={},this.currentState=this.STATE_PRODUCTS,this.enableSwipe()),this.productLeftSelected=!1,this.productRightSelected=!1,this.focusFirstElement()},showEmailPopUp:function(){this.isEmailErrorValdidationVisible=!1,this.isEmailErrorServerVisible=!1,this.isSubmissionLoadingEmail=!1,this.isEmailSuccessVisible=!1,this.communicationOptIn=!1,this.submissionEmail="",this.$refs.popUpEmailSubmission.showPopUp(),Vue.nextTick(function(){document.querySelector(".module-p3-2021-route-play__email-pop-up-heading").focus()})},hideEmailPopUp:function(){this.$refs.popUpEmailSubmission.hidePopUp()},submitBallots:function(){this.isSubmitBallotLoading=!0;var a={RoutePath:this.$router.options.base,WeekNumber:this.currentWeekNumber,LangCode:h.getFullLanguageCode(),FavoriteProducts:this.selectedProductsIds};g.ajax({contentType:"application/x-www-form-urlencoded",method:"POST",url:"/sdmapi/innovation/submitproductchoices?lang="+h.getFullLanguageCode(),data:a,dataType:"json",headers:{__RequestVerificationToken:f.FormToken}}).done(function(a){a&&"OK"===a.Status&&(this.isSubmitBallotLoading=!1,this.currentState=this.STATE_COMPLETE)}.bind(this)).fail(function(a){console.log(a)}).always(function(){this.isSubmitBallotLoading=!1}.bind(this))},submitEmail:function(){if(this.isEmailErrorValdidationVisible=!1,this.isEmailErrorServerVisible=!1,this.$refs.email&&(this.emailSubmissionErrors.email=!(this.submissionEmail.length&&/\S+@\S+/.test(this.submissionEmail))),_.some(this.emailSubmissionErrors,function(a){return a}))this.isEmailErrorValdidationVisible=!0;else{this.isSubmissionLoadingEmail=!0,this.isEmailErrorValdidationVisible=!1,this.isEmailErrorServerVisible=!1,this.isEmailSuccessOptinSucessVisible=!1,this.isEmailSuccessOptinFailVisible=!1,this.isEmailSuccessNoOptInVisible=!1;var a=this.selectedProducts.map(function(a){return a.Id}),b={Email:this.submissionEmail,FavoriteProducts:a,LangCode:h.getFullLanguageCode(),Subscribe:this.communicationOptIn,WeekNumber:this.currentWeekNumber},c=this;g.ajax({cache:!1,contentType:"application/x-www-form-urlencoded",data:b,dataType:"json",headers:{__RequestVerificationToken:f.FormToken},type:"POST",url:"/sdmapi/innovation/SubmitEmailRequest?lang="+h.getFullLanguageCode()}).done(function(a){a&&"OK"===a.Status?(c.isSubmissionLoadingEmail=!1,c.communicationOptIn&&!a.HasEmailSignUpError?c.isEmailSuccessOptinSucessVisible=!0:c.communicationOptIn&&a.HasEmailSignUpError?c.isEmailSuccessOptinFailVisible=!0:c.communicationOptIn||(c.isEmailSuccessNoOptInVisible=!0),c.isEmailSuccessVisible=!0):this.isEmailErrorServerVisible=!0}).fail(function(a){this.isEmailErrorServerVisible=!0,console.log(a)})}},hideInstructionalOverlay:function(){this.instructionalOverlayShow=!1,this.focusFirstElement()},focusFirstElement:function(){Vue.nextTick(function(){if(this&&this.$el){var a='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]',b=document.querySelector(".module-p3-2021-route-play__container").querySelectorAll(a)[0];b&&b.focus()}},this)},trapFocus:function(a){var b=a.querySelectorAll('a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])'),c=b[0],d=b[b.length-1];a.addEventListener("keydown",function(a){
("Tab"===a.key||9===a.keyCode)&&(a.shiftKey?document.activeElement===c&&(d.focus(),a.preventDefault()):document.activeElement===d&&(c.focus(),a.preventDefault()))})}}),computed:Object.assign({},Vuex.mapState("p32021",["gameScore","isGameCompleted"]),{weeklyProductPairs:function(){var a=[],b=this;return f.WeeklyPrizeSchedule[this.currentWeekNumber-1].ProductPairs.forEach(function(c){var d=[];d.push(b.products[c.Name]),d.push(b.products[c.Value]),a.push(d)}),a},currentProductPair:function(){return this.weeklyProductPairs[this.activeStep-1]}}),watch:{$route:function(){this.onRouteChange()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Vue.Mixins"),e=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),f=b.resolve("SDM.Data.P32021");e.RouteProductsDetail={components:{navigation:e.Navigation,productTile:c.ProductTile,"store-selector-modal":c.StoreSelectorModal},computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{product:function(){return this.$route.params.productId?this.products[this.$route.params.productId]:null},relatedProducts:function(){return this.product?this.product.RelatedProductIDs.map(function(a){return this.products[a]}.bind(this)):[]},relatedProductTiles:function(){return this.product.RelatedProductIDs.map(function(a){var b,c=this.products[a];return b=""!==c.BuyNowLink?{url:c.BuyNowLink,urlLabel:f.BuyNowLabel,urlTarget:"_blank",isUrlAbsolute:!0}:{url:"/products/detail/"+c.Id,urlLabel:f.ProductCTALabel,urlTarget:"_self",isUrlAbsolute:!1},{cta:b,inventory:{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel},product:{id:c.Id,image:{alt:c.Images&&c.Images.length>0&&c.Images[0].ImageAltText?c.Images[0].ImageAltText:c.Title,src:c.Images&&c.Images.length>0?c.Images[0].Url:"",url:c.Images&&c.Images.length>0?c.Images[0].Url:""},link:{url:"/products/detail/"+c.Id,target:"_self",isAbsolute:!1},tag:"",title:c.Title,offer:c.OfferShortText}}},this)}}),data:function(){return{isAboutAccordionExpanded:!0,isLegalAccordionExpanded:!0,products:f.Products}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc"]),{checkAvailability:function(a){this.setProductImageUrl(a.Images&&a.Images.length>0?a.Images[0].Url:""),this.setProductHeading(a.Title),this.setProductUpc(a.Id),this.popUp.showPopUp()},goBack:function(){this.$router.go(-1)}}),mixins:[d.LockFocus],mounted:function(){setTimeout(function(){this.focusOnFirstElement()}.bind(this),500)},name:"RouteProductsDetail",template:"#module-p3-2021-route-products-detail",watch:{$route:function(){this.isAboutAccordionExpanded=!0,this.isLegalAccordionExpanded=!0}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),f=SDM.Data.P32021,g=b.resolve("SDM.Util"),h=a.$,i=a._;e.RouteProducts={components:{navigation:e.Navigation,"product-tile":d.ProductTile,"store-selector":d.StoreSelector},computed:{badgeTiles:function(){return this.productBadges.map(function(a){return{type:"badge",badgeTile:{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{label:a.Title,target:a.CTALinkTarget,url:a.CTALink}}}},this)},filterdProducts:function(){return i.shuffle(this.productsByGroup.filter(function(a){var b=0===this.selectedBrands.length||this.selectedBrands.includes(a.BrandSlug),c=0===this.selectedCategories.length||a.Categories.reduce(function(a,b){return a||this.selectedCategories.includes(b.TitleSlug)}.bind(this),!1);return b&&c}.bind(this)))},filterdProductsByBrands:function(){return this.productsByGroup.filter(function(a){return 0===this.selectedBrands.length||this.selectedBrands.includes(a.BrandSlug)}.bind(this))},filterdProductsByCategories:function(){return this.productsByGroup.filter(function(a){return 0===this.selectedCategories.length||a.Categories.reduce(function(a,b){return a||this.selectedCategories.includes(b.TitleSlug)}.bind(this),!1)}.bind(this))},paginatedProducts:function(){var a=[];a.push(this.productTiles.slice(0,this.productPerPage-this.productBadgeSize*Math.min(this.badgeTiles.length,2)));for(var b=this.productTiles.slice(this.productPerPage-this.productBadgeSize*Math.min(this.badgeTiles.length,2),this.productTiles.length),c=0;c<Math.ceil(b.length/this.productPerPage);c++){var d=b.slice(c*this.productPerPage,(c+1)*this.productPerPage);a.push(d)}return a},productTiles:function(){return this.filterdProducts.map(function(a){var b;return b=""!==a.BuyNowLink?{url:a.BuyNowLink,urlLabel:f.BuyNowLabel,urlTarget:"_blank",isUrlAbsolute:!0}:{url:"/products/detail/"+a.Id,urlLabel:f.ProductCTALabel,urlTarget:"_self",isUrlAbsolute:!1},{type:"product",productTile:{componentKey:this.componentKey++,cta:b,inventory:{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel,ourStockLabel:f.OurStockLabel},product:{id:a.Id,image:{alt:a.Images&&a.Images.length>0&&a.Images[0].ImageAltText?a.Images[0].ImageAltText:a.Title,src:a.Images&&a.Images.length>0?a.Images[0].Url:"",url:a.Images&&a.Images.length>0?a.Images[0].Url:""},link:{url:"/products/detail/"+a.Id,target:"_self",isAbsolute:!1},pwr:{id:"pwr-snippet-"+a.Id},tag:"",title:a.Title,offer:a.OfferShortText}}}},this)},productsByGroup:function(){return Object.keys(this.products).reduce(function(a,b){return this.products[b]&&this.products[b].ProductGroup===this.productGroup&&a.push(this.products[b]),a}.bind(this),[])},inventory:function(){return{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel}},isClearButtonEnabled:function(){return this.selectedBrands.length>0||this.selectedCategories.length>0},totalPageNumber:function(){var a=2,b=this.productTiles.length,c=a+b;return Math.ceil(c/this.productPerPage)}},data:function(){return{brands:f.BrandFilters,categories:f.CategoryFilters,componentKey:0,currentPageNumber:1,isFiltersActive:!1,filteredProductsBrands:[],filteredProductsCategories:[],products:f.Products,productBadges:f.ProductBadges,productBadgeSize:2,productPerPage:12,productGrid:[],selectedCategories:[],selectedBrands:[]}},methods:{clearFilter:function(){this.isClearButtonEnabled&&(this.selectedBrands=[],this.selectedCategories=[],this.filteredProductsCategories=this.getCategoriesFromProducts(this.productsByGroup),this.filteredProductsBrands=this.getBrandsFromProducts(this.productsByGroup),this.currentPageNumber=1,this.updateUrlParam(),this.initProductGrid())},getBrandsFromProducts:function(a){return a.reduce(function(a,b){return-1===a.findIndex(function(a){return a===b.BrandSlug})&&a.push(b.BrandSlug),a},[]).map(function(a){return this.brands.find(function(b){if(b.TitleSlug===a)return b})}.bind(this)).sort(function(a,b){return a.Title<b.Title?-1:a.Title>b.Title?1:0})},getCategoriesFromProducts:function(a){return a.reduce(function(a,b){return b.Categories.forEach(function(b){-1===a.findIndex(function(a){return a===b.TitleSlug})&&a.push(b.TitleSlug)}),a},[]).map(function(a){return this.categories.find(function(b){if(b.TitleSlug===a)return b})}.bind(this)).sort(function(a,b){return a.Title<b.Title?-1:a.Title>b.Title?1:0})},hideFilters:function(){this.isFiltersActive=!1},initialize:function(){this.selectedCategories=[],this.selectedBrands=[]},initPowerReviews:function(){for(var a=[],b=this.paginatedProducts[this.currentPageNumber-1],c=0;b.length>c;c++)a[c]={api_key:f.TrendingSocialApiKey,locale:f.TrendingSocialLocale,merchant_group_id:f.TrendingSocialMerchantGroupId,merchant_id:f.TrendingSocialMerchantId,page_id:b[c].productTile.product.id,components:{CategorySnippet:b[c].productTile.product.pwr.id}};pwr("render",a)},initProductGrid:function(){var a=this.currentPageNumber*this.productPerPage-this.productBadgeSize*Math.min(this.badgeTiles.length,2),b=this.productTiles.slice(0,a);this.badgeTiles.length>0&&b.splice(2,0,this.badgeTiles[0]),this.badgeTiles.length>1&&b.splice(7,0,this.badgeTiles[1]);var c=this;this.productGrid=b,setTimeout(function(){c.initPowerReviews()},100)},loadMoreProducts:function(){g.scrollTo$ElementAsync(h(this.$refs.loadMoreButton),500),this.currentPageNumber=this.currentPageNumber+1,this.initProductGrid()},onBrandsFilterChange:function(){this.currentPageNumber=1,this.filteredProductsCategories=this.getCategoriesFromProducts(this.filterdProductsByBrands);var a=this.selectedCategories.filter(function(a){return this.filteredProductsCategories.findIndex(function(b){return b.TitleSlug===a})>=0}.bind(this));this.selectedCategories.length!==a.length&&(this.selectedCategories=a),this.updateUrlParam(),this.initProductGrid()},onCategoriesFilterChange:function(){this.currentPageNumber=1,this.filteredProductsBrands=this.getBrandsFromProducts(this.filterdProductsByCategories);var a=this.selectedBrands.filter(function(a){return this.filteredProductsBrands.findIndex(function(b){return b.TitleSlug===a})>=0}.bind(this));this.selectedBrands.length!==a.length&&(this.selectedBrands=a),this.updateUrlParam(),this.initProductGrid()},updateUrlParam:function(){var a={};this.selectedBrands.length>0&&(a=Object.assign({},a,{brands:this.selectedBrands.join(",")})),this.selectedCategories.length>0&&(a=Object.assign({},a,{categories:this.selectedCategories.join(",")})),g.setUrlVars(a)}},mixins:[c.Responsive],mounted:function(){this.routeBrands&&this.routeBrands.split(",").forEach(function(a){this.selectedBrands.push(a)},this),this.routeCategories&&this.routeCategories.split(",").forEach(function(a){this.selectedCategories.push(a)},this),this.filteredProductsCategories=this.getCategoriesFromProducts(this.productsByGroup),this.filteredProductsBrands=this.getBrandsFromProducts(this.filterdProductsByCategories),this.initProductGrid()},name:"RouteProducts",props:{routeBrands:{type:String,default:""},routeCategories:{type:String,default:""}},template:"#module-p3-2021-route-products",watch:{filterdProducts:function(){this.currentPageNumber=1},productsByGroup:function(){this.filteredProductsBrands=this.getBrandsFromProducts(this.productsByGroup),this.filteredProductsCategories=this.getCategoriesFromProducts(this.productsByGroup)},productGroup:function(){this.initialize()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),d=SDM.Data.P32021;c.RouteTrending={components:{navigation:c.Navigation},data:function(){return{isModalActive:!1,videoData:[],focusableElements:'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]'}},methods:{initSocial:function(){POWERREVIEWS.display.render({api_key:d.TrendingSocialApiKey,locale:d.TrendingSocialLocale,merchant_id:d.TrendingSocialMerchantId,CD4_IRL_IMAGE_GALLERY_STYLE:"GRID",components:{IRLSnippet:"module-top-picks-2020-trending__social"}})},initVideo:function(a){if(a){var b=this.findObjectByKey(this.videoData,"FriendlyUrlTitle",a);this.onVideoThumbnailClick(b.YouTubeVideoID,b.Title)}else this.onCloseVideo()},onVideoThumbnailClick:function(a,b){this.isModalActive=!0,document.body.style.overflow="hidden",document.querySelector("#module-p3-2021-route-trending-video-embed__video").innerHTML='<iframe class="module-p3-2021-route-trending-video__embed" src="https://www.youtube.com/embed/'+a+'?autoplay=1&modestbranding=1&rel=0" frameborder="0" title="'+b+'" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen ></iframe>',TweenMax.to(".module-p3-2021-route-trending-video-embed",.4,{opacity:1}),setTimeout(function(){$(".module-p3-2021-route-trending-video-embed__close").focus()},500)},onCloseVideo:function(){if(this.isModalActive){var a=this;TweenMax.to(".module-p3-2021-route-trending-video-embed",.3,{opacity:0,onComplete:a.closeVideo})}},closeVideo:function(){this.isModalActive=!1,document.body.style.overflow="auto",document.querySelector("#module-p3-2021-route-trending-video-embed__video").innerHTML=""},findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c)return a[d];return null},onKeyDownLockFocusWithinComponent:function(a){if("Tab"===a.key||9===a.keyCode){var b=a.currentTarget,c=b.querySelectorAll(this.focusableElements),d=b.querySelectorAll(this.focusableElements)[0],e=c[c.length-1];a.shiftKey?document.activeElement===d&&(e.focus(),a.preventDefault()):document.activeElement===e&&(d.focus(),a.preventDefault())}}},mounted:function(){this.videoData=JSON.parse(d.TrendingVideos),this.initVideo(this.$route.params.videoId),this.initSocial()},name:"RouteTrending",template:"#module-p3-2021-route-trending",watch:{$route:function(){this.initVideo(this.$route.params.videoId)}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Mixins"),d=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),e=b.resolve("SDM.Data.P32021");d.RouteTutorial={components:{"game-selector":d.GameSelector,navigation:d.Navigation},computed:{gameSelector:function(){var a=this.weeks.findIndex(function(a){return!a.IsExpired&&a.CurrentWeek}),b=this.weeks[a];if(!(b&&b.Games&&b.Games.length>0))return null;var c=b.Games[0];return{cta:{isAbsolute:!1,label:e.PlayButtonLabel,url:"/play?week="+(a+1)+"&game=1"},heading:e.GameLabel+" 1",productImages:c.Products.map(function(a){var b=this.products[a];return b?{url:b.Images&&b.Images.length>0&&b.Images[0].Url?b.Images[0].Url:"",alt:b.Images&&b.Images.length>0&&b.Images[0].ImageAltText?b.Images[0].ImageAltText:b.Title}:null},this)}}},data:function(){return{products:e.Products,weeks:e.WeeklyPrizeSchedule}},methods:{goBack:function(){this.$router.go(-1)}},mixins:[c.Responsive],mounted:function(){},name:"RouteTutorial",template:"#module-p3-2021-route-tutorial"}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Modules.P32021.VueComponents"),f=b.resolve("SDM.Data.P32021");c.P32021=function(){var a=[{component:e.RouteHome,name:"home",path:"/"},{component:e.RouteContest,name:"contest",path:"/contest"},{component:e.RouteTutorial,name:"how-to-play",path:"/contest/how-to-play"},{component:e.RoutePlay,name:"play",path:"/contest/play",redirect:"/contest/play/1"},{component:e.RoutePlay,name:"play",path:"/contest/play/:step"},{component:e.RoutePlay,name:"play",path:"/contest/play/:step/:product"},{component:e.RouteProducts,name:"products",path:"/products",props:function(a){return{routeBrands:a.query.brands,routeCategories:a.query.categories}}},{component:e.RouteProductsDetail,name:"detail",path:"/products/detail/:productId"}];"True"!==f.HideTrending?(a.push({component:e.RouteTrending,name:"trending",path:"/trending"}),a.push({component:e.RouteTrending,name:"trending",path:"/trending/:videoId"})):(a.push({component:e.RouteTrending,name:"trending",path:"/trending",redirect:"/"}),a.push({component:e.RouteTrending,name:"trending",path:"/trending/:videoId",redirect:"/"}));var b=new VueRouter({base:f.CampaignRoute,mode:"history",routes:a,scrollBehavior:function(){if(this&&this.app&&this.app.$el){var a='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]',b=this.app.$el.querySelectorAll(a)[0];b&&b.focus()}return{x:0,y:0,behavior:"smooth"}}}),c=new Vuex.Store({modules:{storeSelector:d.StoreSelector,p32021:{actions:{setGameScore:function(a,b){a.commit("setGameScore",b)},setIsGameCompleted:function(a,b){a.commit("setIsGameCompleted",b)}},mutations:{setGameScore:function(a,b){a.gameScore=b},setIsGameCompleted:function(a,b){a.isGameCompleted=b}},namespaced:!0,state:function(){return{gameScore:0,isGameCompleted:!1}}}}});new Vue({components:{"footer-menu":e.FooterMenu},el:"#module-p3-2021",methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"}),{}),mounted:function(){this.setInventories(f.Inventories.Stores)},router:b,store:c})}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.Spring2021.VueComponents").FooterMenu={computed:{},data:function(){return{}},methods:{},mounted:function(){},props:{},template:"#module-spring-2021-footer-menu",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.Spring2021.VueComponents").Hero={template:"#spring-2021-hero-template",props:{baseBackgroundColor:String,featuredBadges:Object,themesModel:Array,ttwBackgroundColor:String},data:function(){return{currentCategory:"",currentSection:"",headerHexColor:"",heroImage:"",heroImageMobile:"",toPath:"",fromPath:"",themeModel:{},isTextToWin:!1}},created:function(){this.updateCurrentSection()},mounted:function(){},methods:{updateCurrentSection:function(){this.$route.path.split("/").filter(String)[0]?this.currentSection=this.$route.path.split("/").filter(String)[0].toLowerCase():this.currentSection="/"}},watch:{$route:function(a,b){this.toPath=a.path,this.fromPath=b.path,this.updateCurrentSection()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Data.Spring2021");c.Navigation={template:"#module-spring-2021-navigation",components:{navigation:d.Navigation},data:function(){return{menuLabel:e.MobileMenuLabel,menuOpenLabel:e.MobileMenuOpenLabel,menuCloseLabel:e.MobileMenuCloseLabel,links:[]}},mounted:function(){this.links.push({isAbsolute:!1,label:e.HomeTabLabel,target:"",url:"/"});for(var a=0;a<e.TabsJson.length;a++)this.links.push({isAbsolute:!1,label:e.TabsJson[a].Title,target:"",url:"/"+e.TabsJson[a].ThemeKey});this.links.push({isAbsolute:!1,label:e.TextToWinTabLabel,target:"",url:"/contest"})},methods:{},computed:{}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),d=b.resolve("SDM.Vue.Mixins"),e=b.resolve("SDM.Vue.Widgets"),f=SDM.Data.Spring2021,g=b.resolve("SDM.Util"),h=a.$;c.Products={template:"#module-spring-2021-products",components:{"product-tile":e.ProductTile},mixins:[d.Responsive],props:{routeFilters:{type:String,default:""},routeCategories:{type:String,default:""},themeHeading:{type:String,default:""},themeKey:{type:String,default:""}},data:function(){return{categories:[],currentPageNumber:1,isFiltersActive:!1,isFiltersMobile:!1,filteredProductsCategories:[],products:{},productBadges:f.ProductBadges,productBadgeSize:2,productPerPage:12,screenWidth:0,selectedCategories:[],subThemeFilters:[],themeBadgesData:[],componentKey:0}},mounted:function(){TweenMax.to(".module-spring-2021-products__filters",.6,{opacity:1});var a={CampaignTitle:"spring_2021",CampaignRoute:"self-care",ThemeKey:this.themeKey},b=this;h.ajax({method:"POST",url:"/"+f.Lang+"/GetSelfCare2021Products",data:a,dataType:"json",headers:{__RequestVerificationToken:f.FormToken}}).done(_.bind(function(a){b.products=a.Products,this.subThemeFilter=a.SubThemeFilters,this.subThemeFilter.forEach(function(a){b.categories.push(a)},this),b.$route.query.filters&&b.$route.query.filters.split(",").forEach(function(a){b.selectedCategories.push(a)},this),b.filteredProductsCategories=this.getCategoriesFromProducts(this.productsByGroup),TweenMax.to(".module-spring-2021-products__filters-container",.6,{opacity:1})},this)).fail(function(a){console.log(a)}),window.addEventListener("resize",_.debounce(this.onResize,50)),this.onResize()},methods:{onResize:function(){this.screenWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0),this.screenWidth>640?(TweenLite.set(".module-spring-2021-products__filters-container",{height:"auto"}),this.isFiltersActive=!1,this.isFiltersMobile=!1):this.isFiltersMobile||(TweenLite.set(".module-spring-2021-products__filters-container",{height:0}),this.isFiltersActive=!1,this.isFiltersMobile=!0)},getCategoriesFromProducts:function(a){return a.reduce(function(a,b){return b.SubThemes.forEach(function(b){-1===a.findIndex(function(a){return a===b.TitleSlug})&&a.push(b)}),a},[]).map(function(a){return this.categories.find(function(b){if(b.TitleSlug===a)return b})}.bind(this)).sort(function(a,b){return a.Title<b.Title?-1:a.Title>b.Title?1:0})},showHideFilter:function(){this.isFiltersActive?(TweenLite.to(".module-spring-2021-products__filters-container",.3,{height:0}),this.isFiltersActive=!1):(TweenLite.set(".module-spring-2021-products__filters-container",{height:"auto"}),TweenLite.from(".module-spring-2021-products__filters-container",.3,{height:0}),this.isFiltersActive=!0)},initialize:function(){this.selectedCategories=[]},loadMoreProducts:function(){g.scrollTo$ElementAsync(h(this.$refs.loadMoreButton),500),this.currentPageNumber=this.currentPageNumber+1},onCategoriesFilterChange:function(){this.updateUrlParam()},updateUrlParam:function(){var a={};this.selectedCategories.length>0&&(a=Object.assign({},a,{filters:this.selectedCategories.join(",")})),g.setUrlVars(a)}},computed:{filterdProducts:function(){return _.shuffle(this.productsByGroup.filter(function(a){return 0===this.selectedCategories.length||a.SubThemes.reduce(function(a,b){return a||this.selectedCategories.includes(b)}.bind(this),!1)}.bind(this)))},filterdProductsByCategories:function(){return this.productsByGroup.filter(function(a){return 0===this.selectedCategories.length||a.SubThemes.reduce(function(a,b){return a||this.selectedCategories.includes(b)}.bind(this),!1)}.bind(this))},productTiles:function(){return this.filterdProducts.map(function(a){return this.componentKey++,{type:"product",productTile:{cta:{url:a.BuyNowLink?a.BuyNowLink:"/"+this.themeKey+"/"+a.Id+window.location.search,urlLabel:a.BuyNowLink?f.BuyNowLabel:f.ProductCTALabel,urlTarget:a.BuyNowLink?"_blank":"_self",isUrlAbsolute:!!a.BuyNowLink},inventory:{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel},product:{id:a.Id,image:{alt:a.Title+".",url:a.Images&&a.Images.length>0?a.Images[0].Url:""},link:{url:"/"+this.themeKey+"/"+a.Id+window.location.search,target:"_self",isAbsolute:!1},tags:a.Tags,title:a.Title,offer:a.OfferShortText}}}},this)},productsByGroup:function(){return Object.keys(this.products).reduce(function(a,b){return this.products[b]&&this.products[b].ProductGroup===this.productGroup&&a.push(this.products[b]),a}.bind(this),[])},inventory:function(){return{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel}},productGrid:function(){var a=this.currentPageNumber*this.productPerPage;return this.productTiles.slice(0,a)},totalPageNumber:function(){var a=this.productTiles.length;return Math.ceil(a/this.productPerPage)}},watch:{filterdProducts:function(){this.currentPageNumber=1},productsByGroup:function(){this.filteredProductsCategories=this.getCategoriesFromProducts(this.productsByGroup)},productGroup:function(){this.initialize()}}}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.Spring2021.VueComponents").BadgeCta={computed:{},data:function(){return{}},methods:{},mounted:function(){},props:{badge:{type:Object,default:null}},template:"#module-spring-2021-badge-cta",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),d=b.resolve("SDM.Data.Spring2021"),e=b.resolve("SDM.Vue.Mixins");c.Video={template:"#module-spring-2021-video",components:{},props:{},data:function(){return{isModalActive:!1,videoData:[]}},mixins:[e.LockFocus],mounted:function(){for(var a=0;d.Categories.length>a;a++)this.videoData.push(d.Categories[a].Badges);this.videoData.push(d.BottomBadges),this.$route.query.v&&this.initVideo(this.$route.query.v)},methods:{initVideo:function(a){var b=this.findObjectByKey(this.videoData,"TitleSlug",a);this.onVideoThumbnailClick(b.YouTubeVideoID,b.Title)},onVideoThumbnailClick:function(a,b){this.isModalActive=!0,document.body.style.overflow="hidden",document.querySelector("#module-spring-2021-video-embed__video").innerHTML='<iframe class="module-spring-2021-video__embed" src="https://www.youtube.com/embed/'+a+'?autoplay=1&modestbranding=1&rel=0" frameborder="0" title="'+b+'" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen ></iframe>',TweenMax.to(".module-spring-2021-video-embed",.4,{opacity:1}),setTimeout(function(){$(".module-spring-2021-video-embed__close").focus()},500)},onCloseVideo:function(){if(this.isModalActive){var a=this;TweenMax.to(".module-spring-2021-video-embed",.3,{opacity:0,onComplete:a.closeVideo})}},closeVideo:function(){this.isModalActive=!1,document.body.style.overflow="auto",document.querySelector("#module-spring-2021-video-embed__video").innerHTML=""},findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)for(var e=a[d],f=0;f<e.length;f++)if(e[f][b].toString().toLowerCase()===c)return e[f];return null}},computed:{},watch:{"$route.query":function(){this.$route.query.v?this.initVideo(this.$route.query.v):this.isModalActive&&this.onCloseVideo()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),d=b.resolve("SDM.Vue.Modules.Spring2021.VueRoutes"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Vue.Widgets");d.ForMe={template:"#module-spring-2021-route-for-me",name:"RouteForMe",mixins:[e.Responsive],data:function(){return{}},mounted:function(){},methods:{},components:{"store-selector":f.StoreSelector,"products-grid":c.Products},computed:{}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),d=b.resolve("SDM.Vue.Modules.Spring2021.VueRoutes"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Vue.Widgets"),g=b.resolve("SDM.Data.Spring2021"),h=b.resolve("SDM.Util");d.Home={template:"#module-spring-2021-route-home",name:"RouteHome",mixins:[e.Responsive],data:function(){return{banners:g.BannerSlides,bannerCarouselSlidesToShow:{desktop:1,tablet:1,mobile:1},bottomBadgesData:g.BottomBadges,categories:g.Categories,categoryCarouselsSlidesToShow:{desktop:3,tablet:2,mobile:2},homeBadges:g.HomeBadges,isCategoriesActive:!1,products:g.Products}},mounted:function(){},methods:{onVideoTileClick:function(a){var b={};b=Object.assign({},b,{v:a}),h.setUrlVars(b)}},components:{badgeCta:c.BadgeCta,carousel:f.ProductCarousel,"store-selector":f.StoreSelector,"video-modal":c.Video},computed:{badgeCarousels:function(){var a=!1;return this.categories.map(function(b){a=!a;var c=b.FeaturedProducts.map(function(a){return{image:{url:a.Images&&a.Images.length>0?a.Images[0].Url:"",alt:a.Title},link:{isAbsolute:!1,target:"",url:"/"+b.ThemeKey+"/"+a.Id},text1:a.OfferShortText,text2:a.Title,text3:"",tags:a.Tags}},this),d=b.Badges.map(function(a){return{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{isAbsolute:!1,target:a.CTALinkTarget,url:a.CTALink},youTubeVideoId:a.YouTubeVideoID,youTubeVideoCta:a.TitleSlug}},this);return{badge:{heading:b.CarouselText,hexColorBg:b.CarouselBackgroundHex,hexColorFont:b.CarouselFontHex,hexColorCtaLabel:b.CarouselButtonFontHex,text:"",cta:{url:"/"+b.ThemeKey+(b.SubThemeKey.length>0?"?filters="+b.SubThemeKey:""),label:g.ExploreLabel,isUrlAbsolute:!1}},slides:c,isBadgeOnLeft:!this.isDesktopLarge||a,featuredBadges:d}},this)},hideCategories:function(){this.isCategoriesActive=!1},bottomBadges:function(){return this.bottomBadgesData.map(function(a){return{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{isAbsolute:!1,target:a.CTALinkTarget,url:a.CTALink},youTubeVideoId:a.YouTubeVideoID,youTubeVideoCta:a.TitleSlug}},this)},tileBadges:function(){return this.homeBadges.map(function(a){return{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{label:a.Title,target:a.CTALinkTarget,url:a.CTALink}}},this)}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),d=b.resolve("SDM.Vue.Modules.Spring2021.VueRoutes"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Vue.Widgets");d.Refresh={template:"#module-spring-2021-route-refresh",name:"RouteRefresh",mixins:[e.Responsive],data:function(){return{}},mounted:function(){},methods:{},components:{"store-selector":f.StoreSelector,"products-grid":c.Products},computed:{}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),d=b.resolve("SDM.Vue.Modules.Spring2021.VueRoutes"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Vue.Widgets");d.TakeOnTheDay={template:"#module-spring-2021-route-take-on-the-day",name:"RouteTakeOnTheDay",mixins:[e.Responsive],data:function(){return{}},mounted:function(){},methods:{},components:{"store-selector":f.StoreSelector,"products-grid":c.Products},computed:{}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Spring2021.VueRoutes"),d=b.resolve("SDM.Vue.Widgets");c.Contest={template:"#module-spring-2021-route-contest",components:{"pop-up":d.PopUp},props:{},data:function(){return{isPopUpErrorVisible:!1,isPopUpSubmissionVisible:!0,isPopUpCompletionVisible:!1,isPrize1Collapsed:!0,isPrize2Collapsed:!0,isPrize3Collapsed:!0,isSubmissionLoading:!1,submissionTelephone:""}},created:function(){},mounted:function(){},methods:{initializeSubmissionPopUp:function(){this.submissionTelephone="",this.isPopUpSubmissionVisible=!0,this.isPopUpCompletionVisible=!1,this.isPopUpErrorVisible=!1},checkSubmissionTelephone:function(){return this.isSubmissionTelephoneValid?(this.isPopUpSubmissionVisible=!0,this.isPopUpErrorVisible=!1,!0):(this.isPopUpSubmissionVisible=!1,this.isPopUpErrorVisible=!0,!1)},showPopUp:function(){this.initializeSubmissionPopUp(),this.$refs.popUpContestSubmission.showPopUp()},submitContest:function(a,b,c){if(this.$refs.submissionForm.checkValidity()&&this.checkSubmissionTelephone()){var d=this.submissionTelephone.replace(/[()-.]/g,"");this.isSubmissionLoading=!0;var e=JSON.stringify({PhoneNumber:d,ShortCode:c,TriggerID:b});$.ajax({method:"POST",contentType:"application/json",url:"/global/submitphoneto3c",data:e,dataType:"json",headers:{__RequestVerificationToken:a}}).done(function(a){"OK"===a.status?(this.isPopUpSubmissionVisible=!1,this.isPopUpCompletionVisible=!0):(this.isPopUpSubmissionVisible=!1,this.isPopUpErrorVisible=!0,console.log("ERROR: "),console.log(a.message))}.bind(this)).fail(function(a){this.isPopUpSubmissionVisible=!1,this.isPopUpErrorVisible=!0,console.log("ERROR: "),console.log(a)}.bind(this)).always(function(){this.isSubmissionLoading=!1}.bind(this))}else this.$refs.submissionForm.reportValidity()}},computed:{isSubmissionTelephoneValid:function(){return""!==this.submissionTelephone&&null!==this.submissionTelephone.match(/^[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4}$/im)}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Vue.Modules.Spring2021.VueRoutes"),e=b.resolve("SDM.Data.Spring2021");d.ProductsDetail={data:function(){return{componentKey:0,currentImageIndex:0,isAboutAccordionExpanded:!0,isLegalAccordionExpanded:!1,product:{},relatedProducts:[]}},name:"RouteProductsDetail",template:"#module-spring-2021-route-products-detail",components:{productTile:c.ProductTile,"store-selector-modal":c.StoreSelectorModal},mounted:function(){this.initProducts()},methods:Object.assign({},Vuex.mapActions("storeSelector",["setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc"]),{initProducts:function(){TweenLite.to(".module-spring-2021-route-products-detail",.2,{opacity:0});var a={CampaignTitle:"spring_2021",
CampaignRoute:"/self-care",Upc:this.$route.params.productId},b=this;$.ajax({method:"POST",url:"/"+e.Lang+"/GetSelfCare2021ProductDetails",data:a,dataType:"json",headers:{__RequestVerificationToken:e.FormToken}}).done(_.bind(function(a){b.product=a.Product,b.relatedProducts=a.RelatedProducts,TweenLite.to(".module-spring-2021-route-products-detail",.4,{opacity:1,delay:.2})},this)).fail(function(a){console.log(a)})},checkAvailability:function(a){this.setProductImageUrl(a.Images&&a.Images.length>0?a.Images[0].Url:""),this.setProductHeading(a.Title),this.setProductUpc(a.Id),this.popUp.showPopUp()},goBack:function(){this.$router.replace("/"+this.$route.params.category+window.location.search)},toggleAboutAccordian:function(){this.isAboutAccordionExpanded?(TweenLite.to(".module-spring-2021-route-products-detail__accordion-text-wrapper--about",.4,{height:0}),this.isAboutAccordionExpanded=!1):(TweenLite.set(".module-spring-2021-route-products-detail__accordion-text-wrapper--about",{height:"auto"}),TweenLite.from(".module-spring-2021-route-products-detail__accordion-text-wrapper--about",.4,{height:0}),this.isAboutAccordionExpanded=!0)},thumbnailClick:function(a){this.currentImageIndex=a},toggleAccordian:function(a,b){"about"===b?this.isAboutAccordionExpanded?(TweenLite.to(a,.4,{height:0}),this.isAboutAccordionExpanded=!1):(TweenLite.set(a,{height:"auto"}),TweenLite.from(a,.4,{height:0}),this.isAboutAccordionExpanded=!0):"legal"===b&&(this.isLegalAccordionExpanded?(TweenLite.to(a,.4,{height:0}),this.isLegalAccordionExpanded=!1):(TweenLite.set(a,{height:"auto"}),TweenLite.from(a,.4,{height:0}),this.isLegalAccordionExpanded=!0))}}),computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{relatedProductTiles:function(){return this.relatedProducts.map(function(a){return this.componentKey++,{cta:{url:"/"+this.$route.params.category+"/"+a.Id,urlLabel:e.ProductCTALabel,urlTarget:"_self",isUrlAbsolute:!1},inventory:{stockCountLabel:e.InventoryCountLabel,checkStockCountLabel:e.CheckAvailabilityLabel,checkOtherStockCountlabel:e.CheckOtherStoresLabel},product:{id:a.Id,image:{alt:a.Images&&a.Images.length>0&&a.Images[0].ImageAltText?a.Images[0].ImageAltText:a.Title,url:a.Images&&a.Images.length>0?a.Images[0].Url:""},link:{url:"/"+this.$route.params.category+"/"+a.Id,target:"_self",isAbsolute:!1},tags:a.Tags,title:a.Title,offer:a.OfferShortText}}},this)}}),watch:{$route:function(){this.initProducts()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Util"),e=b.resolve("SDM.Vue.Stores"),f=b.resolve("SDM.Vue.Modules.Spring2021.VueComponents"),g=b.resolve("SDM.Vue.Modules.Spring2021.VueRoutes"),h=b.resolve("SDM.Data.Spring2021");c.Spring2021=function(){var a=new VueRouter({base:"/"+d.getShortLanguageCode()+"/self-care/",mode:"history",routes:[{component:g.Home,name:"RouteHome",path:"/"},{component:g.ProductsDetail,name:"RouteProductsDetail",path:"/:category/:productId"},{component:g.Refresh,name:"RouteRefresh",path:"/refresh-renew-relax"},{component:g.ForMe,name:"RouteForMe",path:"/doing-it-for-me"},{component:g.TakeOnTheDay,name:"RouteTakeOnTheDay",path:"/take-on-the-day"},{component:g.Contest,name:"RouteContest",path:"/contest"}],scrollBehavior:function(a,b){if(!a.query.v&&!b.query.v)return{x:0,y:0}}}),b=new Vuex.Store({modules:{storeSelector:e.StoreSelector}});new Vue({components:{hero:f.Hero,navigation:f.Navigation,"footer-menu":f.FooterMenu},el:"#module-spring-2021",methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"}),{}),mounted:function(){this.setInventories(h.Inventories.Stores)},router:a,store:b})}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.Summer2021.VueComponents").FooterMenu={computed:{},data:function(){return{}},methods:{},mounted:function(){},props:{},template:"#module-summer-2021-footer-menu",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.Summer2021.VueComponents").Hero={template:"#summer-2021-hero-template",props:{baseBackgroundColor:String,featuredBadges:Object,themesModel:Array,ttwBackgroundColor:String},data:function(){return{currentCategory:"",currentSection:"",headerHexColor:"",heroImage:"",heroImageMobile:"",toPath:"",fromPath:"",themeModel:{},isTextToWin:!1}},created:function(){this.updateCurrentSection()},mounted:function(){},methods:{updateCurrentSection:function(){this.$route.path.split("/").filter(String)[0]?this.currentSection=this.$route.path.split("/").filter(String)[0].toLowerCase():this.currentSection="/"}},watch:{$route:function(a,b){this.toPath=a.path,this.fromPath=b.path,this.updateCurrentSection()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Data.Summer2021");c.Navigation={template:"#module-summer-2021-navigation",components:{navigation:d.Navigation},data:function(){return{menuLabel:e.MobileMenuLabel,menuOpenLabel:e.MobileMenuOpenLabel,menuCloseLabel:e.MobileMenuCloseLabel,links:[]}},mounted:function(){this.links.push({isAbsolute:!1,label:e.HomeTabLabel,target:"",url:"/"});for(var a=0;a<e.TabsJson.length;a++)this.links.push({isAbsolute:!1,label:e.TabsJson[a].Title,target:"",url:"/"+e.TabsJson[a].ThemeKey});this.links.push({isAbsolute:!1,label:e.TextToWinTabLabel,target:"",url:"/contest"})},methods:{},computed:{}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),d=b.resolve("SDM.Vue.Mixins"),e=b.resolve("SDM.Vue.Widgets"),f=SDM.Data.Summer2021,g=b.resolve("SDM.Util"),h=a.$;c.Products={template:"#module-summer-2021-products",components:{"product-tile":e.ProductTile},mixins:[d.Responsive],props:{routeFilters:{type:String,default:""},routeCategories:{type:String,default:""},themeHeading:{type:String,default:""}},data:function(){return{categories:[],currentPageNumber:1,isFiltersActive:!1,isFiltersMobile:!1,filteredProductsCategories:[],products:{},productBadges:f.ProductBadges,productBadgeSize:2,productPerPage:12,screenWidth:0,selectedCategories:[],subThemeFilters:[],themeBadgesData:[],componentKey:0}},mounted:function(){TweenMax.to(".module-summer-2021-products__filters",.6,{opacity:1});var a={CampaignTitle:"Summer_2021",CampaignRoute:"summer",ThemeKey:this.routeCategories},b=this;h.ajax({method:"POST",url:"/"+f.Lang+"/GetSummer2021Products",data:a,dataType:"json",headers:{__RequestVerificationToken:f.FormToken}}).done(_.bind(function(a){b.products=a.Products,this.subThemeFilter=a.SubThemeFilters,this.subThemeFilter.forEach(function(a){b.categories.push(a)},this),b.$route.query.filters&&b.$route.query.filters.split(",").forEach(function(a){b.selectedCategories.push(a)},this),b.filteredProductsCategories=this.getCategoriesFromProducts(this.productsByGroup),TweenMax.to(".module-summer-2021-products__filters-container",.6,{opacity:1})},this)).fail(function(a){console.log(a)}),window.addEventListener("resize",_.debounce(this.onResize,50)),this.onResize()},methods:{onResize:function(){this.screenWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0),this.screenWidth>640?(TweenLite.set(".module-summer-2021-products__filters-container",{height:"auto"}),this.isFiltersActive=!1,this.isFiltersMobile=!1):this.isFiltersMobile||(TweenLite.set(".module-summer-2021-products__filters-container",{height:0}),this.isFiltersActive=!1,this.isFiltersMobile=!0)},getCategoriesFromProducts:function(a){return a.reduce(function(a,b){return b.SubThemes.forEach(function(b){-1===a.findIndex(function(a){return a===b.TitleSlug})&&a.push(b)}),a},[]).map(function(a){return this.categories.find(function(b){if(b.TitleSlug===a)return b})}.bind(this)).sort(function(a,b){return a.Title<b.Title?-1:a.Title>b.Title?1:0})},showHideFilter:function(){this.isFiltersActive?(TweenLite.to(".module-summer-2021-products__filters-container",.3,{height:0}),this.isFiltersActive=!1):(TweenLite.set(".module-summer-2021-products__filters-container",{height:"auto"}),TweenLite.from(".module-summer-2021-products__filters-container",.3,{height:0}),this.isFiltersActive=!0)},initialize:function(){this.selectedCategories=[]},loadMoreProducts:function(){g.scrollTo$ElementAsync(h(this.$refs.loadMoreButton),500),this.currentPageNumber=this.currentPageNumber+1},updateUrlParam:function(){var a={};this.selectedCategories.length>0&&(a=Object.assign({},a,{categories:this.selectedCategories.join(",")})),this.selectedBrands.length>0&&(a=Object.assign({},a,{brands:this.selectedBrands.join(",")})),console.log(a)}},computed:{filterdProducts:function(){return _.shuffle(this.productsByGroup.filter(function(a){return 0===this.selectedCategories.length||a.SubThemes.reduce(function(a,b){return a||this.selectedCategories.includes(b)}.bind(this),!1)}.bind(this)))},filterdProductsByCategories:function(){return this.productsByGroup.filter(function(a){return 0===this.selectedCategories.length||a.SubThemes.reduce(function(a,b){return a||this.selectedCategories.includes(b)}.bind(this),!1)}.bind(this))},productTiles:function(){return this.filterdProducts.map(function(a){return this.componentKey++,{type:"product",productTile:{cta:{url:a.BuyNowLink?a.BuyNowLink:this.$route.path+"/"+a.Id+window.location.search,urlLabel:a.BuyNowLink?f.BuyNowLabel:f.ProductCTALabel,urlTarget:a.BuyNowLink?"_blank":"_self",isUrlAbsolute:!!a.BuyNowLink},inventory:{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel},product:{id:a.Id,image:{alt:a.Title+".",url:a.Images&&a.Images.length>0?a.Images[0].ImageRegularDef:""},link:{url:this.$route.path+"/"+a.Id+window.location.search,target:"_self",isAbsolute:!1},tags:a.Tags,title:a.Title,offer:a.OfferShortText}}}},this)},productsByGroup:function(){return Object.keys(this.products).reduce(function(a,b){return this.products[b]&&this.products[b].ProductGroup===this.productGroup&&a.push(this.products[b]),a}.bind(this),[])},inventory:function(){return{stockCountLabel:f.InventoryCountLabel,checkStockCountLabel:f.CheckAvailabilityLabel,checkOtherStockCountlabel:f.CheckOtherStoresLabel}},productGrid:function(){var a=this.currentPageNumber*this.productPerPage;return this.productTiles.slice(0,a)},totalPageNumber:function(){var a=this.productTiles.length;return Math.ceil(a/this.productPerPage)}},watch:{filterdProducts:function(){this.currentPageNumber=1},productsByGroup:function(){this.filteredProductsCategories=this.getCategoriesFromProducts(this.productsByGroup)},productGroup:function(){this.initialize()}}}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules.Summer2021.VueComponents").BadgeCta={computed:{},data:function(){return{}},methods:{},mounted:function(){},props:{badge:{type:Object,default:null}},template:"#module-summer-2021-badge-cta",updated:function(){},watch:{}}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),d=b.resolve("SDM.Vue.Mixins");c.Video={template:"#module-summer-2021-video",props:{videoData:Array},data:function(){return{isModalActive:!1}},mixins:[d.LockFocus],mounted:function(){this.$route.query.v&&this.initVideo(this.$route.query.v)},methods:{initVideo:function(a){var b=this.findObjectByKey(this.videoData,"TitleSlug",a);b&&this.onVideoThumbnailClick(b.YouTubeVideoID,b.Title)},onVideoThumbnailClick:function(a,b){this.isModalActive=!0,document.body.style.overflow="hidden",document.querySelector("#module-summer-2021-video-embed__video").innerHTML='<iframe class="module-summer-2021-video__embed" src="https://www.youtube.com/embed/'+a+'?autoplay=1&modestbranding=1&rel=0" frameborder="0" title="'+b+'" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen ></iframe>',TweenMax.to(".module-summer-2021-video-embed",.4,{opacity:1}),setTimeout(function(){document.getElementById("module-summer-2021-video-embed__close").focus()},1e3)},onCloseVideo:function(){if(this.isModalActive){var a=this;TweenMax.to(".module-summer-2021-video-embed",.3,{opacity:0,onComplete:a.closeVideo})}},closeVideo:function(){this.isModalActive=!1,document.body.style.overflow="auto",document.querySelector("#module-summer-2021-video-embed__video").innerHTML=""},findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c.toString().toLowerCase())return a[d];return null}},watch:{"$route.query":function(){this.$route.query.v?this.initVideo(this.$route.query.v):this.isModalActive&&this.onCloseVideo()}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),d=b.resolve("SDM.Vue.Modules.Summer2021.VueRoutes"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Vue.Widgets"),g=b.resolve("SDM.Data.Summer2021"),h=b.resolve("SDM.Util");d.Home={template:"#module-summer-2021-route-home",name:"RouteHome",mixins:[e.Responsive],data:function(){return{banners:g.BannerSlides,bannerCarouselSlidesToShow:{desktop:1,tablet:1,mobile:1},bottomBadgesData:g.BottomBadges,categories:g.Categories,categoryCarouselsSlidesToShow:{desktop:3,tablet:2,mobile:2},homeBadges:g.HomeBadges,isCategoriesActive:!1,products:g.Products,homeVideoData:[]}},created:function(){for(var a=0;g.Categories.length>a;a++)for(var b=0;b<g.Categories[a].Badges.length;b++)this.homeVideoData.push(g.Categories[a].Badges[b]);this.homeVideoData.push(g.BottomBadges)},methods:{onVideoTileClick:function(a){var b={};b=Object.assign({},b,{v:a}),h.setUrlVars(b)}},components:{badgeCta:c.BadgeCta,carousel:f.ProductCarousel,"store-selector":f.StoreSelector,"video-modal":c.Video},computed:{badgeCarousels:function(){var a=!1;return this.categories.map(function(b){a=!a;var c=b.FeaturedProducts.map(function(a){return{image:{url:a.Images&&a.Images.length>0?a.Images[0].Url:"",alt:a.Title+" "+g.ProductImageAODALabel},link:{isAbsolute:!1,target:"",url:"/"+b.ThemeKey+"/"+a.Id},text1:a.Title,text2:a.OfferShortText,text3:"",tags:a.Tags}},this),d=b.Badges.map(function(a){return{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{isAbsolute:!1,target:a.CTALinkTarget,url:a.CTALink},youTubeVideoId:a.YouTubeVideoID,youTubeVideoCta:a.TitleSlug}},this);return{badge:{heading:b.CarouselText,hexColorBg:b.CarouselBackgroundHex,hexColorFont:b.CarouselFontHex,hexColorCtaLabel:b.CarouselButtonFontHex,text:"",cta:{url:"/"+b.ThemeKey+(b.SubThemeKey.length>0?"?filters="+b.SubThemeKey:""),label:g.ExploreLabel,isUrlAbsolute:!1}},slides:c,isBadgeOnLeft:!this.isDesktopLarge||a,featuredBadges:d}},this)},hideCategories:function(){this.isCategoriesActive=!1},bottomBadges:function(){return this.bottomBadgesData.map(function(a){return{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{isAbsolute:!1,target:a.CTALinkTarget,url:a.CTALink},youTubeVideoId:a.YouTubeVideoID,youTubeVideoCta:a.TitleSlug}},this)},tileBadges:function(){return this.homeBadges.map(function(a){return{image:{alt:this.isDesktop||this.isDesktopLarge?a.DesktopImageAltText:a.MobileImageAltText,url:this.isDesktop||this.isDesktopLarge?a.DesktopImage:a.MobileImage},link:{label:a.Title,target:a.CTALinkTarget,url:a.CTALink}}},this)}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules.Summer2021.VueRoutes"),d=b.resolve("SDM.Vue.Widgets");c.Contest={template:"#module-summer-2021-route-contest",components:{"pop-up":d.PopUp},props:{},data:function(){return{isPopUpErrorVisible:!1,isPopUpSubmissionVisible:!0,isPopUpCompletionVisible:!1,isPrize1Collapsed:!0,isPrize2Collapsed:!0,isPrize3Collapsed:!0,isSubmissionLoading:!1,submissionTelephone:""}},created:function(){},mounted:function(){},methods:{initializeSubmissionPopUp:function(){this.submissionTelephone="",this.isPopUpSubmissionVisible=!0,this.isPopUpCompletionVisible=!1,this.isPopUpErrorVisible=!1},checkSubmissionTelephone:function(){return this.isSubmissionTelephoneValid?(this.isPopUpSubmissionVisible=!0,this.isPopUpErrorVisible=!1,!0):(this.isPopUpSubmissionVisible=!1,this.isPopUpErrorVisible=!0,!1)},showPopUp:function(){this.initializeSubmissionPopUp(),this.$refs.popUpContestSubmission.showPopUp()},submitContest:function(a,b,c){if(this.$refs.submissionForm.checkValidity()&&this.checkSubmissionTelephone()){var d=this.submissionTelephone.replace(/[()-.]/g,"");this.isSubmissionLoading=!0;var e=JSON.stringify({PhoneNumber:d,ShortCode:c,TriggerID:b});$.ajax({method:"POST",contentType:"application/json",url:"/global/submitphoneto3c",data:e,dataType:"json",headers:{__RequestVerificationToken:a}}).done(function(a){"OK"===a.status?(this.isPopUpSubmissionVisible=!1,this.isPopUpCompletionVisible=!0):(this.isPopUpSubmissionVisible=!1,this.isPopUpErrorVisible=!0,console.log("ERROR: "),console.log(a.message))}.bind(this)).fail(function(a){this.isPopUpSubmissionVisible=!1,this.isPopUpErrorVisible=!0,console.log("ERROR: "),console.log(a)}.bind(this)).always(function(){this.isSubmissionLoading=!1}.bind(this))}else this.$refs.submissionForm.reportValidity()}},computed:{isSubmissionTelephoneValid:function(){return""!==this.submissionTelephone&&null!==this.submissionTelephone.match(/^[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4}$/im)}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Vue.Modules.Summer2021.VueRoutes"),e=b.resolve("SDM.Data.Summer2021");d.ProductsDetail={data:function(){return{componentKey:0,currentImageIndex:0,isAboutAccordionExpanded:!0,isLegalAccordionExpanded:!1,product:{},relatedProducts:[]}},name:"RouteProductsDetail",template:"#module-summer-2021-route-products-detail",components:{productTile:c.ProductTile,"store-selector-modal":c.StoreSelectorModal},mounted:function(){this.initProducts()},methods:Object.assign({},Vuex.mapActions("storeSelector",["setProductImageUrl","setProductHeading","setProductSubheading","setProductUpc"]),{initProducts:function(){TweenLite.to(".module-summer-2021-route-products-detail",.2,{opacity:0});var a={CampaignTitle:"Summer_2021",CampaignRoute:"summer",Upc:this.$route.params.productId},b=this;$.ajax({method:"POST",url:"/"+e.Lang+"/GetSummer2021ProductDetails",data:a,dataType:"json",headers:{__RequestVerificationToken:e.FormToken}}).done(_.bind(function(a){b.product=a.Product,b.relatedProducts=a.RelatedProducts,TweenLite.to(".module-summer-2021-route-products-detail",.4,{opacity:1,delay:.2})},this)).fail(function(a){console.log(a)})},checkAvailability:function(a){this.setProductImageUrl(a.Images&&a.Images.length>0?a.Images[0].Url:""),this.setProductHeading(a.Title),this.setProductUpc(a.Id),this.popUp.showPopUp()},goBack:function(){this.$router.replace("/"+this.$route.params.category+window.location.search)},toggleAboutAccordian:function(){this.isAboutAccordionExpanded?(TweenLite.to(".module-summer-2021-route-products-detail__accordion-text-wrapper--about",.4,{height:0}),this.isAboutAccordionExpanded=!1):(TweenLite.set(".module-summer-2021-route-products-detail__accordion-text-wrapper--about",{height:"auto"}),TweenLite.from(".module-summer-2021-route-products-detail__accordion-text-wrapper--about",.4,{height:0}),this.isAboutAccordionExpanded=!0)},thumbnailClick:function(a){this.currentImageIndex=a},toggleAccordian:function(a,b){"about"===b?this.isAboutAccordionExpanded?(TweenLite.to(a,.4,{height:0}),this.isAboutAccordionExpanded=!1):(TweenLite.set(a,{height:"auto"}),TweenLite.from(a,.4,{height:0}),this.isAboutAccordionExpanded=!0):"legal"===b&&(this.isLegalAccordionExpanded?(TweenLite.to(a,.4,{height:0}),this.isLegalAccordionExpanded=!1):(TweenLite.set(a,{height:"auto"}),TweenLite.from(a,.4,{height:0}),this.isLegalAccordionExpanded=!0))}}),computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{relatedProductTiles:function(){return this.relatedProducts.map(function(a){return this.componentKey++,{cta:{url:"/"+this.$route.params.category+"/"+a.Id,urlLabel:e.ProductCTALabel,urlTarget:"_self",isUrlAbsolute:!1},inventory:{stockCountLabel:e.InventoryCountLabel,checkStockCountLabel:e.CheckAvailabilityLabel,checkOtherStockCountlabel:e.CheckOtherStoresLabel},product:{id:a.Id,image:{alt:a.Images&&a.Images.length>0&&a.Images[0].ImageAltText?a.Images[0].ImageAltText:a.Title,url:a.Images&&a.Images.length>0?a.Images[0].Url:""},link:{url:"/"+this.$route.params.category+"/"+a.Id,target:"_self",isAbsolute:!1},tags:a.Tags,title:a.Title,offer:a.OfferShortText}}},this)}}),watch:{$route:function(){this.initProducts()}}}}(this),function(a){"use strict";var b=a.NR,c=SDM.Data.Summer2021,d=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),e=b.resolve("SDM.Vue.Modules.Summer2021.VueRoutes"),f=b.resolve("SDM.Vue.Mixins"),g=b.resolve("SDM.Vue.Widgets");e.SummerSwitchUp={template:"#module-summer-2021-route-summer-switch-up",mixins:[f.Responsive],components:{"store-selector":g.StoreSelector,"products-grid":d.Products,"video-modal":d.Video},data:function(){return{themeData:{}}},created:function(){this.themeData=this.findObjectByKey(c.TabsJson,"ThemeKey","summer-switch-up")},methods:{findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c.toString().toLowerCase())return a[d];return null}}}}(this),function(a){"use strict";var b=a.NR,c=SDM.Data.Summer2021,d=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),e=b.resolve("SDM.Vue.Modules.Summer2021.VueRoutes"),f=b.resolve("SDM.Vue.Mixins"),g=b.resolve("SDM.Vue.Widgets");e.SummerStaycation={template:"#module-summer-2021-route-summer-staycation",mixins:[f.Responsive],components:{"store-selector":g.StoreSelector,"products-grid":d.Products,"video-modal":d.Video},data:function(){return{themeData:{}}},created:function(){this.themeData=this.findObjectByKey(c.TabsJson,"ThemeKey","summer-staycation")},methods:{findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c.toString().toLowerCase())return a[d];return null}}}}(this),function(a){"use strict";var b=a.NR,c=SDM.Data.Summer2021,d=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),e=b.resolve("SDM.Vue.Modules.Summer2021.VueRoutes"),f=b.resolve("SDM.Vue.Mixins"),g=b.resolve("SDM.Vue.Widgets");e.TimeForAdventure={template:"#module-summer-2021-route-time-for-adventure",mixins:[f.Responsive],components:{"store-selector":g.StoreSelector,"products-grid":d.Products,"video-modal":d.Video},data:function(){return{themeData:{}}},created:function(){this.themeData=this.findObjectByKey(c.TabsJson,"ThemeKey","time-for-adventure")},methods:{findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c.toString().toLowerCase())return a[d];return null}}}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Util"),e=b.resolve("SDM.Vue.Stores"),f=b.resolve("SDM.Vue.Modules.Summer2021.VueComponents"),g=b.resolve("SDM.Vue.Modules.Summer2021.VueRoutes"),h=b.resolve("SDM.Data.Summer2021");c.Summer2021=function(){var a=new VueRouter({base:"/"+d.getShortLanguageCode()+"/summer/",mode:"history",routes:[{component:g.Home,path:"/"},{component:g.Contest,path:"/contest"},{component:g.SummerSwitchUp,path:"/summer-switch-up"},{component:g.SummerStaycation,path:"/summer-staycation"},{component:g.TimeForAdventure,path:"/time-for-adventure"},{component:g.ProductsDetail,path:"/:category/:productId"}],scrollBehavior:function(a,b){if(!a.query.v&&!b.query.v)return{x:0,y:0}}}),b=new Vuex.Store({modules:{storeSelector:e.StoreSelector}});new Vue({components:{hero:f.Hero,navigation:f.Navigation,"footer-menu":f.FooterMenu},el:"#module-summer-2021",methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"}),{}),mounted:function(){this.setInventories(h.Inventories.Stores)},router:a,store:b})}}(this),function(a){"use strict";var b=a.NR,c=a.$,d=b.resolve("SDM.Util"),e=b.resolve("SDM.Vue.Modules"),f=b.resolve("SDM.Vue.Widgets"),g=b.resolve("SDM.Vue.Stores"),h=b.resolve("SDM.Data.Shoebox");e.Shoebox=function(){var a=new Vuex.Store({modules:{donation:g.Donation,shoebox:{}}});new Vue({components:{donation:f.Donation},computed:Object.assign({},Vuex.mapState("donation",["activePanel","panels"]),{}),data:function(){return{isNavActive:!1,isNavSticky:!1,socialBadges:h.SocialBadges,socialBadgeDataURLs:[],shareImagesBlobs:[],activeDonationStep:0,activeNavSection:"",headerHeight:0,navHeight:0!==c(".module-sticky-navigation__nav-wrapper").length?c(".module-sticky-navigation__nav-wrapper").height():0,navSections:{aboutUs:"aboutUs",donate:"donate",home:"home",resources:"resources"},totalDonationSteps:3,showDonationCompletion:!1,currentSocialBadgeIndex:0}},el:"#module-shoebox",created:function(){var a=window.location.search.substring(1);"completion"===new URLSearchParams(a).get("step")&&(this.showDonationCompletion=!0)},methods:Object.assign({},Vuex.mapActions("donation",["setActivePanel","setMoneyAmount","setPcOptimumAmount"]),{goToDonationStep:function(a){d.scrollTo$ElementAsync(c(this.$refs.sectionDonate),500,this.navHeight),this.activeDonationStep=a},fetchBadgeDataUrl:function(a){if(a&&a.Asset&&a.Asset.URL){var b=new Image;b.setAttribute("crossOrigin","anonymous");var c=this;b.onload=function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height,a.getContext("2d").drawImage(this,0,0);var b=a.toDataURL("image/png");c.socialBadgeDataURLs.push(b)},b.src=a.Asset.URL}},initializeCarousel:function(){this.initializeCarouselProduct(),this.initializeCarouselShare()},initializeCarouselProduct:function(){c(this.$refs.carouselProduct).length>0&&c(this.$refs.carouselProduct).slick({infinite:!0,lazyLoad:"ondemand",slidesToScroll:1,slidesToShow:4,responsive:[{breakpoint:769,settings:{slidesToShow:2,swipeToSlide:!0}},{breakpoint:480,settings:{slidesToShow:1,swipeToSlide:!0}}]})},initializeCarouselShare:function(){c(this.$refs.carouselShare).length>0&&(console.log("Carousel called"),c(this.$refs.carouselShare).on("afterChange",function(){this.currentSocialBadgeIndex=c(this.$refs.carouselShare).slick("slickCurrentSlide")}.bind(this)),c(this.$refs.carouselShare).slick({infinite:!0,lazyLoad:"ondemand",slidesToScroll:1,slidesToShow:1,responsive:[{breakpoint:769,settings:{slidesToShow:1,swipeToSlide:!0}}]}))},initializeSocial:function(){POWERREVIEWS.display.render({api_key:"f40b12ae-7efa-423a-8f12-cb902debf1c0",locale:"en_CA",merchant_id:"867678",irlSubtype:"XL",components:{IRLSnippet:"module-shoebox__social"}})},setDonationAmount:function(a,b){var e=parseFloat(a)>0?a:"",f=parseInt(b)>0?b:"";this.setMoneyAmount(e),localStorage.setItem("donationMoneyAmount",e),this.setPcOptimumAmount(f),localStorage.setItem("donationPointsAmount",f),this.activeDonationStep++,d.scrollTo$ElementAsync(c(this.$refs.sectionDonate),500,this.navHeight)}}),mounted:function(){this.initializeCarousel(),this.initializeSocial();var a=d.getUrlVars();a&&"points"===a.type?this.goToDonationStep(2):a&&"introduction"===a.step&&this.goToDonationStep(1),this.socialBadges.forEach(function(a){this.fetchBadgeDataUrl(a)}.bind(this))},store:a,watch:{activePanel:function(a){a===this.panels.completion?this.showDonationCompletion=!0:a===this.panels.confirmation?(this.activeDonationStep=3,this.totalDonationSteps=3):a===this.panels.points||a===this.panels.pcoptimum||a===this.panels.money?(this.activeDonationStep=2,this.totalDonationSteps=3):this.activeDonationStep=1},showDonationCompletion:function(){var a=this;setTimeout(function(){a.initializeCarouselShare()},50)}}})}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Util");c.StickyNavigation=function(){new Vue({data:function(){return{isNavActive:!1,isNavSticky:!1}},el:"#module-sticky-navigation",methods:{onResize:function(){this.headerHeight=this.$refs.navLogo.clientHeight,this.stickHeader()},onScroll:function(){this.stickHeader()},stickHeader:function(){var a=d.getHeaderBarHeight(),b=window.pageYOffset||document.documentElement.scrollTop;Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=960&&(a=0),this.isNavSticky=b>=a},toggleNav:function(){this.isNavActive=!this.isNavActive,this.isNavActive?document.body.style.overflow="hidden":document.body.style.overflow="visible",this.stickHeader()},toggleNavOff:function(){this.isNavActive=!1,document.body.style.overflow="visible",this.stickHeader()},isNavUrlActive:function(a){return new URL(a,window.location.origin).pathname===window.location.pathname}},mounted:function(){this.headerHeight=this.$refs.navLogo.clientHeight,window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",_.debounce(this.onResize,100))}})}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Core.Modules"),d=b.resolve("SDM.Util");c.ArticleDetails=function(a){new Vue({components:{},created:function(){},data:function(){return{}},el:a,methods:{shareFacebook:function(){FB.ui({display:"popup",href:window.location.href,method:"share"})}},mounted:function(){if(d.getUrlVars().parentUrl&&window.history.replaceState({},document.title,window.location.pathname),this.$refs.productsCarousel){var a=this.$refs.productsCarousel.children.length||0;a<=2||$(this.$refs.productsCarousel).slick({nextArrow:'<button type="button" class="md-ad__carousel-arrow"><span>Next</span></button>',prevArrow:'<button type="button" class="md-ad__carousel-arrow md-ad__carousel-arrow--prev"><span>Previous</span></button>',responsive:[{breakpoint:769,settings:{slidesToShow:Math.min(a,2)}}],slidesToShow:Math.min(a,4)})}},watch:{}})}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Util");c.StickyPromotionBar=function(){new Vue({data:function(){return{isNavSticky:!1}},el:"#module-sticky-promotion-bar",methods:{onResize:function(){this.stickHeader()},onScroll:function(){this.stickHeader()},stickHeader:function(){var a=d.getHeaderBarHeight(),b=window.pageYOffset||document.documentElement.scrollTop;Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=960&&(a=0),this.isNavSticky=b>=a},toggleNav:function(){this.isNavActive=!this.isNavActive,this.isNavActive?document.body.style.overflow="hidden":document.body.style.overflow="visible",this.stickHeader()},toggleNavOff:function(){this.isNavActive=!1,document.body.style.overflow="visible",this.stickHeader()},isNavUrlActive:function(a){return new URL(a,window.location.origin).pathname===window.location.pathname}},mounted:function(){window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",_.debounce(this.onResize,100))}})}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules.WomensHealth.VueComponents"),d=a._,e=a.$;c.Carousel={beforeDestroyed:function(){var b=e(a);b.off("becometonarrow becometowide",this.boundOnBecomeToNarrow),b.off("becometosmalldesktopwide becometoextrawide",this.boundOnBecomeToWide),b.off("resize",this.boundOnResize)},computed:{canMoveLeft:function(){return this.offsetLeftFactor>0},canMoveRight:function(){return this.offsetLeftFactor<this.items.length-this.numDisplayedItems},isShowArrows:function(){return this.canMoveLeft||this.canMoveRight},marginLeft:function(){return"-"+String(this.offsetLeftFactor*this.itemWidth)+"px"}},created:function(){var b=e(a);this.boundOnBecomeToNarrow=d.bind(function(){this.numDisplayedItems=this.numDisplayedItemsMobile},this),this.boundOnBecomeToWide=d.bind(function(){this.numDisplayedItems=this.numDisplayedItemsDesktop},this),this.boundOnResize=d.debounce(this.calculateItemWidth,50),b.on("becometonarrow becometowide",this.boundOnBecomeToNarrow),b.on("becometosmalldesktopwide becometoextrawide",this.boundOnBecomeToWide),b.on("resize",this.boundOnResize)},data:function(){return{itemWidth:300,numDisplayedItems:1,offsetLeftFactor:0}},methods:{calculateItemWidth:function(){if(this.items.length){var a=this.$refs.container.offsetWidth;this.itemWidth=Math.round(a/this.numDisplayedItems)}},moveLeft:function(){this.canMoveLeft&&(this.offsetLeftFactor-=1)},
moveRight:function(){this.canMoveRight&&(this.offsetLeftFactor+=1)}},mounted:function(){this.calculateItemWidth()},name:"Carousel",props:{downloadLinkLabel:{default:"Download",required:!1,type:String},itemPadding:{default:null,required:!1,type:[Number,String]},items:{required:!0,type:Array},numDisplayedItemsDesktop:{default:3,required:!1,type:Number},numDisplayedItemsMobile:{default:2,required:!1,type:Number},layout:{type:String}},template:"#module-womens-health-carousel",watch:{items:function(){this.offsetLeftFactor=0,this.$nextTick(d.bind(function(){this.calculateItemWidth()},this))},numDisplayedItems:function(){this.items.length&&(this.calculateItemWidth(),this.offsetLeftFactor=Math.min(this.offsetLeftFactor,this.items.length-this.numDisplayedItems))}}}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules.WomensHealth.VueComponents"),d=b.resolve("SDM.Util"),e=b.resolve("SDM.Data.WomensHealth"),f=a.localStorage;c.GivingTree={computed:Object.assign({},Vuex.mapState("womensHealth",["isDonationStepVisible","isRedirectingModalStep"]),{activeDonationAmountStepNumber:function(){switch(this.activeDonationAmountStep){case this.donationAmountSteps.pcoptimum:case this.donationAmountSteps.money:return 1;case this.donationAmountSteps.points:case this.donationAmountSteps.address:return 2;case this.donationAmountSteps.confirmation:case this.donationAmountSteps.completion:return 3}},donationNameValue:{get:function(){return this.donationName},set:function(a){this.donationName=a.toUpperCase()}},donationStepsPercentage:function(){switch(this.activeDonationStep){case this.donationSteps.amount:return"25%";case this.donationSteps.personalize:return"50%";case this.donationSteps.preview:return"75%";case this.donationSteps.confirmation:return"100%"}},formattedDonationName:function(){return this.isNameValid?this.donationName.split("").join(".")+".":""},numberOfDonationAmountSteps:function(){switch(this.activeDonationAmountStep){case this.donationAmountSteps.introduction:case this.donationAmountSteps.points:case this.donationAmountSteps.money:case this.donationAmountSteps.pcoptimum:case this.donationAmountSteps.address:case this.donationAmountSteps.confirmation:case this.donationAmountSteps.completion:return 3}},isDonationNextButtonDisabled:function(){return!this.isDonationStepVisible||(this.activeDonationStep!==this.donationSteps.amount?this.activeDonationStep===this.donationSteps.personalize?null===this.activeAvatar:this.activeDonationStep===this.donationSteps.preview&&(""===this.donationName||""===this.donationLocation):this.activeDonationAmountStep===this.donationAmountSteps.introduction?""===this.selectedDonationType:this.activeDonationAmountStep===this.donationAmountSteps.points?!this.isPCOptimumAmountValid:this.activeDonationAmountStep===this.donationAmountSteps.money?!this.isMoneyAmountValid:this.activeDonationAmountStep!==this.donationAmountSteps.completion&&void 0)},isNameValid:function(){var a=/^([A-Z][A-Z])$/;return this.donationName.search(a)>=0},isMoneyAmountValid:function(){var a=/^[1-9]\d*$/;return""!==this.moneyAmount&&this.moneyAmount>=parseFloat(e.MinimumDollarAmount)&&this.moneyAmount.search(a)>=0},isPCOptimumAmountValid:function(){var a=/^[1-9]\d*$/;return""!==this.pcOptimumAmount&&this.pcOptimumAmount>=parseFloat(e.MinimumPointAmount)&&this.pcOptimumAmount.search(a)>=0},isTreeModalVisible:function(){return(this.isWelcomeModalVisible||this.isTreeDetailModalVisible)&&this.activeTreeStep===this.treeSteps.growingTree&&!this.isDonationStepVisible}}),directives:{focus:{inserted:function(a){a.focus()}}},data:function(){return{activeAvatar:null,activeAvatarPlayer:null,activeDonationStep:1,activeDonationAmountStep:"",activeModalPartnerDetail:null,activeModalShelterDetail:null,activeTreeStep:"",address:{firstName:"",lastName:"",email:"",address1:"",address2:"",city:"",province:"",postalCode:""},avatars:e.Avatars,branches:e.Branches,donationLocation:"",donationName:"",donationTypes:{money:"money",points:"points"},isDonationLocationDropdownActive:!1,isLoaderVisible:!1,isPCOptimumErrorVisible:!1,isTreeDetailModalVisible:!1,isWelcomeModalVisible:!0,donationSteps:{amount:1,personalize:2,preview:3,confirmation:4},donationAmountSteps:{introduction:"introduction",points:"points",money:"money",pcoptimum:"pcoptimum",address:"address",confirmation:"confirmation",completion:"completion"},moneyAmount:"",partners:e.Partners,pcOptimumAmount:"",pcOptimumPointsPerDollar:1e3,selectedDonationType:"",shelters:e.Shelters,signature:"",tree:e.Tree,treeSteps:{growingTree:"growingTree",community:"community"}}},methods:Object.assign({},Vuex.mapActions("womensHealth",["setIsDonationStepVisible","setIsRedirectingModalStep"]),{checkDonationName:function(){this.isNameValid?this.$refs.formDonationName.setCustomValidity(""):this.$refs.formDonationName.setCustomValidity(e.InitialsErrorMessage)},clickOutside:function(){this.activeDonationStep===this.donationSteps.confirmation&&this.initializeData()},completeDonation:function(){this.initializeData(),this.setIsDonationStepVisible(!1)},convertDonationNameToUppercase:function(){this.donationName=this.donationName.toUpperCase()},formatToCurrency:function(a){var b=d.getShortLanguageCode(),c=parseFloat(a).toFixed(2).split("."),e=c[0],f=c[1];return"en"===b?"$"+(e=e.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))+"."+f:"fr"===b?(e=e.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 "))+","+f+" $":void 0},donatePCOptimumPoints:function(){this.isLoaderVisible=!0,$.ajax({context:this,data:{points:this.pcOptimumAmount},method:"POST",url:"/Brooklyn/Donate"}).done(function(a,b){"success"===b&&"202"===a?this.activeDonationAmountStep=this.donationAmountSteps.completion:(this.isPCOptimumErrorVisible=!0,console.log("ERROR:"+a))}).fail(function(a){console.log(a),this.isPCOptimumErrorVisible=!0}).always(function(){this.isLoaderVisible=!1})},getFormDataAsObject:function(a){for(var b=$(a).serializeArray(),c={},d=0;d<b.length;d++)c[b[d].name]=b[d].value;return c},findAvatarFromId:function(a){return this.avatars.find(function(b){return b.AvatarID===a})},getFrontStreamUrl:function(){var a=document.createElement("iframe");a.name="iframe_payment",a.id="iframe_payment",a.className="module-womens-health-giving-tree__dontation-iframe",a.title=e.DonateMoneyIframeTitle,a.src=this.signature,this.$refs.iframePaymentContainer.firstChild&&this.$refs.iframePaymentContainer.removeChild(this.$refs.iframePaymentContainer.firstChild),this.$refs.iframePaymentContainer.appendChild(a),this.isLoaderVisible=!0,$.ajax({contentType:"application/x-www-form-urlencoded",context:this,data:{donor:JSON.stringify(this.address),amount:this.moneyAmount,languagePreference:"en-ca"===d.getFullLanguageCode()||"en-qc"===d.getFullLanguageCode()?"en-CA":"fr-CA"},headers:{__RequestVerificationToken:e.VerificationToken},method:"POST",url:"/LoveYou/getFrontStreamUrl"}).done(function(b,c){"success"===c?(this.signature=b,Vue.nextTick(function(){a.src=this.signature}.bind(this))):console.log("ERROR:"+response)}).fail(function(a){console.log(a)}).always(function(){this.isLoaderVisible=!1})},findPartnerFromId:function(a){return this.partners.find(function(b){return b.ID===a})},findShelterFromId:function(a){return this.shelters.find(function(b){return b.ID===a})},getRandomBranch:function(){var a=Math.floor(Math.random()*this.branches.length);return this.branches[a]},getSignature:function(){var a=document.createElement("iframe");a.name="iframe_payment",a.id="iframe_payment",a.className="module-womens-health-giving-tree__dontation-iframe",this.$refs.iframePaymentContainer.firstChild&&this.$refs.iframePaymentContainer.removeChild(this.$refs.iframePaymentContainer.firstChild),this.$refs.iframePaymentContainer.appendChild(a);var b=this.getFormDataAsObject(this.$refs["form-donation"]);b.lang_code=d.getFullLanguageCode(),this.isLoaderVisible=!0,$.ajax({contentType:"application/x-www-form-urlencoded",context:this,data:{data:JSON.stringify(b)},headers:{__RequestVerificationToken:e.VerificationToken},method:"POST",url:"/WomensHealth/GetDonationSignature"}).done(function(a,b){"success"===b?(this.signature=a,f.setItem("donationMoneyAmount",this.moneyAmount),Vue.nextTick(function(){this.$refs["form-donation"].submit()}.bind(this))):console.log("ERROR:"+response)}).fail(function(a){console.log(a)}).always(function(){this.isLoaderVisible=!1})},initializeData:function(){this.moneyAmount="",this.pcOptimumAmount="",this.selectedDonationType="",this.signature="",this.donationName="",this.donationLocation="",this.activeDonationStep=this.donationSteps.amount,this.activeDonationAmountStep=this.donationAmountSteps.introduction,f.removeItem("donationMoneyAmount"),this.isPCOptimumErrorVisible=!1},isAvatarSelectable:function(a){return this.selectedDonationType===this.donationTypes.money?a.MonetaryValue<=this.moneyAmount&&!a.PCOnly:this.selectedDonationType===this.donationTypes.points&&a.PCOnly},isDigit:function(a){var b=a.keyCode?a.keyCode:a.which;(b<48||b>57)&&46!==b&&8!==b&&a.preventDefault()},onDonationNextClick:function(){this.isDonationStepVisible&&(this.activeDonationStep===this.donationSteps.amount?this.activeDonationAmountStep===this.donationAmountSteps.introduction?this.selectedDonationType===this.donationTypes.points?this.activeDonationAmountStep=e.IsLoggedIn?this.donationAmountSteps.points:this.donationAmountSteps.pcoptimum:this.selectedDonationType===this.donationTypes.money&&(this.activeDonationAmountStep=this.donationAmountSteps.money):this.activeDonationAmountStep===this.donationAmountSteps.points?this.donatePCOptimumPoints():this.activeDonationAmountStep===this.donationAmountSteps.money?this.activeDonationAmountStep=this.donationAmountSteps.address:this.activeDonationAmountStep===this.donationAmountSteps.address?this.submitPayment():this.activeDonationAmountStep===this.donationAmountSteps.completion&&(this.activeDonationStep+=1):this.activeDonationStep===this.donationSteps.preview?(this.checkDonationName(),this.$refs.formDonationPreview.checkValidity()?this.submitGivingTreeDonation():this.$refs.formDonationPreview.reportValidity()):this.activeDonationStep+=1)},onDonationPreviousClick:function(){this.isDonationStepVisible&&(this.activeDonationStep===this.donationSteps.amount?this.activeDonationAmountStep===this.donationAmountSteps.introduction?this.setIsDonationStepVisible(!1):this.activeDonationAmountStep===this.donationAmountSteps.points?this.activeDonationAmountStep=this.donationAmountSteps.introduction:this.activeDonationAmountStep===this.donationAmountSteps.money?this.activeDonationAmountStep=this.donationAmountSteps.introduction:this.activeDonationAmountStep===this.donationAmountSteps.pcoptimum?this.activeDonationAmountStep=this.donationAmountSteps.introduction:this.activeDonationAmountStep===this.donationAmountSteps.address?this.activeDonationAmountStep=this.donationAmountSteps.money:this.activeDonationAmountStep===this.donationAmountSteps.confirmation&&(this.activeDonationAmountStep=this.donationAmountSteps.address):this.activeDonationStep-=1)},pauseAvatar:function(a,b){this.activeAvatar&&this.activeAvatar.AvatarID===b||a.target.pause()},playAvatar:function(a,b){this.activeAvatar&&this.activeAvatar.AvatarID===b||a.target.play()},clearUrlParams:function(){var a="";a=-1===window.location.href.indexOf("?")?window.location.href:window.location.href.slice(0,window.location.href.indexOf("?")),history.pushState&&window.history.pushState("",null,a)},setActiveAvatar:function(a,b){null!==this.activeAvatarPlayer&&this.activeAvatarPlayer.pause(),this.activeAvatarPlayer="lottie-player"===a.target.tagName.toLowerCase()?a.target:a.target.querySelectorAll("lottie-player")[0],this.activeAvatarPlayer.play(),this.activeAvatar=b},submitPayment:function(){this.$refs["form-address"].checkValidity()?(this.activeDonationAmountStep=this.donationAmountSteps.confirmation,Vue.nextTick(function(){this.getFrontStreamUrl()}.bind(this))):this.$refs["form-address"].reportValidity()},submitGivingTreeDonation:function(){this.isLoaderVisible=!0,$.ajax({context:this,data:{Initials:this.formattedDonationName,AvatarID:this.activeAvatar.AvatarID,DonationAmount:this.selectedDonationType===this.donationTypes.money?this.moneyAmount:this.pcOptimumAmount,DonationType:this.selectedDonationType===this.donationTypes.money?"d":"p",Location:this.donationLocation},headers:{__RequestVerificationToken:e.VerificationToken},method:"POST",url:"/WomensHealth/Submit"}).done(function(a,b){"success"===b?(this.tree.unshift(a),this.activeDonationStep+=1):console.log("ERROR:"+a)}).fail(function(a){console.log(a)}).always(function(){this.isLoaderVisible=!1})},hidePopUp:function(){this.$root.$emit("pop-up-closed-footer")},checkKeyEvent:function(a){if("Escape"===a.key)return this.isTreeDetailModalVisible=!1,void(this.isWelcomeModalVisible=!1);var b=this.$refs.modalContainer.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(b.length<2&&"Tab"===a.key)return void a.preventDefault();var c=b.length-1;"Tab"===a.key&&!1===a.shiftKey&&a.target===b[c]?(a.preventDefault(),b[0].focus()):"Tab"===a.key&&!0===a.shiftKey&&a.target===b[0]&&(a.preventDefault(),b[c].focus())}}),mounted:function(){this.activeTreeStep=this.treeSteps.growingTree,this.activeDonationStep=this.donationSteps.amount,this.activeDonationAmountStep=this.donationAmountSteps.introduction,window.addEventListener?window.addEventListener("message",function(a){e&&e.FrontStreamUrl&&e.FrontStreamUrl.includes(a.origin)&&("userCancelled"===a.data?this.activeDonationAmountStep=this.donationAmountSteps.address:(this.activeDonationStep=this.donationSteps.personalize,this.activeDonationAmountStep="",this.donationLocation=this.address.province))}.bind(this)):window.attachEvent&&window.attachEvent("onmessage",function(a){e&&e.FrontStreamUrl&&e.FrontStreamUrl.includes(a.origin)&&("userCancelled"===a.data?this.activeDonationAmountStep=this.donationAmountSteps.address:(this.activeDonationStep=this.donationSteps.personalize,this.activeDonationAmountStep="",this.donationLocation=this.address.province))}.bind(this))},name:"GivingTree",template:"#module-womens-health-giving-tree",watch:{isRedirectingModalStep:function(a){if(!0===a){var b=d.getUrlVars();b&&"points"===b.type&&(e.IsLoggedIn?(this.selectedDonationType=b.type,this.activeDonationAmountStep=this.donationAmountSteps.points):this.activeDonationAmountStep=this.donationAmountSteps.pcoptimum),this.setIsRedirectingModalStep(!1),this.clearUrlParams()}},isTreeModalVisible:function(a){a&&this.$nextTick(function(){this.$refs.modalContainer.focus()})}}}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Util"),e=b.resolve("SDM.Vue.Modules.WomensHealth.VueComponents"),f=b.resolve("SDM.Vue.Widgets"),g=a.localStorage,h=b.resolve("SDM.Data.WomensHealth"),i=a._,j=a.$,k=function(a){if(!a)return null;try{var b=a.match(/href="([^"]*)"/i);if(!b||!b.length)return null;var c=a.match(/^<[^>]*>([^<]*)<\/a>$/i);if(!c||!c.length)return null;var d=a.match(/target="([^"]*)"/i);return{href:b[1],target:d&&d.length?d[1]:"",text:c[1]}}catch(b){return console.error("Could not parse URL:",a,b),null}};c.WomensHealth=function(){var a=new Vuex.Store({modules:{womensHealth:{actions:{setIsDonationStepVisible:function(a,b){a.commit("setIsDonationStepVisible",b)},setIsRedirectingModalStep:function(a,b){a.commit("setIsRedirectingModalStep",b)}},mutations:{setIsDonationStepVisible:function(a,b){a.isDonationStepVisible=b},setIsRedirectingModalStep:function(a,b){a.isRedirectingModalStep=b}},namespaced:!0,state:function(){return{isDonationStepVisible:!1,isRedirectingModalStep:!1}}}}});new Vue({components:{carousel:e.Carousel,"giving-tree":e.GivingTree,"pop-up":f.PopUp},computed:Object.assign({},Vuex.mapState("womensHealth",["isRedirectingModalStep"]),{}),created:function(){this.charitiesByProvinceId=i.reduce(this.partners,function(a,b){var c=(b.Province||"").toLowerCase();return c?(a[c]||(a[c]=[]),a[c].push({imageUrl:(b.Image||{}).URL,label:b.Title,url:k(b.Url)}),a):a},{}),this.shelters.length&&(this.featuredShelter={body:this.shelters[0].LongDescription||"",imageUrl:(this.shelters[0].LargeLogo||{}).URL||"",name:this.shelters[0].Name||""}),this.geoLocateUser()},data:function(){return{charitiesByProvinceId:{},charitiesWithImages:[],testimonials:h.Testimonials,charitiesWithoutImages:[],featuredShelter:null,isShowAdditionalCharities:!1,partners:h.Partners,selectedProvinceId:"",shelters:h.Shelters,socialBadges:i.map(i.filter(h.SocialImages||[],function(a){return Boolean(a.URL)}),function(a){return{downloadLink:{href:a.URL,target:"_blank"},label:a.Label||"",imageUrl:a.URL}})}},el:"#module-womens-health",methods:Object.assign({},Vuex.mapActions("womensHealth",["setIsDonationStepVisible","setIsRedirectingModalStep"]),{geoLocateUser:function(){var a=new j.Deferred;navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){b&&b.coords&&b.coords.latitude&&b.coords.longitude?a.resolve({lat:b.coords.latitude,lng:b.coords.longitude}):a.reject("Failed to get lat/lng data")},function(b){console.error(b),a.reject("Failed to get response from navigator.geolocation")}):a.reject("No navigator.geolocation api"),j.when(a.promise()).then(function(a){return d.getProvinceId(a)}).then(i.bind(function(a){this.selectedProvinceId=a},this)).fail(function(a){console.error(a)})},showAdditionalCharities:function(){this.isShowAdditionalCharities=!0},showTreeModal:function(a){this.setIsDonationStepVisible(a),this.$refs.popUpTreeModal.showPopUp(),this.isRedirectingModalStep||g.removeItem("donationMoneyAmount"),this.$refs.givingTree.$refs.modalContainerCloseBtn&&this.$refs.givingTree.$refs.modalContainerCloseBtn.focus()}}),mounted:function(){var a=d.getUrlVars();a&&"points"===a.type&&(this.setIsRedirectingModalStep(!0),this.showTreeModal(!0))},store:a,watch:{selectedProvinceId:function(){var a=d.getShortLanguageCode(),b=i.reduce(this.charitiesByProvinceId[this.selectedProvinceId]||[],function(a,b){return Boolean(b.imageUrl)?a.withImages.push(b):a.withoutImages.push(b),a},{withImages:[],withoutImages:[]});b.withoutImages.length&&b.withImages.push({clickEvent:"view-all",label:"fr"===a?"Tout voir":"View All Charities",imageUrl:"/static/campaigns/womens-health/images/view-all-charities_"+("fr"===a?"fr":"en")+".png"}),this.charitiesWithImages=b.withImages,this.charitiesWithoutImages=b.withoutImages.sort(function(a,b){return a.label<b.label?-1:a.label>b.label?1:0}),this.isShowAdditionalCharities=!1}}})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Util");c.GlobalCtaList=function(a){var c=a.data("contentId"),f=b.resolve("SDM.Data.GlobalCTAList")[c],g=b.resolve("SDM.Vue.Vuex");g.hasModule("provinceSelector")||g.registerModule("provinceSelector",d.ProvinceSelector),new Vue({computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),data:function(){return{badges:f.Badges,sdmLocationProvinceId:""}},el:a[0],methods:{},mounted:function(){var a=JSON.parse(e.getValueFromCookie("sdm-location"));this.sdmLocationProvinceId=a&&a.province?a.province:""},store:g})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Widgets");c.FeaturedProductsCarousel=function(a){var c=b.resolve("SDM.Vue.Vuex");c.hasModule("storeSelector")||c.registerModule("storeSelector",d.StoreSelector),new Vue({el:"#"+a[0].id,store:c,components:{carousel:e.ProductCarousel,"store-selector":e.StoreSelector},props:{dataProducts:String},data:function(){return{categoryCarouselsSlidesToShow:{desktop:5,tablet:3,mobileLarge:2,mobile:2},products:[],showInventory:!1,checkAvailabilityLabel:"",checkOtherStoresLabel:"",detailsButtonLabel:"",inStoreLabel:"",ourStockLabel:"",shopButtonLabel:""}},mounted:function(){this.products=JSON.parse(this.$el.attributes["data-products"].value),this.checkAvailabilityLabel=this.$el.attributes["data-check-availability-label"].value,this.checkOtherStoresLabel=this.$el.attributes["data-check-other-stores-label"].value,this.detailsButtonLabel=this.$el.attributes["data-details-button-label"].value,this.inStoreLabel=this.$el.attributes["data-in-store-label"].value,this.ourStockLabel=this.$el.attributes["data-our-stock-label"].value,this.shopButtonLabel=this.$el.attributes["data-shop-button-label"].value,this.showInventory="False"===this.$el.attributes["data-hide-inventory"].value,this.showInventory&&this.setInventories(JSON.parse(this.$el.attributes["data-inventories"].value).Stores)},methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"}),{}),computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{productsCarousel:function(){return{slides:this.products.map(function(a){var b={};return this.showInventory&&(b={stockCountLabel:this.inStoreLabel,checkStockCountLabel:this.checkAvailabilityLabel,checkOtherStockCountlabel:this.checkOtherStoresLabel,ourStockLabel:this.ourStockLabel}),{id:a.UpcStripped,image:{url:a.ImageUrl,alt:a.Title},cta:{isAbsolute:!0,label:a.UseBuyNowLabel?this.shopButtonLabel:this.detailsButtonLabel,target:a.ProductCTATarget,url:a.ProductCTA},link:{isAbsolute:!0,target:a.ProductCTATarget,url:a.ProductCTA},inventory:b,hasBuyNowLink:a.UseBuyNowLabel,text1:a.Brand,text2:a.Title,text3:a.Tag,title:a.Title}},this)}}}),watch:{}})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Util"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Vue.Stores"),g=b.resolve("SDM.Vue.Widgets");c.DietitionNavigation=function(a){var c=a.data("contentId"),h=b.resolve("SDM.Data.DietitianNavigation")[c],i=b.resolve("SDM.Vue.Vuex");i.hasModule("provinceSelector")||i.registerModule("provinceSelector",f.ProvinceSelector),new Vue({el:a[0],mixins:[e.Responsive],created:function(){},components:{"province-selector":g.ProvinceSelector},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{filteredSlides:function(){return this.slides.filter(function(a){return a.provinces.includes(this.userProvinceId)}.bind(this))}}),data:function(){return{slides:h.Slides}},methods:{isUrlActive:function(a){var b=new URL(a,window.location.origin),c=b.pathname.split("/"+d.getShortLanguageCode()).pop();return window.location.pathname.split("/"+d.getShortLanguageCode()).pop()===c}},mounted:function(){},store:i,watch:{filteredSlides:function(){this.$refs.carousel&&(this.$refs.carousel.hasOwnProperty("slick")&&$(this.$refs.carousel).slick("unslick"),Vue.nextTick(function(){$(this.$refs.carousel).slick({arrows:!1,autoplay:!0,dots:!0})}.bind(this)))}}}),$(".module-dietitian-navigation__region-expand").on("click",function(){$("#module-dietitian-navigation__region-expand").hasClass("module-dietitian-navigation__region-expand--open")?setTimeout(function(){$("#module-dietitian-navigation__region-expand").removeClass("module-dietitian-navigation__region-expand--open"),$(".module-dietitian-navigation__region-expanded").removeClass("module-dietitian-navigation__region-expanded--open")},10):($(".module-dietitian-navigation__region-expanded").addClass("module-dietitian-navigation__region-expanded--open"),$("#module-dietitian-navigation__region-expand").addClass("module-dietitian-navigation__region-expand--open"))}),$(".module-dietitian-navigation__menu-mobilebutton").on("click",function(){$("#module-dietitian-navigation__header-nav").hasClass("module-dietitian-navigation__header-nav--open")?setTimeout(function(){$("#module-dietitian-navigation__header-nav").removeClass("module-dietitian-navigation__header-nav--open"),$(".module-dietitian-navigation__menu-hamburger").removeClass("module-dietitian-navigation__menu-hamburger--open")},10):($(".module-dietitian-navigation__menu-hamburger").addClass("module-dietitian-navigation__menu-hamburger--open"),$("#module-dietitian-navigation__header-nav").addClass("module-dietitian-navigation__header-nav--open"))}),$(".module-dietitian-navigation__recipe-btn").on("click",function(a){$(".module-dietitian-navigation__recipenav").hasClass("module-dietitian-navigation__recipenav--open")?($(".module-dietitian-navigation__recipenav").removeClass("module-dietitian-navigation__recipenav--open"),$(".downarrow").removeClass("downarrow--open"),$(".module-dietitian-navigation__recipe-expand").attr("aria-expanded","false")):($(".module-dietitian-navigation__recipenav").addClass("module-dietitian-navigation__recipenav--open"),$(".downarrow").addClass("downarrow--open"),$(".module-dietitian-navigation__recipe-expand").attr("aria-expanded","true"),a.preventDefault())}),$(document).on("click",function(a){$(a.target).closest(".module-dietitian-navigation__recipe-btn").length||($(".module-dietitian-navigation__recipenav").removeClass("module-dietitian-navigation__recipenav--open"),$(".downarrow").removeClass("downarrow--open"),$(".module-dietitian-navigation__recipe-expand").attr("aria-expanded","false"))})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Mixins");c.DietitionBiography=function(){var a=b.resolve("SDM.Vue.Vuex");a.hasModule("provinceSelector")||a.registerModule("provinceSelector",VueStores.ProvinceSelector),new Vue({el:"#module-dietitian-biography",computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),data:function(){return{}},mixins:[d.Responsive],mounted:function(){},store:a,updated:function(){$("#module-dietitian-biography .module-dietitian-biography__bio-entry").length<1&&$("#module-dietitian-biography").hide()}})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Data.DietitionSocialFeed");c.DietitionSocialFeed=function(){new Vue({el:"#module-dietitian-socialfeed",methods:{initSocial:function(){POWERREVIEWS.display.render({api_key:d.ApiKey,locale:d.Locale,merchant_id:d.MerchantID,CD4_IRL_IMAGE_GALLERY_STYLE:d.GalleryStyle,components:{IRLSnippet:"module-dietitian-socialfeed__social"}})}},mounted:function(){this.initSocial()}})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Widgets");c.FeaturedProductsCarouselWithBadge=function(a){var c=a.data("contentId"),f=b.resolve("SDM.Data.FeaturedProductsCarouselWidthBadges")[c],g=b.resolve("SDM.Vue.Vuex");g.hasModule("storeSelector")||g.registerModule("storeSelector",d.StoreSelector),new Vue({el:a[0],store:g,components:{carousel:e.ProductCarousel,"store-selector":e.StoreSelector},props:{dataProducts:String},data:function(){return{badgeRightAligned:!1,carouselSlides:[],categoryCarouselsSlidesToShow:{desktop:3,tablet:2,mobileLarge:2,mobile:2},checkAvailabilityLabel:"",checkOtherStoresLabel:"",detailsButtonLabel:"",inStoreLabel:"",ourStockLabel:"",products:[],shopButtonLabel:"",showInventory:!1}},mounted:function(){this.products=JSON.parse(f.Products),this.badgeRightAligned="True"===f.BadgeRightAligned,this.checkAvailabilityLabel=f.CheckAvailabilityLabel,this.checkOtherStoresLabel=f.CheckOtherStoresLabel,this.inStoreLabel=f.InStoreLabel,this.showInventory="False"===f.HideInventory,this.showInventory&&this.setInventories(JSON.parse(f.Inventory).Stores),this.initCarouselSlides();var a=this;setTimeout(function(){a.initPowerReviewSnippet()},3e3)},methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"}),{initCarouselSlides:function(){this.carouselSlides=this.products.map(function(a){var b={};return this.showInventory&&(b={stockCountLabel:this.inStoreLabel,checkStockCountLabel:this.checkAvailabilityLabel,checkOtherStockCountlabel:this.checkOtherStoresLabel}),{id:a.UpcStripped,image:{url:a.ImageUrl,alt:a.Title},link:{isAbsolute:!0,target:a.ProductCTATarget,url:a.ProductCTA},inventory:b,InventoryHightlightColor:f.InventoryHighlightColor,InventoryIcon:f.InventoryIcon,hasBuyNowLink:a.UseBuyNowLabel,pwr:{id:"pw-snippet-"+c+a.ID,apiKey:f.PwrApiKey,merchantId:f.PwrMerchantId,merchantGroupId:f.PwrMerchantGroupId,locale:f.PwrLocale},text2:a.Title,text3:a.Tag,title:a.Title}},this)},initPowerReviewSnippet:function(){for(var a=this,b=0;this.carouselSlides.length>b;b++)null!==this.carouselSlides[b].pwr&&pwr("render",{api_key:a.carouselSlides[b].pwr.apiKey,locale:a.carouselSlides[b].pwr.locale,merchant_group_id:a.carouselSlides[b].pwr.merchantGroupId,merchant_id:a.carouselSlides[b].pwr.merchantId,page_id:a.carouselSlides[b].id,components:{CategorySnippet:a.carouselSlides[b].pwr.id}})}}),computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{carouselBadge:function(){return{heading:f.BadgeText,hexColorBg:f.BadgeBackgroundColorHex,hexColorFont:f.BadgeTextColorHex,hexColorCtaLabel:f.BadgeButtonLabelColorHex,hexColorCtaBg:f.BadgeButtonColorHex,text:"",cta:{url:f.BadgeButtonUrl,label:f.BadgeButtonLabel,urlTarget:f.BadgeButtonUrlTarget}}}})})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Data.TwoLevelNavigationMenu"),e=b.resolve("SDM.Util");c.TwoLevelNavigationMenu=function(a){new Vue({el:a[0],data:function(){return{currentPath:"",isNavActive:!1,links:[],menuLabel:"Menu",menuOpenLabel:"Open",menuCloseLabel:"Close"}},created:function(){this.menuItems=JSON.parse(d.MenuItems)},mounted:function(){this.currentPath=window.location.pathname},methods:{toggleNav:function(){this.isNavActive=!this.isNavActive,this.isNavActive?(document.body.style.overflow="hidden",e.scrollTo$ElementAsync($(this.$el),500)):document.body.style.overflow="visible"},toggleNavOff:function(){this.isNavActive=!1,document.body.style.overflow="visible"}}})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Vue.Mixins"),f=b.resolve("SDM.Vue.Stores"),g=b.resolve("SDM.Data.ProductListingWithFeatureFilter"),h=b.resolve("SDM.Util");c.ProductListingWithFeatureFilter=function(a){var c=b.resolve("SDM.Vue.Vuex");c.hasModule("storeSelector")||c.registerModule("storeSelector",f.StoreSelector),new Vue({el:a[0],components:{"product-tile":d.ProductTile,"store-selector":d.StoreSelector},store:c,mixins:[e.Responsive],data:function(){return{componentKey:0,currentPageNumber:0,filteredProductsBrands:[],filteredProductsCategories:[],filteredProductsFeatures:[],isFiltersActive:!1,isFiltersMobile:!1,isFeatureFilterActive:!1,isLoading:!1,products:{},productGrid:[],routeBrands:"",routeCategories:"",routeFeatures:"",screenWidth:0,selectedBrands:[],selectedCategories:[],selectedFeatures:[],showInventory:!1,totalProductCount:0}},created:function(){this.showInventory="False"===g.InventoryHide,this.showInventory&&this.setInventories(JSON.parse(g.Inventory).Stores)},mounted:function(){this.getUrlVars(),this.routeBrands&&this.routeBrands.split(",").forEach(function(a){this.selectedBrands.push(a)},this),this.routeCategories&&this.routeCategories.split(",").forEach(function(a){this.selectedCategories.push(a)},this),this.routeFeatures&&this.routeFeatures.split(",").forEach(function(a){this.selectedFeatures.push(a)},this),this.getProducts(),window.addEventListener("resize",_.debounce(this.onResize,50)),this.onResize()},methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"}),{getUrlVars:function(){this.routeBrands=h.getUrlVars().brands,this.routeCategories=h.getUrlVars().categories,this.routeFeatures=h.getUrlVars().features},getProducts:function(){this.isLoading=!0;var a={productListID:g.ProductListingId,randomize:g.RandomizeProducts,ppp:g.ProductsPerPage,pageNumber:this.currentPageNumber,brandFilters:this.routeBrands,categoryFilters:this.routeCategories,featureFilters:this.routeFeatures};$.ajax({method:"GET",url:"/"+g.Lang+"/product/GetFilteredProducts",data:a,dataType:"json",headers:{__RequestVerificationToken:g.FormToken}}).done(_.bind(function(a){this.currentPageNumber>0?this.products=this.products.concat(a.Products):this.products=a.Products,this.initFilters({categoryFilters:a.CatgoryFilters,brandFilters:a.BrandFilters,featureFilters:a.FeatureFilters}),this.totalProductCount=a.TotalProductCount,
this.initProductGrid(),this.isLoading=!1},this)).fail(function(a){console.log(a)})},onBrandsFilterChange:function(){var a=this.selectedBrands.filter(function(a){return this.filteredProductsBrands.findIndex(function(b){return b.TitleSlug===a})>=0}.bind(this));this.selectedBrands.length!==a.length&&(this.selectedBrands=a),this.updateUrlParam()},onCategoriesFilterChange:function(){var a=this.selectedCategories.filter(function(a){return this.filteredProductsCategories.findIndex(function(b){return b.TitleSlug===a})>=0}.bind(this));this.selectedCategories.length!==a.length&&(this.selectedCategories=a),this.updateUrlParam()},onFeaturesFilterChange:function(){var a=this.selectedFeatures.filter(function(a){return this.filteredProductsFeatures.findIndex(function(b){return b.TitleSlug===a})>=0}.bind(this));this.selectedFeatures.length!==a.length&&(this.selectedFeatures=a),this.updateUrlParam()},initProductGrid:function(){this.productGrid=this.products.map(function(a){return this.componentKey++,{type:"product",productTile:{cta:{bgColor:g.ColorPrimary?g.ColorPrimary:"#CB333B",url:a.BuyNowLink?a.BuyNowLink:"",urlLabel:a.BuyNowLink?g.ProductButtonLabel:g.ProductCTALabel,urlTarget:a.BuyNowLink?"_blank":"_self",isUrlAbsolute:!!a.BuyNowLink},inventory:{stockCountLabel:g.InventoryCountLabel,checkStockCountLabel:g.CheckAvailabilityLabel,checkOtherStockCountlabel:g.CheckOtherStoresLabel},product:{id:a.Upc,image:{alt:a.Title+".",url:a.Images&&a.Images.length>0?a.Images[0].LowRes:""},link:{url:a.BuyNowLink?a.BuyNowLink:"",target:"_blank",isAbsolute:!0},tags:a.Tags,title:a.Title,offer:a.OfferShortText,pwr:{id:"pw-snippet-"+a.UpcDisplay,apiKey:g.PwrApiKey,merchantId:g.PwrMerchantId,merchantGroupId:g.PwrMerchantGroupId,locale:g.PwrLocale},upc:a.UpcDisplay}}}},this)},onResize:function(){this.screenWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0),this.screenWidth>640&&(this.isFiltersActive=!1,this.isFiltersMobile=!1,TweenLite.to(".module-product-listing-with-feature-filter__features-fieldset-container",.4,{height:0}),this.isFeatureFilterActive=!1)},showHideFeatureFilter:function(){this.isFeatureFilterActive?(TweenLite.to(".module-product-listing-with-feature-filter__features-fieldset-container",.4,{height:0}),this.isFeatureFilterActive=!1):(TweenLite.set(".module-product-listing-with-feature-filter__features-fieldset-container",{height:"auto"}),TweenLite.from(".module-product-listing-with-feature-filter__features-fieldset-container",.4,{height:0}),this.isFeatureFilterActive=!0)},showHideFilter:function(){this.isFiltersActive?(TweenLite.to(".module-product-listing-with-feature-filter__filters-container",.3,{height:0}),this.isFiltersActive=!1):(TweenLite.set(".module-product-listing-with-feature-filter__filters-container",{height:"auto"}),TweenLite.from(".module-product-listing-with-feature-filter__filters-container",.3,{height:0}),this.isFiltersActive=!0)},loadMoreProducts:function(){h.scrollTo$ElementAsync($(this.$refs.loadMoreButton),500),this.currentPageNumber=this.currentPageNumber+1,this.getProducts()},initFilters:function(a){a&&(a.categoryFilters&&(this.filteredProductsCategories=a.categoryFilters.map(function(a){return{Count:a.Count,Title:a.Name,TitleSlug:a.Key}})),a.brandFilters&&(this.filteredProductsBrands=a.brandFilters.map(function(a){return{Count:a.Count,Title:a.Name,TitleSlug:a.Key}})),a.featureFilters&&(this.filteredProductsFeatures=a.featureFilters.map(function(a){return{Count:a.Count,IconUrl:a.IconUrl,Title:a.Name,TitleSlug:a.Key}})))},updateUrlParam:function(){var a={};this.selectedCategories.length>0&&(a=Object.assign({},a,{categories:this.selectedCategories.join(",")})),this.selectedBrands.length>0&&(a=Object.assign({},a,{brands:this.selectedBrands.join(",")})),this.selectedFeatures.length>0&&(a=Object.assign({},a,{features:this.selectedFeatures.join(",")})),this.currentPageNumber=0,h.setUrlVars(a),this.getUrlVars(),this.getProducts()},hideFilters:function(){this.isFiltersActive=!1},clearFilters:function(){this.selectedBrands=[],this.selectedCategories=[],this.selectedFeatures=[],this.updateUrlParam()}}),computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{inventory:function(){return{stockCountLabel:g.InventoryCountLabel,checkStockCountLabel:g.CheckAvailabilityLabel,checkOtherStockCountlabel:g.CheckOtherStoresLabel}},totalPageNumber:function(){return Math.ceil(this.totalProductCount/g.ProductsPerPage)-1}})})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Data.ArticleAndVideoBadgeGrid"),f=b.resolve("SDM.Util");c.ArticleAndVideoBadgeGrid=function(a){new Vue({el:a[0],components:{"pop-up":d.PopUp},props:{},data:function(){return{articlesData:[],articlesGrid:[],componentKey:0,currentPage:0,selectedFilters:[],totalPages:0,videoId:"",videoTitle:""}},created:function(){this.articlesData=JSON.parse(e.TilesData),this.initArticlesGrid()},mounted:function(){this.showVideoModal(),this.$root.$on("pop-up-closed",function(){f.setUrlVars()}),this.initAnim()},methods:{initAnim:function(){TweenMax.set(".module-article-and-video-badge-grid__article",{opacity:0}),setTimeout(function(){TweenMax.staggerTo(".module-article-and-video-badge-grid__article",.4,{opacity:1},.1)},200)},initArticlesGrid:function(){var a;a=this.selectedFilters.length>0?this.articlesData.filter(function(a){return this.selectedFilters.findIndex(function(b){return a.Type===b})>=0}.bind(this)):this.articlesData,this.totalPages=(a.length-e.InitialLoadTileCount)/e.LoadMoreTileCount;var b;b=0===this.currentPage?a.slice(0,e.InitialLoadTileCount):a.slice(0,Number(e.InitialLoadTileCount)+Number(this.currentPage*e.LoadMoreTileCount)),this.articlesGrid=b.map(function(a){return{type:a.Type,description:a.Description,image:{altText:a.Image.Label,url:a.Image.URL},legalText:a.LegalText,tag:a.Tag,title:a.Title,timeToRead:a.TimeToRead,cta:{label:a.URLLabel,slug:a.FriendlyUrlName,target:a.Target,url:a.URL}}},this)},setVideoParam:function(a){f.setUrlVars({v:a}),this.showVideoModal()},showVideoModal:function(){if(f.getUrlVars().v){var a=this.articlesData.filter(function(a){if(a.FriendlyUrlName===f.getUrlVars().v)return a}.bind(this));this.videoTitle=a[0].Title,this.videoId=a[0].URL,this.$refs.articleVideoModal.showPopUp()}},onFiltersChange:function(){this.currentPage=0,this.initArticlesGrid(),this.initAnim()},onLoadMore:function(){f.scrollTo$ElementAsync($(this.$refs.loadMoreButton),500,100),this.currentPage++,this.initArticlesGrid()}}})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Util");c.RichTextAreaGeo=function(a){var c=b.resolve("SDM.Vue.Vuex");c.hasModule("provinceSelector")||c.registerModule("provinceSelector",d.ProvinceSelector),new Vue({el:a[0],created:function(){},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),data:function(){return{sdmLocationProvinceId:""}},methods:{},mounted:function(){var a=JSON.parse(e.getValueFromCookie("sdm-location"));this.sdmLocationProvinceId=a&&a.province?a.province:""},store:c,watch:{}})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Widgets"),f=0;c.VideoProductCarousel=function(a){var c=a.data("contentId"),g=b.resolve("SDM.Data.VideoProductCarousel")[c],h=b.resolve("SDM.Vue.Vuex");h.hasModule("storeSelector")||h.registerModule("storeSelector",d.StoreSelector),new Vue({el:a[0],store:h,components:{"product-carousel":e.ProductCarousel,"store-selector-modal":e.StoreSelectorModal},data:function(){return{modifiedProducts:[],products:[],reviewArray:[],showInventory:!1,categoryCarouselsSlidesToShow:{desktop:3,tablet:1,mobile:1},breakpoints:{tablet:960}}},beforeMount:function(){this.products=g.Products,this.showInventory="False"===g.HideInventory,this.initModifiedProducts()},mounted:function(){this.setInventories(g.Inventory.Stores);var a=this;setTimeout(function(){a.initPowerReviewsRatings(a.modifiedProducts)},f),f+=500},methods:Object.assign({},Vuex.mapActions("storeSelector",{setInventories:"setInventories"}),{initModifiedProducts:function(){this.modifiedProducts=this.products.map(function(a){var b={};return this.showInventory&&(b={stockCountLabel:g.InStoreLabel,checkStockCountLabel:g.CheckAvailabilityLabel,checkOtherStockCountlabel:g.CheckOtherStoresLabel}),{id:a.UpcStripped,text1:a.Title.split(" ").length>8?a.Title.split(" ").slice(0,6).join(" ")+"...":a.Title,image:{url:a.ImageUrl,alt:a.Title+" image"},link:a.ProductCTA,cta:{url:a.ProductCTA,label:g.ShopLabel,isAbsolute:!!a.ProductCTA},pwr:{id:a.UpcStripped?c+"-video-product-carousel-pwr-snippet--"+a.UpcStripped:null},upc:a.UpcStripped,inventory:b}},this)},initPowerReviewsRatings:function(a){for(var b=[],c=0;a.length>c;c++)null!==a[c].pwr&&b.push({api_key:g.PowerReviewsApiKey,locale:g.PowerReviewsLocale,merchant_group_id:g.PowerReviewsMerchantGroupId,merchant_id:g.PowerReviewsMerchantId,page_id:a[c].upc,components:{CategorySnippet:a[c].pwr.id}});pwr("render",b)}})})}}(this),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Widgets");c.ProvinceSelector=function(a){var c=b.resolve("SDM.Vue.Vuex");c.hasModule("provinceSelector")||c.registerModule("provinceSelector",d.ProvinceSelector),new Vue({components:{"province-selector":e.ProvinceSelector},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),data:function(){return{}},el:a[0],methods:{},mounted:function(){},store:c})}}(this),function(a){"use strict";var b=a.jQuery,c=a.NR,d=c.resolve("SDM.Vue.Modules"),e=c.resolve("SDM.Vue.Stores"),f=c.resolve("SDM.Vue.Mixins"),g=c.resolve("SDM.Util");d.TextBadgeGrid=function(a){var d=a.data("contentId"),h=c.resolve("SDM.Data.TextBadgeGrid")[d],i=c.resolve("SDM.Vue.Vuex");i.hasModule("provinceSelector")||i.registerModule("provinceSelector",e.ProvinceSelector),new Vue({computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{badges:function(){return h.Badges.filter(function(a){return a.provinces.includes(this.userProvinceId)}.bind(this))},numColumns:function(){return this.isDesktopLarge?4:this.isDesktop?2:1}}),data:function(){return{buttonFilters:h.ButtonFilters,cta1Height:[],selectedFilter:"",headingHeight:[],noteHeight:[],textHeight:[],text2Height:[]}},el:a[0],methods:{getHeadingHeight:function(a){var b=this.headingHeight[Math.floor(a/this.numColumns)];return b||0},getTextHeight:function(a){var b=this.textHeight[Math.floor(a/this.numColumns)];return b||0},getText2Height:function(a){var b=this.text2Height[Math.floor(a/this.numColumns)];return b||0},getNoteHeight:function(a){var b=this.noteHeight[Math.floor(a/this.numColumns)];return b||0},getCta1Height:function(a){var b=this.cta1Height[Math.floor(a/this.numColumns)];return b||0},getMaxHeadingHeight:function(){var a=Array.from(this.$el.querySelectorAll(".module-text-badge-grid__badge__heading")||[]);this.headingHeight=[];for(var b=0,c=a.length;b<c;b+=this.numColumns){var d=a.slice(b,b+this.numColumns);this.headingHeight.push(d.reduce(function(a,b){return Math.max(a,b.offsetHeight)},0))}},getMaxTextHeight:function(){var a=Array.from(this.$el.querySelectorAll(".module-text-badge-grid__badge__text")||[]);this.textHeight=[];for(var b=0,c=a.length;b<c;b+=this.numColumns){var d=a.slice(b,b+this.numColumns);this.textHeight.push(d.reduce(function(a,b){return Math.max(a,b.offsetHeight)},0))}},getMaxText2Height:function(){var a=Array.from(this.$el.querySelectorAll(".module-text-badge-grid__badge__text2")||[]);this.text2Height=[];for(var b=0,c=a.length;b<c;b+=this.numColumns){var d=a.slice(b,b+this.numColumns);this.text2Height.push(d.reduce(function(a,b){return Math.max(a,b.offsetHeight)},0))}},getMaxNoteHeight:function(){var a=Array.from(this.$el.querySelectorAll(".module-text-badge-grid__badge__note")||[]);this.noteHeight=[];for(var b=0,c=a.length;b<c;b+=this.numColumns){var d=a.slice(b,b+this.numColumns);this.noteHeight.push(d.reduce(function(a,b){return Math.max(a,b.offsetHeight)},0))}},getMaxCta1Height:function(){var a=Array.from(this.$el.querySelectorAll(".module-text-badge-grid__badge__cta--1")||[]);this.cta1Height=[];for(var b=0,c=a.length;b<c;b+=this.numColumns){var d=a.slice(b,b+this.numColumns);this.cta1Height.push(d.reduce(function(a,b){return Math.max(a,b.offsetHeight)},0))}},isBadgeSelected:function(a){var b=this.selectedFilter.split(",");if(2!==b.length)return!1;var c=b[0],d=b[1],e=this.buttonFilters[c].buttons[d].badgeContentIds;return!!e&&e.includes(a)},updateHeight:function(){this.getMaxHeadingHeight(),this.getMaxTextHeight(),this.getMaxText2Height(),this.getMaxNoteHeight(),this.getMaxCta1Height()}},mixins:[f.Responsive],mounted:function(){this.updateHeight()},store:i,watch:{userProvinceId:function(){this.filters="",Vue.nextTick(function(){this.updateHeight()}.bind(this))},screenWidth:function(){this.updateHeight()},selectedFilter:function(){Vue.nextTick(function(){var a=Array.from(this.$el.querySelectorAll(".module-text-badge-grid__badge--selected")||[]);0!==a.length&&g.scrollTo$ElementAsync(b(a[0]),500,20)}.bind(this))}}})}}(this),function(a){"use strict";var b=a.NR,c=a.jQuery,d=b.resolve("SDM.Vue.Modules"),e=b.resolve("SDM.Vue.Stores"),f=b.resolve("SDM.Data.FAQList"),g=b.resolve("SDM.Util");d.Faq=function(a){var d=b.resolve("SDM.Vue.Vuex");d.hasModule("provinceSelector")||d.registerModule("provinceSelector",e.ProvinceSelector),new Vue({el:a[0],data:function(){return{sections:f.Sections,sdmLocationProvinceId:""}},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),mounted:function(){var a=JSON.parse(g.getValueFromCookie("sdm-location"));this.sdmLocationProvinceId=a&&a.province?a.province:"",c(".widget-parent-accordion[data-accordion-index='0']").addClass("wg-acc-active"),c(".widget-parent-accordion[data-accordion-index='0'] > .wg-acc-content").slideToggle()},methods:{getYouTubeID:function(a){var b=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,c=a.match(b);return!(!c||11!==c[7].length)&&c[7]},getVimeoID:function(a){var b=/\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,c=a.match(b);return!(!c||!c[2])&&c[2]},toggleAccordion:function(a){c(a.target).parent().toggleClass("wg-acc-active"),c(a.target).next().slideToggle()},toggleAccordionIcon:function(a){c(a.target).parent().parent().toggleClass("wg-acc-active"),c(a.target).parent().next().slideToggle()}},store:d})}}(this),function(a){"use strict";a.NR.resolve("SDM.Vue.Modules").GlobalPromotionGrid=function(a){new Vue({data:function(){return{seenBadges:[]}},el:a[0],methods:{badgeClick:function(a){window.location.href.includes("home")&&dataLayer.push({event:"badge_click","badge.id":a.currentTarget.getAttribute("data-id"),"badge.position":a.currentTarget.getAttribute("data-index"),"badge.name":a.currentTarget.getAttribute("data-name"),"badge.image_url":a.currentTarget.querySelectorAll(".md-gpg__badge-image")[0].src})},isElementInView:function(a){var b=a.getBoundingClientRect(),c=b.top,d=b.top+b.height;return c>=0&&d<=Math.min(document.documentElement.clientHeight,window.innerHeight||0)},checkElementViewability:function(){for(var a=document.querySelectorAll(".md-gpg__badge"),b=0;b<a.length;b++)if(this.isElementInView(a[b])&&"false"===window.sessionStorage.getItem("userHasSeenAllBadges"))if(this.seenBadges.length<a.length){if(-1===this.seenBadges.indexOf(a[b].getAttribute("data-id"))){this.seenBadges.push(a[b].getAttribute("data-id"));var c={event:"badge_impression","badge.id":a[b].getAttribute("data-id"),"badge.position":a[b].getAttribute("data-index"),"badge.name":a[b].getAttribute("data-name"),"badge.image_url":a[b].querySelectorAll(".md-gpg__badge-image")[0].src};console.log("Sending: ",c),dataLayer.push(c)}}else this.seenBadges.length===a.length&&(sessionStorage.setItem("userHasSeenAllBadges","true"),console.log("All badges seen!"))}},mounted:function(){window.location.href.includes("home")&&(window.addEventListener("scroll",this.checkElementViewability),null===sessionStorage.getItem("userHasSeenAllBadges")&&sessionStorage.setItem("userHasSeenAllBadges","false"))}})}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Modules"),d=b.resolve("SDM.Vue.Stores");c.UniversalCTAItemGrid=function(a){var c=b.resolve("SDM.Vue.Vuex");c.hasModule("provinceSelector")||c.registerModule("provinceSelector",d.ProvinceSelector),new Vue({computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),el:a[0],store:c})}}(this),function(){function a(a){this.urls={conditionListJson:c.template(a.urls.conditionListJson),conditionDetailPage:c.template(a.urls.conditionDetailPage),conditionPage:c.template(a.urls.conditionPage)}}var b=this,c=b._,d=b.jQuery,e=b.NR||(b.NR={}),f=e.resolve("SDM.Util"),g=e.resolve("SDM.Core.Widgets"),h=g.ConditionAlphabet=function(a,b){var c={class_names:{active:"active"},dataLabels:{alphabetButton:"data-wg-calp-alphabet-button",listTemplate:"data-wg-calp-list-template",listContainer:"data-wg-calp-list-container",listItemLimit:"data-wg-calp-list-item-limit",loadingContainer:"data-wg-calp-loading-container",errorContainer:"data-wg-calp-error-container",noItemsContainer:"data-wg-calp-no-items-container",activeAlphabetContainer:"data-wg-calp-active-alphabet-container",defaultAlphabet:"data-wg-calp-default-alphabet",alphabetLinkTemplate:"data-wg-calp-alphabet-link-template",alphabetLinkContainer:"data-wg-calp-alphabet-link-container"},templates:{list:"<% _.each(conditions, function(condition) { %> <li><a href='<%= condition.link %>'><%= condition.name %></a></li> <% }); %>",alphabetLink:"<a href='<%= link %>'><%= alphabet %></a>"},defaultListItemLimit:0,urls:{conditionListJson:"/<%- shortLanguageCode %>/condition/getConditionsByLetter?letter=<%- alphabet %>",conditionDetailPage:"/<%- shortLanguageCode %>/health-and-pharmacy/conditions/<%= name %>/<%- id %>",conditionPage:"/<%- shortLanguageCode %>/health-and-pharmacy/conditions/<%- alphabet %>"}};this.config=d.extend(!0,c,b||{}),this._initialize(a)};a.prototype.getConditionObject=function(a,b,e){var f=this._getJsonUrl(b),g=this,h=function(b){return b=c(b).filter(function(a){return a.DiseaseName&&a.DiseaseId}),a>0&&(b=b.slice(0,a)),c(b).map(function(a){return{name:a.DiseaseName,link:g._getConditionDetailPageLink(a.SafeDiseaseName,a.DiseaseId)}})};return d.ajax({dataType:"json",url:f,beforeSend:e}).pipe(h)},a.prototype._getJsonUrl=function(a){return this.urls.conditionListJson({alphabet:encodeURIComponent(a),shortLanguageCode:f.getShortLanguageCode()})},a.prototype._getConditionDetailPageLink=function(a,b){return this.urls.conditionDetailPage({name:encodeURIComponent(a).toLowerCase(),id:encodeURIComponent(b),shortLanguageCode:f.getShortLanguageCode()})},a.prototype.getConditionPageLink=function(a){return this.urls.conditionPage({alphabet:encodeURIComponent(a).toLowerCase(),shortLanguageCode:f.getShortLanguageCode()})},h.prototype._initialize=function(b){var d=this.config.dataLabels,e=this.config.templates,f=b,g=f.find("["+d.listTemplate+"]"),h=g.length>0?g.html():e.list,i=f.find("["+d.alphabetLinkTemplate+"]"),j=i.length>0?i.html():e.alphabetLink,k=c.bind(this._onClickAlphabetButton,this);this.listTemplate=c.template(h),this.$listContainer=f.find("["+d.listContainer+"]"),this.alphabetLinkTemplate=c.template(j),this.$alphabetLinkContainer=f.find("["+d.alphabetLinkContainer+"]"),this.listItemLimit=f.attr(d.listItemLimit)||this.config.defaultListItemLimit,this.$loadingContainer=f.find("["+d.loadingContainer+"]"),this.$errorContainer=f.find("["+d.errorContainer+"]"),this.activeAlphabetContainer=f.find("["+d.activeAlphabetContainer+"]"),this.alphabetButtonAttributeName=d.alphabetButton,this.$alphabetButtons=f.find("["+d.alphabetButton+"]"),this.defaultAlphabet=f.attr(d.defaultAlphabet)||null,this.$noItemsContainer=f.find("["+d.noItemsContainer+"]"),this.onChangeEventHandler=function(){},this.previousAjaxRequestXhr=null,this.previousAlphabet=null,this.gateway=new a(this.config),this._deleteListItems(),this._deleteAlphabetLink(),this._hideLoading(),this._hideError(),this.$alphabetButtons.on("click.sdm-condition-widget",k),this.defaultAlphabet&&this.render(this.defaultAlphabet)},h.prototype._onClickAlphabetButton=function(a){var b=d(a.currentTarget),c=b.attr(this.alphabetButtonAttributeName);this.render(c)},h.prototype._activateButton=function(a){this.$alphabetButtons.removeClass(this.config.class_names.active),a.addClass(this.config.class_names.active)},h.prototype._renderAlphabetCharacter=function(a){this.activeAlphabetContainer.text(a)},h.prototype._renderAlphabetLink=function(a){this.$alphabetLinkContainer.html(this.alphabetLinkTemplate(a))},h.prototype._deleteAlphabetLink=function(){this.$alphabetLinkContainer.empty()},h.prototype._renderListItems=function(a){this.$listContainer.html(this.listTemplate({conditions:a}))},h.prototype._deleteListItems=function(){this.$listContainer.empty()},h.prototype._showLoading=function(){this.$loadingContainer.show()},h.prototype._hideLoading=function(){this.$loadingContainer.hide()},h.prototype._showError=function(){this.$errorContainer.show()},h.prototype._hideError=function(){this.$errorContainer.hide()},h.prototype._showNoItems=function(){this.$noItemsContainer.show()},h.prototype._hideNoItems=function(){this.$noItemsContainer.hide()},h.prototype.render=function(a){var b=this.$alphabetButtons.filter("["+this.alphabetButtonAttributeName+"='"+a+"']"),d=this.previousAlphabet&&this.previousAlphabet!==a,e=null===this.previousAlphabet,f=c.bind(function(a){a.length>0?this._renderListItems(a):this._showNoItems(),this._hideLoading()},this),g=c.bind(function(){this._showError(),this._hideLoading(),this.previousAlphabet=null},this),h={alphabet:a,link:this.gateway.getConditionPageLink(a)},i=c.bind(function(a){this.previousAjaxRequestXhr=a},this);(e||d)&&(d&&this.onChangeEventHandler(a),this.previousAjaxRequestXhr&&this.previousAjaxRequestXhr.abort(),this._activateButton(b),this._showLoading(),this._deleteListItems(),this._hideError(),this._hideNoItems(),this._renderAlphabetCharacter(a),this._renderAlphabetLink(h),this.previousAlphabet=a,this.gateway.getConditionObject(this.listItemLimit,a,i).done(f).fail(g))},h.prototype.setOnChangeEventHandler=function(a){this.onChangeEventHandler=a}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d="<a href='<%= link %>'><%= title %></a> <%= views %> views <%= age %> ago",e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Widgets"),g=e.resolve("SDM.Util"),h=f.FeaturedVideo=function(a,b){var d={data_labels:{video_placeholder:"data-fvd-video-placeholder",video_info_template:"data-fvd-video-info-template",video_info_container:"data-fvd-video-info-container",loading_container:"data-fvd-loading-container",error_container:"data-fvd-error-container",youtube_api_key:"AIzaSyAqyipvzq62aB7-5OZ35FiVAp4T2WszDTM",youtube_video:"data-fvd-youtube-id",vimeo_video:"data-fvd-vimeo-id"},video_info_template:""};this.config=c.extend(!0,d,b||{}),this._initialize(a)},i=h.YoutubeVideo=function(a,b,d){var e={url_regex:/youtube\.com\/watch\?(.*)([^&]&)?v=([^\s&#]+)/};this.config=c.extend(!0,e,d||{}),this._setInstanceVars(b,a),this._initialize()};i.prototype._setInstanceVars=function(a,b){var c=a.match(this.config.url_regex);this.video_id=c&&c[3]?c[3]:null;var d=this.config.data_labels;this.$container=b,this.$video_placeholder=b.find("["+d.video_placeholder+"]"),this.$video_info_container=b.find("["+d.video_info_container+"]"),this.$loading_container=b.find("["+d.loading_container+"]"),this.$error_container=b.find("["+d.error_container+"]"),this.video_info_template=this.config.video_info_template},i.prototype._initialize=function(){if(this.$loading_container.hide(),this.$error_container.hide(),this.$video_info_container.hide(),!this.video_id)return this.$loading_container.hide(),this.$error_container.show(),void this.$video_info_container.hide();this._loadVideo(),this._loadData()},i.prototype._loadVideo=function(){g.loadYoutubeVideoApi().done(b(this._createPlayerInstance).bind(this))},i.prototype._createPlayerInstance=function(){var a=this.$video_placeholder.attr("id",this.video_id).attr("id"),b=this.$video_placeholder.attr("width"),c=this.$video_placeholder.attr("height");return new YT.Player(a,{width:b,height:c,videoId:this.video_id,playerVars:{controls:1,showinfo:0,modestbranding:1,wmode:"opaque"}})},i.prototype._loadData=function(){var a=this.config.youtube_api_key,c="https://www.googleapis.com/youtube/v3/videos?id="+this.video_id+"&key="+a+"&part=snippet,statistics";this.$loading_container.show(),this.$error_container.hide(),this.$video_info_container.hide();var d=b(this._renderVideoInfo).bind(this),e={dataType:"json"};SDM.Util.ajax(c,e).done(d).fail(b(function(){this.$error_container.show(),this.$loading_container.hide()}).bind(this))},i.prototype._renderVideoInfo=function(a){var b=this._parseVideoInfo(a);this.$video_info_container.html(this.video_info_template(b)).show(),this.$loading_container.hide()},i.prototype._parseVideoInfo=function(a){if(!(a&&a.items&&a.items.length))return{};var b=a.items[0];return{title:b.snippet.title,link:"https://www.youtube.com/watch?v="+b.id,views:parseInt(b.statistics.viewCount,10).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),age:this._getAge(b.snippet.publishedAt)}},i.prototype._getAge=function(a){var b=new Date,c=new Date(Date.parse(a)),d={};return d.diffYears=b.getUTCFullYear()-c.getUTCFullYear(),d.diffMonths=b.getUTCMonth()-c.getUTCMonth()+12*d.diffYears,d};var j=h.VimeoVideo=function(a,b,d){var e={};this.config=c.extend(!0,e,d||{}),this._setInstanceVars(b,a),this._initialize()};j.prototype._setInstanceVars=function(a,b){this.video_id=a;var c=this.config.data_labels;this.$video_info_container=b.find("["+c.video_info_container+"]"),this.$loading_container=b.find("["+c.loading_container+"]"),this.$error_container=b.find("["+c.error_container+"]"),this.video_info_template=this.config.video_info_template},j.prototype._initialize=function(){if(this.$loading_container.hide(),this.$error_container.hide(),this.$video_info_container.hide(),!this.video_id)return this.$loading_container.hide(),this.$error_container.show(),void this.$video_info_container.hide();this._loadData()},j.prototype._loadData=function(){this.$loading_container.show(),this.$error_container.hide(),this.$video_info_container.hide();var a="https://vimeo.com/api/v2/video/"+this.video_id+".json",c=b(this._renderVideoInfo).bind(this),d={data:{},dataType:"json"};SDM.Util.ajax(a,d).done(c).fail(b(function(){this.$error_container.show(),this.$loading_container.hide()}).bind(this))},j.prototype._renderVideoInfo=function(a){if(a.length>0){var b=this._parseVideoInfo(a[0]);this.$video_info_container.html(this.video_info_template(b)).show(),this.$loading_container.hide()}},j.prototype._parseVideoInfo=function(a){return{title:a.title,link:a.url,views:a.stats_number_of_plays,age:this._getAge(a.upload_date)}},j.prototype._getAge=function(a){var b=new Date,c=new Date(Date.parse(a)),d={};return d.diffYears=b.getUTCFullYear()-c.getUTCFullYear(),d.diffMonths=b.getUTCMonth()-c.getUTCMonth()+12*d.diffYears,d},h.prototype._initialize=function(a){this.config.video_info_template=this._getVideoInfoTemplate();var b=a,c=b.attr(this.config.data_labels.youtube_video),d=b.attr(this.config.data_labels.vimeo_video);c?new i(b,c,this.config):d&&new j(b,d,this.config)},h.prototype._getVideoInfoTemplate=function(){var a=c("["+this.config.data_labels.video_info_template+"]"),e=a.length>0?a.html():d;return b(e).template()}}.call(this),function(){function a(a,b){this._config=b,this._$widget=a,this._initialize()}function b(a,b,c){this._config=c,this._$star=a,this._index=b}var c=this,d=c._,e=c.jQuery,f="sdm-product-rating",g=c.NR||(c.NR={}),h=g.resolve("SDM.Core.Widgets");b.prototype.empty=function(){this._$star.addClass(this._config.classNames.emptyStar).removeClass(this._config.classNames.filledStar)},b.prototype.fill=function(){this._$star.removeClass(this._config.classNames.emptyStar).addClass(this._config.classNames.filledStar)},b.prototype.getIndex=function(){return this._index},b.prototype.setOnMouseEnterEventHandler=function(a){this._$star.on("mouseenter."+f,d(function(){a(this)}).bind(this))},b.prototype.setOnMouseLeaveEventHandler=function(a){this._$star.on("mouseleave."+f,d(function(){a(this)}).bind(this))},b.prototype.setOnClickEventHandler=function(a){this._$star.on("click."+f,d(function(){a(this)}).bind(this))},a.prototype._initialize=function(){this._stars=d(this._$widget.find("["+this._config.dataLabels.star+"]")).map(d(function(a,c){var f=new b(e(a),c,this._config);return f.setOnMouseEnterEventHandler(d(this._onMouseEnterStarEventHandler).bind(this)),f.setOnMouseLeaveEventHandler(d(this._onMouseLeaveStarEventHandler).bind(this)),f.setOnClickEventHandler(d(this._onClickStarEventHandler).bind(this)),f}).bind(this)),this._rate=parseInt(this._$widget.attr(this._config.dataLabels.rate)||0,10),this.updateStar()},a.prototype._onMouseEnterStarEventHandler=function(a){this._renderStar(a.getIndex())},a.prototype._onMouseLeaveStarEventHandler=function(){this.updateStar()},a.prototype._onClickStarEventHandler=function(a){this.setRate(a.getIndex()+1)},a.prototype._renderStar=function(a){d(this._stars).each(function(b){b.getIndex()<=a?b.fill():b.empty()})},a.prototype.updateStar=function(){this._renderStar(this._rate-1)},a.prototype.setRate=function(a){this._rate=a,this.updateStar()},a.prototype.getRate=function(){return this._rate},h.ProductRating=function(b,c){var d={dataLabels:{star:"data-prt-star",rate:"data-prt-rate"},classNames:{emptyStar:"mod-icn-gray-star",filledStar:"mod-icn-red-star"}};return new a(b,e.extend(!0,d,c||{}))}}.call(this),function(){var a=this,b=this._,c=a.jQuery,d=a.Accordion,e=a.NR,f=e.resolve("SDM.Core.Components"),g=e.resolve("SDM.Core.Widgets"),h=f.PopUp;FAQModal=g.FAQModal=function(a,b){var d={selectors:{fap_popup:"[data-wg-faq-popup]",faq_content:"[data-wg-faq-content]",faq_nano:"[data-wg-faq-nano]",faq_nano_content:"[data-wg-faq-nano-content]",parent_accordion:"[data-wg-faq-parent-accordion]",parent_accordion_button:"[data-wg-faq-parent-accordion-button]",parent_accordion_content:"[data-wg-faq-parent-accordion-content]",accordion:"[data-wg-faq-accordion]",accordion_button:"[data-wg-faq-accordion-button]",accordion_content:"[data-wg-faq-accordion-content]",flag:"[data-wg-faq-flag]",faq_list:"[data-wg-faq-list]",question_list:"[data-wg-faql-question-list]",question_list_item:"[data-wg-faql-question-list-item]"},classnames:{accordion_active_class:"wg-acc-active",parent_accordion_actice_class:"wg-parent-acc--active"},attributes:{list_item_id:"data-wg-faql-question-list-item",flag:"data-wg-faq-flag"},data_attributes:{initial_active_id:"wg-faq-initial-active-id",list_item_id:"wg-faql__question-list-item"}};this.config=c.extend(!0,d,b||{}),this._initialize(a)},FAQModal.prototype._initialize=function(a){this.$link=a,this.$link.on("click",b.bind(function(a){this.linkToFlag=c(a.currentTarget).attr(this.config.attributes.flag),a.preventDefault(),this._openPopup()},this)),this.popup=new h({templates:{modal:'<div class="wg-ppb-modal wg-ppb-modal-full"></div>'}}),this.template=b.template(c(this.config.selectors.faq_content).html()),this.initial_active_id=this.$link.data(this.config.data_attributes.initial_active_id)||null,this.$faqPopup=null,this.$nano=null,this.$nanoContent=null,this.nanoContentClass=null,this.linkToFlag=null,this.isClosed=!0,SDM.Util.isWindowWide()?this.popupHeightOffset=40:this.popupHeightOffset=0,this.popup.onOpenCompleted(b(this._onPopupOpened).bind(this)),this.popup.onCloseCompleted(b(this._onPopupClosed).bind(this)),this.popup.onRepositioned(b(this._onPopupRepositioned).bind(this))},FAQModal.prototype._initializeNanoScroller=function(a){var c={contentClass:this.nanoContentClass,preventPageScrolling:!0,alwaysVisible:!0};b(a).isNumber()&&(c.scrollTop=a),this.$nano.nanoScroller(c)},FAQModal.prototype._onPopupOpened=function(a){var e;if(new Analytics.DataAttributes,this.isClosed){
this.$faqPopup.outerWidth(this.popup.$modal.css("width")),this.$nanoContent.css("position","");var f=null,g=0;b(c(a.currentTarget).find(this.config.selectors.parent_accordion)).each(b(function(a){var e=new d(c(a),{selectors:{button:this.config.selectors.parent_accordion_button,content:this.config.selectors.parent_accordion_content},classnames:{active:this.config.classnames.parent_accordion_actice_class}});e.id=g++,e.isActive()&&(e.open(0),f=e),e.onClickButton(b(function(){f&&f.id!==e.id&&f.close()}).bind(this)),e.onOpenCompleted(b(function(){f=e,this._initializeNanoScroller(),c(this.$nano.find(this.config.selectors.faq_nano_content)).stop().animate({scrollTop:f.$element.get(0).offsetTop-15},300)}).bind(this)),e.onCloseCompleted(b(function(){this._initializeNanoScroller(),f&&f.id===e.id&&(f=null)}).bind(this))}).bind(this)),b(c(a.currentTarget).find(this.config.selectors.accordion)).each(b(function(a){var e=c(a),f=new d(e,{selectors:{button:this.config.selectors.accordion_button,content:this.config.selectors.accordion_content}});f.isActive()&&(f.open(0),c(this.$nano.find(this.config.selectors.faq_nano_content)).stop().animate({scrollTop:e.get(0).offsetTop-15},300)),f.onOpenCompleted(b(function(){this._initializeNanoScroller()}).bind(this)),f.onCloseCompleted(b(function(){this._initializeNanoScroller()}).bind(this))}).bind(this)),this.linkToFlag?(e=this._findFlag(this.linkToFlag),0!==e.length?this._initializeNanoScroller(e.position().top):this._initializeNanoScroller()):this._initializeNanoScroller(),this.isClosed=!1}},FAQModal.prototype._findFlag=function(a){return this.$nanoContent.find(this.config.selectors.flag).filter("["+this.config.attributes.flag+"='"+a+"']")},FAQModal.prototype._onPopupClosed=function(){this.isClosed=!0},FAQModal.prototype._onPopupRepositioned=function(){this.popup.$modal&&(this.$faqPopup.outerWidth(this.popup.$modal.width()),this._initializeNanoScroller())},FAQModal.prototype._openPopup=function(){var a,b=this.template(),d=c(b);this.$faqPopup=d.is(this.config.selectors.fap_popup)?d:d.find(this.config.selectors.fap_popup),this.$nano=d.find(this.config.selectors.faq_nano),this.$nanoContent=d.find(this.config.selectors.faq_nano_content),this.nanoContentClass=this.$nanoContent.attr("class"),a=this.linkToFlag?this._findFlag(this.linkToFlag):c({}),this.initial_active_id?d.find("["+this.config.attributes.list_item_id+'="'+this.initial_active_id+'"]:first').find(this.config.selectors.accordion).addClass(this.config.classnames.accordion_active_class).parents(this.config.selectors.parent_accordion).addClass(this.config.classnames.parent_accordion_actice_class):a.length?a.addClass(this.config.classnames.parent_accordion_actice_class):d.find(this.config.selectors.question_list_item+":first").parents(this.config.selectors.parent_accordion).addClass(this.config.classnames.parent_accordion_actice_class),this.$nanoContent.css("position","static"),this.$faqPopup.css("height",c(window).height()-this.popupHeightOffset),this.popup.open(d[0])},FAQModal.prototype.get$link=function(){return this.$link}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e="gpalwf-events",f=a.NR||(a.NR={}),g=f.resolve("SDM.Core.Components"),h=f.resolve("SDM.Core.Widgets"),i=g.CollapsibleButtonList,j=g.ArticleSummaryCollection,k=g.ArticleSummaryListingView,l=null,m=h.GeneralArticleSummaryListing=function(a,b){var d={selectors:{listingContainer:"[data-wg-gasl-listing-container]",filterContainer:"[data-wg-gasl-filter-container]",pageTitle:"[data-wg-gasl-title]",filterButton:"[data-wg-gasl-filter-button]",defaultButton:"[data-wg-gasl-filter-button-default]"},attributes:{tag:"data-wg-gasl-article-tag",detailPageUrlRoot:"data-wg-gasl-detail-page-url-root",jsonResourceUrlRoot:"data-wg-gasl-json-resource-url-root",filterRouterUrlRoot:"data-wg-gasl-filter-router-url-root",filterId:"data-wg-gasl-filter-id",filterPageTitle:"data-wg-gasl-filter-title",filterName:"data-wg-gasl-filter-name",truncateLimit:"data-wg-gasl-truncate-limit",destinationID:"data-wg-gasl-destinationID",tagID:"data-wg-gasl-tagID",articleIDs:"data-wg-gasl-articleIDs"}};this.config=c.extend(!0,d,b||{}),this._initialize(a)};m.prototype._initialize=function(a){this.tag=a.attr(this.config.attributes.tag)||"",this.destinationID=a.attr(this.config.attributes.destinationID)||"",this.tagID=a.attr(this.config.attributes.tagID)||"",this.articleIDs=a.attr(this.config.attributes.articleIDs)||"",this.truncateLimit=a.attr(this.config.attributes.truncateLimit)||"0",this.detailPageUrlRoot=a.attr(this.config.attributes.detailPageUrlRoot),this.jsonResourceUrlRoot=a.attr(this.config.attributes.jsonResourceUrlRoot),this.filterRouterUrlRoot=this._cleanUpUrL(a.attr(this.config.attributes.filterRouterUrlRoot)||""),this.$listingContainer=a.find(this.config.selectors.listingContainer),this.$filterContainer=a.find(this.config.selectors.filterContainer),this.$pageTitle=a.find(this.config.selectors.pageTitle),this.router=null,this._setupListing(),this.$filterContainer.length>0&&this.filterRouterUrlRoot?(this.$filterButtons=a.find(this.config.selectors.filterButton),this.collapsibleButtonList=new i({$container:this.$filterContainer}),this.$filterButtons.on("click."+e,b(this._onClickFilterLink).bind(this)),this.router=new l({urlRoot:this.filterRouterUrlRoot}),this.router.on("route-home",b(function(){this.$filterButtons.filter(this.config.selectors.defaultButton).trigger("click."+e,{isPreventNavigation:!0})}).bind(this)),this.router.on("route-filter",b(function(a,b){this.$filterButtons.filter("["+this.config.attributes.filterId+"='"+b+"']").trigger("click."+e,{isPreventNavigation:!0})}).bind(this)),this.router.start()):this.articleSummaryCollection.setCurrentPage(1).setCategoryId().fetch()},m.prototype._setupListing=function(){this.articleSummaryCollection=new j,this.articleSummaryListingView=new k({$container:this.$listingContainer,collection:this.articleSummaryCollection}),this.articleSummaryCollection.setTag(this.tag).setDestinationID(this.destinationID).setTagID(this.tagID).setArticleIDs(this.articleIDs).setDetailPageUrlRoot(this.detailPageUrlRoot).setTruncateLimit(this.truncateLimit).setJsonResourceUrlRoot(this.jsonResourceUrlRoot)},m.prototype._onClickFilterLink=function(a,d){d=d||{};var e=c(a.currentTarget),f=e.attr(this.config.attributes.filterId),g=e.attr(this.config.attributes.filterPageTitle),h=(e.attr(this.config.attributes.filterName)||"").toLowerCase(),i=e.is(this.config.selectors.defaultButton);if(this.articleSummaryListingView.showLoading(),this.articleSummaryListingView.clearResults(),this.articleSummaryCollection.setCurrentPage(1).setCategoryId(f).fetch(),b.each(this.collapsibleButtonList.getItems(),function(a){a.getName()===f?a.addActiveClass():a.removeActiveClass()}),this.$pageTitle.length>0&&this.$pageTitle.html(g),a.preventDefault(),d.isPreventNavigation)return void this.articleSummaryListingView.clearResults();i?this.router.navigate(""):this.router.navigate(h+"/"+f)},m.prototype._cleanUpUrL=function(a){if(""===a)return"";var b=a.match(/^(http[s]?:\/\/[^\/]+)?(\/.*)$/);return b&&b.length>=3&&b[2]?b[2]:null},l=d.Router.extend({initialize:function(a){this.urlRoot=a.urlRoot,this.route("","home"),this.route(/^([A-Za-z0-9_\-]+)\/(\d+)$/,"filter")},home:function(){this.trigger("route-home")},filter:function(a,b){this.trigger("route-filter",a,b)},start:function(){d.history.start({pushState:!0,root:this.urlRoot})}})}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=d.SharedSimpleRouter.getInstance(),f=a.NR||(a.NR={}),g=f.resolve("SDM.Core.Widgets"),h=g.AnchorsInPage=function(a,b){var d={selectors:{container:"[data-widget-anchors-in-page]",anchor:"[data-wg-aip-anchor]"},attributes:{active_class_name:"data-wg-aip-active-class",default_route_id:"data-wg-aip-default-route-id"}};this.config=c.extend(!0,d,b||{}),this._initialize(a)};h.prototype._initialize=function(a){a=a.is(this.config.selectors.container)?a:a.find(this.config.selectors.container),0!==a.length&&(this.defaultRouteId=a.attr(this.config.attributes.default_route_id)||!1,this.activeClassName=a.attr(this.config.attributes.active_class_name),this.anchors=b(b(a.find(this.config.selectors.anchor)).map(b(function(a){var b=c(a);return[b.attr("href").replace("#",""),b]}).bind(this))).object(),this._setupRouter(),this._setupClickEvent())},h.prototype._setupRouter=function(){b(this.anchors).each(b(function(a,c){e.on(c,b(function(){this._addActiveClass(c)}).bind(this))}).bind(this)),!this.anchors[""]&&this.defaultRouteId&&e.on("",b(function(){this._addActiveClass(this.defaultRouteId)}).bind(this)),e.historyStart()},h.prototype._setupClickEvent=function(){b(this.anchors).each(b(function(a,c){a.on("click.anchors-in-page",b(function(a){e.navigate(c,{trigger:!0}),a.preventDefault()}).bind(this))}).bind(this))},h.prototype._addActiveClass=function(a){b(this.anchors).each(b(function(b,c){a===c?b.addClass(this.activeClassName):b.removeClass(this.activeClassName)}).bind(this))}}.call(this),function(a){"use strict";var b=a.jQuery,c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Widgets"),e=c.resolve("SDM.Util"),f=c.resolve("SDM.Core.Components.BrooklynAuth"),g=f.Repository;d.BrooklynLogin=function(a,c){c=c||{},b(".widget-brooklyn-login--okta").length>=1&&g.getOktaConfigurationAsync().done(_.bind(function(a){for(var d={okta:{i18n:{en:{},fr:{}},baseUrl:a.EnvironmentBaseUrl,pcidUrls:{pcidMigrationUrl:a.PcidMigrationUrl,passwordPolicyUrl:a.PasswordPolicyUrl},language:e.getShortLanguageCode(),assets:{baseUrl:"https://assets.lblw.cloud/okta-signin-widget"},helpLinks:{forgotPassword:"https://www.pcoptimum.ca/forgot-password",login:[{text:"",link:"ld.pcid.primary.auth.create.account",href:"https://www.pcoptimum.ca/register"}],mfa:[{text:"ld.pcid.primary.auth.need.help",link:"ld.pcid.primary.auth.contact.support",href:"https://loblaw.force.com/PCoptimumsupport/s/?language="+e.getShortLanguageCode()}]}}},f=0;f<a.OktaLabels.length;f++){var g=a.OktaLabels[f].OktaCode,h=a.OktaLabels[f].Message,i=a.OktaLabels[f].LanguageCode.substring(0,2);d.okta.i18n[i][g]=h}var j=b.extend(!0,{},d,c);this.redirectUrl=a.EnvironmentBaseUrl+"oauth2/v1/authorize?client_id="+a.ClientId+"&response_type="+a.ResponseType+"&scope="+a.Scope+"&redirect_uri="+a.AppRedirectUrl+"&response_mode="+a.ResponseMode+"&state="+a.StaticState+"&nonce="+a.Nonce+"&sessionToken=",new OktaSignIn(j.okta).renderEl({el:".module-brooklyn-landing-login--pcoptimum .widget-brooklyn-login--okta"},function(a){"SUCCESS"===a.status&&(this.redirectUrl.includes("shoppersdrugmart.ca")||this.redirectUrl.includes("pharmaprix.ca"))&&(window.location.href=this.redirectUrl+a.session.token)}.bind(this),function(a){window.console.error("ERROR: "+a)}),setTimeout(function(){b(".widget-brooklyn-login form").submit(function(){0!==b("[data-md-bll-error]").length&&(b("[data-md-bll-error]")[0].innerHTML="")})},0)},this)).fail(_.bind(function(){console.log("Configuration not found")},this)),0!==b("[data-md-bll-error]").length&&(b("[data-md-bll-error]")[0].innerHTML=b("#tokenError").val())}}(this),function(a){var b=a.NR||(a.NR={}),c=b.resolve("SDM.Core.Utils"),d=b.resolve("SDM.Core.Widgets"),e=c.OmnitureUtil;d.BrooklynLogout=function(a){a.on("click","[data-wg-blo-logout-button]",function(){e.trackLogout()})}}(this),function(a){(a.NR||(a.NR={})).resolve("SDM.Core.Widgets").BrooklynUserControls=function(){}}(this),function(a){var b=a._,c=a.Vue,d=a.location,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Widgets"),g=e.resolve("SDM.Core.Components.BrooklynAuth"),h=g.Repository;f.BrooklynPointsRefresh=c.extend({data:function(){return{hasError:!1,isSyncing:!1}},methods:{refresh:function(){this.isSyncing=!0,h.getRefreshedPointsAsync().done(function(){d.reload()}).fail(b.bind(function(){this.isSyncing=!1,this.hasError=!0},this))}}})}(this),function(a){var b=a.jQuery,c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Components"),e=c.resolve("SDM.Core.Widgets"),f=c.resolve("SDM.Core.Components.BrooklynAuth.Repository"),g=d.PopUp,h=e.BrooklynConvertPopup=function(a,c){c=c||{};var d={selectors:{btn_convert:"[data-pwg-btn-convert]",btn_dismiss:"[data-pwg-btn-dismiss]"}};this.config=b.extend(!0,{},d,c),this.$el=a,this._init()};h.prototype._init=function(){this.popup=new g,this.popup_content=this.$el.html(),this.event_namespace="."+_.uniqueId("BrooklynConvertPopup_"),this.popup.onOpenCompleted(_.bind(this._bindEvents,this))},h.prototype.openPopUp=function(){this.popup.open(this.popup_content),f.setHasViewedConvertPopUp()},h.prototype.isViewable=function(){return!f.hasViewedConvertPopUp()},h.prototype._bindEvents=function(){this.popup.$modal.on("click"+this.event_namespace,this.config.selectors.btn_convert,_.bind(function(){this.popup.close()},this)),this.popup.$modal.on("click"+this.event_namespace,this.config.selectors.btn_dismiss,_.bind(function(){this.popup.close()},this))}}(this),function(){var a=this,b=this.jQuery,c="redemption-event",d=a.NR,e=d.resolve("SDM.Core.Widgets"),f=e.RedemptionEvent=function(a,c){var d={selectors:{redemption_button:"[data-wg-re-button]",redemption_container:"[data-wg-re-container]",redemption_close_button:"[data-wg-re-close-button]"}};this.config=b.extend(!0,d,c||{}),this._initialize(a)};f.prototype._initialize=function(a){this.$widget=a,this._setupRedemption()},f.prototype._setupRedemption=function(){this.$widget.find(this.config.selectors.redemption_button).on("click."+c,_(this._showRedemptionMessage).bind(this))},f.prototype._showRedemptionMessage=function(a){a.stopPropagation();var b=this.$widget.find(this.config.selectors.redemption_container);b.show(),b.find(this.config.selectors.redemption_close_button).on("click."+c,_(this._hideRedemptionMessage).bind(this)),this._bindWindowClickEvent(_(this._hideRedemptionMessage).bind(this))},f.prototype._hideRedemptionMessage=function(a){a&&a.stopPropagation(),this.$widget.find(this.config.selectors.redemption_container).hide(),this._unbindWindowClickEvent()},f.prototype._bindWindowClickEvent=function(a){_.isFunction(a)&&b(window).on("click."+c,a)},f.prototype._unbindWindowClickEvent=function(){b(window).off("click."+c)}}.call(this),function(){var a=this,b=a._,c=a.NR||(a.NR={}),d=c.resolve("SDM"),e=c.resolve("SDM.Core.Widgets"),f=d.Util;UnsupportedBrowserWarning=e.UnsupportedBrowserWarning=function(a,b){var c={cookies:{is_warning_viewed:"sdm-is-unsupported-browser-warning-viewed"},selectors:{button_close:"[data-ubw-button-close]"}};b=b||{},this.config=$.extend(!0,{},c,b),this._initialize(a)},UnsupportedBrowserWarning.prototype._initialize=function(a){this.$element=a,this._bindCloseClick()},UnsupportedBrowserWarning.prototype._bindCloseClick=function(){this.$element.on("click",this.config.selectors.button_close,b.bind(this._onCloseClick,this))},UnsupportedBrowserWarning.prototype._onCloseClick=function(a){a.preventDefault(),this._setCookie(),this._animateOut()},UnsupportedBrowserWarning.prototype._setCookie=function(){var a=this.config.cookies.is_warning_viewed;f.saveCookie(a,"true")},UnsupportedBrowserWarning.prototype._animateOut=function(){this.$element.fadeOut("fast")}}.call(this),function(a,b,c,d){var e="core-widgets-social-share",f=NR.resolve("SDM.Core.Widgets"),g=f.SocialShare=function(a,b){var d={attributes:{description:"data-wg-ss-description",title:"data-wg-ss-title",image:"data-wg-ss-image",tweetVia:"data-wg-ss-tweet-via"},dataAtttributes:{eventAction:"wg-ss-event-action",eventCategory:"wg-ss-event-category",eventLabel:"wg-ss-event-label"},selectors:{facebookShare:"[data-wg-ss-facebook-share-btn]",twitterShare:"[data-wg-ss-twitter-share-btn]",instagramShare:"[data-wg-ss-instagram-share-btn]"}};this.config=c.extend(!0,d,b||{}),this._initialize(a)};g.prototype._initialize=function(a){this._registerInstanceVars(a),this._registerDataVars(a),this._initializeEvents()},g.prototype._registerInstanceVars=function(a){this.$facebookShare=c(this.config.selectors.facebookShare,a),this.$twitterShare=c(this.config.selectors.twitterShare,a),this.$instagramShare=c(this.config.selectors.instagramShare,a)},g.prototype._registerDataVars=function(a){this.title=a.attr(this.config.attributes.title)||"",this.image=a.attr(this.config.attributes.image)||"",this.description=a.attr(this.config.attributes.description)||"",0===this.image.indexOf("//")&&(this.image="https:"+this.image)},g.prototype._initializeEvents=function(){this.$facebookShare.on("click."+e,d.bind(function(a){a.preventDefault(),FB.ui({method:"share_open_graph",action_type:"og.shares",action_properties:JSON.stringify({object:{"og:url":b.location.href,"og:title":this.title,"og:description":this.description,"og:image":this.image}})})},this)),this.$twitterShare.on("click."+e,d.bind(function(a){a.preventDefault();var e=c(a.currentTarget),f=e.attr("href"),g=b.location.href,h=e.attr(this.config.attributes.tweetVia)||"",i={url:g,text:this.title.substring(0,140),via:h};f+="?"+d.map(i,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),b.open(f,"twitter_share_dialog","width=550,height=450")},this))}}(console,window,jQuery,_),function(){var a=this,b=a.jQuery,c=a._,d=a.NR,e=a.SDM||(a.SDM={}),f=d.resolve("SDM.Core.Widgets"),g=e.Util,h=d.resolve("SDM.Core.Components.BrooklynAuth"),i=h.Repository,j=f.NewsletterSubscription=function(a,c){var d={selectors:{newsletter_form_submit:"[data-wg-sns-form-submit]",email_input:'[name="Email"]',form:"[data-wg-sns-form-submit]",subscriber_key:'[name="SubscriberKey"]'},newsletter_subscription_cookie:"newsletter-subscription"};this.config=b.extend(!0,{},d,c),this._init(a)};j.prototype._init=function(a){this.$el=a;var d=b(this.config.selectors.email_input,a),e=b(this.config.selectors.subscriber_key,a);i.getUserEmail().done(function(a){d.attr("value",a),e.attr("value","SDM_"+a)}),this.$el.on("submit",this.config.selectors.newsletter_subscription_cookie,c.bind(this._onNewsletterSubscribeSubmit,this))},j.prototype._onNewsletterSubscribeSubmit=function(){this._setViewedCookie()},j.prototype._setViewedCookie=function(){var a=this.config.newsletter_subscription_cookie;g.saveCookie(a,"true".toString())}}(),function(a,b){var c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Widgets"),e=a._,f=d.PopUp=function(a,c){c=c||{};var d={$el:a,modalScrollY:0,selectors:{showModal:"[data-wg-pu-show-modal]",hideModal:"[data-wg-pu-hide-modal]",modal:"[data-wg-pu-modal]",content:"[data-wg-pu-content]"},classes:{popUpActive:"wg-pu--active"}};this.config=b.extend(!0,{},d,c),this._init()};f.prototype._init=function(){this.config.$el.find(this.config.selectors.showModal).on("click",e.bind(this._showModal,this)),this.config.$el.find(this.config.selectors.hideModal).on("click",e.bind(this._hideModal,this)),this.config.$el.find(this.config.selectors.modal).on("click",e.bind(this._clickOutsideModal,this)),this.config.$el.find(this.config.selectors.modal).on("keydown",e.bind(this._onKeyDown,this))},f.prototype._showModal=function(){var a=500;this.config.$el.addClass(this.config.classes.popUpActive),this.config.$el.find(this.config.selectors.content).velocity({top:"0%"},a,[210,19]),this.config.modalScrollY=window.scrollY,setTimeout(e.bind(function(){b(document.body).css("top","-"+this.config.modalScrollY+"px"),b(document.body).css("position","fixed"),b(document.body).css("width","100%"),setTimeout(function(){}.bind(this),a)},this),0)},f.prototype._hideModal=function(){this.config.$el.removeClass(this.config.classes.popUpActive),this.config.$el.find(this.config.selectors.content).velocity({top:"100%"},300),setTimeout(e.bind(function(){b(document.body).css("position",""),b(document.body).css("top",""),b(document.body).css("width",""),window.scrollTo(0,this.config.modalScrollY)},this),0)},f.prototype._clickOutsideModal=function(a){0===b(a.target).closest(this.config.selectors.content).length&&this._hideModal()},f.prototype._onKeyDown=function(){if(this.config.$el.hasClass(this.config.classes.popUpActive)){if("Tab"===event.key||9===event.keyCode){var a='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]',b=this.config.$el.find(this.config.selectors.modal),c=b.find(a),d=b.find(a)[0],e=c[c.length-1];event.shiftKey?document.activeElement===d&&(e.focus(),event.preventDefault()):document.activeElement===e&&(d.focus(),event.preventDefault())}}}}(this,jQuery);(function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Components.PopUp"),g=e.resolve("SDM.Core.Widgets"),h="welcome-popup";PopUpWelcome=g.PopUpWelcome=function(a,b){var d={selectors:{pc_image:"data-wg-wpu-pc-image",mobile_image:"data-wg-wpu-mobile-image"},attributes:{content_id:"data-wg-wpu-content-id",page_view_count:"data-wpg-wpu-page-view-count"}};this.config=c.extend(!0,d,b||{}),this.$element=a},PopUpWelcome.prototype.openPopUp=function(){var a=new PopUpWelcome.View({el:this.$element.html()});a.isAbleToShowPopup()&&a.showPopUp()},PopUpWelcome.prototype.isViewable=function(){return!0},PopUpWelcome.View=d.View.extend({config:{selectors:{image_pc:"[data-wg-wpu-image-pc]",image_mobile:"[data-wg-wpu-image-mobile]",content:"[data-wg-wpu-popup-content]"}},initialize:function(){var a=this.$el.find(this.config.selectors.image_pc),b=this.$el.find(this.config.selectors.image_mobile),d=this._createImageLoaderPromise(a),e=this._createImageLoaderPromise(b);this.$window=c(window),this.has_pc_images=a.length>0,this.has_mobile_images=b.length>0,this.image_loader_promise=c.when.apply(this,[d,e]).promise()},onOpenPopUp:function(a){this.on("open-popup",a)},onClickContent:function(a){this.on("click-content",a)},onClosePopup:function(a){this.on("close-popup",a)},isAbleToShowPopup:function(){return(SDM.Util.isWindowWide()||SDM.Util.isWindowSmallDesktopWide()||SDM.Util.isWindowExtraWide())&&this.has_pc_images||!SDM.Util.isWindowWide()&&this.has_mobile_images},showPopUp:function(){this.image_loader_promise.done(b(function(){if(this.isAbleToShowPopup()){this.popup=new f,this.popup.open(this.el),a.Placeholder&&new Placeholder,this.trigger("open-popup"),this.popup.$modal.find(this.config.selectors.content).on("click."+h+"-"+this.cid,b(function(){this.trigger("click-popup")}).bind(this)),this.popup.onCloseCompleted(b(function(){this._unbindResizeEvents(),this.trigger("close-popup")}).bind(this));var c=this.$('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').first();c.length&&c.focus(),this.popup.$modal.on("keydown",function(a){var b="Tab"===a.key||9===a.keyCode,c=event.currentTarget;if(b){var d=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),e=d[0],f=d[d.length-1];a.shiftKey?document.activeElement===e&&(f.focus(),a.preventDefault()):document.activeElement===f&&(e.focus(),a.preventDefault())}}),this._bindResizeEvents()}}).bind(this))},_createImageLoaderPromise:function(a){var d=b(a).map(function(a){var b=c.Deferred(),d=new Image;return c(d).on("load",function(){b.resolve()}),d.src=a.src,b.promise()});return c.when.apply(this,d).promise()},_switchModeToPC:function(){this.popup&&!this.has_pc_images&&this.popup.close()},_switchModeToMobile:function(){this.popup&&!this.has_mobile_images&&this.popup.close()},_bindResizeEvents:function(){this.$window.on("becometowide."+h+"-"+this.cid,b(this._switchModeToPC).bind(this)),this.$window.on("becometonarrow."+h+"-"+this.cid,b(this._switchModeToMobile).bind(this))},_unbindResizeEvents:function(){this.$window.off("becometowide."+h+"-"+this.cid),this.$window.off("becometonarrow."+h+"-"+this.cid)}})}).call(this),function(a){var b=a.jQuery,c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Components"),e=c.resolve("SDM.Core.Widgets"),f=d.PopUp,g=e.PopUpBlogRedirect=function(a,c){c=c||{};var d={selectors:{redirect_image:"[data-pbr-redirect-image]"}};this.config=b.extend(!0,{},d,c),this.$el=a,this._init()};g.prototype._init=function(){this.popup=new f,this.popup_content=this.$el.html(),this.event_namespace="."+_.uniqueId("PopUpBlogRedirect_"),this.popup.onOpenCompleted(_.bind(this._bindEvents,this))},g.prototype.openPopUp=function(){this.popup.open(this.popup_content)},g.prototype.isViewable=function(){return!0},g.prototype._bindEvents=function(){this.popup.$modal.on("click"+this.event_namespace,this.config.selectors.redirect_image,_.bind(function(){this.popup.close()},this))}}(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Widgets"),f=d.resolve("SDM.Core.Components.EventHub"),g=e.PopUpManager=function(a,b){b=b||{};var d={selectors:{widget:"[data-popup-widget]"},data_attributes:{name:"popup-widget",priority:"popwg-priority"},names:{brooklyn_convert_popup:"brooklyn-convert-popup",pop_up_optimum_vib:"pop-up-optimum-vib",pop_up_welcome:"pop-up-welcome",pop_up_blog_redirect:"pop-up-blog-redirect"}};this.config=c.extend(!0,{},d,b),this._initialize(a)};g.prototype._initialize=function(){var a=c(this.config.selectors.widget),d=this.config.names;this.popups=[],this.boundUnshift=b.bind(this.unshift,this),this.boundEmpty=b.bind(this.empty,this),b.each(a,function(a){var b=c(a),f=b.data(this.config.data_attributes.name),g=b.data(this.config.data_attributes.priority);switch(f){case d.brooklyn_convert_popup:this.popups.push({widget:new e.BrooklynConvertPopup(b),priority:g});break;case d.pop_up_optimum_vib:this.popups.push({widget:new e.PopUpOptimumVib(b),priority:g});break;case d.pop_up_welcome:this.popups.push({widget:new e.PopUpWelcome(b),priority:g});break;case d.pop_up_blog_redirect:this.popups.push({widget:new e.PopUpBlogRedirect(b),priority:g})}},this),this.popups=b.filter(this.popups,function(a){return a.widget.isViewable()}),this.popups=b.sortBy(this.popups,"priority"),f.subscribe(f.EVENTS.ADD_MANAGED_POPUP,this.boundUnshift),f.subscribe(f.EVENTS.CANCEL_ALL_MANAGED_POPUPS,this.boundEmpty),c(b.bind(this._onWindowReady,this))},g.prototype._onWindowReady=function(){f.unsubscribe(f.EVENTS.ADD_MANAGED_POPUP,this.boundUnshift),f.unsubscribe(f.EVENTS.CANCEL_ALL_MANAGED_POPUPS,this.boundEmpty),this.popups.length>0&&this.popups[0].widget.openPopUp()},g.prototype.unshift=function(a){return this.popups.unshift({priority:0,widget:a})},g.prototype.empty=function(){this.popups=[]}}.call(this),function(a){"use strict";var b=a._,c=NR.resolve("SDM.Core.Components.BrooklynAuth"),d=NR.resolve("SDM.Core.Widgets"),e=SDM.EmailSignup||(SDM.EmailSignup={}),f=NR.resolve("SDM.Subscription"),g=NR.resolve("SDM.Util"),h=c.Repository;d.EmailSignup=function(a){new Vue({created:function(){this.isAuthenticated=e.IsLoggedIn,this.isSignedUp=g.getValueFromCookie("salesforceSubscription"),this.isAuthenticated&&h.getUserEmail().done(b.bind(function(a){this.email=a},this)).fail(b.bind(function(a){console.log(a)},this))},data:function(){return{email:"",errors:{email:!1,isConsenting:!1},instanceId:b.uniqueId("wgEs_"),isAuthenticated:!1,isConsenting:!1,isSending:!1,isSent:!1,isSignedUp:!1}},el:a.get(0),methods:{submit:function(){var a=this.$refs.signupForm.dataset.wgEsCasl||"";this.$refs.email&&(this.errors.email=!(this.email.length&&/\S+@\S+/.test(this.email))),this.$refs.consent&&(this.errors.isConsenting=!this.isConsenting),b.some(this.errors,function(a){return a})||(this.isSending=!0,f.signup(this.email,a).done(b.bind(function(){this.isSent=!0,g.saveCookie("salesforceSubscription","true")},this)).fail(b.bind(function(a){console.log(a)},this)).always(b.bind(function(){this.isSending=!1},this)))}},watch:{email:function(){this.email.length&&(this.errors.email=!1)},isConsenting:function(){this.isConsenting&&(this.errors.isConsenting=!1)}}})}}(this),function(a){"use strict";var b=a.jQuery,c=NR.resolve("SDM.Util"),d=NR.resolve("SDM.Subscription"),e=NR.resolve("SDM.Core.Components.BrooklynAuth.Repository"),f=a.SDM||(a.SDM={}),g=f.EmailSignupPopup||(f.EmailSignupPopup={}),h=NR.resolve("SDM.Core.Widgets"),i=h.EmailSignupPopup=function(a,c){c=c||{};var d={popupCookieName:"emailSignupPopup",subscriptionCookieName:"salesforceSubscription",isLoggedIn:"True"===g.IsLoggedIn,modalScrollY:window.scrollY,selectors:{close_button:"[data-wg-es-close-button]",modal:"[data-wg-es-modal]"}},e=b.extend(!0,{},d,c);this._init(a,e)};i.prototype._init=function(a,f){var g="",h=f.isLoggedIn,i=c.getValueFromCookie(f.popupCookieName),j=c.getValueFromCookie(f.subscriptionCookieName);i||j||(h?e.getUserEmail().done(function(b){g=b,d.isEmailSubscribed(g).done(function(b){b&&this._showPopup(a,f)}).fail(function(a){console.log(a)})}).fail(function(a){console.log(a)}):this._showPopup(a,f)),a.find(f.selectors.close_button).click(_.bind(function(){this._hidePopup(a,f)},this)),a.find(f.selectors.modal).click(_.bind(function(c){0===b(c.target).closest(".wg-esp__content-container").length&&a.hasClass("wg-esp--visible")&&this._hidePopup(a,f)},this))},i.prototype._showPopup=function(a,c){a.addClass("wg-esp--visible"),a.find(c.selectors.modal).velocity({top:"0%"},500,[210,19],function(){var c=b('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',a).first();c.length&&c.focus()}),setTimeout(function(){b(document.body).css("top","-"+c.modalScrollY+"px"),b(document.body).css("position","fixed"),b(document.body).css("width","100%")},0)},i.prototype._hidePopup=function(a,d){a.removeClass("wg-esp--visible"),a.find(d.selectors.modal).velocity({top:"100%"},300),setTimeout(function(){b(document.body).css("position",""),b(document.body).css("top",""),b(document.body).css("width","%"),window.scrollTo(0,d.modalScrollY)},0),c.saveCookie(d.popupCookieName,"true")}}(this),function(a){"use strict";var b=a.jQuery,c=NR.resolve("SDM.Util"),d=NR.resolve("SDM.Core.Widgets");(d.ImagePopup=function(a,c){c=c||{};var d={popupCookieName:"imagePopup",selectors:{content:"[data-wg-pu-content]",modal:'[data-widget="image-pop-up"]',modalCloseButton:"[data-wg-pu-hide-modal]"}},e=b.extend(!0,{},d,c);this._init(a,e)}).prototype._init=function(a,e){var f=c.getValueFromCookie(e.popupCookieName),g=a.find(e.selectors.modal);!f&&g.length>0&&new d.PopUp(g)._showModal(),a.find(e.selectors.modalCloseButton).on("click",function(){c.saveCookie(e.popupCookieName,"true")}),a.find(e.selectors.modal).on("click",_.bind(function(){0===b(event.target).closest(e.selectors.content).length&&c.saveCookie(e.popupCookieName,"true")},this))}}(this),function(a){"use strict";var b=a.NR||(a.NR={}),c=b.resolve("SDM.Core.Widgets"),d=b.resolve("SDM.Vue.Widgets"),e=b.resolve("SDM.Vue.Stores"),f=b.resolve("SDM.Data.FluShotFinderBanner");c.FluShotFinderBanner=function(a){var c=b.resolve("SDM.Vue.Vuex");c.hasModule("provinceSelector")||c.registerModule("provinceSelector",e.ProvinceSelector),new Vue({el:a[0],store:c,components:{provinceSelector:d.ProvinceSelector},mixins:[],data:function(){return{searchHeadline:"",searchSubHeading:"",searchDescription:""}},mounted:function(){this.updateSearchHeadline(this.userProvinceId)},methods:{updateSearchHeadline:function(a){this.searchHeadline=f.SearchHeadlinesPerProvince[a]},updateSearchSubHeadline:function(a){this.searchSubHeading=f.SearchSubHeadlinesPerProvince[a]},updateSearchDescription:function(a){this.searchDescription=f.SearchFieldDescriptionPerProvince[a]}},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),watch:{userProvinceId:function(){this.updateSearchHeadline(this.userProvinceId),this.updateSearchSubHeadline(this.userProvinceId),this.updateSearchDescription(this.userProvinceId)}}})}}(this),function(a){var b=a._,c=a.jQuery,d=a.Vue,e=a.NR,f=e.resolve("SDM.Util"),g=e.resolve("SDM.Core.Widgets"),h=e.resolve("SDM.QuickSearchFrequencyDelay")||50,i=4,j={DEFAULT:"all",ARTICLES:"Article",CONDITIONS:"Condition",PRODUCTS:"Products"},k={ARTICLE:"Article",BRAND:"Brand",CATEGORIE:"Category",CONDITION:"Condition",PRODUCT:"Product"},l=function(a,b){switch(a){case k.CONDITION:return b.AllConditions;case k.PRODUCT:return b.AllProducts;default:return null}},m=function(a,c){if(!a)return[];var d=null,e=b.map(a.StructuredResult,function(c){var d=c.Filter,e=c.FilterName,f=l(d,a),g=d===k.PRODUCT||d===k.BRAND;return{categoryType:d,suggestions:b.map(((c.Result||{}).records||{}).page||[],function(a,b){return{suggestionId:d+"_"+String(b),imageUrl:g?a.image||"":"",title:a.title,
url:a.url}}),title:e,viewAllLabel:f}});return c===j.DEFAULT&&a.FAQ.length&&(d={title:a.FAQLabel||"",suggestions:b.map(a.FAQ,function(a){return{title:a.Title,url:a.Link}})},e=e.concat(d)),b.filter(e,function(a){return a.suggestions.length>0})},n={beforeCreate:function(){this.API_URL="/"+f.getShortLanguageCode()+"/search/getstructuredsearch",this.FACET_MODES=j,this.focusTimeout=null},computed:{isDropdownOpen:function(){return this.isContainsFocusedEl&&(this.isFetchingSuggestions||this.allSuggestions.length||this.isShowErrorMessage||this.isShowNoResultsMessage)},allSuggestions:function(){return Array.prototype.concat.apply([],b.map(this.suggestionCategories,function(a){return a.suggestions}))},selectedSuggestion:function(){return-1===this.selectedIndex?null:this.allSuggestions[this.selectedIndex]}},created:function(){this.debouncedFetchSuggestion=b.debounce(this.fetchSuggestions,h),this.isPrefillQuery&&(this.query=(f.getUrlVars()||{}).query||"")},data:function(){return{currentRequest:null,hasFocus:!1,isContainsFocusedEl:!1,isFetchingSuggestions:!1,isShowErrorMessage:!1,isShowNoResultsMessage:!1,noResultsMessage:"",selectedIndex:-1,suggestionCategories:[],query:""}},methods:{decrementSelectedIndex:function(){this.isFetchingSuggestions||(this.selectedIndex-=1,this.selectedIndex<0&&(this.selectedIndex=0))},fetchSuggestions:function(){if(this.isShowErrorMessage=!1,this.isShowNoResultsMessage=!1,this.isFetchingSuggestions=!1,this.currentRequest&&this.currentRequest.abort(),this.query.length<i)return void(this.suggestionCategories=[]);if(this.isContainsFocusedEl){var a={filters:this.filters,numRes:this.facetMode===j.DEFAULT?3:15,type:this.facetMode,query:this.query},d=c.ajax({url:this.API_URL,data:a});this.isFetchingSuggestions=!0,this.selectedIndex=-1,d.then(b.bind(function(a){this.isFetchingSuggestions=!1,this.suggestionCategories=m(a,this.facetMode),this.noResultsMessage=a.NoResults||"",this.suggestionCategories.length||(this.isShowNoResultsMessage=Boolean(this.noResultsMessage))},this)).catch(b.bind(function(a,b,c){"abort"!==b&&(this.isFetchingSuggestions=!1,this.isShowErrorMessage=Boolean(this.errorMessage)),console.error(c)},this)),this.currentRequest=d}},incrementSelectedIndex:function(){this.isFetchingSuggestions||(this.selectedIndex+=1,this.selectedIndex>=this.allSuggestions.length&&(this.selectedIndex=this.allSuggestions.length-1))},makeViewAllUrl:function(a){return"/search?query="+encodeURIComponent(this.query)+"&srhtype="+encodeURIComponent(a.title.toLowerCase())},onFocusChange:function(){this.focusTimeout&&clearTimeout(this.focusTimeout),this.focusTimeout=setTimeout(b.bind(function(){var a=document.activeElement;this.hasFocus=b.some(this.$el.querySelectorAll("*"),function(b){return b===a})},this),50),this.focusTimeout=setTimeout(b.bind(function(){this.isContainsFocusedEl=this.hasFocus},this),h)},onNonSuggestionFocus:function(){this.selectedIndex=-1,this.onFocusChange()},onSubmit:function(){this.isShowErrorMessage=!1,this.isShowNoResultsMessage=!1,this.selectedIndex=-1,this.suggestionCategories=[],this.currentRequest&&(this.currentRequest.abort(),this.isFetchingSuggestions=!1)},onSuggestionFocus:function(a){this.selectedIndex=b.findIndex(this.allSuggestions,function(b){return b.suggestionId===a},this),this.onFocusChange()}},props:{errorMessage:{default:"",required:!1,type:String},facetMode:{default:j.DEFAULT,required:!1,type:String,validator:function(a){return b.indexOf(b.map(Object.keys(j),function(a){return j[a]}),a)>-1}},filters:{default:"",required:!1,type:String},hasAltStyling:{default:!1,required:!1,type:Boolean},isAlwaysSmallSubmit:{default:!1,required:!1,type:Boolean},inputPlaceholder:{required:!0,type:String},isPrefillQuery:{default:!1,required:!1,type:Boolean},submitLabel:{required:!0,type:String}},template:"#SearchBarV2Template",watch:{isContainsFocusedEl:function(){this.isContainsFocusedEl&&this.query&&!this.suggestionCategories.length&&this.fetchSuggestions()},query:function(){this.debouncedFetchSuggestion()},selectedSuggestion:function(){if(this.selectedSuggestion){var a=this.selectedSuggestion.suggestionId;this.$refs[a].length&&this.$refs[a][0].focus()}}}};g.SearchBar=function(a){new d({components:{searchBar:n},el:a.get(0)})}}(this),function(a,b){var c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Modules"),e=c.resolve("SDM.Core.Widgets"),f=c.resolve("SDM.Util"),g=a._,h=d.StoreLocatorPerService=function(a,c){c=c||{};var d={$el:a,selectors:{searchForm:"[data-md-slps-search-form]",searchInput:"[data-md-slps-search-input]",searchError:"[data-md-slps-search-error]",finder:"[data-md-slps-finder]",map:"[data-md-slps-map]",finderLoading:"[data-md-slps-finder-loading]",store:"[data-md-slps-store]",storeList:"[data-md-slps-store-list]",storeListPrevious:"[data-md-slps-store-list-previous]",storeListNext:"[data-md-slps-store-list-next]",storeHourPopUp:"[data-slps-store-hours-pop-up]",storeInfoStore:"[data-md-slps-store-info-store]",storeInfoStoreHours:"[data-md-slps-store-info-store-hours]"},classes:{storeListCollapse:"md-slps__store-list--collapse",loadingVisible:"md-slps__loading--visible"},data:{storeId:"md-slps-store-id",storeInfoStoreId:"md-slps-store-info-store-id",storeInfoStoreHoursId:"md-slps-store-info-store-hours-id",serviceCodes:"md-slps-service-codes",customPinSrc:"md-slps-custom-pin-src",markerLabel:"md-slps-marker-label"},templates:{storeList:"#store-locator-per-service-store-list-template",storeInfo:"#store-locator-per-service-store-info-template"},mapOptions:{center:{lat:43.6532,lng:-79.3832},zoom:10},stores:{},storeNotificationStores:{},storeListCurrentPage:1,storeHoursPopUps:{}};this.config=b.extend(!0,{},d,c);var e=SDM.Util.loadGoogleMapsApi();!0===e?this._init():b.when(e).then(g.bind(function(){this._init()},this))};h.prototype._init=function(){this._initMap(),this._initPopUps(),this._initSearch()},h.prototype._initGeolocation=function(){b.when(this._getGeolocation()).then(g.bind(function(a){if(a){var b=a.coords.latitude,c=a.coords.longitude;this.map.setCenter({lat:b,lng:c}),this._getStores({latitude:b,longitude:c,radius:"500",unit:"km",lookup:"nearby",filters:this.config.$el.data(this.config.data.serviceCodes).split(",").map(function(a){return a+":TRUE"}).join(","),rpp:"3"})}},this))},h.prototype._getGeolocation=function(){var a=b.Deferred();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a.resolve(b)},function(b){console.log(b),a.resolve(null)}):a.resolve(null),a.promise()},h.prototype._initSearch=function(){var a=b(this.config.$el.find(this.config.selectors.searchForm)),c=a.find(this.config.selectors.searchInput),d=f.getUrlVars(),e=d.search;e&&""!==e?(c[0].value=decodeURIComponent(e),this._searchFormSubmit()):this._initGeolocation(),a.submit(g.bind(this._onSearchFormSubmit,this))},h.prototype._onSearchFormSubmit=function(a){this._searchFormSubmit(),a.preventDefault()},h.prototype._searchFormSubmit=function(){var a=b(this.config.$el.find(this.config.selectors.searchForm)),c=a.find(this.config.selectors.searchInput),d=c[0].value;""!==d&&(f.setUrlVars({search:d}),this.config.storeListCurrentPage=1,this._queryMap(d))},h.prototype._initMap=function(){this.config.mapOptions.mapTypeId=a.google.maps.MapTypeId.ROADMAP,this.map=new a.google.maps.Map(b(this.config.selectors.map)[0],this.config.mapOptions),this.geocoder=new a.google.maps.Geocoder,this.markers=[]},h.prototype._initPopUps=function(){var a=b(this.config.$el.find(this.config.selectors.storeNotificationPopUp));this.config.storeNotificationPopUp=new e.PopUp(a);var c=b(this.config.$el.find(this.config.selectors.storeReminderPopUp));this.config.storeReminderPopUp=new e.PopUp(c)},h.prototype._queryMap=function(a){this.geocoder.geocode({address:a},g.bind(this._geocoderCallback,this))},h.prototype._geocoderCallback=function(b,c){if(c===a.google.maps.GeocoderStatus.OK){this.config.$el.find(this.config.selectors.searchError).hide();var d=b[0].geometry.location;this.map.setCenter(d),this._getStores({latitude:d.lat(),longitude:d.lng(),radius:"500",unit:"km",lookup:"nearby",filters:this.config.$el.data(this.config.data.serviceCodes).split(",").map(function(a){return a+":TRUE"}).join(","),rpp:"3"})}else this.config.$el.find(this.config.selectors.searchError).show()},h.prototype._getStores=function(a){this._clearAllMarkers(),this.config.$el.find(this.config.selectors.finderLoading).addClass(this.config.classes.loadingVisible),b.ajax({method:"GET",url:"/"+f.getShortLanguageCode()+"/store/getstores",data:a}).done(g.bind(function(a){a&&(this.config.storeHoursPopUps={},this._renderStoreList(JSON.parse(a)),this._addMarkerToMap(JSON.parse(a)),this.config.$el.find(this.config.selectors.finderLoading).removeClass(this.config.classes.loadingVisible),this._initStorePopUp(JSON.parse(a).results))},this)).fail(function(a){console.log(a)})},h.prototype._addMarkerToMap=function(a){if(0!==a.results.length){this.bounds=new google.maps.LatLngBounds;for(var c=g.template(b(this.config.templates.storeInfo).html()),d=0;d<a.results.length;d++){var e,f=a.results[d];e=""!==this.config.$el.data(this.config.data.customPinSrc)?this.config.$el.data(this.config.data.customPinSrc):"/static/core/images/icon-pin.png";var h=new google.maps.Marker({position:{lat:f.latitude,lng:f.longitude},map:this.map,icon:{url:e,scaledSize:new google.maps.Size(24.5,35.5)},title:this.config.$el.data(this.config.data.markerLabel)+" "+(d+1)});this.markers.push(h);var i=new google.maps.LatLng(h.position.lat(),h.position.lng());this.bounds.extend(i);var j=new google.maps.InfoWindow({content:c({store:f,storeNotificationStores:this.config.storeNotificationStores})});h.addListener("click",g.bind(this._openInfoWindow,this,j,this.map,h))}this.map.fitBounds(this.bounds),this.map.panToBounds(this.bounds)}},h.prototype._openInfoWindow=function(a,b,c){this.lastInfoWindow&&this.lastInfoWindow.close(),a.open(b,c),this.lastInfoWindow=a,google.maps.event.addListener(a,"domready",g.bind(this._initInfoWindow,this))},h.prototype._initInfoWindow=function(){var a=b(this.config.$el.find(this.config.selectors.storeInfoStoreHours)),c=b(a.closest(this.config.selectors.storeInfoStore)),d=c.data(this.config.data.storeInfoStoreId),e=this.config.storeHoursPopUps[d];a.unbind("click").on("click",g.bind(e._showModal,e))},h.prototype._clearAllMarkers=function(){for(var a=0;a<this.markers.length;a++)this.markers[a].setMap(null);this.markers=[]},h.prototype._renderStoreList=function(a){if(a.results.length>0){this.config.$el.find(this.config.selectors.storeList).removeClass(this.config.classes.storeListCollapse);var c=g.template(b(this.config.templates.storeList).html());this.config.$el.find(this.config.selectors.storeList).html(c({storeList:a.results,storeListCurrentPage:this.config.storeListCurrentPage,isStoreListLastPage:3*this.config.storeListCurrentPage>=a.count})),this.config.$el.find(this.config.selectors.storeListPrevious).on("click",g.bind(this._onStoreListPreviousClick,this,a)),this.config.$el.find(this.config.selectors.storeListNext).on("click",g.bind(this._onStoreListNextClick,this,a))}else this.config.$el.find(this.config.selectors.storeList).addClass(this.config.classes.storeListCollapse),this.config.$el.find(this.config.selectors.searchError).show()},h.prototype._onStoreListPreviousClick=function(a){this.config.storeListCurrentPage-=1,this._getStores(this._getUrlParametersAsObject(a.previous))},h.prototype._onStoreListNextClick=function(a){this.config.storeListCurrentPage+=1,this._getStores(this._getUrlParametersAsObject(a.next))},h.prototype._getUrlParametersAsObject=function(a){return JSON.parse('{"'+decodeURI(a).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')},h.prototype._initStorePopUp=function(a){for(var c=0;c<a.length;c++){var d=a[c].id;this.config.stores[d]=a[c];var f=b(this.config.$el.find("[data-"+this.config.data.storeId+"="+d+"]")),g=b(f.find(this.config.selectors.storeHourPopUp));this.config.storeHoursPopUps[d]=new e.PopUp(g)}}}(this,jQuery),function(a){"use strict";var b=a.NR||(a.NR={}),c=b.resolve("SDM.Vue.Widgets"),d=b.resolve("SDM.Core.Widgets"),e=b.resolve("SDM.Vue.Stores"),f=b.resolve("SDM.Data.CovidShotFinderBanner");d.CovidShotFinderBanner=function(a){var d=b.resolve("SDM.Vue.Vuex");d.hasModule("provinceSelector")||d.registerModule("provinceSelector",e.ProvinceSelector),new Vue({el:a[0],components:{"province-selector":c.ProvinceSelector},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),mixins:[],data:function(){return{searchFormRedirect:"[data-wg-fsfb-search-form-redirect]",searchInput:"[data-wg-fsfb-search-input]",formRedirectUrl:"wg-fsfb-search-form-redirect-url",formRedirectTarget:"wg-fsfb-search-form-redirect-target",geoTargetCta:{},geoTargetHeadline:""}},mounted:function(){},methods:{updateGeoHeadline:function(a){this.geoTargetHeadline=f.GeoTargetedSearchHeadline[a]},updateGeoCta:function(a){this.geoTargetCta=f.GeoRegisterCTAs[a]}},store:d,watch:{userProvinceId:function(){this.updateGeoHeadline(this.userProvinceId.toUpperCase()),this.updateGeoCta(this.userProvinceId.toUpperCase())}}})}}(this),function(a){var b=a.NR||(a.NR={}),c=b.resolve("SDM.Core.Modules"),d=a.Vue,e=4;c.ArticleGridWithVerticalSide=function(a){new d({computed:{hasMoreArticles:function(){return this.maxIndexToShow<this.numTotalArticles-1},maxIndexToShow:function(){return this.currentPageIndex*e+(e-1)}},data:function(){return{currentPageIndex:0,numTotalArticles:0}},el:a.get(0),methods:{incrementCurrentPageIndex:function(){this.currentPageIndex+=1}},mounted:function(){var a=this.$refs.articles;if(a){var b=a.querySelectorAll("li");this.numTotalArticles=b.length}}})}}(this),function(){var a=this,b=a.jQuery,c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Modules"),e=a.wishabi,f=d.Flyer=function(a,c){var d={selectors:{container:"[data-md-fly-container]"},attributes:{flyer_identifier:"md-fly-flyer-identifier",hide_identifier:"md-fly-hide-identifier",initial_height:"md-fly-initial-height",mix_height:"md-fly-min-height",language:"md-fly-lang"},initial_height:0,min_height:0,query_parameters:"",id:"md-fly-container",page_sizing:"PAGE",extra_padding:0,flyer_identifier:"shoppersdrugmart"};this.config=b.extend(!0,d,c||{}),this.$element=a,this._initialize()};f.prototype._initialize=function(){this._extendConfig();var a=this.config,b=e.hostedservices.iframe.Sizing;new e.hostedservices.iframe.decorate(a.id,a.flyer_identifier,b[a.page_sizing],{minHeight:a.min_height,initialHeight:a.initial_height,extraPadding:a.extra_padding,queryParameters:a.query_parameters})},f.prototype._extendConfig=function(){var a,c=this.$element.find(this.config.selectors.container),d="locale="+c.data(this.config.attributes.language),e=c.data(this.config.attributes.hide_identifier);e&&(d+="&hide="+encodeURIComponent(e)),a={flyer_identifier:c.data(this.config.attributes.flyer_identifier),initial_height:c.data(this.config.attributes.initial_height),min_height:c.data(this.config.attributes.min_height),query_parameters:d},this.config=b.extend(!0,this.config,a||{})}}.call(this),function(){var a=this,b=this._,c=a.jQuery,d=a.NR,e=d.resolve("SDM.Core.Components"),f=d.resolve("SDM.Core.Components.Coupon.CardModel"),g=d.resolve("SDM.Core.Components.Coupon.CouponCollection"),h=d.resolve("SDM.Core.Components.Coupon.CouponListView"),i=d.resolve("SDM.Core.Components.FlyerCollection"),j=d.resolve("SDM.Core.Components.FlyerListView"),k=d.resolve("SDM.Core.Modules"),l=null,m=e.EventHub;l=k.FeaturedDeals=function(a,b){var d={selectors:{personalized_coupon_container:"[data-md-ftdl-personalized-coupon-container]",recommended_flyer_products_container:"[data-md-ftdl-recommended-flyer-products-container]",view_all_coupons_btn_container:"[data-md-ftdl-view-all-coupons-btn-container]",no_results_templates:{loaded_coupons:"[data-widget-coupon-list-loaded-all-template]",no_loaded_coupons:"[data-widget-coupon-list-view-flyers-template]"}},tab_ids:{personalized_coupons:"personalized-coupons",recommended_flyer:"recommended-flyer"},data_attributes:{analytics_tag:"md-ftdl-analytics-tag",analytics_label:"md-ftdl-analytics-label"}};this.config=c.extend(!0,d,b||{}),this._initialize(a)},l.prototype._initialize=function(a){this.hasCoupons=!1,a.find(this.config.selectors.personalized_coupon_container).length>0&&(this.hasCoupons=!0,this._initializePersonalizedCoupon(a)),a.find(this.config.selectors.recommended_flyer_products_container).length>0&&this._initializeRecommendedCoupon(a),m.subscribe(m.EVENTS.TAB_SWITCHED,b.bind(function(a){a.tabId===this.config.tab_ids.recommended_flyer&&this._updateFlyer()},this))},l.prototype._initializePersonalizedCoupon=function(a){var d=c(this.config.selectors.no_results_templates.loaded_coupons),e=c(this.config.selectors.no_results_templates.no_loaded_coupons);this.card=f.getInstance(),this.couponCollection=new g;var i=new h({model:this.couponCollection,getNoResultsHtml:b.bind(function(){return this.card.getLoadedCoupons().size()>0?d.html():e.html()},this)});i.overrideAddItemViewMethod(b.bind(function(a,b,c,d){d.isContinuityOptIn()&&c.addContinuityOptInClass(),b.html(c.el),a.append(b)},this)),this.$couponContainer=a.find(this.config.selectors.personalized_coupon_container),this.$viewAllCouponsButtonContainer=a.find(this.config.selectors.view_all_coupons_btn_container),this.$couponContainer.html(i.el),this.couponCollection.onCouponRemoveComplete(function(){this._updatePersonlizedCoupons()},this),this.couponCollection.onListSet(this._toggleViewAllCouponsButton,this),this.card.onSimpleDataReady(b.bind(function(){this._updatePersonlizedCoupons(),this._pushPersonalizedCouponAnalytics()},this)).getAllCoupons().onCouponLoaded(b.bind(function(a){this._removePersonlizedCoupons(a)},this)),this.card.fetchSimpleData()},l.prototype._updatePersonlizedCoupons=function(){var a=this.card.getExclusiveContinuityOptInCoupons().add(this.card.getExclusiveCoupons().models).first(3);this.couponCollection.setList(a).fetchDetails()},l.prototype._removePersonlizedCoupons=function(a){this.couponCollection.removeCoupons(a)},l.prototype._toggleViewAllCouponsButton=function(){var a=this.card.getAllAvailableCoupons().size()>0;this.$viewAllCouponsButtonContainer.toggle(a)},l.prototype._initializeRecommendedCoupon=function(a){this.flyerModelCollection=new i,this.flyerViewModelCollection=new i,this.$flyerContainer=a.find(this.config.selectors.recommended_flyer_products_container),this.flyerListView=new j({model:this.flyerViewModelCollection}),this.$flyerContainer.html(this.flyerListView.el),this.flyerModelCollection.fetchSimple().done(b(function(){this.flyerViewModelCollection.setList(this.flyerModelCollection.first(6)).fetchDetails()}).bind(this)).fail(b(function(){this.flyerViewModelCollection.trigger("error-fetch")}).bind(this))},l.prototype._updateFlyer=function(){this.flyerListView.adjustTextAreaSize()}}.call(this),function(){var a=this,b=a.jQuery,c=a.NR||(a.NR={}),d="sdm-overlay",e=c.resolve("SDM.Core.Modules"),f=e.Overlays=function(a,c){var d={selectors:{close:"[data-md-ovl-close]",grey_bg:"[data-md-ovl-gry]",overlay:"[data-md-ovl-oly]",background:"[data-md-ovl-bg]",image:"[data-md-ovl-image]",html:"html"}};this.config=b.extend(!0,d,c||{}),this.$element=a,this._initialize(a)};f.prototype._initialize=function(){this._setInstanceVars(),b(window).on("becometowide."+d,_(function(){this._switchModeToDesktop()}).bind(this)),b(window).on("becometonarrow."+d,_(function(){this._switchModeToMobile()}).bind(this)),SDM.Util.isWindowWide()&&this._openOverlay()},f.prototype._setInstanceVars=function(){this.$image=b(this.config.selectors.image),this.imageLoaded=SDM.Util.loadImage(this.$image.attr("src")),this.$close=b(this.config.selectors.close),this.$grey_bg=b(this.config.selectors.grey_bg),this.$overlay=b(this.config.selectors.overlay),this.$background=b(this.config.selectors.background),this.$html=b(this.config.selectors.html)},f.prototype._openOverlay=function(){this.imageLoaded.done(_.bind(function(){var a=this.$background.height();this.$grey_bg.css({height:a}),this.$html.css("overflow","hidden"),this.$grey_bg.fadeIn(),this.$overlay.fadeIn(),this.$element.css("overflow","auto");var b=_(this._closeOverlay).bind(this);this.$close.off("click."+d).on("click."+d,b)},this))},f.prototype._switchModeToMobile=function(){this._closeOverlay()},f.prototype._switchModeToDesktop=function(){this._openOverlay()},f.prototype._closeOverlay=function(){this.$element.css("overflow","hidden").fadeOut(),this.$html.css("overflow","auto")}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=d.SharedSimpleRouter.getInstance(),f=a.Accordion,g=a.NR||(a.NR={}),h=g.resolve("SDM.Core.Modules"),i=h.AccordionContentList=function(a,b){var d={selectors:{accordion:"[data-wg-acl-accordion]",accordion_button:"[data-wg-acl-accordion-button]",accordion_content:"[data-wg-acl-accordion-content]"},attributes:{content_id:"data-wg-acl-content-id",is_first_item_expanded:"data-wg-acl-is-first-item-expanded",use_router:"data-wg-acl-use-router"},moveDuration:300,useRouter:!1};this.config=c.extend(!0,d,b||{}),this._initialize(a)};i.prototype._initialize=function(a){this.useRouter="true"===a.attr(this.config.attributes.use_router),this.isFirstItemExpanded=!this.useRouter&&"true"===a.attr(this.config.attributes.is_first_item_expanded),this.accordion$Elements=b(a.find(this.config.selectors.accordion)).map(b(function(a){var b=c(a);return{id:b.attr(this.config.attributes.content_id),$element:b}}).bind(this)),this.accordionObjects=b(this.accordion$Elements).map(b(function(a){var b=new f(a.$element,{selectors:{button:this.config.selectors.accordion_button,content:this.config.selectors.accordion_content}});return{id:a.id,accordion:b}}).bind(this)),this.useRouter&&(this.$scrollParent=this.$scrollParent||c("html, body"),this._setupRouter(),this._bindClickEvent()),this.isFirstItemExpanded&&this.accordionObjects.length&&b(this.accordionObjects).first().accordion.open()},i.prototype._openAccordion=function(a){return b(this.accordionObjects).find(function(b){return b.id===a}).accordion.open()},i.prototype._closeAccordionsExcept=function(a){var d=[];return b(this.accordionObjects).each(function(b){b.id!==a&&d.push(b.accordion.close())}),c.when.apply(c,d)},i.prototype._moveToAccordion=function(a){var c=b(this.accordion$Elements).find(function(b){return b.id===a}).$element;return this.$scrollParent.animate({scrollTop:c.offset().top-SDM.Util.getScrollOffset()},this.config.moveDuration).promise()},i.prototype._moveToTop=function(){return this.$scrollParent.animate({scrollTop:0},this.config.moveDuration).promise()},i.prototype._setupRouter=function(){var a=b(this.accordionObjects).map(function(a){return a.id}),d=new RegExp("^(?!"+a.join("|")+")");e.on(d,b(function(){this._closeAccordionsExcept(null).done(b(function(){this._moveToTop()}).bind(this))}).bind(this)),b(this.accordionObjects).each(b(function(a){e.on(a.id,b(function(){c.when(this._openAccordion(a.id),this._closeAccordionsExcept(a.id)).done(b(function(){this._moveToAccordion(a.id)}).bind(this))}).bind(this))}).bind(this)),e.historyStart()},i.prototype._bindClickEvent=function(){b(this.accordionObjects).each(function(a){a.accordion.onClickButton(b(function(){e.navigate(a.id,{trigger:!0})}).bind(this))})}}.call(this),function(a){"use strict";var b=a.jQuery,c=a._,d=a.NR||(a.NR={}),e=d.resolve("SDM"),f=d.resolve("SDM.Core.Modules"),g=d.resolve("SDM.Core.Components.Blog"),h=e.Util,i=g.BlogHeader,j=g.BlogHeaderView;(f.BeautyBlogPostDetails=function(a,c){c=c||{};var d={classes:{active_categories_toggle_btn:"wg-bbh-categories-toggle-active",search_term_input_expanded:"wg-bbh-search-input-expanded"},data_attributes:{title:"md-bbpd-title",tweet_via:"md-bbpd-tweet-via"},selectors:{categories:"[data-wg-bbh-categories]",categories_toggle_btn:"[data-wg-bbh-cat-toggle-btn]",header:"[data-widget-beauty-blog-header]",search:"[data-wg-bbh-list-search]",search_form:"[data-wg-bbh-search-form]",search_term_input:'[name="q"]',facebook_btn:"[data-md-bbpd-facebook-btn]",pinterest_btn:"[data-md-bbpd-pinterest-btn]",twitter_btn:"[data-md-bbpd-twitter-btn]",image:"[data-md-bbpd-image]"}};this.config=b.extend(!0,{},d,c),this.$element=a,this._initialize(this.$element,this.config)}).prototype._initialize=function(d,e){this.title=d.data(e.data_attributes.title)||"",this.$image=d.find(this.config.selectors.image),new j({el:b(this.config.selectors.header,d).get(0),model:new i,config:this.config}),h.loadPinterestApi(),b(this.config.selectors.facebook_btn,d).on("click",c.bind(function(a){var b=this.$image.attr("src");0===b.indexOf("//")&&(b="https:"+b),FB.ui({method:"feed",display:"popup",link:document.location.href,name:this.title,picture:b.length>0?b:null},c.noop),a.preventDefault()},this)),b(this.config.selectors.pinterest_btn,d).on("click",c.bind(function(b){a.PinUtils&&a.PinUtils.pinOne({url:document.location.href,media:this.$image.attr("src")||"",description:this.title}),b.preventDefault()},this)),b(this.config.selectors.twitter_btn,d).on("click",c.bind(function(d){var e=b(d.currentTarget),f=e.attr("href"),g=document.location.href,h=e.data(this.config.data_attributes.tweet_via)||"",i={url:g,text:this.title.substring(0,140),via:h};f+="?"+c.map(i,function(a,b){return b+"="+encodeURIComponent(a)}).join("&"),a.open(f,"twitter_share_dialog","width=550,height=450"),d.preventDefault()},this))}}(this),function(a){"use strict";var b=a.jQuery,c=a._,d=a.Backbone,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Modules"),g=e.resolve("SDM.Core.Components.Blog"),h=e.resolve("SDM.Util"),i=g.BlogListing,j=g.BlogListingView,k=g.BlogPost,l=g.BlogPostCollection,m=g.Category,n=g.CategoryCollection,o=g.Pagination,p=g.Router,q=g.SortTypeCollection,r=f.BeautyBlogPosts=function(a,c){c=c||{};var d={classes:{active_categories_toggle_btn:"wg-bbh-categories-toggle-active",active_category_item:"wg-bbh-category-item-active",active_sort_item:"md-bbp-sort-item-active",post_image:"wg-bli-image",search_term_input_expanded:"wg-bbh-search-input-expanded"},data_attributes:{api_path:"md-bbp-api-path",category_id:"wg-bbh-cat-id",category_path:"wg-bbh-cat-path",destination_id:"md-bpp-destination-id",featuredcontent_id:"md-bpp-featured-content-id",homepage_title:"md-bbp-home-title",num_results_per_page:"md-bbp-num-results-per-page",pagination_btn_num:"md-bbp-pagination-btn",post_id:"wg-bli-id",post_path_prefix:"md-bbp-post-path-prefix",router_root:"md-bbp-router-root",sort_btn_type:"md-bbp-sort-btn"},selectors:{body:"[data-md-bpp-body]",categories:"[data-wg-bbh-categories]",category_btn:"[data-wg-bbh-cat-btn]",categories_toggle_btn:"[data-wg-bbh-cat-toggle-btn]",clear_category_btn:"[data-md-bbp-cat-clear]",header:"[data-widget-beauty-blog-header]",pagination:"[data-md-bbp-pagination]",no_results_template:"[data-md-bbp-no-results-tmpl]",no_server_template:"[data-md-bbp-no-server-tmpl]",pagination_btn:"[data-md-bbp-pagination-btn]",pagination_btn_next:"[data-md-bbp-pagination-btn-next]",pagination_btn_prev:"[data-md-bbp-pagination-btn-prev]",pagination_template:"[data-md-bbp-pagination-tmpl]",post_loading:"[data-wg-bli-post-loading]",post_template:"[data-md-bbp-post-tmpl]",posts:"[data-md-bbp-posts]",posts_loading_template:"[data-md-bbp-posts-loading-tmpl]",search:"[data-wg-bbh-list-search]",search_form:"[data-wg-bbh-search-form]",search_term_input:'[name="q"]',search_status:"[data-md-bbp-search-status]",search_status_template:"[data-md-bbp-search-status-tmpl]",search_clear_btn:"[data-md-bbp-clear-search-btn]",sort_btn:"[data-md-bbp-sort-btn]",sort_type_default:"[data-md-bbp-sort-type-default]",sort_types:"[data-md-bbp-sort-types]",sticky_post:"[data-md-bbp-sticky-post]",sticky_post_template:"[data-md-bbp-sticky-post-tmpl]",sticky_post_image_loading:"[data-md-bbp-sticky-image-loading]",title:"[data-wg-bbh-title]"},speeds:{fade_in:"slow",fade_out:"fast",scroll_duration:.5}};this.config=b.extend(!0,{},d,c),this.$element=a,this._initalize(this.$element,this.config)};r.prototype._initalize=function(a,e){var f=a.data(e.data_attributes.api_path),g=a.data(e.data_attributes.destination_id),h=a.data(e.data_attributes.featuredcontent_id),p=a.data(e.data_attributes.homepage_title),r=a.data(e.data_attributes.num_results_per_page),s=a.data(e.data_attributes.post_path_prefix);k.prototype.path_prefix=s;var t=function(a){var b=a.data(e.data_attributes.category_path)||"/";return 0!==b.indexOf("/")&&(b="/"+b),b},u=new n(c.map(b(e.selectors.category_btn,a),function(a){var c=b(a);return new m({category_id:c.data(e.data_attributes.category_id),path:t(c),title:c.text()||""})},this)),v=new q(c.map(b(e.selectors.sort_btn,a),function(a){var c=b(a);return new d.Model({type:c.data(e.data_attributes.sort_btn_type),is_default:c.is(e.selectors.sort_type_default)})},this)),w=new l([],{url:f}),x=new o({num_results_per_page:r}),y=new i({categories:u,destination_id:g,featuredcontent_id:h,homepage_title:p,pagination_model:x,posts:w,sort_types:v,sort_type:v.getDefault().get("type")});this._initalizeRouter(a,e,y),new j({el:a.get(0),config:e,model:y}).render()},r.prototype._initalizeRouter=function(a,b,e){var f=a.data(b.data_attributes.router_root),g=new p;g.on("route:category",function(a){if(!a)return void e.setCategoryId(null);0!==a.indexOf("/")&&(a="/"+a);var b=e.get("categories").findWhere({path:a});if(!b)return void e.setCategoryId(null);e.setCategoryId(b.id)},this),g.listenTo(e,"set-category-id",function(a){var b=a.getActiveCategory()||a.getNullCategory();g.navigate(b.get("path"))}),g.listenTo(e,"set-search-term",function(a,b){if(c.isEmpty(b))return void g.navigate(a.getNullCategory().get("path"));g.navigate("/search?q="+encodeURIComponent(b))}),g.on("route:search",function(){var a=h.getUrlVars(),b=a.q||"";e.setSearchTerm(b)},this),d.history.start({pushState:!0,root:f})}}(this),function(a){var b=a.jQuery,c=a._,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Modules"),f=d.resolve("SDM.Util");(e.BeautyBrandsListing=function(a,c){c=c||{};var d={animation_duration_sec:500,selectors:{brand_nav:"[data-md-bbl-brand-navigation]",letter_group:"[data-md-bbl-letter-group]"}},e=b.extend(!0,d,c||{});this._init(a,e)}).prototype._init=function(a,d){this.$element=a,this.config=d,this.$element.on("click",this.config.selectors.letter_group,c.bind(function(a){var c=b(a.currentTarget).attr("href"),d=this.$element.find(c);0!==d.length&&f.scrollTo$ElementAsync(d,this.config.animation_duration_sec)},this))}}(this),function(){var a=this,b=a.console,c=a.jQuery,d=a._,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Modules"),g=f.BmiCalculator=function(a,b){var d={classes:{custom_radio_button_has_error:"wg-crb-has-error",field_has_error:"md-bmi-calc-calculator-field-has-error"},selectors:{bmi:"[data-md-bmi-calc-bmi]",bmi_container:"[data-md-bmi-calc-bmi-container]",button_submit:"[data-md-bmi-calc-button-submit]",calculator_header:"[data-md-bmi-calc-calculator-header]",custom_radio_button:".widget-custom-radio-button",form:"[data-md-bmi-calc-form]",field:"[data-md-bmi-calc-field]",input_units:'[name="md-bmi-calc-units"]',input_height:'[name="md-bmi-calc-height"]',input_weight:'[name="md-bmi-calc-weight"]',val_error:"[data-md-bmi-calc-val-error]",val_empty_height:"[data-md-bmi-calc-val-empty-height]",val_empty_weight:"[data-md-bmi-calc-val-empty-weight]",val_empty_units:"[data-md-bmi-calc-val-empty-units]",val_invalid_height:"[data-md-bmi-calc-val-invalid-height]",val_invalid_weight:"[data-md-bmi-calc-val-invalid-weight]"}};b=b||{},this.config=c.extend(!0,d,b),this._initialize(a)};g.fn=g.prototype,g.CONSTANTS={MIN_WEIGHT_IN_KG:25,MAX_WEIGHT_IN_KG:250,MIN_HEIGHT_IN_CM:100,MAX_HEIGHT_IN_CM:250,CM_PER_METRE:100,INCHES_PER_CM:2.54,LBS_PER_KG:2.2},g.UNITS={INVALID:0,METRIC:1,IMPERIAL:2},g.DURATIONS={HIDE_RESULT:100,SHOW_RESULT:600,HIDE_VAL_ERRORS:200,SHOW_VAL_ERRORS:400},g.VAL_ERRORS={EMPTY_UNITS:0,EMPTY_HEIGHT:1,EMPTY_WEIGHT:2,INVALID_HEIGHT:3,INVALID_WEIGHT:4},g.fn._initialize=function(a){this.$element=a,this._bindTextInputBlur(),this._bindTextInputKeyDown(),this._bindUnitsChange(),this._bindFormSubmit()},g.fn._bindTextInputBlur=function(){var a=[this.config.selectors.input_height,this.config.selectors.input_weight].join(", ")
;this.$element.on("blur",a,d.bind(this._onTextInputBlur,this))},g.fn._bindTextInputKeyDown=function(){var a=[this.config.selectors.input_height,this.config.selectors.input_weight].join(", ");this.$element.on("keydown",a,d.bind(this._onTextInputKeyDown,this))},g.fn._bindUnitsChange=function(){var a=this.config.selectors.input_units||"";this.$element.on("change",a,d.bind(this._onUnitsChange,this))},g.fn._bindFormSubmit=function(){var a=this.config.selectors.form||"";this.$element.on("submit",a,d.bind(this._onFormSubmit,this))},g.fn._onFormSubmit=function(a){var b=this._getRawValues()||{},c=this._getValidationErrors(b);0===c.length?(this._hideInvalidFields(d.values(g.VAL_ERRORS)),this._hideAllValidationMessages(),this._updateResult(this._getBmiFromRawValues(b))):(this._showInvalidFields(c),this._updateAllValidationMessages(c)),a.preventDefault()},g.fn._onTextInputBlur=function(a){if(!0!==c(a.relatedTarget).is(this.config.selectors.button_submit)){var b=c(a.currentTarget),d=b.is(this.config.selectors.input_height),e=b.is(this.config.selectors.input_weight),f=this._getRawValues();if((!0!==d||f.height)&&(!0!==e||f.weight)){var h=g.VAL_ERRORS.INVALID_HEIGHT,i=g.VAL_ERRORS.INVALID_WEIGHT,j=this._getValidationErrors(f),k=this._hasError(j,h),l=this._hasError(j,i);!0===d?!0===k?(this._showValidationMessages([h]),this._showInvalidFields([h])):(this._hideValidationMessages([h]),this._hideInvalidFields([h])):!0===e&&(!0===l?(this._showValidationMessages([i]),this._showInvalidFields([i])):(this._hideValidationMessages([i]),this._hideInvalidFields([i])))}}},g.fn._onTextInputKeyDown=function(a){if(13!==(a.keyCode||a.which)){var b=c(a.currentTarget),d=this.config.selectors.input_height,e=this.config.selectors.input_weight,f=[];b.is(d)?f=[g.VAL_ERRORS.EMPTY_HEIGHT,g.VAL_ERRORS.INVALID_HEIGHT]:b.is(e)&&(f=[g.VAL_ERRORS.EMPTY_WEIGHT,g.VAL_ERRORS.INVALID_WEIGHT]),this._hideResult(),this._hideInvalidFields(f),this._hideValidationMessages(f)}},g.fn._onUnitsChange=function(){var a=g.VAL_ERRORS.EMPTY_UNITS,b=g.VAL_ERRORS.INVALID_HEIGHT,c=g.VAL_ERRORS.INVALID_WEIGHT,d=this._getRawValues(),e=this._getValidationErrors(d),f=this._hasError(e,b),h=this._hasError(e,c);this._hideResult(),this._hideInvalidFields([a]),this._hideValidationMessages([a]),d.height&&(!0===f?(this._showValidationMessages([b]),this._showInvalidFields([b])):(this._hideValidationMessages([b]),this._hideInvalidFields([b]))),d.weight&&(!0===h?(this._showValidationMessages([c]),this._showInvalidFields([c])):(this._hideValidationMessages([c]),this._hideInvalidFields([c])))},g.fn._getBmiFromRawValues=function(a){var b=this._parseRawUnits(a.units),c=this._getCentimetres(this._parseRawFloat(a.height),b),d=this._centimetresToMetres(c),e=this._getKilograms(this._parseRawFloat(a.weight),b);return 0===d?0:e/(d*d)},g.fn._getCentimetres=function(a,b){return!1===this._isValidUnits(b)?0:!0===this._isMetric(b)?a:this._inchesToCentimetres(a)},g.fn._getElementChildren=function(a,c){c=c||"";var d=a.find(c);return 0===d.length&&b.log("No child elements exists with selector: ["+c+"]."),d},g.fn._getFormattedBmi=function(a){a=Math.round(100*(a||0))/100;var b=a.toString().split(".");return b[0]+"."+((b[1]||"")+"00").slice(0,2)},g.fn._getKilograms=function(a,b){return!1===this._isValidUnits(b)?0:!0===this._isMetric(b)?a:this._poundsToKilograms(a)},g.fn._getRawValues=function(){return{height:this._getRawHeightValue(),weight:this._getRawWeightValue(),units:this._getRawUnits()}},g.fn._getRawHeightValue=function(){var a=this.config.selectors.input_height||"";return this.$element.find(a).val()||""},g.fn._getRawUnits=function(){var a=this.config.selectors.input_units||"";return this.$element.find(a+":checked").val()||""},g.fn._getRawWeightValue=function(){var a=this.config.selectors.input_weight||"";return this.$element.find(a).val()||""},g.fn._getValidationErrors=function(a){var b=this._parseRawFloat(a.height),c=this._parseRawFloat(a.weight),d=this._parseRawUnits(a.units),e=this._getCentimetres(b,d),f=this._getKilograms(c,d),h=[],i=this._isValidUnits(d);return!1===i&&h.push(g.VAL_ERRORS.EMPTY_UNITS),a.height?b<=0?h.push(g.VAL_ERRORS.INVALID_HEIGHT):!0===i&&!1===this._isValidHeightInCentimetres(e)&&h.push(g.VAL_ERRORS.INVALID_HEIGHT):h.push(g.VAL_ERRORS.EMPTY_HEIGHT),a.weight?c<=0?h.push(g.VAL_ERRORS.INVALID_WEIGHT):!0===i&&!1===this._isValidWeightInKilograms(f)&&h.push(g.VAL_ERRORS.INVALID_WEIGHT):h.push(g.VAL_ERRORS.EMPTY_WEIGHT),h},g.fn._getValidationElementFromError=function(a){return a===g.VAL_ERRORS.EMPTY_UNITS?this._getElementChildren(this.$element,this.config.selectors.val_empty_units).get(0):a===g.VAL_ERRORS.EMPTY_HEIGHT?this._getElementChildren(this.$element,this.config.selectors.val_empty_height).get(0):a===g.VAL_ERRORS.EMPTY_WEIGHT?this._getElementChildren(this.$element,this.config.selectors.val_empty_weight).get(0):a===g.VAL_ERRORS.INVALID_HEIGHT?this._getElementChildren(this.$element,this.config.selectors.val_invalid_height).get(0):a===g.VAL_ERRORS.INVALID_WEIGHT?this._getElementChildren(this.$element,this.config.selectors.val_invalid_weight).get(0):null},g.fn._isMetric=function(a){return a===g.UNITS.METRIC},g.fn._isValidHeightInCentimetres=function(a){return g.CONSTANTS.MIN_HEIGHT_IN_CM<=a&&a<=g.CONSTANTS.MAX_HEIGHT_IN_CM},g.fn._isValidWeightInKilograms=function(a){return g.CONSTANTS.MIN_WEIGHT_IN_KG<=a&&a<=g.CONSTANTS.MAX_WEIGHT_IN_KG},g.fn._isValidUnits=function(a){return a===g.UNITS.METRIC||a===g.UNITS.IMPERIAL},g.fn._hasError=function(a,b){return d.indexOf(a,b)>-1},g.fn._parseRawFloat=function(a){return a&&!0===d.isArray(a.match(/^\d*(\.\d+)?$/))?parseFloat(a):0},g.fn._parseRawUnits=function(a){return a=(a||"").toUpperCase(),g.UNITS[a]||g.UNITS.INVALID},g.fn._centimetresToMetres=function(a){return a/g.CONSTANTS.CM_PER_METRE},g.fn._inchesToCentimetres=function(a){return a*g.CONSTANTS.INCHES_PER_CM},g.fn._poundsToKilograms=function(a){return a/g.CONSTANTS.LBS_PER_KG},g.fn._hideInvalidFields=function(a){var b=this.config.selectors.field||"",c=this.config.classes.field_has_error||"",d=this.config.classes.custom_radio_button_has_error,e=this._hasError(a,g.VAL_ERRORS.EMPTY_UNITS),f=this._hasError(a,g.VAL_ERRORS.EMPTY_HEIGHT)||this._hasError(a,g.VAL_ERRORS.INVALID_HEIGHT),h=this._hasError(a,g.VAL_ERRORS.EMPTY_WEIGHT)||this._hasError(a,g.VAL_ERRORS.INVALID_WEIGHT);return!0===e&&this._getElementChildren(this.$element,this.config.selectors.custom_radio_button).removeClass(d),!0===f&&this._getElementChildren(this.$element,this.config.selectors.input_height).parents(b).first().removeClass(c),!0===h&&this._getElementChildren(this.$element,this.config.selectors.input_weight).parents(b).first().removeClass(c),this},g.fn._showInvalidFields=function(a){var b=this.config.selectors.field||"",c=this.config.classes.field_has_error||"",d=this.config.classes.custom_radio_button_has_error||"",e=this._hasError(a,g.VAL_ERRORS.EMPTY_UNITS),f=this._hasError(a,g.VAL_ERRORS.EMPTY_HEIGHT)||this._hasError(a,g.VAL_ERRORS.INVALID_HEIGHT),h=this._hasError(a,g.VAL_ERRORS.EMPTY_WEIGHT)||this._hasError(a,g.VAL_ERRORS.INVALID_WEIGHT);return!0===e&&this._getElementChildren(this.$element,this.config.selectors.custom_radio_button).addClass(d),!0===f&&this._getElementChildren(this.$element,this.config.selectors.input_height).parents(b).addClass(c),!0===h&&this._getElementChildren(this.$element,this.config.selectors.input_weight).parents(b).addClass(c),this},g.fn._hideAllValidationMessages=function(){return this._getElementChildren(this.$element,this.config.selectors.val_error).hide(),this},g.fn._hideValidationMessages=function(a){var b=c.map(a,d.bind(this._getValidationElementFromError,this));c(b).fadeOut()},g.fn._showValidationMessages=function(a){var b=g.DURATIONS.SHOW_VAL_ERRORS||"slow",e=c.map(a,d.bind(this._getValidationElementFromError,this));return c(e).fadeIn(b),this},g.fn._updateAllValidationMessages=function(a){return this._hideAllValidationMessages(),this._showValidationMessages(a),this},g.fn._hideResult=function(a){a=a||d.noop,this._getElementChildren(this.$element,this.config.selectors.bmi_container).slideUp(g.DURATIONS.HIDE_RESULT,a)},g.fn._showResult=function(a){this._getElementChildren(this.$element,this.config.selectors.bmi).text(this._getFormattedBmi(a)),this._getElementChildren(this.$element,this.config.selectors.bmi_container).slideDown(g.DURATIONS.SHOW_RESULT)},g.fn._updateResult=function(a){var b=function(){this._showResult(a)};this._hideResult(d.bind(b,this))}}.call(this),function(){var a=this,b=a.jQuery,c=a._,d=a.NR||(a.NR={}),e=d.resolve("SDM.Core.Modules"),f=d.resolve("SDM.Core.Utils"),g=d.resolve("SDM.ContactUs.Forms"),h=d.resolve("SDM.Util"),i=f.ReCaptchaFactory,j=e.ContactUs=function(a,c){var d={urls:{answers_by_question:"/search/GetAllResultsByQuery"},rating_helpful:100,rating_unhelpful:0,character_limit:100,character_limit_label:"{0}",character_limit_delay:2e3,scroll_to_customer_help_duration_ms:1e3,inquiry:{selectors:{detail_forms:"[data-md-ctus-inquiry-detail-forms]",selected_category:"[data-md-ctus-inquiry-selected-category]",detail_template:"[data-md-ctus-inquiry-detail-tmpl]",inquiry_dropdown:"[data-md-ctus-inquiry-dropdown]",next_button:"[data-inquiry-next-button]",back_button:"[data-inquiry-back-button]",submit_button:"[data-inquiry-submit-button]"}},classes:{help_toggle_expanded:"md-ctus__customer-help-toggle--expanded"},selectors:{customer_help:"[data-md-ctus-customer-help]",customer_help_toggle:"[data-ctus-customer-help-toggle]",radio_container:"[data-md-ctus-inquiry-radio-container]"}};this.config=b.extend(!0,d,c||{}),this._initialize(a)};j.fn=j.prototype,j.fn._initialize=function(a){this.$element=a,this.$element.on("click",this.config.selectors.customer_help_toggle,c.bind(function(){b(this.config.selectors.customer_help,this.$element).is(":visible")?this._closeHelpSection():this._openHelpSection()},this)),this.$element.on("keydown",c.bind(function(a){var c=b(event.target);if(c.is(this.config.selectors.radio_container)){a.which===32&&(b('input[type="radio"]',c).prop("checked",!0),a.preventDefault())}},this)),this._initializeInquiry()},j.fn._initializeInquiry=function(){var a=c.template(b(this.config.inquiry.selectors.detail_template,this.$element).html());b(this.config.inquiry.selectors.detail_forms).html(a({inquireForms:g.Data})),this.$element.on("change",this.config.inquiry.selectors.selected_category,c.bind(this._onInquiryCategoryChange,this)),this.$element.on("click",this.config.inquiry.selectors.next_button,c.bind(this._onInquiryNextButtonClick,this)),this.$element.on("click",this.config.inquiry.selectors.back_button,c.bind(this._onInquiryBackButtonClick,this)),this.$element.on("click",this.config.inquiry.selectors.submit_button,c.bind(this._onInquirySubmitButtonClick,this)),this.$element.on("keydown","[data-inquiry-input=pcoptimum]",c.bind(this._onPCOptimumInputKeyDown,this)),this.$element.on("keydown","[data-inquiry-input=phone]",c.bind(this._onPhoneInputKeyDown,this)),this.$element.on("keydown","[data-inquiry-input=numeric]",c.bind(this._onNumericInputKeyDown,this));var d=this.$element.find("[data-md-ctus-inquiry-detail-form]");this.reCaptcha=[];for(var e=0;e<d.length;e++){var f=b(d[e]).find("[data-inquiry-recaptcha]"),h=b(d[e]).data("md-ctus-inquiry-detail-form");0!==f.length?this.reCaptcha[e]=this._renderReCaptcha(f,h):b("[data-inquiry-submit-button="+h+"]").length>0&&(b("[data-inquiry-submit-button="+h+"]")[0].disabled=!1)}},j.fn._renderReCaptcha=function(a,d){i.getReCaptchaAsync().done(c.bind(function(e){this.reCaptcha[d]=e,e.render(a,c.bind(function(a){a.length>0&&(b("[data-inquiry-submit-button="+d+"]")[0].disabled=!1)},this),c.bind(function(){b("[data-inquiry-submit-button="+d+"]")[0].disabled=!0},this))},this))},j.fn._onInquiryCategoryChange=function(a){this.$element.find(this.config.inquiry.selectors.next_button)[0].disabled=!1,a.preventDefault()},j.fn._onPCOptimumInputKeyDown=function(a){var c=b(a.currentTarget).find("input");b.isNumeric(a.key)&&19!==c[0].value.length||8===a.keyCode||9===a.keyCode||a.preventDefault()},j.fn._onPhoneInputKeyDown=function(a){var c=b(a.currentTarget).find("input");b.isNumeric(a.key)&&10!==c[0].value.length||8===a.keyCode||9===a.keyCode||a.preventDefault()},j.fn._onNumericInputKeyDown=function(a){b.isNumeric(a.key)||8===a.keyCode||9===a.keyCode||a.preventDefault()},j.fn._onInquiryNextButtonClick=function(a){var c=b("option:selected",b(this.config.inquiry.selectors.selected_category)),d=c.val();this.$element.find("[data-md-ctus-inquiry-selection]").hide(),this.$element.find("[data-md-ctus-inquiry-detail-form="+d+"]").show(),this.$element.find("[data-md-ctus-inquiry-detail-form="+d+"] .md-ctus__inquiry-heading").focus(),h.scrollTo$ElementAsync(b(".md-ctus__inquiry")),a.preventDefault()},j.fn._onInquiryBackButtonClick=function(a){this.$element.find("[data-md-ctus-inquiry-detail-form]").hide(),this.$element.find("[data-md-ctus-inquiry-selection]").show(),this.$element.find("[data-md-ctus-inquiry-selection] .md-ctus__inquiry-heading").focus(),h.scrollTo$ElementAsync(b(".md-ctus__inquiry")),a.preventDefault()},j.fn._onInquirySubmitButtonClick=function(a){var c=b(a.currentTarget).parents("form"),d=this;this._validateForm(c)&&(g.Payload.reason_code_level_1__c=b(c).data().inquiryReason,g.Payload.Banner_Email__c=b(c).data().inquiryBannerEmail,this._fillPayload(c,g.Payload,""),h.scrollTo$ElementAsync(b(".md-ctus__inquiry")),b("[data-md-ctus-inquiry-loading]").show(),b.ajax({contentType:"application/x-www-form-urlencoded",type:"POST",url:"/Global/SubmitInquiry",data:{data:JSON.stringify(g.Payload)}}).done(function(a){var c=JSON.parse(a);"OK"===c.Status?(b("[data-md-ctus-inquiry-external-id]")[0].innerHTML=g.Payload.web_external_id__c,b("[data-md-ctus-inquiry-case-id]")[0].innerHTML=c.CaseID):"FAIL"===c.Status&&(b("[data-md-ctus-inquiry-response]")[0].innerHTML=c.ErrorMessage)}).always(function(){b("[data-md-ctus-inquiry-detail-form]").hide(),b("[data-md-ctus-inquiry-loading]").hide(),b("[data-md-ctus-inquiry-response]").show(),d.$element.find("[data-md-ctus-inquiry-response]").focus()})),a.preventDefault()},j.fn._fillPayload=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)){var e=a.find("[data-inquiry-key='"+c+d+"']");if(0!==e.length){var f=e.data().inquiryInput,g=e.find("input, textarea, select");"radio"===f&&(g=e.find("input:checked")),0!==g.length&&(b[d]="postal"===f?g[0].value.replace(/\s/g,""):g[0].value)}else"object"==typeof b[d]&&this._fillPayload(a,b[d],c+d+",")}},j.fn._validateForm=function(a){for(var c=a.find("[data-inquiry-input]"),d=!0,e=!1,f=0;f<c.length;f++){var g=b(c[f]),i=g.data().inquiryInput,j=g.find("[data-inquiry-error]"),k=g.find("[data-required-error]"),l=j.data().inquiryError,m=j.data().inquiryConfirmationError,n=g.data().inquiryRequired,o=g.data().inquiryConfirmation,p=g.data().inquiryConfirmationId;if(k.hide(),j[0].innerHTML="","province"===i){var q=b(g).find("select")[0];if(n&&!q.value){k.show(),d=!1,e=this._setFirstInputFocus(q,e);continue}if(o){var r=a.find("[data-inquiry-confirmation-id="+p+"] select");if(r[0].value!==r[1].value){k.show(),d=!1,e=this._setFirstInputFocus(r[1],e);continue}}}else if("radio"===i){var s=b(g).find("input:checked");if(n&&0===s.length){k.show(),d=!1,e=this._setFirstInputFocus(s,e);continue}if(o){var t=a.find("[data-inquiry-confirmation-id="+p+"] input:checked");if(t[0].value!==t[1].value){j[0].innerHTML=m,d=!1,e=this._setFirstInputFocus(t[1],e);continue}}}else{var u=b(g).find("input")[0];if(j[0].innerHTML="",n&&0===u.value.length){k.show(),d=!1,e=this._setFirstInputFocus(u,e);continue}if("phone"===i){if(u.value.length>0&&(10!==u.value.length||!/^\d+$/.test(u.value))){j[0].innerHTML=l,d=!1,e=this._setFirstInputFocus(u,e);continue}}else if("email"===i){var v=/^(([abcdefg.hijklmnopqrstuvwxyz!#$%&'*/=?^_+-`{|}~0123456789]+))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(u.value.length>0&&!v.test(u.value)){j[0].innerHTML=l,d=!1,e=this._setFirstInputFocus(u,e);continue}}else if("numeric"===i){if(u.value.length>0&&!/^\d+$/.test(u.value)){j[0].innerHTML=l,d=!1,e=this._setFirstInputFocus(u,e);continue}}else if("postal"===i){if(u.value.length>0&&!h.validatePostalCode(u.value)){j[0].innerHTML=l,d=!1,e=this._setFirstInputFocus(u,e);continue}}else if("pcoptimum"===i&&u.value.length>0&&(19!==u.value.length||!/^\d+$/.test(u.value))){j[0].innerHTML=l,d=!1,e=this._setFirstInputFocus(u,e);continue}if(o){var w=a.find("[data-inquiry-confirmation-id="+p+"] input");if(w[0].value!==w[1].value){j[0].innerHTML=m,d=!1,e=this._setFirstInputFocus(w[1],e);continue}}}}return d},j.fn._setFirstInputFocus=function(a,c){return c||(a.focus(),h.scrollTo$ElementAsync(b(a),500,20)),!0},j.fn._openHelpSection=function(){var a=this.config.classes.help_toggle_expanded||"",c=b(this.config.selectors.customer_help,this.$element);c.stop().slideDown(),c.addClass(a)},j.fn._closeHelpSection=function(){var a=this.config.classes.help_toggle_expanded||"",c=b(this.config.selectors.customer_help,this.$element);c.stop().slideUp(),c.removeClass(a)}}.call(this),function(){var a,b,c,d,e,f,g,h,i=this,j=i._,k=i.jQuery,l=i.Backbone,m=i.NR||(i.NR={}),n=m.resolve("SDM.Core.Components"),o=m.resolve("SDM.Core.Modules"),p=o.VideoPlayerMVC=function(a,b){var c={attributes:{add_rating_endpoint:"data-md-vpm-add-rating-url",filter_view:"data-wg-tbg-content",get_paginated_videos_endpoint:"data-md-vpm-get-paginated-videos-url",get_video_by_friendly_name_endpoint:"data-md-vpm-get-video-by-friendly-name-url",increment_views_endpoint:"data-md-vpm-increment-views-url",root_url:"data-md-vpm-root-url"},classes:{now_playing_container_hidden:"md-vpm-now-playing-hidden",tab_content_active:"wg-tcl-active",tab_hidden:"md-vpm-tab-hidden"},selectors:{active_tab_content:".wg-tcl-active",module_wrapper:"[data-vpm-mod-wrapper]",now_playing_details:"[data-md-vpm-now-playing-details]",tab_content_template:"[data-md-vpm-tab-content-template]",tab_filter_selector:"[data-vpm-tabs-select]",video_item_template:"[data-md-vpm-video-item-template]",video_player_container:"[data-md-vpm-video-player-container]",video_player_template:"[data-md-vpm-video-player-template]"},most_recent_tab_button:"most-recent",video_base_url:"details/"};this.config=k.extend(!0,c,b||{}),this._initialize(a)},q=m.resolve("SDM"),r=m.resolve("SDM.Core.Components.VideoPlayer"),s=n.PaginationModel,t=n.PaginationView;d=l.Model.extend({config:{rating_cookie:"ShoppersVideoStats",v3_youtube_api_key:"AIzaSyAqyipvzq62aB7-5OZ35FiVAp4T2WszDTM"},idAttribute:"Id",defaults:{Cats:"",Duration:"0:00",Friendly:"",MaxRating:5,Rating:1,RatingsCount:0,ThumbnailUrl:"",Title:"",Views:0},getExternalData:function(){if(!0===j.isEmpty(this.get("YouId"))&&!0===j.isEmpty(this.get("VimId")))return this.trigger("external-data-failed"),void console.log("A vimeo id or a youtube id is required on the video.");var a=this.get("YouId"),b=this.get("VimId");a?k.when(this.getYoutubeVideoData(a)).then(j(this.handleYoutubeVideoDataResponse).bind(this)).fail(j(function(){this.trigger("external-data-failed")}).bind(this)):b&&k.when(this.getVimeoVideoData(b)).then(j(this.handleVimeoVideoDataResponse).bind(this)).fail(function(){this.trigger("external-data-failed")})},getFormattedDuration:function(a){if(!0===j.isUndefined(a))return this.defaults.Duration;if(!0===j.isNaN(a))return this.defaults.Duration;var b=a%60,c=Math.floor(a/60),d=Math.floor(a/3600);return d>0?d+":"+("00"+c).slice(-2)+":"+("00"+b).slice(-2):c+":"+("00"+b).slice(-2)},getFormattedRating:function(a){return!0===j.isUndefined(a)?this.defaults.Rating:!0===j.isNaN(a)?this.defaults.Rating:Math.min(Math.round(a),this.defaults.MaxRating)},getFormattedThumbnailUrl:function(a){if(!0===j.isUndefined(a))return this.defaults.thumbnail_url;var b=this.get("VideoThumbnail");return b&&!0===b.hasOwnProperty("URL")?b.URL:a},getFormattedViews:function(a){if(!0===j.isUndefined(a))return this.defaults.Views;if(!0===j.isNaN(a))return this.defaults.Views;for(var b=a.toString(),c=/(\d+)(\d{3})/;!0===c.test(b);)b=b.replace(c,"$1, $2");return b},getYoutubeId:function(a){var b="";if(!(a.indexOf("?v=")>-1))return a.substring(a.lastIndexOf("/")+1);var c=a.match(/[.]*?v=([^&]*)?/);return c.length>1&&(b=c[1]),b},getYoutubeVideoData:function(a){var b=this.config.v3_youtube_api_key,c="https://www.googleapis.com/youtube/v3/videos?id="+a+"&key="+b+"&part=snippet,contentDetails";return k.ajax({dataType:"jsonp",method:"GET",url:c}).fail(j(function(){this.trigger("external-data-failed")}).bind(this))},parseYoutubeApiV3DurationIntoSeconds:function(a){var b=new RegExp(/^PT((\d*)H)?((\d*)M((\d*)S)?)?/i),c=b.exec(a);return 60*(parseInt(c[2],10)||0)*60+60*(parseInt(c[4],10)||0)+(parseInt(c[6],10)||0)},getVimeoVideoData:function(a){return k.ajax({dataType:"jsonp",method:"GET",url:"//vimeo.com/api/v2/video/"+a+".json"})},handleYoutubeVideoDataResponse:function(a){if(!a.items||!a.items.length)return void this.trigger("external-data-failed");var b,c;a.items[0].snippet&&a.items[0].snippet.thumbnails&&a.items[0].snippet.thumbnails.high&&(b=a.items[0].snippet.thumbnails.high.url,this.set("ThumbnailUrl",this.getFormattedThumbnailUrl(b),{silent:!0})),a.items[0].contentDetails&&a.items[0].contentDetails.duration&&(c=a.items[0].contentDetails.duration,this.set("Duration",this.getFormattedDuration(this.parseYoutubeApiV3DurationIntoSeconds(c)),{silent:!0})),this.trigger("external-data-loaded")},handleVimeoVideoDataResponse:function(a){!1!==j.isArray(a)&&!1!==j.isObject(a[0])&&(!0===j.has(a[0],"duration")&&this.set("Duration",this.getFormattedDuration(a[0].duration),{silent:!0}),!0===j.has(a[0],"thumbnail_medium")&&this.set("ThumbnailUrl",this.getFormattedThumbnailUrl(a[0].thumbnail_medium),{silent:!0}),this.trigger("external-data-loaded"))},getRatedIdsFromCookie:function(){var a=q.Util.getValueFromCookie(this.config.rating_cookie);return a?decodeURIComponent(a).split(","):[]},isRated:function(){for(var a=this.getRatedIdsFromCookie(),b=0,c=a.length;b<c;b+=1)if(parseInt(a[b],10)===this.id)return!0;return!1},isVideo:function(){return!0===this.isYoutube()||!0===this.isVimeo()},isVimeo:function(){return!!this.get("VimId")},isYoutube:function(){return!!this.get("YouId")},submitRating:function(a){if(!0===j.isEmpty(this.add_rating_endpoint))return null;var b={videoID:this.id,videoTitle:this.get("Title"),newRating:a};return this.trigger("submitting-rating"),k.ajax({data:b,dataType:"json",type:"GET",url:this.add_rating_endpoint}).done(j(function(a){if(!1!==j.isNumber(a)){var b=this.getRatedIdsFromCookie();b.push(this.id);var c=encodeURIComponent(b.join(",")),d=new Date;d.setDate(d.getDate()+1),q.Util.saveCookie(this.config.rating_cookie,c,null,d.toUTCString()),this.set({Rating:a,RatingsCount:this.get("RatingsCount")+1})}}).bind(this))},incrementViews:function(){if(!0===j.isEmpty(this.increment_views_endpoint))return null;var a={videoID:this.id,videoTitle:this.get("Title")};return k.ajax({data:a,dataType:"json",type:"GET",url:this.increment_views_endpoint}).done(j(function(a){!1!==j.isNumber(a)&&this.set({Views:a})}).bind(this))}}),e=l.Collection.extend({model:d,initialize:function(){this.num_results_per_page=9,this.on("reset",this.handleReset,this)},handleReset:function(){this.trigger("end-loading")},fetchVideos:function(a,b,c){var d={catId:c||-1,sort:b||0,query:"",page:a||1,rpp:this.num_results_per_page};return this.trigger("start-loading"),k.ajax({data:d,dataType:"json",url:this.get_paginated_videos_endpoint})},fetchVideoByFriendlyName:function(a){return this.trigger("start-loading"),k.ajax({data:{friendlyName:a},dataType:"json",url:this.get_video_by_friendly_name_endpoint}).done(j(function(a){var b=new d(a);!0===b.isVideo()?this.setAsUserSelected(b):(console.log("Unknown response: "+b.toJSON()+"."),this.trigger("error-loading"))}).bind(this)).fail(j(function(){this.trigger("error-loading")}).bind(this))},setAsDefault:function(a){!1!==j.isUndefined(this.get(a.id))&&(this.reset(a.toJSON(),{silent:!0}),this.trigger("default-video-set",a))},setAsUserSelected:function(a){!1!==j.isUndefined(this.get(a.id))&&(this.reset(a.toJSON(),{silent:!0}),this.trigger("user-selected-video-set",a))}}),b=l.View.extend({model:d,config:{selectors:{error_template:"[data-md-vpm-video-loading-error]",loading_template:"[data-md-vpm-loading-template]",video_player_container:"[data-md-vpm-video-player-wrapper]"}},initialize:function(){this.$video_container=this.$(this.config.selectors.video_player_container),this.video_player=new r({$container:this.$video_container,event_handlers:{finish:j(this.onPlaybackFinishedHandler).bind(this)}}),this.$error=k(this.config.selectors.error_template).html(),this.$loading=k(this.config.selectors.loading_template).html(),this.listenTo(this.model,"change:ContentID",this.render),this.listenTo(this.model,"start-loading",this.renderLoading),this.listenTo(this.model,"error-loading",this.renderLoadingError),this.listenTo(this.model,"reset",function(){0===this.model.size()&&this.renderLoading()},this)},renderLoading:function(){return!1===j.isNull(this.video_player.getCurrentApi())&&this.video_player.destroy(),this.$video_container.html(this.$loading),this},renderLoadingError:function(){return!1===j.isNull(this.video_player.getCurrentApi())&&this.video_player.destroy(),this.$video_container.html(this.$error),this},render:function(a){var b=this.model.first();b||this.renderLoadingError();var c;return!0===a&&(c=function(){this.play()}),!0===b.isYoutube()?this.video_player.load(r.type.YOUTUBE,b.get("YouId"),c):!0===b.isVimeo()&&this.video_player.load(r.type.VIMEO,b.get("VimId"),c),this},onPlaybackFinishedHandler:function(){var a=this.model.first();a&&a.incrementViews()}}),h=l.View.extend({config:{selectors:{text_overflow:"[data-ml-text-overflow]"}},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"external-data-loaded",this.render),this.listenTo(this.model,"external-data-failed",this.render)},tagName:"li",model:d,renderLoading:function(){return this.$el.html(this.loading_template({video:this.model.toJSON()})),this},render:function(){return this.$el.html(this.template({video:this.model.toJSON()})),this.$el.find(this.config.selectors.text_overflow).mlTextOverflow(),this},onThumbnailClick:function(a){a.preventDefault(),this.current_video.setAsUserSelected(this.model)}}),a=l.View.extend({model:d,config:{attributes:{rating_value:"data-wg-rs-rating-value"},classes:{rating_selector_is_disabled:"wg-rs-is-disabled",rating_selector_is_active:"wg-rs-is-rating",rating_value_is_hovered:"wg-rs-rating-value-hovered",rating_value_is_selected:"wg-rs-rating-value-selected"},selectors:{rating_selector:"[data-md-vpm-rating-selector]",rating_status_message:"[data-md-vpm-now-playing-details-rating-status-message]",submitting_template:"[data-md-vpm-rating-submitting-template]",template:"[data-md-vpm-now-playing-template]",text_overflow:"[data-ml-text-overflow]"}},initialize:function(){this.template=j.template(k(this.config.selectors.template).html()),this.$submitting=k(this.config.selectors.submitting_template).html(),this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"external-data-loaded",this.render),this.listenTo(this.model,"submitting-rating",this.renderSubmittingRating)},events:{"mouseenter [data-md-vpm-rating-selector]":"onRatingMouseEnter","mouseleave [data-md-vpm-rating-selector]":"onRatingMouseLeave","mouseover [data-wg-rs-rating-value]":"onRatingValueMouseOver","click [data-wg-rs-rating-value]":"onRatingValueClick","click .md-vpm-fb-share-btn":"onFacebookClick"},renderSubmittingRating:function(){this.$el.find(this.config.selectors.rating_status_message).html(this.$submitting)},render:function(){return this.$el.html(this.template({is_rated:this.model.isRated(),url:location.href,encoded_title:encodeURIComponent(this.model.get("Title")),video:this.model.toJSON()})),this.$el.find(this.config.selectors.text_overflow).mlTextOverflow(),i.twttr&&!0===j.has(i,"twttr")&&!0===j.has(i.twttr,"widgets")&&i.twttr.widgets.load(this.el),this},onRatingMouseEnter:function(a){var b=k(a.currentTarget);b.hasClass(this.config.classes.rating_selector_is_disabled)||b.addClass(this.config.classes.rating_selector_is_active)},onRatingMouseLeave:function(a){var b=k(a.currentTarget);b.removeClass(this.config.classes.rating_selector_is_active),b.find("."+this.config.classes.rating_value_is_hovered).removeClass(this.config.classes.rating_value_is_hovered)},onRatingValueClick:function(a){var b=k(a.currentTarget),c=b.closest(this.config.selectors.rating_selector);if(!c.hasClass(this.config.classes.rating_selector_is_disabled)){b.siblings().removeClass(this.config.classes.rating_value_is_selected),b.addClass(this.config.classes.rating_value_is_selected),b.prevAll().addClass(this.config.classes.rating_value_is_selected),c.removeClass(this.config.classes.rating_selector_is_active).addClass(this.config.classes.rating_selector_is_disabled);var d=b.attr(this.config.attributes.rating_value);this.model.submitRating(d)}},onRatingValueMouseOver:function(a){var b=k(a.currentTarget);$rating_container=b.closest(this.config.selectors.rating_selector),$rating_container.hasClass(this.config.classes.rating_selector_is_disabled)||(b.siblings().removeClass(this.config.classes.rating_value_is_hovered),b.addClass(this.config.classes.rating_value_is_hovered),b.prevAll().addClass(this.config.classes.rating_value_is_hovered))},onFacebookClick:function(a){a.preventDefault(),a.stopPropagation(),FB.ui({method:"feed",display:"popup",link:document.location.href,name:this.model.get("Title"),picture:this.model.get("ThumbnailUrl")},j.noop)}}),g=l.Model.extend({defaults:{current_page:0,category_id:"",sort:"",total_pages:0,videos:null},getVideos:function(a){var b=this.get("current_page"),c=this.get("category_id"),d=this.get("sort");return k.when(this.get("videos").fetchVideos(b,d,c)).then(j(function(b){this.set("total_pages",parseInt(b.total,10)),this.get("videos").reset(b.videos,a)}).bind(this)).fail(j(function(){this.set("total_pages",1),this.get("videos").reset([])}).bind(this))}}),f=l.View.extend({model:g,config:{attributes:{content_id:"data-md-vpm-video-listing-item-content-id"},selectors:{error_message_template:"[data-md-vpm-error-message-template]",list_container:"[data-md-vpm-list-container]",no_videos_template:"[data-md-vpm-no-videos-template]",loading_template:"[data-md-vpm-list-loading-template]",pagination_container:"[data-md-vpm-pagination-container]",template:"[data-md-vpm-tab-content-template]"}},initialize:function(){this.template=j.template(k(this.config.selectors.template).html()),this.$list_container=this.$(this.config.selectors.list_container),this.$error_message=k(this.config.selectors.error_message_template).html(),this.$no_videos=k(this.config.selectors.no_videos_template).html(),this.$loading=k(this.config.selectors.loading_template).html(),this.pagination_model=new s,this.pagination_view=new t({model:this.pagination_model}),this.$pagination_container=this.$(this.config.selectors.pagination_container),this.$pagination_container.html(this.pagination_view.el),this.pagination_model.setNumberOfPages(0),this.pagination_model.onChangeCurrentPage(function(){this.model.set("current_page",this.pagination_model.getCurrentPage(),{trigger_scroll:!0})},this),this.listenTo(this.model,"change:current_page",this.handlePageChange),this.listenTo(this.model,"change:total_pages",this.handleTotalPagesChange),this.listenTo(this.model.get("videos"),"reset",this.showPagination),this.listenTo(this.model.get("videos"),"start-loading",this.renderLoading),this.listenTo(this.model.get("videos"),"start-loading",this.hidePagination),this.listenTo(this.model.get("videos"),"fail-loading",this.renderErrorMessage),this.listenTo(this.model.get("videos"),"reset",this.render)},render:function(){var a=this.model.get("videos");return 0===a.size()?this.$list_container.html(this.$no_videos):(this.$list_container.html(this.template({videos:a.toJSON()})),a.each(function(a){new h({model:a}).setElement(this.$list_container.find("["+this.config.attributes.content_id+'="'+a.id+'"]')).renderLoading(),a.getExternalData()
},this)),this},renderErrorMessage:function(){return this.$list_container.html(this.$error_message),this},renderLoading:function(){return this.$list_container.html(this.$loading),this},handlePageChange:function(a,b,c){c=c||{},c.trigger_scroll&&this.scrollToContainerTop(),this.pagination_model.setCurrentPage(b),this.model.getVideos({ignore_set_default_video:Boolean(c.ignore_set_default_video)})},scrollToContainerTop:function(){var a=this.$el.offset().top-q.Util.getScrollOffset()-30;TweenLite.to(k("body, html"),.5,{scrollTop:a})},handleTotalPagesChange:function(a,b){this.pagination_model.setNumberOfPages(b)},hidePagination:function(){return this.$pagination_container.hide(),this},showPagination:function(){return this.pagination_model.getNumberOfPages()>1&&this.$pagination_container.show(),this}}),p.prototype._initialize=function(a){this.$element=a,this.current_video=new e,this.tab_content_views={};var b=this.$element.find(this.config.selectors.module_wrapper);return this.is_now_playing_video_container_hidden=b.length>0&&b.is("."+this.config.classes.now_playing_container_hidden),this.add_rating_endpoint=this.$element.attr(this.config.attributes.add_rating_endpoint),Boolean(this.add_rating_endpoint)?(this.increment_views_endpoint=this.$element.attr(this.config.attributes.increment_views_endpoint),Boolean(this.increment_views_endpoint)?(this.get_paginated_videos_endpoint=this.$element.attr(this.config.attributes.get_paginated_videos_endpoint),Boolean(this.get_paginated_videos_endpoint)?(this.get_video_by_friendly_name_endpoint=this.$element.attr(this.config.attributes.get_video_by_friendly_name_endpoint),Boolean(this.get_video_by_friendly_name_endpoint)?(this.root_url=this.$element.attr(this.config.attributes.root_url),Boolean(this.root_url)?(this._setupPrototypesVars(),this._setupTabGroups(a),this._setupTabContentViews(),this._setupNowPlayingViews(),this.current_video.on("user-selected-video-set",function(a){this.setPlayingVideo(a,!0,!0)},this),this.current_video.on("default-video-set",function(a){this.setPlayingVideo(a,!1,!1)},this),void this._setupRouter()):void console.log("A "+this.config.attributes.root_url+" attribute is required.")):void console.log("A "+this.config.attributes.get_video_by_friendly_name_endpoint+" attribute is required.")):void console.log("A "+this.config.attributes.get_paginated_videos_endpoint+" attribute is required.")):void console.log("A "+this.config.attributes.increment_views_endpoint+" attribute is required.")):void console.log("A "+this.config.attributes.add_rating_endpoint+" attribute is required.")},p.prototype.setCurrentVideoUrl=function(a){var b=this.config.video_base_url;this.router.navigate(b+a)},p.prototype._setupPrototypesVars=function(){e.prototype.get_paginated_videos_endpoint=this.get_paginated_videos_endpoint,e.prototype.get_video_by_friendly_name_endpoint=this.get_video_by_friendly_name_endpoint,d.prototype.add_rating_endpoint=this.add_rating_endpoint,d.prototype.increment_views_endpoint=this.increment_views_endpoint,h.prototype.events=h.prototype.events||{},h.prototype.events["click [md-vpm-listing-item-thumbnail]"]="onThumbnailClick",h.prototype.template=j.template(k("[data-md-vpm-video-list-item-template]").html()),h.prototype.loading_template=j.template(k("[data-md-vpm-video-list-item-loading-template]").html()),h.prototype.current_video=this.current_video},p.prototype._setupTabGroups=function(){this.filter_select=this.$element.find(this.config.selectors.tab_filter_selector),this.filter_select.on("change",j(function(){this.clearPlayingVideo();var a=this.filter_select.val();this._triggerTabViewReload(a),this.router.navigate(a)}).bind(this))},p.prototype._triggerTabViewReload=function(a,b){b=b||{};var c=this.tab_content_views[a].model,d=this._getContentViewElementWrapped(a);if(this._setActiveTab(d),0===c.get("current_page"))c.set("current_page",1,{trigger_scroll:!1,ignore_set_default_video:b.has_default_video});else{var e=c.get("videos");e.size()>0?this.setPlayingVideo(e.first(),!1,!1):this.hideNowPlayingContainer()}},p.prototype._getContentViewElementWrapped=function(a){return k("["+this.config.attributes.filter_view+"="+a+"]")},p.prototype._setActiveTab=function(a){typeof a!==k&&(a=k(a)),this.$element.find("."+this.config.classes.tab_content_active).removeClass(this.config.classes.tab_content_active),a.addClass(this.config.classes.tab_content_active)},p.prototype._setupNowPlayingViews=function(){this.now_playing_player_view=new b({el:this.config.selectors.video_player_container,model:this.current_video})},p.prototype._setupTabContentViews=function(){this.filter_select.find("option").each(j(function(a,b){var c=k(b),d=c.val(),h=this._getContentViewElementWrapped(d);if(!h.length)return void console.log("Cannot find corresponding tab view for label: "+d+".");var i=h.attr("data-md-vpm-sort-id")||"0",j=h.attr("data-md-vpm-category-id")||"",l=new e,m=new g({sort:i,category_id:j,videos:l});l.on("reset",function(a,b){b=b||{},0===this.current_video.size()&&(a.size()>0?(!0===this.is_now_playing_video_container_hidden&&this.showNowPlayingContainer(),b.ignore_set_default_video||this.current_video.setAsDefault(a.first())):this.hideNowPlayingContainer())},this),l.on("start-loading",function(){this.clearPlayingVideo()},this);var n=new f({el:h,model:m});n.on("video-selected",this.setCurrentVideo,this),this.tab_content_views[d]=n}).bind(this))},p.prototype.hideNowPlayingContainer=function(){return this.is_now_playing_video_container_hidden=!0,this.$element.find(this.config.selectors.module_wrapper).addClass(this.config.classes.now_playing_container_hidden),this},p.prototype.showNowPlayingContainer=function(){return this.is_now_playing_video_container_hidden=!1,this.$element.find(this.config.selectors.module_wrapper).removeClass(this.config.classes.now_playing_container_hidden),this},p.prototype.scrollToVideoContainer=function(){var a=this.$element.find(this.config.selectors.video_player_container),b=a.offset().top-q.Util.getScrollOffset()-30;TweenLite.to(k("body, html"),.5,{scrollTop:b})},p.prototype.setPlayingVideo=function(b,c,d){d=d&&!0===q.Util.isWindowWide(),this.current_video.reset(b,{trigger:!0}),!0===c&&b.get("Friendly")&&this.setCurrentVideoUrl(b.get("Friendly"));var e=this.$element.find(this.config.selectors.now_playing_details),f=new a({model:b});f.render(),e.html(f.el),this.now_playing_player_view.render(d),!0===this.is_now_playing_video_container_hidden&&this.showNowPlayingContainer(),this.scrollToVideoContainer()},p.prototype.clearPlayingVideo=function(){this.current_video.reset([],{trigger:!0}),this.$element.find(this.config.selectors.now_playing_details).empty()},c=l.Router.extend({routes:{"":"home","details(/:id)":"video",":tab":"tab","*notFound":"home"}}),p.prototype._setupRouter=function(){this.router=new c,this.router.on("route:home",this._navigateToDefaultRoute,this),this.router.on("route:video",function(a){if(!0===j.isNull(a))return void this._navigateToDefaultRoute();this._triggerTabViewReload(this.config.most_recent_tab_button,{has_default_video:!0}),this.current_video.fetchVideoByFriendlyName(a)},this),this.router.on("route:tab",function(a){!0===j.has(this.tab_content_views,a)?this.filter_select.val(a).trigger("change"):this._navigateToDefaultRoute()},this);var a=this.root_url;"/"!==a.charAt(a.length-1)&&(a+="/"),l.history.start({pushState:!0,root:a})},p.prototype._navigateToDefaultRoute=function(){this.router.navigate(this.filter_select.find("option").first().val(),{trigger:!0})}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Components.PopUp"),g=e.resolve("SDM.Core.Modules"),h="promo-badge";PromoBadge=g.PromoBadge=function(a,b){var d={selectors:{badge:"[data-md-pb-badge]"}};this.config=c.extend(!0,d,b||{}),this.$element=a,this._initialize()},PromoBadge.prototype._initialize=function(){this.modal=new PromoBadge.Modal,this._bindEvents()},PromoBadge.prototype._bindEvents=function(){var a=this.$element.find(this.config.selectors.badge),c=b(this._openModal).bind(this);a.on("click",c)},PromoBadge.prototype._openModal=function(){this.modal.open()},PromoBadge.Modal=d.View.extend({config:{selectors:{image_pc:"[data-md-pb-modal-image-pc]",image_mobile:"[data-md-pb-modal-image-mobile]",content:"[data-md-pb-modal-content]"}},initialize:function(){this.render();var a=this.$(this.config.selectors.image_pc),b=this.$(this.config.selectors.image_mobile),d=this.createImageLoadPromise(a),e=this.createImageLoadPromise(b);this.$window=c(window),this.has_pc_images=a.length>0,this.has_mobile_images=b.length>0,this.image_loader_promise=c.when([d,e]).promise()},isAbleToShowPopup:function(){return SDM.Util.isWindowWide()&&this.has_pc_images||!SDM.Util.isWindowWide()&&this.has_mobile_images},open:function(){this.image_loader_promise.done(b.bind(function(){this.isAbleToShowPopup()&&(this.popup=new f,this.popup.open(this.el),this.popup.onCloseCompleted(b(function(){this.unbindResizeEvents()}).bind(this)),this.bindResizeEvents())},this))},render:function(){var a=b.template(c("[data-md-pb-modal-tamplate]").html());this.setElement(a())},createImageLoadPromise:function(a){var d=b(a).map(function(a){var b=c.Deferred(),d=new Image;return c(d).on("load",function(){b.resolve()}),d.src=a.src,b.promise()});return c.when(d).promise()},switchModeToPC:function(){this.popup&&!this.has_pc_images&&this.popup.close()},switchModeToMobile:function(){this.popup&&!this.has_mobile_images&&this.popup.close()},bindResizeEvents:function(){this.$window.on("becometowide."+h+"-"+this.cid,b(this.switchModeToPC).bind(this)),this.$window.on("becometonarrow."+h+"-"+this.cid,b(this.switchModeToMobile).bind(this))},unbindResizeEvents:function(){this.$window.off("becometowide."+h+"-"+this.cid),this.$window.off("becometonarrow."+h+"-"+this.cid)}})}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR,e=d.resolve("SDM.Util"),f=d.resolve("SDM.Core.Modules"),g=d.resolve("SDM.PharmacyServicesList.Data"),h=d.resolve("SDM.Vue.Stores"),i=d.resolve("SDM.Vue.Widgets"),j="on",k=c(window),l=b.reduce(g.Categories,function(a,b){var c=b.Slug||(b.Title||"").toLowerCase().replace(/\s/g,"-");return a[c]={categoryId:String(b.ContentID),body:b.Body,legal:b.Legal,slug:c,title:b.Title,featuredArticle:b.FeaturedArticle,featuredArticleUrl:b.FeaturedArticleUrl},a},{}),m=function(a,c){c=c||{};var d=b.map(a,function(a){return{id:a.Abbreviation.toLowerCase(),label:a.Title.toLowerCase()}});return c.isExcludeQc&&(d=b.filter(d,function(a){return"qc"!==a.id})),d},n=function(a){return c.ajax({type:"GET",url:"/"+e.getShortLanguageCode()+"/PharmacyServices/GetServices",data:{province:a},contentType:"application/json; charset=utf-8",dataType:"json"}).then(function(a){var c=b.map(a,function(a){var b=a.PharmacyService;if(!b)return null;var c=(a.SafeTitle||"").toLowerCase();if(!c)return null;var d=null;return a.OverrideUrl&&(d={href:a.OverrideUrl,target:a.OverrideUrlTarget,text:a.OverrideUrlText}),{serviceId:c,categoryId:b.PharmacyServiceCategoryID?String(b.PharmacyServiceCategoryID):null,bodyHtml:b.Description,title:b.Title,url:d}});return b.filter(c,Boolean)})},o=function(a,c){return!(!a.length||!c)&&b.contains(b.map(a,function(a){return a.categoryId}),c)},p=function(a,c){return!(!a.length||!c)&&b.contains(b.map(a,function(a){return a.id}),c.toLowerCase())},q=function(a,c){return!(!a.length||!c)&&b.contains(b.map(a,function(a){return a.serviceId}),c.toLowerCase())};f.PharmacyServiceList=function(f){var r=d.resolve("SDM.Vue.Vuex");r.hasModule("provinceSelector")||r.registerModule("provinceSelector",h.ProvinceSelector),new Vue({beforeCreate:function(){this.isPharmaprix=(a.location.hostname||"").indexOf("pharmaprix")>-1,this.hasProvinceSelect=!this.isPharmaprix},beforeDestroy:function(){k.off("becometonarrow becometowide becometosmalldesktopwide becometoextrawide",this.onChangeBreakpoint)},components:{"province-selector":i.ProvinceSelector},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{pageColumnWidth:function(){return Math.floor(100/this.maxNumServiceColumns)},selectedCategory:function(){return this.categorySlug?this.categoriesToShow.find(function(a){return a.slug===this.categorySlug},this)||null:null},servicePages:function(){return this.servicesToShow.length?b.reduce(this.servicesToShow,function(a,b,c){var d=c%this.maxNumServiceColumns;return a[d]||(a[d]=[]),a[d].push(b),a},[],this):[]},servicesToShow:function(){this.categorySlug||(this.categorySlug=g.Categories[0].Slug);var a=l[this.categorySlug];return a?this.services.filter(function(b){return b.categoryId===a.categoryId},this):this.services}}),created:function(){var a=e.getUrlVars(),b=a.province||this.userProvinceId||null;this.provinces=this.isPharmaprix?[]:m(g.Provinces,{isExcludeQc:!0}),this.setUserProvinceId(this.isPharmaprix?"qc":p(this.provinces,b)?b:null),this.isShowShareLocationPrompt=!this.userProvinceId,this.categorySlug=(a.category||"").toLowerCase()||null,this.serviceId=(a.service||"").toLowerCase()||null},data:function(){return{categoriesToShow:[],categorySlug:null,isLoading:!1,isShowShareLocationPrompt:!1,maxNumServiceColumns:3,provinces:[],serviceId:null,services:[]}},el:f.get(0),filters:{uppercase:function(a){return(a||"").toUpperCase()}},methods:Object.assign({},Vuex.mapActions("provinceSelector",["setUserProvinceId"]),{closeServiceEl:function(a,b){TweenLite.to(a,.4,{height:0,onComplete:b})},fetchServices:function(){this.isLoading=!0,n(this.userProvinceId).then(b.bind(function(a){this.services=a},this)).catch(function(a){console.error(a)}).always(b.bind(function(){this.isLoading=!1},this))},geoLocateUser:function(){var a=new c.Deferred;this.isShowShareLocationPrompt=!1,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(b){a.resolve({lat:b.coords.latitude,lng:b.coords.longitude})},function(b){console.error(b),a.reject(b)}):a.reject(new Error("geolocation is not supported")),a.promise().then(function(a){return e.getProvinceId(a)}).then(b.bind(function(a){this.setUserProvinceId(a)},this)).catch(b.bind(function(a){console.error(a),this.setUserProvinceId(j)},this))},onChangeBreakpoint:function(){e.isWindowNarrow()?this.maxNumServiceColumns=1:e.isWindowWide()?this.maxNumServiceColumns=2:this.maxNumServiceColumns=3},openServiceEl:function(a,b){TweenLite.set(a,{height:"auto"}),TweenLite.from(a,.4,{height:0,onComplete:b})},selectService:function(a){this.serviceId=a,this.updateQuerystring()},setCategorySlug:function(a){this.categorySlug=a,this.updateQuerystring()},updateQuerystring:function(){var a={};!this.isPharmaprix&&this.userProvinceId&&(a.province=this.userProvinceId),this.categorySlug&&(a.category=this.categorySlug),this.serviceId&&(a.service=this.serviceId),e.setUrlVars(a)},useDefaultProvinceId:function(){this.isShowShareLocationPrompt=!1,this.setUserProvinceId(j)}}),mounted:function(){k.on("becometonarrow becometowide becometosmalldesktopwide becometoextrawide",this.onChangeBreakpoint),this.onChangeBreakpoint()},store:r,watch:{isShowShareLocationPrompt:function(){this.$refs.shareLocationPrompt&&(this.isShowShareLocationPrompt?this.$nextTick(b.bind(function(){b.each(document.body.querySelectorAll("button, [href], input, select, textarea"),function(a){a.tabIndex=-1}),b.each(this.$refs.shareLocationPrompt.querySelectorAll("button, [href], input, select, textarea"),function(a,b){a.tabIndex=0,0===b&&a.focus()})},this)):this.$nextTick(b.bind(function(){b.each(document.body.querySelectorAll("button, [href], input, select, textarea"),function(a){a.tabIndex=0})},this)))},userProvinceId:function(){this.userProvinceId?this.fetchServices():this.services=[],this.updateQuerystring()},services:function(){this.services.length?this.categoriesToShow=b.filter(b.map(b.keys(l),function(a){return l[a]}),function(a){return b.any(this.services,function(b){return b.categoryId===a.categoryId})},this):this.categoriesToShow=[],o(this.categoriesToShow,this.categoryId)||(this.categoryId=null),q(this.services,this.serviceId)||(this.serviceId=null),this.updateQuerystring()},servicesToShow:function(){q(this.servicesToShow,this.serviceId)||(this.serviceId=null),this.updateQuerystring()}}})}}(),function(){var a=this,b=a._,c=a.jQuery,d=a.NR,e=d.resolve("SDM.Util"),f=d.resolve("SDM.Core.Modules"),g=null,h=f.PharmacyServiceDetail=function(a,b,d){var e={url:"/PharmacyServices/GetServices",scrolled:!1,scrollOffset:SDM.Util.getScrollOffset()+10,selectors:{provinces_select:"[data-md-phsd-provinces-select]",provinces_label:"[data-md-phsd-province-label]",details_template:"[data-md-phsd-detail-template]",details_container:'[data-service-list="all"]',loading_template:"[data-md-phsd-loading-template]",accordion:"[data-md-phsd-accordion]",accordion_button:"[data-md-phsd-accordion-button]",accordion_content:"[data-md-phsd-accordion-content]",scroll_top:"[data-md-phsd-scroll-top]",scroll_to:"[data-md-phsd-scroll-to]"},attributes:{scroll_to:"data-md-phsd-scroll-to",link_name:"data-md-phsd-link-name"}};this.config=c.extend(!0,e,d||{}),this._initialize(a,b)};h.prototype._initialize=function(a,d){g=g||c("html, body"),this._setInstantVars(a,d),this.$provinces_select.on("change.pharmacy-services-details",b(this._updateList).bind(this)),this.$provinces_select.val(this.province).triggerHandler("change")},h.prototype._setInstantVars=function(a,d){this.$container=a,this.$details_container=this.$container.find(this.config.selectors.details_container),this.details_template=b.template(this.$container.find(this.config.selectors.details_template).html()||""),this.loading_template=b.template(this.$container.find(this.config.selectors.loading_template).html()||"");var e=SDM.Util.getUrlVars();this.service=e.service,this.service&&(this.service=this.service.toLowerCase()),this.province=e.province,this.province&&(this.province=this.province.toLowerCase()),this.$provinces_select=this.$container.find(this.config.selectors.provinces_select);var f=b(this.$provinces_select.find("option")).map(function(a){return c(a).val()});this.province||b.contains(f,this.province)||(this.province=(d||"").toLowerCase()),b.contains(f,this.province)||(this.province=f[0])},h.prototype._updateList=function(){this._showLoading(),this.province=this.$provinces_select.val(),this.provinceName=this.$provinces_select.find(":selected").text(),this.$container.find(this.config.selectors.provinces_label).html(this.provinceName),c.when(this._fetchList()).then(b(this._renderList).bind(this))},h.prototype._showLoading=function(){this.$details_container.html(this.loading_template())},h.prototype._fetchList=function(){return c.ajax({type:"GET",url:"/"+e.getShortLanguageCode()+this.config.url,data:{province:this.province},contentType:"application/json; charset=utf-8",dataType:"json"})},h.prototype._renderList=function(a){var d=this.details_template({services:a,active_service:this.service,province:this.province}),e={selectors:{button:this.config.selectors.accordion_button,content:this.config.selectors.accordion_content}};this.$details_container.html(d),this._updateQueryString(),b(this.$details_container.find(this.config.selectors.accordion)).each(function(a){var b=new Accordion(c(a),e);b.isActive()&&b.open(0)}),this._scrollToActive(),this._bindEvents()},h.prototype._bindEvents=function(){var a=b(this._scrollToTop).bind(this);this.$container.find(this.config.selectors.scroll_top).on("click",a);var c=b(this._changeActiveService).bind(this);this.$container.find(this.config.selectors.scroll_to).on("click",c)},h.prototype._updateQueryString=function(){var a=SDM.Util.getUrlVars();a.province=this.province,a.service=this.service,SDM.Util.setUrlVars(a)},h.prototype._changeActiveService=function(a){a.preventDefault();var b=c(a.currentTarget);this.service=b.attr(this.config.attributes.scroll_to),this._updateQueryString(),this._scrollToActive()},h.prototype._scrollToActive=function(){var a=null;this.service&&""!==this.service&&(a=this.$container.find("["+this.config.attributes.link_name+"="+this.service+"]"),a.length>0&&this._scroll(a.offset().top))},h.prototype._scrollToTop=function(a){a.preventDefault(),this._scroll(0)},h.prototype._scroll=function(a){g.animate({scrollTop:a-this.config.scrollOffset},1e3)}}.call(this),function(){var a=this,b=a.NR,c=b.resolve("SDM.PharmacistQA");c.Initializer={init:function(){app=new Vue({el:"#pharmacist-qa",data:function(){return{isVideo:!0}},created:function(){},mounted:function(){},methods:{onVideoTabClick:function(){this.isVideo=!0},onTranscriptTabClick:function(){this.isVideo=!1}}})}},document.querySelector("#pharmacist-qa")&&c.Initializer.init()}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.NR,e=d.resolve("SDM.Util"),f=d.resolve("SDM.Core.Modules"),g=null,h=f.MinorAilmentsList=function(a,b,d){var e={url:"/PharmacyServices/GetMinorAilments",scrolled:!1,scrollOffset:SDM.Util.getScrollOffset()+10,selectors:{provinces_select:"[data-md-mal-provinces-select]",provinces_label:"[data-md-mal-province-label]",details_template:"[data-md-mal-detail-template]",details_container:"[data-md-mal-details-container]",loading_template:"[data-md-mal-loading-template]",accordion:"[data-md-mal-accordion]",accordion_button:"[data-md-mal-accordion-button]",accordion_content:"[data-md-mal-accordion-content]",scroll_top:"[data-md-mal-scroll-top]",scroll_to:"[data-md-mal-scroll-to]"},attributes:{scroll_to:"data-md-mal-scroll-to",link_name:"data-md-mal-link-name"}};this.config=c.extend(!0,e,d||{}),this._initialize(a,b)};h.prototype._initialize=function(a,d){g=g||c("html, body"),this.friendly_urls={},this._setInstantVars(a,d),this.$provinces_select.on("change.minor-ailments-list",b(this._updateList).bind(this)),this.$provinces_select.val(this.province).triggerHandler("change")},h.prototype._setInstantVars=function(a,d){this.$container=a,this.$details_container=this.$container.find(this.config.selectors.details_container),this.details_template=b.template(this.$container.find(this.config.selectors.details_template).html()||""),this.loading_template=b.template(this.$container.find(this.config.selectors.loading_template).html()||"");var e=SDM.Util.getUrlVars();this.province=e.province,this.province&&(this.province=this.province.toLowerCase()),this.$provinces_select=this.$container.find(this.config.selectors.provinces_select);var f=b(this.$provinces_select.find("option")).map(function(a){return c(a).val()});this.province||b.contains(f,this.province)||(this.province=(d||"").toLowerCase()),b.contains(f,this.province)||(this.province=f[0])},h.prototype._updateList=function(){this._showLoading(),this.province=this.$provinces_select.val(),this.provinceName=this.$provinces_select.find(":selected").text(),this.$container.find(this.config.selectors.provinces_label).html(this.provinceName),c.when(this._fetchList()).then(b(this._renderList).bind(this))},h.prototype._showLoading=function(){this.$details_container.html(this.loading_template())},h.prototype._fetchList=function(){return c.ajax({type:"GET",url:"/"+e.getShortLanguageCode()+this.config.url,data:{province:this.province},contentType:"application/json; charset=utf-8",dataType:"json"})},h.prototype._renderList=function(a){this.friendly_urls=b.reduce(a,function(a,b){return a[b.Title.toLowerCase()]=b.UrlFriendlyName,a},{});var d=SDM.Util.getUrlVars();d.ailment&&b.each(this.friendly_urls,function(a,b){if(a===d.ailment)return void(this.ailment=b)},this);var e=this.details_template({ailments:a,active_ailment:this.ailment||null,province:this.province}),f={selectors:{button:this.config.selectors.accordion_button,content:this.config.selectors.accordion_content}};this.$details_container.html(e),this._updateQueryString(),b(this.$details_container.find(this.config.selectors.accordion)).each(function(a){var b=new Accordion(c(a),f);b.isActive()&&b.open(0)}),this._bindEvents(),this.ailment&&this._scrollToActive()},h.prototype._bindEvents=function(){var a=b(this._scrollToTop).bind(this);this.$container.find(this.config.selectors.scroll_top).on("click",a);var c=b(this._changeActiveAilment).bind(this);this.$container.find(this.config.selectors.scroll_to).on("click",c)},h.prototype._updateQueryString=function(){var a=SDM.Util.getUrlVars(),b=this.friendly_urls[this.ailment];a.province=this.province,b&&(a.ailment=b),SDM.Util.setUrlVars(a)},h.prototype._changeActiveAilment=function(a){a.preventDefault();var b=c(a.currentTarget);this.ailment=b.attr(this.config.attributes.scroll_to),this._updateQueryString(),this._scrollToActive()},h.prototype._scrollToActive=function(){var a=null;this.ailment&&""!==this.ailment&&(a=this.$container.find("["+this.config.attributes.link_name+'="'+this.ailment+'"]'),a.length>0&&this._scroll(a.offset().top))},h.prototype._scrollToTop=function(a){a.preventDefault(),this._scroll(0)},h.prototype._scroll=function(a){g.animate({scrollTop:a-this.config.scrollOffset},1e3)}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.Backbone,e=a.NR||(a.NR={}),f=e.resolve("SDM.Core.Modules"),g=e.resolve("SDM.Core.Components"),h=g.CollapsibleButtonList,i=g.PaginationModel,j=g.PaginationView,k=f.BrandDetails=function(){new k.View};k.Model=d.Model.extend({defaults:{page:1,numRes:12,filters:{},prducts:{},type:"Product",categoryId:-1,isLBV:!1,getFilters:!0,numberOfPages:0,totalNumberOfResults:0},initialize:function(a,b){this.set("filters",new k.FilterModules),this.set("products",new k.Products),this.setBrand(b.brands),this.fetch();var c=this.getFilters();this.on("change:page",this.fetchNextPage),this.listenTo(c,"filters-updated",this.fetchWithNewFilter)},setBrand:function(a){var c=[];a=a.split(","),b.each(a,function(a){var b=new k.FilterModule.FilterOption;b.setValues(null,a,0,!0,1,a),c.push(b)},this),this.addFilters("BR","",c),this.addFilters("CAT","",[])},addFilters:function(a,b,c){this.get("filters").addFilter(a,b,c)},toJSON:function(){var a=b.clone(this.attributes),c=this.generateFilterString();return a.filters="type,"+this.get("type")+","+c,a=b.omit(a,["type","numberOfPages","totalNumberOfResults","products"])},generateFilterString:function(){var a=this.get("filters"),c=[];return a.each(function(a){var d=a.getType(),e=a.getSelectedOptions();b.isEmpty(e)?c.push(d+":"):b.each(e,function(a){c.push(d+":"+encodeURIComponent(a.getValue()))})}),c.join(",")},fetchWithNewFilter:function(){this.set({page:1},{silent:!0}),this.fetch()},fetchNextPage:function(){this.set("getFilters",!1),this.fetch()},fetch:function(){this.trigger("fetch-start"),c.ajax({url:this.url(),type:"POST",data:this.toJSON(),success:b(this.parse).bind(this),error:function(){console.log("error")}})},parse:function(a){var c=a.FilterModules;b.each(c,function(a){if(!b.isNull(a)){var c=a.Info[0],d=c.Prefix.replace(":",""),e=c.FilterName,f=[],g=0;b.each(a.Results,function(a){var b=new k.FilterModule.FilterOption;b.setValues(a.Type,a.Name,a.TotalResults,null,g,a.Id),f.push(b),g+=1},this),this.addFilters(d,e,f)}},this);var d=a.SwiftypeResults.records.page,e=[];b.each(d,function(a){e.push(a)},this),this.setProducts(e);var f=a.SwiftypeResults.info.page;this.set("numberOfPages",f.num_pages),this.set("totalNumberOfResults",f.total_result_count),this.trigger("data-fetched")},getFilters:function(){return this.get("filters")},getNumberOfResults:function(){return this.get("totalNumberOfResults")},getCurrentPage:function(){return this.get("page")},getNumberPerPage:function(){return this.get("numRes")},getNumberOfPages:function(){var a=parseInt(this.getNumberOfResults(),10),b=parseInt(this.getNumberPerPage(),10);return Math.ceil(a/b)},getProducts:function(){return this.get("products")},setCurrentPage:function(a){this.set("page",a)},setProducts:function(a){this.getProducts().setProducts(a)}}),k.View=d.View.extend({namespace:"sdm-brand-details-view",config:{selectors:{category_field:"[name=CategoryID]",brandName_field:"[name=Brands]",form:"[data-md-brnd-form]",header_container:"[data-md-brnd-products-header]",filter_container:"[data-md-brnd-products-filter]",products_container:"[data-md-brnd-products-list]",footer_container:"[data-md-brnd-products-pagination]"},templates:{header:"[data-widget-search-result-header-template]",loading:"[data-md-brnd-loading-template]"}},el:"[data-module='brand-details']",initialize:function(){var a=this.$(this.config.selectors.form);if(a.length>0){var d=this.$(this.config.selectors.category_field).val(),e=a.attr("action"),f=this.$(this.config.selectors.brandName_field).val();this.model=new k.Model({categoryId:d},{urlRoot:e,brands:f}),this.paginationModel=new i,this.paginationView=new j({model:this.paginationModel}),this.productGrid=new k.ProductGrid({products:this.model.getProducts()}),this.listenToOnce(this.model,"data-fetched",this.render),this.listenTo(this.model,"fetch-start",this.onFectchStart),c(window).on("becometowide."+this.namespace,b(function(){this.switchModeToDesktop()}).bind(this)),c(window).on("becometonarrow."+this.namespace,b(function(){this.switchModeToMobile()}).bind(this))}},switchModeToDesktop:function(){this.$(this.config.selectors.products_container).removeAttr("style")},switchModeToMobile:function(){this.$(this.config.selectors.products_container).removeAttr("style")},render:function(){this.setupPagination(),this.renderHeader(),this.renderFooter();var a=this.$(this.config.selectors.filter_container);this.model.getFilters().each(function(b){var c=b.renderView();c&&(a.append(c.$el),c.reinitializeScroller())},this),this.renderProductGrid(),this.listenTo(this.model,"data-fetched",this.updateView)},renderHeader:function(){var a=this.$(this.config.selectors.header_container),c=b.template(this.$(this.config.templates.header).html()),d=c({total_result_count:this.model.getNumberOfResults(),current_page:this.model.getCurrentPage(),per_page:this.model.getNumberPerPage()});a.html(d)},renderFooter:function(){this.$(this.config.selectors.footer_container).html(this.paginationView.$el)},renderProductGrid:function(){var a=this.$(this.config.selectors.products_container),b=this.productGrid.render().$el;a.html(b);var c=b.height();TweenLite.to(a,.5,{"min-height":c})},onFectchStart:function(){this.$(this.config.selectors.products_container).html("");var a=b.template(c(this.config.templates.loading).html())();this.$(this.config.selectors.header_container).html(a)},setupPagination:function(){this.paginationModel.setNumberOfPages(this.model.getNumberOfPages()),this.paginationModel.setCurrentPage(this.model.getCurrentPage()),this.paginationModel.onChangeCurrentPage(this.onPageChange,this)},onPageChange:function(){this.scrollTop(),this.model.setCurrentPage(this.paginationModel.getCurrentPage())},scrollTop:function(){var a=this.$(this.config.selectors.header_container).offset().top-(SDM.Util.getScrollOffset()+25);TweenLite.to(c("body, html"),.5,{scrollTop:a})},updateView:function(){this.renderHeader(),this.renderProductGrid(),this.setupPagination(),this.model.getFilters().trigger("data-fetched")}}),k.Products=d.Collection.extend({setProducts:function(a){this.set(a)}}),k.ProductGrid=d.View.extend({config:{analytics_event_label:"category"},initialize:function(a){this.products=a.products},render:function(){var a=b.template(c("[data-widget-product-grid-template]").html()),d=a({products:this.products.toJSON(),analytics_event_label:this.config.analytics_event_label});return this.setElement(d),this}}),k.FilterModules=d.Collection.extend({model:k.FilterModule,initialize:function(){this.on("filters-updated",this.onFiltersUpdated),this.on("data-fetched",this.updateView)},onFiltersUpdated:function(){this.disableFilters()},disableFilters:function(){this.each(function(a){a.trigger("disable-view")})},updateView:function(){this.each(function(a){a.trigger("update-view")})},addFilter:function(a,b,c){var d=this.findFilterModuleByType(a);if(d)d.setName(b),d.addOptions(c);else{var e=new k.FilterModule({type:a,name:b});e.addOptions(c),this.add(e)}},findFilterModuleByType:function(a){return this.find(function(b){return b.getType()===a},this)}}),k.FilterModule=d.Model.extend({defaults:{type:"",name:"",options:null},config:{brand_filter:"BR"},initialize:function(){if(this.set("options",new k.FilterModule.FilterOptions),this.getType()!==this.config.brand_filter){
this.view=new k.FilterModuleView({model:this});var a=this.getOptions();this.updateComparator(),this.listenTo(a,"selection-updated",this.triggerReFetch)}},updateComparator:function(){this.get("type")===this.config.brand_filter&&this.getOptions().setComparatorToSortByAlphabet()},triggerReFetch:function(){this.trigger("filters-updated")},addOptions:function(a){this.get("options").set(a)},getType:function(){return this.get("type")},getSelectedOptions:function(){return this.get("options").getSelectedOptions()},getOptions:function(){return this.get("options")},getCount:function(){return this.getOptions().getCount()},renderView:function(){if(this.view)return this.view.render()},setName:function(a){this.get("name")!==a&&this.set("name",a)},clearAll:function(){this.getOptions().clearAll()},selectAll:function(){this.getOptions().selectAll()}}),k.FilterModuleView=d.View.extend({config:{selectors:{checkbox_container:"[data-wg-pf-cbl]",loading_continer:"[data-wg-pf-loading-container]"},template:"[data-widget-product-filters-generic-template]",special_templates:{BR:"[data-widget-product-filters-brand-template]"}},events:{"click [data-wg-pf-filter-clear-all-button]":"clearAll","click [data-wg-pf-filter-select-all-button]":"selectAll","click [data-wg-pf-alphabet-tab]":"scrollTo"},initialize:function(){this.listenTo(this.model,"disable-view",this.showLoading),this.listenTo(this.model,"update-view",this.update)},render:function(){var a=this.getTemplate(),b="",c={},d=this.model.attributes;return d.count=this.model.getCount(),b=a(d),this.setElement(b),this.cbl=new h({$container:this.$(this.config.selectors.checkbox_container)}),c=this.model.getOptions(),c.each(function(a){this.cbl.addItem(a.renderView().$el)},this),this},getTemplate:function(){var a=this.model.getType(),d=this.config.special_templates[a];return d=d||this.config.template,b.template(c(d).html())},update:function(){this.cbl.emptyList(),this.model.getOptions().each(function(a){this.cbl.addItem(a.renderView().$el)},this),this.reinitializeScroller(),this.hideLoading()},showLoading:function(){this.$(this.config.selectors.loading_continer).show()},hideLoading:function(){this.$(this.config.selectors.loading_continer).hide()},reinitializeScroller:function(){this.cbl.reinitializeScroller()},clearAll:function(a){a.preventDefault(),this.model.clearAll()},selectAll:function(a){a.preventDefault(),this.model.selectAll()},scrollTo:function(a){a.preventDefault();var b=c(a.target),d=b.data("wg-pf-alphabet-tab");this.$(".wg-pf-alphabet-tab-active").removeClass("wg-pf-alphabet-tab-active"),b.addClass("wg-pf-alphabet-tab-active");var e=this.$("[data-wg-pf-item-alphabet-group="+d+"]").first(),f=e.data("wg-clbl-item");this.cbl.scrollTo(f)}}),k.FilterModule.FilterOption=d.Model.extend({defaults:{id:"",value:"",name:"",label:"",type:"checkbox",total_results:0,order:0,first_letter:"",letter_group:""},letter_groups:{"a-c":["a","b","c"],"d-k":["d","e","f","g","h","i","j","k"],"l-p":["l","m","n","o","p"],"q-z":["q","r","s","t","u","v","w","x","y","z"]},initialize:function(){this.view=new k.FilterModule.FilterOptionView({model:this})},getValue:function(){return this.get("value")},isSelected:function(){return this.get("selected")},setValues:function(a,c,d,e,f,g){b.isNull(e)||this.set({selected:e},{silent:!0}),b.isNull(a)||this.set({type:a},{silent:!0}),b.isNull(g)&&(g=c),d=parseInt(d,10);var h=this.stripSpecialChars(c),i=h.charAt(0).toLowerCase();this.set({id:h,name:h,value:g,label:c+" ("+d+")",order:f,total_results:d,first_letter:i},{silent:!0}),this.setLetterGroup()},setLetterGroup:function(){b.each(this.letter_groups,function(a,c){b.find(a,function(a){return a===this.get("first_letter")},this)&&this.set({letter_group:c},{silent:!1})},this)},setSelected:function(a,b){this.set({selected:a},b)},stripSpecialChars:function(a){return a=a.replace(/[^\w\s]/gi,""),a=a.replace(/ /g,"_")},renderView:function(){return this.view.render()}}),k.FilterModule.FilterOptionView=d.View.extend({config:{selectors:{input:"[data-wg-pf-input]"}},initialize:function(){this.template=b.template(c("[data-wg-pf-filter-list-item-template]").html(),{evaluate:/\(\((.+?)\)\)/g,interpolate:/\(\(=(.+?)\)\)/g,escape:/\(\(-(.+?)\)\)/g})},events:{"change [data-wg-pf-input]":"toggleSelected"},render:function(){this.setElement(this.template(this.model.attributes));var a=this.model.isSelected();return this.$(this.config.selectors.input).prop("checked",a),this},toggleSelected:function(){var a=this.$(this.config.selectors.input),b=a.prop("checked");this.model.setSelected(b,{silent:!1})}}),k.FilterModule.FilterOptions=d.Collection.extend({model:k.FilterModule.FilterOption,comparator:"order",initialize:function(){this.on("change:selected",this.selectionUpdated)},selectionUpdated:function(){this.trigger("selection-updated")},getSelectedOptions:function(){return this.where({selected:!0,type:"checkbox"})},getCount:function(){return this.length},setComparatorToSortByAlphabet:function(){this.comparator="first_letter",this.sort()},clearAll:function(){this.each(function(a){a.setSelected(!1,{silent:!0})},this),this.trigger("selection-updated")},selectAll:function(){this.each(function(a){a.setSelected(!0,{silent:!0})},this),this.trigger("selection-updated")}})}.call(this),function(a){var b=this.NR||(this.NR={}),c=b.resolve("SDM.Core.Components"),d=b.resolve("SDM.Core.Modules"),e=d.CustomProductList||(d.CustomProductList={}),f={brands:"BR:",categories:"CT:"};e.Controller=function(a){this.config={View:new e.View({el:a,model:new e.ViewModel})}},e.Props=a.Model.extend({defaults:{products:e.Products,brands:e.Brands,categories:e.Categories}}),e.State=a.Model.extend({defaults:{products:[],brands:[],categories:[]}}),e.Filters=a.Model.extend({defaults:{brands:[],categories:[]},toggleFilter:function(a,b){if(!_.isEmpty(a)&&!_.isEmpty(b)){var c=_.invert(f)[a],d=this.get(c);_.indexOf(d,b)>=0?this.removeFilter(c,b):this.addFilter(c,b)}},addFilter:function(a,b){if(!_.isEmpty(a)&&!_.isEmpty(b)){var c=this.get(a);_.indexOf(c,b)>0||this.set(a,c.concat([b]))}},removeFilter:function(a,b){if(!_.isEmpty(a)&&!_.isEmpty(b)){var c=this.get(a),d=_.indexOf(c,b);d<0||this.set(a,c.slice(0,d).concat(c.slice(d+1)))}}}),e.ViewModel=a.Model.extend({defaults:{props:new e.Props,state:new e.State,filters:new e.Filters,pagination:new c.PaginationModel,resultsPerPage:9},initialize:function(){this.props=this.get("props"),this.state=this.get("state"),this.filters=this.get("filters"),this.pagination=this.get("pagination"),this.initBrands(this.props.get("brands")),this.initCategories(this.props.get("categories")),this.filters.on("change",_.debounce(function(){this.applyFilters()},300),this),this.pagination.onChangeCurrentPage(_.debounce(function(){this.applyFilters()},300),this),this.pagination.setCurrentPage(1)},initBrands:function(a){this.state.set("brands",this.formatBrands(a)),this.filters.set("brands",_.map(a,function(a){return a.Name}))},initCategories:function(a){this.state.set("categories",this.formatCategories(a)),this.filters.set("categories",_.map(a,function(a){return a.Name}))},formatBrands:function(a){if(_.isEmpty(a))return[];var b=_.clone(a).sort(function(a,b){return a.Name<b.Name?-1:a.Name>b.Name?1:0});return _.groupBy(b,function(a){return a.Name.charAt(0).toLowerCase()})},formatCategories:function(a){return _.isEmpty(a)?[]:_.clone(a).sort(function(a,b){return a.Name<b.Name?-1:a.Name>b.Name?1:0})},applyFilters:function(){var a=this.props.get("products"),b=this.filters.get("brands"),c=this.filterProductsByBrands(a,b),d=this.filters.get("categories");c=this.filterProductsByCategories(c,d);var e=this.get("resultsPerPage");this.updatePaginationPagesByProductList(c,e);var f=this.pagination.getCurrentPage();c=this.filterProductsByPageNumber(c,f,e),this.state.set("products",c),this.trigger("products:updated")},filterProductsByBrands:function(a,b){return _.isEmpty(a)?[]:_.filter(a,function(a){return _.some(b,function(b){return a.brand===b})})},filterProductsByCategories:function(a,b){return _.isEmpty(a)?[]:_.filter(a,function(a){return _.some(b,function(b){return _.some(a.categories,function(a){return a===b})})})},filterProductsByPageNumber:function(a,b,c){if(_.isEmpty(a))return[];if(!_.isNumber(b)||b<0)throw new Error("Page Number cannot be invalid.");if(!_.isNumber(c)||c<0)throw new Error("Results Per Page cannot be invalid.");var d=(b-1)*c;return a.slice(d,d+c)},updatePaginationPagesByProductList:function(a,b){if(!_.isArray(a))throw new Error("Products cannot be invalid.");if(!_.isNumber(b)||b<0)throw new Error("Results Per Page cannot be invalid.");var c=Math.ceil(a.length/b);this.pagination.setNumberOfPages(c),this.pagination.getCurrentPage()>c&&this.pagination.setCurrentPage(1)}}),e.View=a.View.extend({initialize:function(a){var b={srhtype:"products",event_label:"custom-product-list",selectors:{header_container:"[data-md-cpl-header-container]",brands_container:"[data-md-cpl-brands-container]",categories_container:"[data-md-cpl-categories-container]",products_container:"[data-md-cpl-products-container]",footer_container:"[data-md-cpl-footer-container]",checkbox:"[data-srh-checkbox]"},attributes:{categories_filter_label:"md-cpl-categories-filter-label",filter_type:"srh-flt-type",goto_page:"goto-page",checkbox:"srh-checkbox"},classes:{filters_container_collapsed:"flt-collapsed",checkbox_checked:"flt-lst-checked"},templates:{header:_.template($("#SrhTemplHeader").html()),brand_filters:_.template($("#SrhTemplBrandFlt").html()),generic_filters:_.template($("#SrhTemplChbx").html()),products:_.template($("#SrhTemplContProducts").html()),footer:_.template($("#SrhTemplFooter").html())}};this.options=$.extend(!0,b,a||{}),this.$header_container=$(this.options.selectors.header_container),this.$brands_container=$(this.options.selectors.brands_container),this.$categories_container=$(this.options.selectors.categories_container),this.$products_container=$(this.options.selectors.products_container),this.$footer_container=$(this.options.selectors.footer_container),this.props=this.model.get("props"),this.state=this.model.get("state"),this.filters=this.model.get("filters"),this.pagination=this.model.get("pagination"),this.listenTo(this.model,"products:updated",this.render),this.initBrandFilters(),this.initCategoryFilters(),this.render()},events:{"click [data-goto-page]":"clickGoToPage","click [data-srh-checkbox]":"toggleFilterItem","click [data-srh-title]":"toggleFilterContainer","click [data-srh-clear-all]":"clickClearAll","click [data-srh-select-all]":"clickSelectAll"},render:function(){var a=this.state.get("products"),b=this.model.filterProductsByCategories(this.model.filterProductsByBrands(this.props.get("products"),this.filters.get("brands")),this.filters.get("categories")),c={srhtype:this.options.srhtype,current_page:this.pagination.getCurrentPage(),num_pages:this.pagination.getNumberOfPages(),per_page:this.model.get("resultsPerPage"),total_result_count:b.length,results:a,event_label:this.options.event_label};this.$header_container.html(this.options.templates.header({templData:c})),this.$products_container.html(this.options.templates.products({templData:c})),this.$footer_container.html(this.options.templates.footer({templData:c}))},initBrandFilters:function(){var a=this.state.get("brands"),b={groupedBrands:a,numBrands:a.length};this.$brands_container.html(this.options.templates.brand_filters({templData:b})),this.BrandsFilterComponent=new c.CollapsibleButtonList({$container:this.$brands_container})},initCategoryFilters:function(){var a=this.state.get("categories"),b={filterByName:this.$categories_container.data(this.options.attributes.categories_filter_label),prefix:f.categories,results:a};this.$categories_container.html(this.options.templates.generic_filters({specTempData:b})),this.CategoriesFilterComponent=new c.CollapsibleButtonList({$container:this.$categories_container})},clickGoToPage:function(a){a.preventDefault();var b=$(a.currentTarget).data(this.options.attributes.goto_page);_.isNumber(b)&&(this.pagination.setCurrentPage(b),this.scrollToTop())},toggleFilterItem:function(a){a.preventDefault();var b=$(a.currentTarget),c=b.data(this.options.attributes.filter_type),d=b.data(this.options.attributes.checkbox);this.filters.toggleFilter(c,d),b.toggleClass(this.options.classes.checkbox_checked)},toggleFilterContainer:function(a){$(a.currentTarget).parent().toggleClass(this.options.classes.filters_container_collapsed)},clickClearAll:function(a){a.preventDefault();var b=$(a.target);this.modifyAllFilters($(a.target),_.bind(this.filters.removeFilter,this.filters)),b.parent().find(this.options.selectors.checkbox).removeClass(this.options.classes.checkbox_checked)},clickSelectAll:function(a){a.preventDefault();var b=$(a.target);this.modifyAllFilters(b,_.bind(this.filters.addFilter,this.filters)),b.parent().find(this.options.selectors.checkbox).addClass(this.options.classes.checkbox_checked)},modifyAllFilters:function(a,b){var c=a.data(this.options.attributes.filter_type),d=_.invert(f)[c],e=_.pluck(this.props.get(d),"Name");_.each(e,function(a){b(d,a)})},scrollToTop:function(){var a=this.$el.offset().top-50;document.body.scrollTop<a||$("html, body").animate({scrollTop:a},500)}})}(Backbone),function(a){"use strict";var b=a.jQuery,c=a._,d=a.Backbone,e=a.document,f=a.NR,g=f.resolve("SDM.Core.Modules"),h=f.resolve("SDM.Core.Modules.Data.StoreServiceListing"),i=f.resolve("SDM.Util"),j=d.Router.extend({routes:{"(/)":"default","locations(/)(:province_key)":"locations"}}),k=g.StoreServiceListing=function(a,c){c=c||{};var d=window.location.pathname.split("/"),e={num_columns:3,router_root:"/"+d[2]+"/"+d[3],scroll_duration_ms:1500,data_attrs:{is_fresh_food:"md-ssl-is-fresh-food"},selectors:{listing_template:"[data-md-ssl-listing-template]",list_container:"[data-md-ssl-list-container]",province_select:"[data-md-ssl-province-select]"}},f=b.extend(!0,{},e,c);this._init(a,f)};k.prototype._init=function(a,f){var g=c.sortBy(c.map(h||[],function(a){return{store_id:a.StoreId,address:a.Address,city:a.City,name:a.Name,province:(a.Province||"").toLowerCase()}}),function(a){return a.name}),k=c.groupBy(g,function(a){return a.province}),l=c.reduce(c.keys(k),function(a,b){return a[b]=c.groupBy(k[b],function(a){return a.city}),a},{}),m=b(f.selectors.province_select,this.$el),n=c.map(m.find("option"),function(a){return(a.value||"").toLowerCase()}),o=a.data(f.data_attrs.is_fresh_food),p=o?new j:null;this.$el=a,this.config=f,this.listing_template=c.template(b(this.config.selectors.listing_template,a).html()),this.stores_by_city_by_province_key=l,m.on("change",c.bind(function(a){var d=(b(a.currentTarget).val()||"").toLowerCase();this._renderListing(d),c.isNull(p)||p.navigate("locations/"+d)},this)),o?(b(e).on("click","[href]",c.bind(function(b){var c=b.currentTarget.getAttribute("href").toLowerCase();c.indexOf(this.config.router_root+"/locations")>-1&&(b.preventDefault(),p.navigate(c.substr(c.indexOf("locations"))),i.scrollTo$ElementAsync(a,this.config.scroll_duration_ms))},this)),p.on("route:locations",function(b){if(b&&c.indexOf(n,b)>-1)this._renderListing(b);else{if(b)return void p.navigate("locations",{trigger:!0});this._renderListing((m.val()||"").toLowerCase())}i.scrollTo$ElementAsync(a,this.config.scroll_duration_ms)},this),p.on("route:default",function(){this._renderListing((m.val()||"").toLowerCase())},this),d.history.start({pushState:!0,root:i.getShortLanguageCode()+f.router_root})):this._renderListing((m.val()||"").toLowerCase())},k.prototype._renderListing=function(a){var d=this.stores_by_city_by_province_key[a]||[],e=c.keys(d).sort();b(this.config.selectors.list_container,this.$el).html(this.listing_template({cities:e,stores_by_city:d,num_total_stores:Array.prototype.concat.apply([],c.values(d)).length,language_code:i.getShortLanguageCode()}))}}(this),function(a,b){"use strict";var c=b(a),d=NR.resolve("SDM.Util"),e=NR.resolve("SDM.Core.Modules"),f=NR.resolve("SDM.Core.Components.VideoPanelDeeplink"),g=a.SDM||(a.SDM={}),h=g.GlobalTileGridData||(g.GlobalTileGridData={}),i=e.GlobalTileGrid=function(a,c){h.GlobalTiles||console.error(new Error("Missing GlobalTileGridData")),this.tileData=h.GlobalTiles.shift(),this.tileRow=h.InitialLoadRowCount.shift(),this.tileTemplateId=h.TileTemplateIds.shift(),this.isNavIncluded="True"===h.IsNavIncluded.shift(),c=c||{};var d={$el:a,tiles_per_load_desktop:3,tiles_per_load_tablet:2,tiles_per_load_mobile:3,tiles:[],isLastWindowDesktop:!1,selectors:{tiles_template:this.tileTemplateId,tiles_container:"[data-tiles-container]",load_more_button:"[data-load-more-button]"}},e=b.extend(!0,{},d,c);this._init(e)};i.prototype._init=function(a){this.config=a,this.template=_.template(b(a.selectors.tiles_template).html()),this.videoPanels=_.reduce(_.filter(this.tileData,function(a){return"video"===a.Type}),function(a,b){return a[b.ID]=b,a},{}),c.on("becometonarrow becometowide becometosmalldesktopwide becometoextrawide",{config:a},_.bind(this._resetGrid,this)),b(".wg-gt__tile-video-modal-popup, .wg-gt__tile-video-modal-close-button",this.config.$el).click(_.bind(this._onModalClick,this)),this.config.$el.on("click",".wg-gt__tile-video-detail-play",_.bind(function(a){var c=b(a.target).closest(".wg-gt__tile-video-detail"),d=c.data("wg-vp-video-player-id");if(history.pushState){var e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?v="+encodeURIComponent(d);window.history.pushState({path:e},"",e)}this._showVideo(d)},this)),this.config.$el.on("keydown",".wg-gt__tile-video-detail-play",_.bind(function(a){if(13===a.keyCode){var c=b(a.target).closest(".wg-gt__tile-video-detail"),d=c.data("wg-vp-video-player-id");if(history.pushState){var e=window.location.protocol+"//"+window.location.host+window.location.pathname+"?v="+encodeURIComponent(d);window.history.pushState({path:e},"",e)}this._showVideo(d)}},this)),this.isNavIncluded&&this.config.$el.on("click",".md-gtg__tile-list-hamburger",_.bind(function(){this.config.$el.find(".md-gtg__tile-list-hamburger").toggleClass("md-gtg__tile-list-hamburger--active")},this)),window.onpopstate=_.bind(function(){var a=new URLSearchParams(window.location.search),b=a.get("v");b?this._showVideo(b):this.currentVideoPanel&&(this.currentVideoPanel._hide(!0),this.currentVideoPanel=null)},this);var d=new URLSearchParams(window.location.search),e=d.get("v");e&&this._showVideo(e)},i.prototype._resetGrid=function(){var a=d.isWindowSmallDesktopWide()||d.isWindowExtraWide();if(!a||!this.config.isLastWindowDesktop){this.config.isLastWindowDesktop=a;var c=d.isWindowNarrow();this.config.$el.find(this.config.selectors.tiles_container).empty();var e=0;e=c?this.tileRow*this.config.tiles_per_load_mobile:d.isWindowWide()?this.tileRow*this.config.tiles_per_load_tablet:this.tileRow*this.config.tiles_per_load_desktop;var f=this.isNavIncluded&&a?1:0;this.pagedTiles=_.reduce(this.tileData,function(a,b){if(c&&b.HideMobile)return a;var d=!c&&b.DoubleTile?2:1;return f+=d,f>e&&(f=d,a.push([])),a[a.length-1].push(b),a},[[]]);var g=0;0===this.tileRow?g=this.tileData.length:this.config.$el.find(this.config.selectors.load_more_button).off("click").click(function(){this._renderPage(g+=1)}.bind(this)),b(document.body).css({position:"",top:"",width:""}),window.scrollTo(0,this.modalScrollY),this._renderPage(g),this.isNavIncluded&&(d.isWindowNarrow()||d.isWindowWide()?b("#Body").css("padding-top",b(".md-gtg__tile-list-links")[0].clientHeight):b("#Body").css("padding-top",""))}},i.prototype._renderPage=function(a){for(var b=[],c=0;c<=a;c++)b=b.concat(this.pagedTiles[c]);this.config.$el.find(this.config.selectors.load_more_button).toggleClass("md-gtg__load-more-button--hidden",!this.pagedTiles[a+1]),this.config.$el.find(this.config.selectors.tiles_container).html(this.template({tiles:b}))},i.prototype._showVideo=function(a){if(a&&this.videoPanels[a]){this.currentVideoPanel=new f({$modalContainer:b(document).find("[data-wg-gt-tile-video-modal]"),$container:this.videoPanels[a],$closeButtonContainer:b(document).find("[data-wg-gt-tile-video-modal-close-button]")});var c=document.querySelector(".wg-gt__tile-video-modal-container");this.modalScrollY=window.scrollY,c.velocity({top:"0%"},500,[210,19]),setTimeout(function(){b(document.body).css("top","-"+this.modalScrollY+"px"),b(document.body).css("position","fixed"),b(document.body).css("width","100%")},0),setTimeout(function(){var a=c.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]'),b=a[0],d=a[a.length-1];c.addEventListener("keydown",function(a){("Tab"===a.key||9===a.keyCode)&&(a.shiftKey?document.activeElement===b&&(d.focus(),a.preventDefault()):document.activeElement===d&&(b.focus(),a.preventDefault()))}),b.focus()},1e3)}},i.prototype._onModalClick=function(a){a.stopPropagation(),a.preventDefault(),this.currentVideoPanel._hide(!1),this.currentVideoPanel=null}}(this,jQuery),function(a,b){var c=NR.resolve("SDM.Core.Modules"),d=NR.resolve("SDM.ArticleContentGridData"),e=NR.resolve("SDM.Core.Components.VideoPanel"),f=NR.resolve("SDM.Core.Components"),g=f.SliderCarousel,h=c.ArticleContentGrid=function(a,c){c=c||{};for(var e={$el:a},f=d.RelatedArticlesJSON,g=d.RelatedArticlesUrlsJSON,h=0;h<f.length;h++)f[h].url=g[f[h].ContentID];var i=b.extend(!0,{},e,c);this._init(i),this._initRelatedArticles(f,g),this._initSliderCarousel()};h.prototype._init=function(a){var c=this;this.videoPanels=[],a.$el.find(".wg-vp-play").click(function(a){var d=b(a.target).closest(".widget-video-panel"),e=d.find(".wg-gt__tile-video-modal-container");c.modalScrollY=window.scrollY,e.velocity({top:"0%"},500,[210,19]),setTimeout(function(){b(document.body).css("top","-"+c.modalScrollY+"px"),b(document.body).css("position","fixed"),b(document.body).css("width","100%")},0)}),a.$el.find(".wg-gt__tile-video-modal-close-button").click(function(a){var d=b(a.target).closest(".widget-video-panel");c._hideVideoModal(d)});for(var d=a.$el.find("[data-widget-video-panel]"),f=0;f<d.length;f++){var g=b(d[f]),h=g.data("wg-vp-video-player-id"),i=new e({$modalContainer:g.find("[data-wg-gt-tile-video-modal]"),$container:g,$closeButtonContainer:g.find("[data-wg-gt-tile-video-modal-close-button]")});this.videoPanels[h]=i,g.find(".wg-gt__tile-video-modal-popup").click(_.bind(this._clickOutsideModal,this))}},h.prototype._clickOutsideModal=function(a){if(0===b(a.target).closest(".wg-gt__tile-video-modal").length){var c=b(a.target).closest(".widget-video-panel"),d=c.data("wg-vp-video-player-id");this._hideVideoModal(c),this.videoPanels[d]._hide()}},h.prototype._hideVideoModal=function(a){a.find(".wg-gt__tile-video-modal-container").velocity({top:"100%"},300),setTimeout(_.bind(function(){b(document.body).css("position",""),b(document.body).css("top",""),b(document.body).css("width",""),window.scrollTo(0,this.modalScrollY)},this),0)},h.prototype._initRelatedArticles=function(a){var c=_.template(b("#md-acg-related-article-template").html());b(".md-acg__related-articles-container").find("[data-related-articles]").html(c({articles:a}))},h.prototype._loadMoreRelatedArticles=function(){var a=_.template(b("#md-acg-related-article-template").html());b(".md-acg__related-articles-container").find("[data-related-articles]").html(a({articles:d.RelatedArticlesJSON})),b("#md-acg__related-articles-load-more").hide()},h.prototype._initSliderCarousel=function(){new g(b("[data-widget-slider-carousel]",this.$element),{selectors:{container:"[data-widget-slider-carousel]"}})}}(0,jQuery),function(a,b){var c=a.NR,d=a.SDM||(a.SDM={}),e=c.resolve("SDM.Core.Modules"),f=c.resolve("SDM.Core.Widgets"),g=c.resolve("SDM.Util"),h=c.resolve("SDM.FluShotFinder.FormToken"),i=c.resolve("SDM.FluShotFinder.ConsentForms"),j=c.resolve("SDM.FluShotFinder.NotifyMeIconDisplayPerProvince"),k=c.resolve("SDM.FluShotFinder.MapMarkerLabel"),l=c.resolve("SDM.FluShotFinder.SubscriberKey"),m="False"===c.resolve("SDM.FluShotFinder.DisableLogin");m=!m;var n=e.FluShotFinder=function(a,c){c=c||{};var d={$el:a,selectors:{searchForm:"[data-wg-fsfb-search-form]",searchInput:"[data-wg-fsfb-search-input]",searchError:"[data-wg-fsfb-search-error]",finder:"[data-md-fsf-finder]",map:"[data-md-fsf-map]",finderLoading:"[data-md-fsf-finder-loading]",instructionsPopUp:"[data-fsf-instructions-pop-up]",store:"[data-md-fsf-store]",storeList:"[data-md-fsf-store-list]",storeHourPopUp:"[data-fsf-store-hours-pop-up]",storeHourNotificationButton:"[data-md-fsf-store-hours-notification-button]",storeInfoStore:"[data-md-fsf-store-info-store]",storeInfoStoreHours:"[data-md-fsf-store-info-store-hours]",storeInfoStoreNotification:"[data-md-fsf-store-info-store-notification]",storeIconNotificationButton:"[data-md-fsf-store-icon-notification-button]",storeListSearchError:"[data-wg-fsfb-store-list-search-error]",storeNotification:"[data-md-fsf-store-notification]",storeNotificationPopUp:"[data-fsf-store-notification-pop-up]",storeNotificationLoading:"[data-md-fsf-store-notification-loading]",storeNotificationButtonBack:"[data-md-fsf-store-notification-button-back]",storeNotificationButtonNext:"[data-md-fsf-store-notification-button-next]",storeNotificationButtonSkip:"[data-md-fsf-store-notification-button-skip]",storeNotificationButtonSubmit:"[data-md-fsf-store-notification-button-submit]",storeNotificationButtonClose:"[data-md-fsf-store-notification-button-close]",storeNotificationAddStore:"[data-md-fsf-store-notification-add-store]",storeNotificationEditStore:"[data-md-fsf-store-notification-edit-store]",storeNotificationAddStoreError:"[data-md-fsf-store-notification-add-store-error]",storeNotificationStore:"[data-md-fsf-store-notification-store]",storeNotificationStoreRemove:"[data-md-fsf-store-notification-store-remove]",storeNotificationEmailInput:"[data-md-fsf-store-notification-email-input]",storeNotificationEmailInputError:"[data-md-fsf-store-notification-email-input-error]",storeNotificationSmsInputError:"[data-md-fsf-store-notification-sms-input-error]",storeNotificationSmsInput:"[data-md-fsf-store-notification-sms-input]",storeNotificationEmailCheckbox:"[data-md-fsf-store-notification-email-checkbox]",storeNotificationSmsCheckbox:"[data-md-fsf-store-notification-sms-checkbox]",storeNotificationEmailRadio:"[data-md-fsf-store-notification-email-radio]",storeNotificationSmsRadio:"[data-md-fsf-store-notification-sms-radio]",storeNotificationEmailConfirmation:"[data-md-fsf-store-notification-email-confirmation]",storeNotificationSmsConfirmation:"[data-md-fsf-store-notification-sms-confirmation]",storeNotificationEmailEdit:"[data-md-fsf-store-notification-email-edit]",storeNotificationTypesEdit:"[data-md-fsf-store-notification-types-edit]",storeNotificationSubmitError:"[data-md-fsf-store-notification-email-submit-error]",storeNotificationConsentForms:"[data-md-fsf-store-notification-consent-forms]",storeNotificationShotTypeHigh:"[data-md-fsf-store-notification-type-high-checkbox]",storeNotificationShotTypeRegular:"[data-md-fsf-store-notification-type-regular-checkbox]",storeHourReminderButton:"[data-md-fsf-store-hours-reminder-button]",storeInfoStoreReminder:"[data-md-fsf-store-info-store-reminder]",storeConsentFormButton:"[data-md-fsf-store-consent-form-button]",storeProvincialBookingButton:"[data-md-fsf-store-provincial-booking-button]",storeReminder:"[data-md-fsf-store-reminder]",storeReminderPopUp:"[data-fsf-store-reminder-pop-up]"},classes:{storeListCollapse:"md-fsf__store-list--collapse",storeIconNotificationButtonEdit:"md-fsf__store-icon-notification-button--edit",storeNotificationStepCollapse:"md-fsf__store-notification-step--collapse",storeNotificationButtonCollapse:"md-fsf__store-notification-button--collapse",storeNotificationButtonDisable:"md-fsf__store-notification-button--disable",storeNotificationAddStoreErrorCollapse:"md-fsf__store-notification-add-store-error--collapse",storeReminderStepCollapse:"md-fsf__store-notification-step--collapse",storeReminderButtonCollapse:"md-fsf__store-notification-button--collapse",storeReminderButtonDisable:"md-fsf__store-notification-button--disable",storeReminderAddStoreErrorCollapse:"md-fsf__store-notification-add-store-error--collapse",loadingVisible:"md-fsf__loading--visible"},data:{storeId:"md-fsf-store-id",storeInfoStoreId:"md-fsf-store-info-store-id",storeInfoStoreHoursId:"md-fsf-store-info-store-hours-id",storeNotificationStoreId:"md-fsf-store-notification-store-id",storeNotificationStep:"md-fsf-store-notification-step",storeReminderStoreId:"md-fsf-store-reminder-store-id",storeReminderStep:"md-fsf-store-reminder-step"},templates:{instructions:"#flu-shot-instructions",consentForm:"#flu-shot-consent-form-template",provincialBooking:"#flu-shot-provincial-booking-template",storeList:"#flu-shot-store-list-template",storeInfo:"#flu-shot-store-info-template",storeNotification:"#flu-shot-store-notification-template"},mapOptions:{center:{lat:43.6532,lng:-79.3832},minZoom:10,maxZoom:17,zoom:12},elements:{$storeNotification:"",$storeNotificationSteps:"",$storeNotificationBack:"",$storeNotificationNext:"",$storeNotificationSubmit:"",$storeNotificationShotTypeHigh:"",$storeNotificationShotTypeRegular:"",$storeNotificationEmailInput:"",$storeNotificationSmsInput:"",$storeNotificationEmailInputError:"",$storeNotificationSmsInputError:"",$storeNotificationEmailCheckbox:"",$storeNotificationSmsCheckbox:"",$storeNotificationEmailRadio:"",$storeNotificationSmsRadio:"",$storeNotificationEmailConfirmation:"",$storeNotificationSmsConfirmation:"",$storeNotificationRemove:"",$storeNotificationAddStore:"",$storeNotificationAddStoreError:"",$storeNotificationSubmitError:"",$storeNotificationEditStore:"",$storeNotificationEmailEdit:"",$storeNotificationTypesEdit:""},selectedFilters:[],stores:{},storeListCurrentPage:1,storeHoursPopUps:{},storeNotificationPopUp:null,storeNotificationStores:{},storeNotificationActiveStep:1,storeNotificationFluShotTypeHigh:!1,storeNotificationFluShotTypeRegular:!1,storeNotificationEmail:"",storeNotificationEmailChecked:!0,storeNotificationEmailConsent:!1,storeNotificationPhoneNumber:"",storeNotificationPhoneNumberChecked:!1,storeNotificationSmsConsent:!1,storeNotificationSmsRadioChecked:!1,storeNotificationEmailRadioChecked:!0,storeNotificationSubmitUrl:"/FluShot/Submit",storeReminderSubmitUrl:"/store/getstoresbyids",storeReminderPopUp:null,lang:document.querySelector("#module-flu-shot").getAttribute("data-lang"),tempStoreId:"",selectedStoresArray:[],storeListData:{},walkinsFilter:!1,focusableElements:'a[href]:visible, area[href]:visible, input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, [tabindex="0"], [contenteditable]',activeStep:0};this.config=b.extend(!0,{},d,c),this._init()};n.prototype._init=function(){this._initGoogleAPI()},n.prototype._initGoogleAPI=function(){var a=d.Util.loadGoogleMapsApi();!0===a?(this._initMap(),this._initPopUps(),this._initSearch(),this._initFilters()):b.when(a).then(_.bind(function(){this._initMap(),this._initPopUps(),this._initSearch(),this._initFilters()},this))},n.prototype._initSearch=function(){var a=b(this.config.$el.find(this.config.selectors.searchForm)),c=a.find(this.config.selectors.searchInput),d=g.getUrlVars(),e=d.search;e&&""!==e&&(c[0].value=decodeURIComponent(e),this._searchFormSubmit()),document.getElementById("wg-fsfb__search-button").disabled=!1,a.submit(_.bind(this._onSearchFormSubmit,this))},n.prototype._onSearchFormSubmit=function(a){b("#md-fsf__filters-wrapper").removeClass("md-fsf__filters-wrapper--active"),this._searchFormSubmit(),a.preventDefault()},n.prototype._searchFormSubmit=function(){var a=b(this.config.$el.find(this.config.selectors.searchForm)),c=a.find(this.config.selectors.searchInput),d=c[0].value;""!==d&&(b(".md-fsf__finder").css("display","block"),g.setUrlVars({search:d}),this.config.storeListCurrentPage=1,this._queryMap(d))},n.prototype._initInstructions=function(){new f.PopUp(b(".flu-shot-instructions-pop-up"))._showModal()},n.prototype._initMap=function(){
this.config.mapOptions.mapTypeId=a.google.maps.MapTypeId.ROADMAP,this.map=new a.google.maps.Map(b(this.config.selectors.map)[0],this.config.mapOptions),this.geocoder=new a.google.maps.Geocoder,this.markers=[]},n.prototype._initFilters=function(){var a=this;b("#md-fsf__filters-button").click(function(){b("#md-fsf__filters-wrapper").toggleClass("md-fsf__filters-wrapper--active"),"true"===b("#md-fsf__filters-button").attr("aria-expanded")?b("#md-fsf__filters-button").attr("aria-expanded",!1):b("#md-fsf__filters-button").attr("aria-expanded",!0)}),b(".md-fsf__filter-checkbox").on("click",function(){if(b(".md-fsf__filters-container").addClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").addClass("wg-fsfb__search-form--disabled"),"walkins"===b(this).val())a.config.walkinsFilter=b(this).prop("checked");else{var c=a.config.selectedFilters.indexOf(b(this).val());c>-1?a.config.selectedFilters.splice(c,1):a.config.selectedFilters.push(b(this).val())}a._getStores()}),b(".md-fsf__filter-clear-button").on("click",function(){b(".md-fsf__filters-container").addClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").addClass("wg-fsfb__search-form--disabled"),b(".md-fsf__filter-checkbox").prop("checked",!1),a.config.selectedFilters=[],a.config.walkinsFilter=!1,a._getStores()})},n.prototype._initPopUps=function(){var a=b(this.config.$el.find(this.config.selectors.storeNotificationPopUp));this.config.storeNotificationPopUp=new f.PopUp(a);var c=b(this.config.$el.find(this.config.selectors.storeReminderPopUp));this.config.storeReminderPopUp=new f.PopUp(c),this.config.elements.$storeNotificationBack=this.config.$el.find(this.config.selectors.storeNotificationButtonBack),this.config.elements.$storeNotificationBack.on("click",_.bind(this._onStoreNotificationBack,this))},n.prototype._queryMap=function(a){this.geocoder.geocode({address:a},_.bind(this._geocoderCallback,this))},n.prototype._geocoderCallback=function(c,d){d===a.google.maps.GeocoderStatus.OK?(this.config.$el.find(this.config.selectors.searchError).css("display","none"),this.config.$el.find(this.config.selectors.searchInput).attr("aria-invalid",!1),this.config.$el.find(this.config.selectors.storeListSearchError).hide(),b("#md-fsf__filters-button").prop("disabled",!1),this.query_location=c[0].geometry.location,this.map.setCenter(this.query_location),this._getStores()):(b("#md-fsf__store-list-error-msg--pre-search").hide(),b("#md-fsf__store-list-error-msg").show(),this.config.$el.find(this.config.selectors.searchError).css("display","block"),this.config.$el.find(this.config.selectors.searchInput).attr("aria-invalid",!0),this.config.$el.find(this.config.selectors.storeListSearchError).show(),b("#md-fsf__filters-button").prop("disabled",!0),b(".md-fsf__filters-container").removeClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").removeClass("wg-fsfb__search-form--disabled"),this._renderStoreList([]))},n.prototype._getStores=function(){google.maps.event.removeListener(this.zoomChangedListener),google.maps.event.removeListener(this.dragEndListener),b(".md-fsf__filters-container").addClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").addClass("wg-fsfb__search-form--disabled"),this._clearAllMarkers(),this.config.$el.find(this.config.selectors.finderLoading).addClass(this.config.classes.loadingVisible);var a={fluShotTypes:this.config.selectedFilters.join(","),lang:g.getShortLanguageCode(),lat:this.query_location.lat(),lng:this.query_location.lng(),minLat:this.map.getBounds().getSouthWest().lat(),minLng:this.map.getBounds().getSouthWest().lng(),maxLat:this.map.getBounds().getNorthEast().lat(),maxLng:this.map.getBounds().getNorthEast().lng(),walkin:this.config.walkinsFilter};b.ajax({method:"GET",url:"/sdmapi/store/GetFluShotStores",data:a}).done(_.bind(function(a){if(a){this.config.storeHoursPopUps={},this.config.$el.find(this.config.selectors.finderLoading).removeClass(this.config.classes.loadingVisible),this._renderStoreList(a),this._addMarkerToMap(a),this._initStorePopUp(a);var c=this;this.dragEndListener=google.maps.event.addListenerOnce(this.map,"dragend",function(){c.dragEndListener=google.maps.event.addListenerOnce(c.map,"idle",function(){c._getStores()})}),this.zoomChangedListener=google.maps.event.addListenerOnce(this.map,"zoom_changed",function(){c._getStores()}),b(".md-fsf__filters-container").removeClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").removeClass("wg-fsfb__search-form--disabled")}},this)).fail(function(a){console.log(a)})},n.prototype._addMarkerToMap=function(a){if(0!==a.length){this.bounds=new google.maps.LatLngBounds;for(var c=_.template(b(this.config.templates.storeInfo).html()),d=0;d<a.length;d++){var e=a[d];window.location.host.search("shoppersdrugmart")>0?e.storeUrl="https://stores.shoppersdrugmart.ca/"+g.getShortLanguageCode()+"/store/"+e.StoreID:e.storeUrl="https://stores.pharmaprix.ca/"+g.getShortLanguageCode()+"/store/"+e.StoreID;var f=d+1,h="",i={};e.VaccineAvailable?(h="/static/core/images/covid-shot-available-pin.png",i={text:String(f),fontSize:"16px",fontWeight:"bold",color:"white"}):(h="/static/core/images/covid-shot-unavailable-pin.png",i={text:String(f),fontSize:"16px",fontWeight:"bold",color:"black"});var l=k+" "+(d+1),m=new google.maps.Marker({position:{lat:e.Latitude,lng:e.Longitude},map:this.map,label:i,icon:{url:h,scaledSize:new google.maps.Size(24.5,35.5),labelOrigin:new google.maps.Point(12,15)},title:l});this.markers.push(m);var n=new google.maps.InfoWindow({content:c({store:e,storeNotificationStores:this.config.storeNotificationStores,notifyMeIconDisplayPerProvince:j})});m.addListener("click",_.bind(this._openInfoWindow,this,n,this.map,m))}}},n.prototype._openInfoWindow=function(a,b,c){this.lastInfoWindow&&this.lastInfoWindow.close(),a.open(b,c),this.lastInfoWindow=a,google.maps.event.addListener(a,"domready",_.bind(this._initInfoWindow,this))},n.prototype._initInfoWindow=function(){var a=b(this.config.$el.find(this.config.selectors.storeInfoStoreHours)),c=b(a.closest(this.config.selectors.storeInfoStore));this.config.tempStoreId=c.data(this.config.data.storeInfoStoreId);var d=c.find(this.config.selectors.storeInfoStoreNotification),e=c.find(this.config.selectors.storeInfoStoreReminder);this._updateStoreInfoStoreNotificationButton(),d.unbind("click").on("click",_.bind(this._renderStoreNotification,this)),e.unbind("click").on("click",_.bind(this._renderStoreReminder,this,this.config.tempStoreId))},n.prototype._clearAllMarkers=function(){for(var a=0;a<this.markers.length;a++)this.markers[a].setMap(null);this.markers=[]},n.prototype._renderStoreList=function(a){if(a.length>0){this.config.$el.find(this.config.selectors.searchError).css("display","none"),this.config.$el.find(this.config.selectors.searchInput).attr("aria-invalid",!1),this.config.$el.find(this.config.selectors.storeListSearchError).hide(),b("#md-fsf__filters-button").prop("disabled",!1);for(var c=0;a.length>c;c++)window.location.host.search("shoppersdrugmart")>0?a[c].storeUrl="https://stores.shoppersdrugmart.ca/"+g.getShortLanguageCode()+"/store/"+a[c].StoreID:a[c].storeUrl="https://stores.pharmaprix.ca/"+g.getShortLanguageCode()+"/store/"+a[c].StoreID;this.config.$el.find(this.config.selectors.storeList).removeClass(this.config.classes.storeListCollapse);var d=_.template(b(this.config.templates.storeList).html());this.config.storeListData=a;var e={storeList:a,notifyMeIconDisplayPerProvince:j,storeNotificationStores:this.config.storeNotificationStores};this.config.$el.find(this.config.selectors.storeList).html(d(e)),this.config.$el.find(this.config.selectors.storeIconNotificationButton).on("click",_.bind(this._onStoreIconNotificationButtonClick,this)),this.config.$el.find(this.config.selectors.storeConsentFormButton).on("click",_.bind(this._onStoreConsentFormButtonClick,this)),this.config.$el.find(this.config.selectors.storeProvincialBookingButton).on("click",_.bind(this._onStoreprovincialBookingButtonClick,this))}else this.config.$el.find(this.config.selectors.storeList).addClass(this.config.classes.storeListCollapse),this.config.$el.find(this.config.selectors.searchError).css("display","block"),this.config.$el.find(this.config.selectors.searchInput).attr("aria-invalid",!0),this.config.$el.find(this.config.selectors.storeListSearchError).show(),b("#md-fsf__filters-button").prop("disabled",!0)},n.prototype._onStoreIconNotificationButtonClick=function(a){var c=b(b(a.currentTarget).closest(this.config.selectors.store));this.config.tempStoreId=c.data(this.config.data.storeId),this.config.selectedStoresArray.length<3&&-1===this.config.selectedStoresArray.indexOf(this.config.tempStoreId)&&(this.config.selectedStoresArray.push(this.config.tempStoreId),b(".md-fsf__store-icon-notification-item--pilot-notify-a").css("display","none"),b(".md-fsf__store-icon-notification-item--pilot-notify-b").css("display","flex"),b(a.currentTarget).addClass(this.config.classes.storeIconNotificationButtonEdit)),this._renderStoreNotification()},n.prototype._updateStoreInfoStoreNotificationButton=function(){var a=this.config.$el.find(this.config.selectors.storeInfoStore),b=a.data(this.config.data.storeInfoStoreId),c=a.find(this.config.selectors.storeInfoStoreNotification);this.config.storeNotificationStores[b]?c.addClass(this.config.classes.storeIconNotificationButtonEdit):c.removeClass(this.config.classes.storeIconNotificationButtonEdit)},n.prototype._renderStoreNotification=function(){var a=!1;delete this.config.storeNotificationStores[""],Object.keys(this.config.storeNotificationStores).length<3?this.config.storeNotificationStores[this.config.tempStoreId]=this.config.stores[this.config.tempStoreId]:this.config.storeNotificationStores[this.config.tempStoreId]||(a=!0),this.config.storeNotificationPopUp._showModal();var c=_.template(b(this.config.templates.storeNotification).html());this.config.storeNotificationStores[""]="",delete this.config.storeNotificationStores[""];var d={stores:this.config.storeNotificationStores,showStoreNotificationAddStoreError:a};this.config.$el.find(this.config.selectors.storeNotification).html(c(d)),this._initStoreNotification()},n.prototype._updateStoreNotificationButton=function(a){b(this.config.$el.find("[data-"+this.config.data.storeId+"="+a+"]")).find(this.config.selectors.storeIconNotificationButton).addClass(this.config.classes.storeIconNotificationButtonEdit),this._updateStoreInfoStoreNotificationButton()},n.prototype._getStoreListConsentForm=function(a){var b={};for(var c in a)if(a.hasOwnProperty(c)){var d=i[a[c].province];if(!d)continue;b[a[c].province]=d}return b},n.prototype._initStoreNotification=function(){this.config.elements.$storeNotification=this.config.$el.find(this.config.selectors.storeNotification),this.config.elements.$storeNotificationSteps=this.config.elements.$storeNotification.find("[data-"+this.config.data.storeNotificationStep+"]"),this.config.elements.$storeNotificationNext=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationButtonNext),this.config.elements.$storeNotificationSkip=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationButtonSkip),this.config.elements.$storeNotificationSubmit=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationButtonSubmit),this.config.elements.$storeNotificationShotTypeHigh=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationShotTypeHigh),this.config.elements.$storeNotificationShotTypeRegular=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationShotTypeRegular),this.config.elements.$storeNotificationEmailInput=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationEmailInput),this.config.elements.$storeNotificationSmsInput=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationSmsInput),this.config.elements.$storeNotificationSmsCheckbox=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationSmsCheckbox),this.config.elements.$storeNotificationEmailInputError=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationEmailInputError),this.config.elements.$storeNotificationSmsInputError=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationSmsInputError),this.config.elements.$storeNotificationEmailCheckbox=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationEmailCheckbox),this.config.elements.$storeNotificationEmailRadio=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationEmailRadio),this.config.elements.$storeNotificationSmsRadio=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationSmsRadio),this.config.elements.$storeNotificationEmailConfirmation=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationEmailConfirmation),this.config.elements.$storeNotificationSmsConfirmation=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationSmsConfirmation),this.config.elements.$storeNotificationRemove=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationStoreRemove),this.config.elements.$storeNotificationAddStore=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationAddStore),this.config.elements.$storeNotificationAddStoreError=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationAddStoreError),this.config.elements.$storeNotificationSubmitError=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationSubmitError),this.config.elements.$storeNotificationEditStore=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationEditStore),this.config.elements.$storeNotificationEmailEdit=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationEmailEdit),this.config.elements.$storeNotificationTypesEdit=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationTypesEdit),this.config.elements.$storeNotificationTypesEdit=this.config.elements.$storeNotification.find(this.config.selectors.storeNotificationTypesEdit),this.config.storeNotificationActiveStep=1,this.config.activeStep=0,this.config.elements.$storeNotificationBack.addClass(this.config.classes.storeNotificationButtonCollapse),this.config.elements.$storeNotificationNext.removeClass(this.config.classes.storeNotificationButtonCollapse);for(var a=1;a<=this.config.elements.$storeNotificationSteps.length;a++)this.config.elements.$storeNotificationStep=b(this.config.elements.$storeNotification.find("[data-"+this.config.data.storeNotificationStep+"="+a+"]")),1===a?this.config.elements.$storeNotificationStep.removeClass(this.config.classes.storeNotificationStepCollapse):this.config.elements.$storeNotificationStep.addClass(this.config.classes.storeNotificationStepCollapse);var c=this;document.querySelector("#email").addEventListener("change",function(){c.config.storeNotificationEmailChecked=this.checked,c.config.storeNotificationPhoneNumberChecked=!1,document.querySelector("#md-fsf__store-notification-email-checkbox-consent").classList.add("active"),document.querySelector("#md-fsf__store-notification-sms-checkbox-consent").classList.remove("active"),document.querySelector("[data-md-fsf-store-notification-sms-checkbox]").checked=!1,c.config.elements.$storeNotificationSmsInput.prop("disabled",!0),c.config.elements.$storeNotificationEmailInput.prop("disabled",!1),b("#md-fsf__store-notification-email-input-consent").show(),b("#md-fsf__store-notification-sms-input-consent").hide(),b("#md-fsf__store-notification-email-disclaimer").show(),b("#md-fsf__store-notification-sms-disclaimer").hide(),c._onDisplayStep3()}),document.querySelector("#sms").addEventListener("change",function(){c.config.storeNotificationPhoneNumberChecked=this.checked,c.config.storeNotificationEmailChecked=!1,document.querySelector("[data-md-fsf-store-notification-email-checkbox]").checked=!1,document.querySelector("#md-fsf__store-notification-email-checkbox-consent").classList.remove("active"),document.querySelector("#md-fsf__store-notification-sms-checkbox-consent").classList.add("active"),c.config.elements.$storeNotificationSmsInput.prop("disabled",!1),c.config.elements.$storeNotificationEmailInput.prop("disabled",!0),b("#md-fsf__store-notification-email-input-consent").hide(),b("#md-fsf__store-notification-sms-input-consent").show(),b("#md-fsf__store-notification-email-disclaimer").hide(),b("#md-fsf__store-notification-sms-disclaimer").show(),c._onDisplayStep3()}),document.querySelector("#shot-type-high").addEventListener("change",function(){c.config.storeNotificationFluShotTypeHigh=this.checked,c._onDisplayStep2()}),document.querySelector("#shot-type-regular").addEventListener("change",function(){c.config.storeNotificationFluShotTypeRegular=this.checked,c._onDisplayStep2()}),document.querySelector("#md-fsf__store-notification-shot-type-remove-button--high").addEventListener("click",function(){b("#md-fsf__store-notification-shot-type-confirmation--high").hide(),b("#md-fsf__store-notification-shot-type-remove-button--high").hide(),b("#md-fsf__store-notification-shot-type-remove-button--regular").hide(),c.config.storeNotificationFluShotTypeHigh=!1}),document.querySelector("#md-fsf__store-notification-shot-type-remove-button--regular").addEventListener("click",function(){b("#md-fsf__store-notification-shot-type-confirmation--regular").hide(),b("#md-fsf__store-notification-shot-type-remove-button--high").hide(),b("#md-fsf__store-notification-shot-type-remove-button--regular").hide(),c.config.storeNotificationFluShotTypeRegular=!1}),this.config.$el.find(".wg-pu__content-container").on("keydown",_.bind(this._onKeyDown,this)),this.config.elements.$storeNotificationNext.on("click",_.bind(this._onStoreNotificationNext,this)),this.config.elements.$storeNotificationSubmit.on("click",_.bind(this._onStoreNotificationSubmit,this)),this.config.elements.$storeNotificationRemove.on("click",_.bind(this._onStoreNotificationStoreRemove,this)),this.config.elements.$storeNotificationAddStore.on("click",_.bind(this.config.storeNotificationPopUp._hideModal,this.config.storeNotificationPopUp)),this.config.elements.$storeNotificationEditStore.on("click",_.bind(this._onStoreNotificationStoreEdit,this)),this.config.elements.$storeNotificationEmailEdit.on("click",_.bind(this._onStoreNotificationBack,this)),this.config.elements.$storeNotificationTypesEdit.on("click",_.bind(this._onStoreNotificationTypesEdit,this)),this._onDisplayStep1()},n.prototype._onStoreNotificationNext=function(a){if(this.config.storeNotificationActiveStep!==this.config.elements.$storeNotificationSteps.length){if(3===this.config.storeNotificationActiveStep){var b=/^(([abcdefg.hijklmnopqrstuvwxyz!#$%&'*/=?^_+-`{|}~0123456789]+))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(this.config.elements.$storeNotificationEmailRadio[0].checked){if(0===this.config.elements.$storeNotificationEmailInput[0].value.length||!b.test(this.config.elements.$storeNotificationEmailInput[0].value))return this.config.elements.$storeNotificationEmailInputError.show(),this.config.elements.$storeNotificationSmsInputError.hide(),void this.config.elements.$storeNotificationEmailInput.focus();this.config.storeNotificationEmail=this.config.elements.$storeNotificationEmailInput[0].value,this.config.storeNotificationEmailConsent=this.config.elements.$storeNotificationEmailCheckbox[0].checked,this.config.storeNotificationPhoneNumber="",this.config.storeNotificationSmsConsent=!1,this.config.storeNotificationEmailRadioChecked=!0,this.config.storeNotificationSmsRadioChecked=!1,this._notificationStepForward()}else{if(0===this.config.elements.$storeNotificationSmsInput[0].value.length||null===this.config.elements.$storeNotificationSmsInput[0].value.match(/^[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4}$/im))return this.config.elements.$storeNotificationEmailInputError.hide(),this.config.elements.$storeNotificationSmsInputError.show(),void this.config.elements.$storeNotificationSmsInput.focus();this.config.storeNotificationPhoneNumber=this.config.elements.$storeNotificationSmsInput[0].value,this.config.storeNotificationSmsConsent=this.config.elements.$storeNotificationSmsCheckbox[0].checked,this.config.storeNotificationEmail="",this.config.storeNotificationEmailConsent=!1,this.config.storeNotificationEmailRadioChecked=!1,this.config.storeNotificationSmsRadioChecked=!0,this._notificationStepForward()}}else this._notificationStepForward();1===this.config.storeNotificationActiveStep?this._onDisplayStep1():2===this.config.storeNotificationActiveStep?this._onDisplayStep2():3===this.config.storeNotificationActiveStep?this._onDisplayStep3():4===this.config.storeNotificationActiveStep&&this._onDisplayStep4(),a.preventDefault()}},n.prototype._onStoreNotificationBack=function(a){1!==this.config.storeNotificationActiveStep&&(b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).addClass(this.config.classes.storeNotificationStepCollapse),this.config.storeNotificationActiveStep--,b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).removeClass(this.config.classes.storeNotificationStepCollapse),1===this.config.storeNotificationActiveStep?this._onDisplayStep1():2===this.config.storeNotificationActiveStep?this._onDisplayStep2():3===this.config.storeNotificationActiveStep?this._onDisplayStep3():4===this.config.storeNotificationActiveStep&&this._onDisplayStep4(),a.preventDefault())},n.prototype._onStoreNotificationStoreEdit=function(){b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).addClass(this.config.classes.storeNotificationStepCollapse),this.config.storeNotificationActiveStep=1,b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).removeClass(this.config.classes.storeNotificationStepCollapse),this.config.activeStep=0,this._onDisplayStep1()},n.prototype._onStoreNotificationTypesEdit=function(){b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).addClass(this.config.classes.storeNotificationStepCollapse),this.config.storeNotificationActiveStep=2,b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).removeClass(this.config.classes.storeNotificationStepCollapse)},n.prototype._notificationStepForward=function(){b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).addClass(this.config.classes.storeNotificationStepCollapse),this.config.storeNotificationActiveStep++,b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).removeClass(this.config.classes.storeNotificationStepCollapse)},n.prototype._onDisplayStep1=function(){this.config.elements.$storeNotificationBack.addClass(this.config.classes.storeNotificationButtonCollapse),b(".md-fsf__store-notification-button--next").removeClass("md-fsf__store-notification-button--disabled"),b(".md-fsf__store-notification-button--next").prop("disabled",!1),Object.keys(this.config.storeNotificationStores).length>=3?(this.config.elements.$storeNotificationAddStore.hide(),this.config.elements.$storeNotificationAddStore.prop("disabled",!0)):(this.config.elements.$storeNotificationAddStore.show(),this.config.elements.$storeNotificationAddStore.prop("disabled",!1)),0===Object.keys(this.config.storeNotificationStores).length&&(this.config.elements.$storeNotificationNext[0].disabled=!0),1!==this.config.activeStep&&(this._focusFirstElement(),this.config.activeStep=1)},n.prototype._onDisplayStep2=function(){this.config.elements.$storeNotificationBack.removeClass(this.config.classes.storeNotificationButtonCollapse),this.config.elements.$storeNotificationAddStoreError.addClass(this.config.classes.storeNotificationAddStoreErrorCollapse),document.querySelector("[data-md-fsf-store-notification-type-high-checkbox]").checked=this.config.storeNotificationFluShotTypeHigh,document.querySelector("[data-md-fsf-store-notification-type-regular-checkbox]").checked=this.config.storeNotificationFluShotTypeRegular,this.config.storeNotificationFluShotTypeHigh||this.config.storeNotificationFluShotTypeRegular?(b(".md-fsf__store-notification-button--next").removeClass("md-fsf__store-notification-button--disabled"),b(".md-fsf__store-notification-button--next").prop("disabled",!1)):(b(".md-fsf__store-notification-button--next").addClass("md-fsf__store-notification-button--disabled"),b(".md-fsf__store-notification-button--next").prop("disabled",!0)),Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var a=Object.size(this.config.storeNotificationStores);b("#md-fsf__store-notification-stores-selected-count--step-2").html(a),2!==this.config.activeStep&&(this._focusFirstElement(),this.config.activeStep=2)},n.prototype._onDisplayStep3=function(){this.config.elements.$storeNotificationEmailInputError.hide(),this.config.elements.$storeNotificationSmsInputError.hide(),this.config.elements.$storeNotificationSmsRadio.checked=this.config.storeNotificationSmsRadioChecked,this.config.elements.$storeNotificationEmailRadio.checked=this.config.storeNotificationEmailRadioChecked,this.config.storeNotificationEmailRadioChecked?this.config.elements.$storeNotificationEmailInput[0].value=this.config.storeNotificationEmail:this.config.elements.$storeNotificationSmsInput[0].value=this.config.storeNotificationPhoneNumber,this.config.storeNotificationEmailConsent&&(this.config.elements.$storeNotificationEmailCheckbox[0].checked=!0),this.config.storeNotificationSmsConsent&&(this.config.elements.$storeNotificationSmsCheckbox[0].checked=!0),Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c};var a=Object.size(this.config.storeNotificationStores);b("#md-fsf__store-notification-stores-selected-count--step-3").html(a);var c=1;this.config.storeNotificationFluShotTypeHigh&&this.config.storeNotificationFluShotTypeRegular&&(c=2),b("#md-fsf__store-notification-selected-shot-count").html(c),3!==this.config.activeStep&&(this._focusFirstElement(),this.config.activeStep=3)},n.prototype._onDisplayStep4=function(){this.config.elements.$storeNotificationSubmitError.hide(),Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},this.config.storeNotificationFluShotTypeHigh?b("#md-fsf__store-notification-shot-type-confirmation--high").show():(b("#md-fsf__store-notification-shot-type-confirmation--high").hide(),b("#md-fsf__store-notification-shot-type-confirmation--high").prop("disabled",!0)),this.config.storeNotificationFluShotTypeRegular?b("#md-fsf__store-notification-shot-type-confirmation--regular").show():(b("#md-fsf__store-notification-shot-type-confirmation--regular").hide(),b("#md-fsf__store-notification-shot-type-confirmation--regular").prop("disabled",!0)),this.config.storeNotificationFluShotTypeRegular&&this.config.storeNotificationFluShotTypeHigh?(b("#md-fsf__store-notification-shot-type-remove-button--high").show(),b("#md-fsf__store-notification-shot-type-remove-button--regular").show()):(b("#md-fsf__store-notification-shot-type-remove-button--high").hide(),b("#md-fsf__store-notification-shot-type-remove-button--regular").hide(),b("#md-fsf__store-notification-shot-type-remove-button--high").prop("disabled",!0),b("#md-fsf__store-notification-shot-type-remove-button--regular").prop("disabled",!0)),this.config.storeNotificationEmail?(b("#md-fsf__store-notification-email-confirmation-container").show(),b("#md-fsf__store-notification-sms-confirmation-container").hide(),this.config.elements.$storeNotificationEmailConfirmation.html(this.config.storeNotificationEmail)):(b("#md-fsf__store-notification-email-confirmation-container").hide(),b("#md-fsf__store-notification-sms-confirmation-container").show(),this.config.elements.$storeNotificationSmsConfirmation.html(this.config.storeNotificationPhoneNumber)),4!==this.config.activeStep&&(this._focusFirstElement(),this.config.activeStep=4)},n.prototype._onDisplayStep5=function(){this._focusFirstElement()},n.prototype._focusFirstElement=function(){var a=this.config.$el.find(".md-fsf__store-notification-step--"+this.config.storeNotificationActiveStep),b=a.find(this.config.focusableElements),c=a.find(b)[0];setTimeout(function(){c.focus()}.bind(this),600)},n.prototype._onKeyDown=function(){if("Tab"===event.key||9===event.keyCode){var a=this.config.$el.find(".md-fsf__store-notification-step--"+this.config.storeNotificationActiveStep),b=a.find(this.config.focusableElements);1!==this.config.storeNotificationActiveStep&&b.push(document.querySelector(".wg-pu__content-container").querySelector(".md-fsf__store-notification-button--back")),b.push(document.querySelector(".wg-pu__content-container").querySelector(".wg-pu__close-button"));var c=a.find(b)[0],d=b[b.length-1];event.shiftKey?document.activeElement===c&&(d.focus(),event.preventDefault()):document.activeElement===d&&(c.focus(),event.preventDefault())}},n.prototype._onStoreNotificationSubmit=function(){Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},this.config.elements.$storeNotificationBack.addClass(this.config.classes.storeNotificationButtonCollapse);var a=b(this.config.$el.find(this.config.selectors.storeNotification)),c=b(a.find(this.config.selectors.storeNotificationButtonBack)),d=b(a.find(this.config.selectors.storeNotificationButtonSubmit)),e=b(this.config.$el.find(this.config.selectors.storeNotificationSubmitError)),f=a.find(this.config.selectors.storeNotificationEmailRadio),i=a.find(this.config.selectors.storeNotificationSmsRadio);e.hide(),a.find(this.config.selectors.storeNotificationLoading).addClass(this.config.classes.loadingVisible);var j=Object.keys(this.config.storeNotificationStores),k={SubscriberKey:l,Email:this.config.storeNotificationEmail,LangCode:g.getFullLanguageCode(),Phone:this.config.storeNotificationPhoneNumber,StoreA:j[0]?j[0]:"",StoreB:j[1]?j[1]:"",StoreC:j[2]?j[2]:"",EmailFluOptIn:f[0].checked,SmsFluOptIn:i[0].checked,EmailPromoOptIn:this.config.storeNotificationEmailConsent,SmsPromoOptIn:this.config.storeNotificationSmsConsent,FluShotRegular:this.config.storeNotificationFluShotTypeRegular,FluShotHighDose:this.config.storeNotificationFluShotTypeHigh};b.ajax({type:"POST",url:this.config.storeNotificationSubmitUrl,contentType:"application/json",data:JSON.stringify(k),headers:{__RequestVerificationToken:h}}).done(_.bind(function(f){if(a.find(this.config.selectors.storeNotificationLoading).removeClass(this.config.classes.loadingVisible),"OK"!==f.Status)return void e.show();f.Updated?(b("#md-fsf__store-notification-header-success").hide(),b("#md-fsf__store-notification-header-resubmission").show()):(b("#md-fsf__store-notification-header-success").show(),b("#md-fsf__store-notification-header-resubmission").hide()),b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).addClass(this.config.classes.storeNotificationStepCollapse),this.config.storeNotificationActiveStep+=1,b(this.config.$el.find("[data-"+this.config.data.storeNotificationStep+"="+this.config.storeNotificationActiveStep+"]")).removeClass(this.config.classes.storeNotificationStepCollapse),c.addClass(this.config.classes.storeNotificationButtonCollapse),d.addClass(this.config.classes.storeNotificationButtonCollapse),
this.config.elements.$storeNotification.find("[data-md-fsf-store-notification-button-complete]").on("click",_.bind(this.config.storeNotificationPopUp._hideModal,this.config.storeNotificationPopUp)),this.config.storeNotificationStores={},this.config.selectedStoresArray=[],this.config.$el.find(this.config.selectors.storeIconNotificationButton).removeClass(this.config.classes.storeIconNotificationButtonEdit),this.config.storeNotificationEmail="",this.config.storeNotificationEmailConsent=!1,this.config.storeNotificationPhoneNumber="",this.config.storeNotificationSmsConsent=!1,this.config.storeNotificationFluShotTypeRegular=!1,this.config.storeNotificationFluShotTypeHigh=!1,b(".md-fsf__store-icon-notification-item--pilot-notify-a").css("display","flex"),b(".md-fsf__store-icon-notification-item--pilot-notify-b").css("display","none"),this._onDisplayStep5()},this))},n.prototype._onStoreNotificationStoreRemove=function(a){setTimeout(_.bind(function(){var c=b(this.config.$el.find(this.config.selectors.storeNotification)),d=b(a.currentTarget.closest(this.config.selectors.storeNotificationStore)),e=d.data(this.config.data.storeNotificationStoreId),f=c.find("[data-"+this.config.data.storeNotificationStoreId+"="+e+"]"),g=b(this.config.$el.find(this.config.selectors.storeNotificationAddStoreError));f.remove(),delete this.config.storeNotificationStores[e],g.addClass(this.config.classes.storeNotificationAddStoreErrorCollapse);var h=b(this.config.$el.find("[data-"+this.config.data.storeId+"="+e+"]")),i=h.find(this.config.selectors.storeIconNotificationButton),j=this.config.$el.find(this.config.selectors.storeInfoStore),k=j.data(this.config.data.storeInfoStoreId),l=j.find(this.config.selectors.storeInfoStoreNotification);i.removeClass(this.config.classes.storeIconNotificationButtonEdit),e===k&&l.removeClass(this.config.classes.storeIconNotificationButtonEdit),this.config.selectedStoresArray=this.config.selectedStoresArray.filter(function(a){return a!==e});var m=c.find(this.config.selectors.storeNotificationButtonNext),n=c.find(this.config.selectors.storeNotificationButtonSubmit);0===Object.keys(this.config.storeNotificationStores).length?(m[0].disabled=!0,n[0].disabled=!0,b(".md-fsf__store-icon-notification-item--pilot-notify-a").css("display","flex"),b(".md-fsf__store-icon-notification-item--pilot-notify-b").css("display","none")):Object.keys(this.config.storeNotificationStores).length<3&&b(c.find(this.config.selectors.storeNotificationAddStore)).show()},this),0),a.preventDefault()},n.prototype._getUrlParametersAsObject=function(a){return JSON.parse('{"'+decodeURI(a).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')},n.prototype._initStorePopUp=function(a){for(var b=0;b<a.length;b++){var c=a[b].StoreID;this.config.stores[c]=a[b]}this.config.$el.find(this.config.selectors.storeHourNotificationButton).on("click",_.bind(this._onStoreHourNotificationButtonClick,this))},n.prototype._onstoreHourPopUpClick=function(a){var c=b(b(a.currentTarget).closest(this.config.selectors.store)),d=c.data(this.config.data.storeId),e=c.find(this.config.selectors.storeHourNotificationButton);this.config.storeNotificationStores[d]?e.addClass(this.config.classes.storeIconNotificationButtonEdit):e.removeClass(this.config.classes.storeIconNotificationButtonEdit),a.preventDefault()},n.prototype._onStoreHourNotificationButtonClick=function(a){var c=b(b(a.currentTarget).closest(this.config.selectors.store)),d=c.data(this.config.data.storeId);this.config.storeHoursPopUps[d]._hideModal(),setTimeout(_.bind(function(){this._renderStoreNotification(d)},this),0),a.preventDefault()},n.prototype._onStoreConsentFormButtonClick=function(a){var c=b(b(a.currentTarget).closest(this.config.selectors.store)),d=c.data(this.config.data.storeId),e=this._findObjectByKey(this.config.storeListData,"StoreID",d),f=e.StoreType.DisplayName+" "+e.Name;this.config.storeReminderPopUp._showModal();var g=_.template(b(this.config.templates.consentForm).html());this.config.$el.find(this.config.selectors.storeReminder).html(g({storeName:f}))},n.prototype._onStoreprovincialBookingButtonClick=function(a){var c=b(b(a.currentTarget).closest(this.config.selectors.store)),d=c.data(this.config.data.storeId),e=this._findObjectByKey(this.config.storeListData,"StoreID",d),f=e.StoreType.DisplayName+" "+e.Name;this.config.storeReminderPopUp._showModal();var g=_.template(b(this.config.templates.provincialBooking).html());this.config.$el.find(this.config.selectors.storeReminder).html(g({storeName:f,ctaUrl:e.ProvincialUrl}))},n.prototype._findObjectByKey=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c.toString().toString().toLowerCase())return a[d];return null}}(this,jQuery),function(a,b){var c=a.NR,d=a.SDM||(a.SDM={}),e=c.resolve("SDM.Core.Modules"),f=c.resolve("SDM.Core.Widgets"),g=c.resolve("SDM.Util"),h=c.resolve("SDM.Data.CovidShotFinder"),i=e.CovidShotFinder=function(a,c){c=c||{};var d={$el:a,selectors:{searchForm:"[data-wg-fsfb-search-form]",searchInput:"[data-wg-fsfb-search-input]",searchError:"[data-wg-fsfb-search-error]",storeListSearchError:"[data-wg-fsfb-store-list-search-error]",finder:"[data-md-fsf-finder]",map:"[data-md-fsf-map]",finderLoading:"[data-md-fsf-finder-loading]",store:"[data-md-fsf-store]",storeList:"[data-md-fsf-store-list]",storeHourPopUp:"[data-fsf-store-hours-pop-up]",storeInfoStore:"[data-md-fsf-store-info-store]",storeInfoStoreHours:"[data-md-fsf-store-info-store-hours]"},classes:{storeListCollapse:"md-fsf__store-list--collapse",loadingVisible:"md-fsf__loading--visible"},data:{storeId:"md-fsf-store-id",storeInfoStoreId:"md-fsf-store-info-store-id",storeInfoStoreHoursId:"md-fsf-store-info-store-hours-id"},templates:{storeList:"#covid-shot-store-list-template",storeInfo:"#covid-shot-store-info-template"},mapOptions:{minZoom:10,maxZoom:17,zoom:12},stores:{},storeListCurrentPage:1,storeListPerPage:4,storeHoursPopUps:{},selectedFilters:[],dragEndListener:"",zoomChangedListener:"",query_location:{}};this.config=b.extend(!0,{},d,c),this._init()};i.prototype._init=function(){this._initGoogleAPI()},i.prototype._initGoogleAPI=function(){var a=d.Util.loadGoogleMapsApi();!0===a?(this._initMap(),this._initSearch(),this._initFilters()):b.when(a).then(_.bind(function(){this._initMap(),this._initSearch(),this._initFilters()},this))},i.prototype._initSearch=function(){var a=b(this.config.$el.find(this.config.selectors.searchForm)),c=a.find(this.config.selectors.searchInput),d=g.getUrlVars(),e=d.search;e&&""!==e&&(c[0].value=decodeURIComponent(e),this._searchFormSubmit()),document.getElementById("wg-fsfb__search-button").disabled=!1,a.submit(_.bind(this._onSearchFormSubmit,this))},i.prototype._onSearchFormSubmit=function(a){b("#md-fsf__filters-wrapper").removeClass("md-fsf__filters-wrapper--active"),this._searchFormSubmit(),a.preventDefault()},i.prototype._searchFormSubmit=function(){var a=b(this.config.$el.find(this.config.selectors.searchForm)),c=a.find(this.config.selectors.searchInput),d=c[0].value;""!==d&&(b(".md-fsf__finder").css("display","block"),b(".wg-fsfb__search-form").addClass("wg-fsfb__search-form--disabled"),g.setUrlVars({search:d}),this.config.storeListCurrentPage=1,this._queryMap(d))},i.prototype._initMap=function(){this.config.mapOptions.mapTypeId=a.google.maps.MapTypeId.ROADMAP,this.map=new a.google.maps.Map(b(this.config.selectors.map)[0],this.config.mapOptions),this.geocoder=new a.google.maps.Geocoder,this.markers=[]},i.prototype._initFilters=function(){var a=this;b("#md-fsf__filters-button").click(function(){b("#md-fsf__filters-wrapper").toggleClass("md-fsf__filters-wrapper--active"),"true"===b("#md-fsf__filters-button").attr("aria-expanded")?b("#md-fsf__filters-button").attr("aria-expanded",!1):b("#md-fsf__filters-button").attr("aria-expanded",!0)}),b(".md-fsf__filter-checkbox").on("click",function(){b(".md-fsf__filters-container").addClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").addClass("wg-fsfb__search-form--disabled");var c=a.config.selectedFilters.indexOf(b(this).val());c>-1?a.config.selectedFilters.splice(c,1):a.config.selectedFilters.push(b(this).val()),a._getStores()})},i.prototype._queryMap=function(a){this.geocoder.geocode({address:a},_.bind(this._geocoderCallback,this))},i.prototype._geocoderCallback=function(c,d){d===a.google.maps.GeocoderStatus.OK?(this.config.$el.find(this.config.selectors.searchError).hide(),this.config.$el.find(this.config.selectors.storeListSearchError).hide(),this.query_location=c[0].geometry.location,this.map.setCenter(this.query_location),this._getStores()):(this.config.$el.find(this.config.selectors.searchError).show(),this.config.$el.find(this.config.selectors.storeListSearchError).show(),b(".md-fsf__filters-container").removeClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").removeClass("wg-fsfb__search-form--disabled"))},i.prototype._getStores=function(){google.maps.event.removeListener(this.zoomChangedListener),google.maps.event.removeListener(this.dragEndListener),b(".md-fsf__filters-container").addClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").addClass("wg-fsfb__search-form--disabled"),this._clearAllMarkers(),this.config.$el.find(this.config.selectors.finderLoading).addClass(this.config.classes.loadingVisible);var a;a=h.IsAntigenTestFinder?{lang:g.getShortLanguageCode(),testAvailable:this.config.selectedFilters.join(","),lat:this.query_location.lat(),lng:this.query_location.lng(),minLat:this.map.getBounds().getSouthWest().lat(),minLng:this.map.getBounds().getSouthWest().lng(),maxLat:this.map.getBounds().getNorthEast().lat(),maxLng:this.map.getBounds().getNorthEast().lng()}:{lang:g.getShortLanguageCode(),covidBrands:this.config.selectedFilters.join(","),lat:this.query_location.lat(),lng:this.query_location.lng(),minLat:this.map.getBounds().getSouthWest().lat(),minLng:this.map.getBounds().getSouthWest().lng(),maxLat:this.map.getBounds().getNorthEast().lat(),maxLng:this.map.getBounds().getNorthEast().lng()},b.ajax({method:"GET",url:"/sdmapi/store/GetCovidShotStores",data:a}).done(_.bind(function(a){if(a){this.config.storeHoursPopUps={},this.config.$el.find(this.config.selectors.finderLoading).removeClass(this.config.classes.loadingVisible),this._renderStoreList(a),this._addMarkerToMap(a);var c=this;this.dragEndListener=google.maps.event.addListenerOnce(this.map,"dragend",function(){c.dragEndListener=google.maps.event.addListenerOnce(c.map,"idle",function(){c._getStores()})}),this.zoomChangedListener=google.maps.event.addListenerOnce(this.map,"zoom_changed",function(){c._getStores()}),b(".md-fsf__filters-container").removeClass("md-fsf__filters-container--disabled"),b(".wg-fsfb__search-form").removeClass("wg-fsfb__search-form--disabled")}},this)).fail(function(a){console.log(a)})},i.prototype._addMarkerToMap=function(a){if(0!==a.length){this.bounds=new google.maps.LatLngBounds;for(var c=_.template(b(this.config.templates.storeInfo).html()),d=0;d<a.length;d++){var e=a[d];window.location.host.search("shoppersdrugmart")>0?e.storeUrl="https://stores.shoppersdrugmart.ca/"+g.getShortLanguageCode()+"/store/"+e.StoreID:e.storeUrl="https://stores.pharmaprix.ca/"+g.getShortLanguageCode()+"/store/"+e.StoreID;var f=d+1,i="",j={};h.IsAntigenTestFinder?e.AntigenTestAvailable?(i="/static/core/images/covid-shot-available-pin.png",j={text:String(f),fontSize:"16px",fontWeight:"bold",color:"white"}):(i="/static/core/images/covid-shot-unavailable-pin.png",j={text:String(f),fontSize:"16px",fontWeight:"bold",color:"black"}):e.VaccineAvailable?(i="/static/core/images/covid-shot-available-pin.png",j={text:String(f),fontSize:"16px",fontWeight:"bold",color:"white"}):(i="/static/core/images/covid-shot-unavailable-pin.png",j={text:String(f),fontSize:"16px",fontWeight:"bold",color:"black"});var k=new google.maps.Marker({position:{lat:e.Latitude,lng:e.Longitude},map:this.map,label:j,icon:{url:i,scaledSize:new google.maps.Size(24.5,35.5),labelOrigin:new google.maps.Point(12,15)}});this.markers.push(k);var l=new google.maps.InfoWindow({content:c({store:e})});k.addListener("click",_.bind(this._openInfoWindow,this,l,this.map,k))}}},i.prototype._openInfoWindow=function(a,b,c){this.lastInfoWindow&&this.lastInfoWindow.close(),a.open(b,c),this.lastInfoWindow=a,google.maps.event.addListener(a,"domready",_.bind(this._initInfoWindow,this))},i.prototype._initInfoWindow=function(){var a=b(this.config.$el.find(this.config.selectors.storeInfoStoreHours)),c=b(a.closest(this.config.selectors.storeInfoStore));this.config.tempStoreId=c.data(this.config.data.storeInfoStoreId)},i.prototype._clearAllMarkers=function(){for(var a=0;a<this.markers.length;a++)this.markers[a].setMap(null);this.markers=[]},i.prototype._renderStoreList=function(a){if(a.length>0){this.config.$el.find(this.config.selectors.searchError).hide(),this.config.$el.find(this.config.selectors.storeListSearchError).hide();for(var c=0;a.length>c;c++)window.location.host.search("shoppersdrugmart")>0?a[c].storeUrl="https://stores.shoppersdrugmart.ca/"+g.getShortLanguageCode()+"/store/"+a[c].StoreID:a[c].storeUrl="https://stores.pharmaprix.ca/"+g.getShortLanguageCode()+"/store/"+a[c].StoreID;this.config.$el.find(this.config.selectors.storeList).removeClass(this.config.classes.storeListCollapse);var d=_.template(b(this.config.templates.storeList).html());this.config.$el.find(this.config.selectors.storeList).html(d({storeList:a,medmeBypassProvinces:h.MedmeBypassProvinces}))}else this.config.$el.find(this.config.selectors.storeList).addClass(this.config.classes.storeListCollapse),this.config.$el.find(this.config.selectors.searchError).show(),this.config.$el.find(this.config.selectors.storeListSearchError).show()},i.prototype._getUrlParametersAsObject=function(a){return JSON.parse('{"'+decodeURIComponent(a).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')},i.prototype._initStorePopUp=function(a){for(var c=0;c<a.length;c++){var d=a[c].id;this.config.stores[d]=a[c];var e=b(this.config.$el.find("[data-"+this.config.data.storeId+"="+d+"]")),g=b(e.find(this.config.selectors.storeHourPopUp));this.config.storeHoursPopUps[d]=new f.PopUp(g)}},i.prototype._findObjectByKey=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c.toString().toString().toLowerCase())return a[d];return null}}(this,jQuery),function(a){var b=a.NR||(a.NR={}),c=b.resolve("SDM.Core.Modules"),d=b.resolve("SDM.Util"),e=b.resolve("SDM.GiftCardMall.Brands"),f=b.resolve("SDM.GiftCardMall.Categories"),g=b.resolve("SDM.GiftCardMall.Products"),h=b.resolve("SDM.GiftCardMall.ProductsPerPage"),i=b.resolve("SDM.GiftCardMall.Inventory"),j=b.resolve("SDM.GiftCardMall.InventoryLabels"),k=b.resolve("SDM.Vue.Stores"),l=b.resolve("SDM.Vue.Widgets");c.GiftCardMall=function(){var a=b.resolve("SDM.Vue.Vuex");a.hasModule("storeSelector")||a.registerModule("storeSelector",k.StoreSelector),new Vue({el:"#module-gift-card-mall",store:a,data:function(){return{allProducts:g,inventoryLabels:j,brandFiltersSelected:[],categoryFiltersSelected:[],currentPage:1,isFiltersOpen:!1,productsPerPage:""===h?12:h}},mounted:function(){i.Stores&&this.setInventories(i.Stores);var a=d.getUrlVars().categories;if(a){var b=a.split("_").map(function(a){return parseInt(a)});this.categoryFiltersSelected=this.categoryFiltersSelected.concat(b)}},methods:Object.assign({},Vuex.mapActions("storeSelector",["setInventories","setProductImageUrl","setProductHeading","setProductUpc"]),{loadMore:function(){this.currentPage++},showHideFilters:function(){this.isFiltersOpen?TweenLite.to(".widget-gift-card-mall-filters__wrapper",.3,{height:0,onComplete:_.bind(function(){this.isFiltersOpen=!1},this)}):(this.isFiltersOpen=!0,this.$nextTick(_.bind(function(){TweenLite.set(".widget-gift-card-mall-filters__wrapper",{height:"auto"}),TweenLite.from(".widget-gift-card-mall-filters__wrapper",.3,{height:0}),d.scrollTo$ElementAsync($(".widget-gift-card-mall-filters__heading-button"),300,20)},this)))},toggleFilter:function(a,b){for(var c=!1,d=0;d<a.length;d++)if(a[d]===b.id){a.splice(d,1),c=!0;break}c||a.push(b.id)},applyFilters:function(){this.currentPage=1,TweenLite.to(this.$el.querySelector(".module-gift-card-mall__products"),.1,{opacity:0}),d.setUrlVars({categories:this.categoryUrlParameter})},clearFilters:function(){this.categoryFiltersSelected=[],this.brandFiltersSelected=[],this.currentPage=1,d.setUrlVars({categories:this.categoryUrlParameter})},findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c)return a[d];return null},checkAvailability:function(a){console.log(a),this.setProductImageUrl(a.Assets?a.Assets.Url:""),this.setProductHeading(a.Content.Title),this.setProductUpc(a.UpcStripped),this.popUp.showPopUp()}}),components:{"store-selector":l.StoreSelector},computed:Object.assign({},Vuex.mapState("storeSelector",["inventories","popUp","selectedStore"]),{brandFilters:function(){var a=e.map(function(a){return{id:a.ID,name:a.Name,count:this.allProducts.reduce(function(b,c){return c.Content.Brand&&c.Content.Brand.ID===a.ID?b+1:b},0)}}.bind(this));return a.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),a},categoryFilters:function(){var a=f.map(function(a){return{id:a.id,name:a.Name}});return a.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}),a},filteredProducts:function(){var a=this.allProducts.map(function(a){var b={inventory:{ShopLabel:j.ShopLabel,checkStockCountLabel:j.CheckOtherStoresLabel,CheckAvailabilityLabel:j.CheckAvailabilityLabel,stockCountLabel:j.InStoreLabel,ourStockLabel:j.OurStockLabel}};return Object.assign({},a,b)});return this.brandFiltersSelected.length>0&&(a=a.filter(function(a){return!!a.Content.Brand&&this.brandFiltersSelected.includes(a.Content.Brand.ID)}.bind(this))),this.categoryFiltersSelected.length>0&&(a=a.filter(function(a){var b=a.Taxonomies.reduce(function(a,b){return a.push(b.Category.id),a},[]);return!!this.categoryFiltersSelected.find(function(a){return b.includes(a)})}.bind(this))),a},products:function(){return this.$el.querySelector(".module-gift-card-mall__products")&&TweenLite.to(this.$el.querySelector(".module-gift-card-mall__products"),.3,{opacity:1}),this.filteredProducts.sort(function(a,b){return a.Content.Title<b.Content.Title?-1:a.Content.Title>b.Content.Title?1:0}).slice(0,this.productsPerPage*this.currentPage)},isLoadMoreVisible:function(){return this.products.length<this.filteredProducts.length},categoryUrlParameter:function(){return this.categoryFiltersSelected.join("_")}})})}}(this),function(a){var b=a.NR||(a.NR={}),c=b.resolve("SDM.Core.Modules"),d=b.resolve("SDM.Vue.Stores"),e=b.resolve("SDM.Vue.Widgets"),f=b.resolve("SDM.Data.GlobalSlider"),g=a.SDM||(a.SDM={}),h=g.Util,i=e.SearchWithAutocomplete,j=a.Vue,k=a.jQuery,l=a._;c.GlobalSlider=function(a){var c=b.resolve("SDM.Vue.Vuex");c.hasModule("provinceSelector")||c.registerModule("provinceSelector",d.ProvinceSelector),new j({components:{provinceSelector:e.ProvinceSelector,searchWithAutocomplete:i},computed:Object.assign({},Vuex.mapState("provinceSelector",["userProvinceId"]),{}),created:function(){this.currentRequest=null},mounted:function(){"True"===f.HideProvinceSelector&&(this.setSlideIndex(0),this.filterSlides("ON"),"flu_shot"===f.FinderMode&&(this.updateFluFinderLeftText("ON"),this.updateFluFinderRightText("ON")),this.filterBottomCtaBadges("ON")),this.leftRightBadges=f.LeftBadges.concat(f.RightBadges)},data:function(){return{autocompleteSuggestions:[],fluFinderLeftText:{},fluFinderRightText:"",isLoadingSuggestions:!1,slideIndex:0,slides:[],leftRightBadges:[],bottomCtaBadges:[],widths:["narrow","wide"]}},el:a.get(0),methods:{cancelSuggestionsRequest:function(){this.currentRequest&&this.currentRequest.abort&&(this.currentRequest.abort(),this.isLoadingSuggestions=!1)},fetchSuggestions:function(a){a.length&&(this.isLoadingSuggestions=!0,this.cancelSuggestionsRequest(),this.currentRequest=k.ajax({type:"GET",url:"/"+h.getShortLanguageCode()+"/search/getstructuredsearch",data:{numRes:15,query:a,type:"Condition"},success:l.bind(function(a){this.isLoadingSuggestions=!1,this.autocompleteSuggestions=l.map(a.StructuredResult[0].Result.records.page,function(a){return{title:a.title,url:a.url}})},this)}))},onClearSearch:function(){this.autocompleteSuggestions=[],this.cancelSuggestionsRequest()},setSlideIndex:function(a){this.slideIndex=a},updateFluFinderLeftText:function(a){if(f.FluFinderLeftText.length>1){for(var b=0;b<f.FluFinderLeftText.length;b++)if(f.FluFinderLeftText[b].Provinces.includes(a))return void(this.fluFinderLeftText=f.FluFinderLeftText[b])}else this.fluFinderLeftText=f.FluFinderLeftText[0]},updateFluFinderRightText:function(a){this.fluFinderRightText=f.FluFinderRightText[a]},filterSlides:function(a){this.slides=[];for(var b=0;b<f.Slides.length;b++){var c=f.Slides[b];if(c.DescriptionCTA&&c.DescriptionCTA.length>0){c.DescriptionCTAHref=c.DescriptionCTA.match(/href="([^"]*)/)[1],c.DescriptionCTATarget=c.DescriptionCTA.match(/target="([^"]*)/)[1];var d=document.createElement("span");d.innerHTML=c.DescriptionCTA,c.DescriptionCTALabel=d.textContent||d.innerText}if(c.DescriptionCTA2&&c.DescriptionCTA2.length>0){c.DescriptionCTAHref2=c.DescriptionCTA2.match(/href="([^"]*)/)[1],c.DescriptionCTATarget2=c.DescriptionCTA2.match(/target="([^"]*)/)[1];var e=document.createElement("span");e.innerHTML=c.DescriptionCTA2,c.DescriptionCTALabel2=e.textContent||e.innerText}"False"===f.HideProvinceSelector?f.Slides[b].Provinces.includes(a)&&this.slides.push(c):this.slides.push(c)}},filterBottomCtaBadges:function(a){this.bottomCtaBadges=[];for(var b=0;b<f.BottomCtaBadges.length;b++){var c=f.BottomCtaBadges[b];"False"===f.HideProvinceSelector?f.BottomCtaBadges[b].Provinces.includes(a)&&this.bottomCtaBadges.push(c):this.bottomCtaBadges.push(c)}}},store:c,watch:{userProvinceId:function(){this.setSlideIndex(0),this.filterSlides(this.userProvinceId),"flu_shot"===f.FinderMode&&(this.updateFluFinderLeftText(this.userProvinceId),this.updateFluFinderRightText(this.userProvinceId)),this.filterBottomCtaBadges(this.userProvinceId)}}})}}(this),function(a){(a.NR||(a.NR={})).resolve("SDM.Core.Modules").DietitianQuiz=function(){new Vue({el:"#module-dietitian-quiz",data:function(){return{activeStep:1,activeQuestion:1,answers:{},weights:{},packageNumbers:{}}},mounted:function(){},methods:{goToStep:function(a){this.activeStep=a},goToQuestion:function(a){this.activeQuestion=a},selectAnswer:function(a,b,c){Vue.set(this.weights,a,b),Vue.set(this.packageNumbers,a,c)},restartQuiz:function(){this.activeStep=1,this.activeQuestion=1,this.answers={},this.weights={},this.packageNumbers={}}},computed:{packageScores:function(){var a={};for(var b in this.packageNumbers)if(this.packageNumbers.hasOwnProperty(b)){var c=this.packageNumbers[b];a[c]=a[c]?a[c]+this.weights[b]:this.weights[b]}return a},maxPackageScores:function(){return Object.values(this.packageScores).reduce(function(a,b){return Math.max(a,b)},0)}}})}}(this),function(a){var b=a.NR,c=b.resolve("SDM.Vue.Widgets");b.resolve("SDM.DrugFinder.VueComponents").PopUp={components:{"pop-up":c.PopUp},props:["alsoKnownAsLabel","brandNameDescription","brandNameLabel","activeDrug","learnMoreLabel","popupReferenceName"],template:"#vue-component-drug-finder-pop-up",methods:{splitArray:function(a,b){var c=[];if(a)for(var d=Math.ceil(a.length/b),e=0;e<b;e++)c[e]=a.slice(e*d,(e+1)*d);return c}},watch:{activeDrug:function(){this.activeDrug&&this.$refs[this.popupReferenceName].showPopUp()}}}}(this),function(a){var b=a.NR||(a.NR={}),c=b.resolve("SDM.Core.Modules");$=a.jQuery;var d=b.resolve("SDM.Util"),e=b.resolve("SDM.DrugFinder.VueComponents");c.DrugFinderListing=function(){new Vue({components:{"drug-finder-popup":e.PopUp},el:"#module-drug-finder-listing",data:function(){return{activeDrug:null,activeFilter:"Common",activeLetter:"A",activePage:0,drugListing:[],drugs:{},drugPerPage:24,paginatedDrugs:[],popupReferenceName:"drugFinderListingPopup"}},methods:{getDrugsByFirstLetter:function(){$.ajax({url:"/en/DrugFinder/GetDrugsByFirstLetter",method:"GET",data:{firstLetter:this.activeLetter,byCommonName:"Common"===this.activeFilter}}).done(_.bind(function(a,b){if("success"===b){var c=JSON.parse(a);for(c.forEach(function(a){this.drugs[a.ID]=a},this),this.paginatedDrugs=[];c.length>0;){var d=[],e=c.splice(0,this.drugPerPage);e.length>0&&d.push(e),e=c.splice(0,this.drugPerPage),e.length>0&&d.push(e),this.paginatedDrugs.push(d)}this.paginatedDrugs&&this.paginatedDrugs.length>0&&this.drugListing.push(this.paginatedDrugs[0])}},this))},setActiveDrug:function(a){this.activeDrug=a},setActivePage:function(a){this.drugListing=[],this.activePage=a,this.paginatedDrugs&&this.paginatedDrugs[this.activePage]&&this.drugListing.push(this.paginatedDrugs[this.activePage]),d.scrollTo$ElementAsync($(this.$refs.drugListing))},loadMore:function(){this.activePage+1<this.paginatedDrugs.length&&(this.activePage=this.activePage+1,this.paginatedDrugs&&this.paginatedDrugs[this.activePage]&&this.drugListing.push(this.paginatedDrugs[this.activePage]))},setActiveLetter:function(a){this.activePage=0,this.drugListing=[],this.activeLetter=a,this.getDrugsByFirstLetter()},handleResize:function(){$(window).on("becometonarrow becometowide becometosmalldesktopwide becometoextrawide",_.bind(function(){this.initializeListing()},this))},initializeListing:function(){this.activePage=0,this.drugListing=[],this.paginatedDrugs&&this.paginatedDrugs.length>0&&this.drugListing.push(this.paginatedDrugs[0])},toggleFilter:function(a){a.preventDefault(),this.activeFilter="Common"===this.activeFilter?"Brand":"Common"}},mounted:function(){this.getDrugsByFirstLetter(),this.$root.$on("pop-up-closed",function(){this.activeDrug=null},this),window.addEventListener("resize",this.handleResize)},computed:{alphabets:function(){for(var a=[],b=0;b<26;b++)a.push(String.fromCharCode(b+65));return a}},watch:{activeFilter:function(){this.paginatedDrugs=[],this.activePage=0,this.drugListing=[],this.getDrugsByFirstLetter(),this.$nextTick(_.bind(function(){var a=this.$refs["filter"+this.activeFilter];a&&a.focus()},this))}}})}}(this),function(a){var b=a.NR||(a.NR={}),c=b.resolve("SDM.Core.Modules"),d=b.resolve("SDM.DrugFinder.VueComponents");c.DrugFinderSearch=function(){new Vue({components:{"drug-finder-popup":d.PopUp},computed:{drugsSorted:function(){return this.drugs.sort(function(a,b){var c=a.IsBrand?a.BrandName:a.CommonName,d=b.IsBrand?b.BrandName:b.CommonName,e=new RegExp(this.searchTerm,"ig"),f=new RegExp(this.searchTerm,"ig"),g=e.exec(c),h=f.exec(d),i=g?g.join().length:0,j=h?h.join().length:0;return j>i?1:j<i?-1:c.toLowerCase()<d.toLowerCase()?-1:c.toLowerCase()>d.toLowerCase()?1:0}.bind(this))}},data:function(){return{activeDrug:null,drugs:[],isDropdownVisible:!1,isDropdownLoading:!1,getDrugsBySearchTimeout:null,popupReferenceName:"drugFinderSearchPopup",searchTerm:"",isNoResultsFound:!1}},el:"#module-drug-finder-search",methods:{getDrugsBySearch:function(){if(!this.searchTerm||""===this.searchTerm||this.searchTerm.length<3)return void(this.drugs=[]);this.isDropdownLoading=!0,$.ajax({context:this,data:{search:this.searchTerm},method:"GET",url:"/en/DrugFinder/GetDrugsBySearch"}).done(function(a,b){"success"===b&&(this.drugs=JSON.parse(a),this.drugs.length>0?(this.isNoResultsFound=!1,this.isDropdownVisible=!0):this.isNoResultsFound=!0)}).always(function(){this.isDropdownLoading=!1})},getHighlightedDrugName:function(a){var b=a.IsBrand?a.BrandName:a.CommonName,c=new RegExp(this.searchTerm,"ig");return b.replace(c,function(a){return'<span class="typ--bold">'+a+"</span>"})},reloadGetDrugsBySearch:function(){this.isNoResultsFound=!1,this.isDropdownVisible=!1,this.getDrugsBySearchTimeout&&clearTimeout(this.getDrugsBySearchTimeout),this.getDrugsBySearchTimeout=setTimeout(function(){this.getDrugsBySearch()}.bind(this),500)},search:function(){if(!this.searchTerm||""===this.searchTerm||this.searchTerm.length<3)return void(this.drugs=[]);this.reloadGetDrugsBySearch()},submit:function(){this.search(),0!==this.drugs.length&&this.setActiveDrug(this.drugs[0])},setActiveDrug:function(a){this.activeDrug=a},hideDropdown:function(){this.activeDrug||(this.isDropdownVisible=!1)},showDropdown:function(){this.drugs.length>0&&(this.isDropdownVisible=!0)}},mounted:function(){this.$root.$on("pop-up-closed",function(){this.activeDrug=null},this)}})}}(this),function(a){(a.NR||(a.NR={})).resolve("SDM.Core.Modules").DrugFinderDetails=function(){new Vue({el:"#module-drug-finder-details",data:function(){return{}},methods:{print:function(){a.print()}},mounted:function(){}})}}(this),function(a,b){var c=a.NR||(a.NR={}),d=c.resolve("SDM.Core.Modules"),e=this.SDM||(this.SDM={}),f=e.SubscriptionData||(e.SubscriptionData={}),g=c.resolve("SDM.Util"),h=c.resolve("SDM.Vue.Mixins");d.Subscription=function(){new Vue({el:"#module-subscription",data:function(){return{emailAddress:"",isPCOptimumSubscriptionLoading:!1,isSubscriptionLoading:!1,isPCOptimumSubscriptionConsented:"false",isPCOptimumSubscriptionCompleted:!1,isSubscriptionCompleted:!1,province:""}},methods:{formSubmit:function(){this.subscribe(),"true"===this.isPCOptimumSubscriptionConsented?this.pcoSubscribe():this.isPCOptimumSubscriptionCompleted=!0},pcoSubscribe:function(){this.isPCOptimumSubscriptionLoading=!0,b.ajax({context:this,cache:!1,contentType:"application/x-www-form-urlencoded",type:"POST",url:"/subscribe",data:{email:this.emailAddress,casl:""}}).done(function(a){"True"===a?(this.isPCOptimumSubscriptionLoading=!1,this.isPCOptimumSubscriptionCompleted=!0,g.scrollTo$ElementAsync(b("#module-subscription"))):console.log(err)}).fail(function(a){console.log(a)})},subscribe:function(){this.isSubscriptionLoading=!0,b.ajax({context:this,data:{email:this.emailAddress,subscriberKey:f.SubScriberKey,apiKey:f.ApiKey,siteCode:f.SiteCode,langCode:f.LangCode,sdmPromotion:this.isPCOptimumSubscriptionConsented,province:this.province},headers:{__RequestVerificationToken:f.Token},method:"POST",url:"/global/subscriptionsubmit"}).done(function(a,c){"success"===c?(this.isSubscriptionLoading=!1,this.isSubscriptionCompleted=!0,g.scrollTo$ElementAsync(b("#module-subscription"))):console.log(a)}).always(function(){this.isDropdownLoading=!1})}},mixins:[h.Geolocation],watch:{provinceCode:function(a){this.province=a}}})}}(this,this.jQuery),function(a){"use strict";var b=a.NR,c=b.resolve("SDM.Promotions");c.Initializer={init:function(){new Vue({el:"#app-all-optimum-offers",data:function(){return{filterSelected:"",promotionsModel:[],promotionsDisplayData:[],rootUrl:""}},mounted:function(){this.rootUrl=this.$el.attributes["data-root-url"].value,this.promotionsModel=JSON.parse(this.$el.attributes["data-promotions-model"].value),this.updatePromotionsDisplayData()},methods:{updatePromotionsDisplayData:function(){this.promotionsDisplayData=[];for(var a=[],b=0;b<this.promotionsModel.length;b++){var c={};if(c.url=null!==this.promotionsModel[b].AlternativeUrl?this.promotionsModel[b].AlternativeUrl:this.rootUrl+"/"+this.promotionsModel[b].EnglishFriendlyURLName,c.imageUrl=this.promotionsModel[b].ListingPageImage.URL,c.imageLabel=this.promotionsModel[b].ListingPageImage.Label,c.description=null!==this.promotionsModel[b].Description?this.promotionsModel[b].Description:this.promotionsModel[b].Title,c.categories=this.promotionsModel[b].PromotionCategoriesText?this.promotionsModel[b].PromotionCategoriesText.split(","):"",""!==this.filterSelected){for(var d=0;d<c.categories.length;d++)if(this.filterSelected===c.categories[d]){a.push(c);break}}else a.push(c)}this.promotionsDisplayData=a},toggleFilter:function(a){this.filterSelected=a,this.updatePromotionsDisplayData()},findObjectByKey:function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b].toString().toLowerCase()===c)return a[d];return null}},watch:{$route:function(){}}})}},document.querySelector("#app-all-optimum-offers")&&c.Initializer.init()}(this),function(){function a(a){this._json=null,this._products=null,this._initialize(a)}function b(a){this.imageUrl=a.ImageUrl+"",this.title=a.Title+"",this.price=a.Price+""}
var c=this,d=c._,e=c.jQuery,f=c.SDM||(c.SDM={}),g=c.X2JS,h=function(){var a=new g;return function(b){var c=null;try{c=a.xml2json(b)}catch(a){throw a}return c}}();a.prototype._initialize=function(a){this._json=h(a),this._products=[],this._validate()&&(this._products=d(this._findProperProductList()).map(function(a){return new b(a)}))},a.prototype._validate=function(){var a=this._json.Promotions&&this._json.Promotions.Promotion&&parseInt(this._json.Promotions.Promotion._TotalProducts,10)>0;return a=a||d.isArray(this._json.Promotions.Promotion)},a.prototype._findProperProductList=function(){var a=d(this._json.Promotions.Promotion).find(function(a){return"Zoned"===a._Type}),b=a?a.Product:this._json.Promotions.Promotion.Product;if(!d.isArray(b)){var c=[];return c.push(b),c}return b},a.prototype.getArray=function(){return this._products},a.prototype.getRawData=function(){return this._json},f.EflyerProductDataLoader={load:function(a,b){var c=e.Deferred();return e.get(this.getApiUrl(a,b)).done(d(function(a){c.resolve(this.parse(a))}).bind(this)).fail(function(a){c.reject(a)}),c.promise()},getApiUrl:function(a,b){return"/Handlers/EFlyerPromotions.ashx?category="+encodeURIComponent(a)+"&postalCode="+encodeURIComponent(b)},parse:function(b){return new a(b)}}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.SDM||(a.SDM={}),e="eflyer",f=a.NR||(a.NR={}),g=f.resolve("SDM.Core.Components.SliderCarousel"),h=d.EflyerProductDataLoader,i=null;i=d.Eflyer=function(a){this._setInstanceVars(a),this._initialize()},i.prototype._setInstanceVars=function(a){this.consts={selectors:{carousel:"[data-wg-efl-carousel]",category_button:"[data-wg-efl-category-button]",postal_code_input:"[data-wg-efl-postal-code-input]",ml_text_overflow:"[data-wg-efl-ml-text-overflow]",category_select:"[data-wg-efl-category-select]"},attributes:{initial_category:"data-wg-efl-initial-category",category_button:"data-wg-efl-category-button",postal_code_input:"data-wg-efl-postal-code-input",carousel_item_template:"data-wg-efl-carousel-item-template",pagination_button_template:"data-wg-efl-carousel-pagination-template",loading:"data-wg-efl-carousel-loading"},class_names:{active:"active"}},this.slider_carousel_options={selectors:{carousel_container:"[data-wg-efl-carousel-container]"},attributes:{pc_visible:"wg-efl-number-visible-pc",mob_visible:"wg-efl-number-visible-mob",pc_toggle_at_once:"wg-efl-toggle-at-once-pc",mob_toggle_at_once:"wg-efl-toggle-at-once-mob"}},this.$container=a,this.category="",this.initial_category=a.attr(this.consts.attributes.initial_category),this.postal_code=a.find(this.consts.selectors.postal_code_input).attr("placeholder"),this.carousel=new g(a.find(this.consts.selectors.carousel),this.slider_carousel_options),this.$category_select=a.find(this.consts.selectors.category_select),this.locked=!1,this.carousel_item_template=b.template(a.find("["+this.consts.attributes.carousel_item_template+"]").html()),this.pagination_button_template=b.template(a.find("["+this.consts.attributes.pagination_button_template+"]").html()),this.$loading=a.find("["+this.consts.attributes.loading+"]")},i.prototype._initialize=function(){this._changeCategory(this.initial_category),this._bindInputEvents(),this._bindSelectEvents()},i.prototype._updateCarousel=function(){d.Util.validatePostalCode(this.postal_code.toUpperCase())&&(this.carousel.hideMainContainer(),this.$loading.show(),this.locked=!0,h.load(this.category,this.postal_code.toUpperCase()).done(b(function(a){var b=a.getArray();this.carousel.renderPanels(this.carousel_item_template({products:b})),this.carousel.renderPaginationButtons(this.pagination_button_template({length:b.length})),this.carousel.setNumberOfPanels(b.length),this.carousel.showMainContainer(),this.$loading.hide(),this.$container.find(this.consts.selectors.ml_text_overflow).mlTextOverflow(),this.locked=!1}).bind(this)))},i.prototype._bindInputEvents=function(){this.$container.on("keypress."+e,this.consts.selectors.postal_code_input,b.bind(this._onKeyPressPostalCodeInput,this)),this.$container.on("change."+e,this.consts.selectors.postal_code_input,b.bind(this._onChangePostalCodeInput,this)),this.$container.on("click."+e,this.consts.selectors.category_button,b.bind(this._onClickCategoryButton,this))},i.prototype._bindSelectEvents=function(){this.$category_select.on("change."+e,b(function(a){this._changeCategory(c(a.currentTarget).val())}).bind(this))},i.prototype._unbindSelectEvents=function(){this.$category_select.off("change."+e)},i.prototype._onKeyPressPostalCodeInput=function(a){var b=c(a.currentTarget);13!==a.which||this._isLocked()||(this.postal_code=""!==b.val()?b.val():b.prop("placeholder"),this._updateCarousel())},i.prototype._onChangePostalCodeInput=function(a){var b=c(a.currentTarget);this._isLocked()||(this.postal_code=""!==b.val()?b.val():b.prop("placeholder"),this._updateCarousel())},i.prototype._onClickCategoryButton=function(a){var b=c(a.currentTarget),d=b.attr(this.consts.attributes.category_button);this._changeCategory(d)},i.prototype._changeCategory=function(a){this._isLocked()||(this.category=a,this.$container.find(this.consts.selectors.category_button).removeClass(this.consts.class_names.active).filter("["+this.consts.attributes.category_button+"='"+a+"']").addClass(this.consts.class_names.active),this._unbindSelectEvents(),this.$category_select.val(a),this._bindSelectEvents(),this._updateCarousel())},i.prototype._isLocked=function(){return this.locked},i.prototype.updateCarousel=function(){this.carousel.updateMode()}}.call(this),function(){function a(a,b){this._initialize(a,b)}var b=this,c=b._,d=b.jQuery,e=b.NR||(b.NR={}),f=e.resolve("SDM"),g=e.resolve("SDM.Core.Components"),h=g.TabGroup,i=f.Util;a.prototype._initialize=function(a,b){var e=d("."+a.searchResultsClass),g=d("."+a.categoryLandingClass);if(e.length>0||g.length>0){this.config=a,this.statusObj={query:"",page:1,numres:a.resultsPerPage,filters:"",srhtype:"all",subbusunit:"all",sort:a.defaultSort,catid:""},this.queryObj={},this.responseObj={},this.checkboxes=b,this.searchURL=d(".ajax-form",this.$element).attr("action"),this.newfilters=!0,this.filters=[],this.urlVars=f.Util.getUrlVars(),this.statusObj=d.extend(!0,this.statusObj,this.urlVars||{});var i=f.Util.getFullLanguageCode(),j=c.isUndefined(this.urlVars.fltCat)?this.urlVars.fltcat:this.urlVars.fltCat;if(this.langMatch=!c.isUndefined(this.urlVars.quelang)&&this.urlVars.quelang===i||!c.isUndefined(j),e.length>0){this.$element=e,this.mode="search",this.tabs=new h(e,{selectors:{button:"[data-srh-tab-button]",content:"[data-srh-tab-content]"},attributes:{button:"data-srh-tab-button",content:"data-srh-tab-content"},classnames:{buttonDefault:"active",contentDefault:"wg-tcl-active"}}),this.tabs.onSwitch(function(a,b,c,d){d.trigger("reloadSearch",[{reloadType:"changeTab",newTabNum:a}])}),this.tabKey={all:1,products:2,articles:3,conditions:4};var k=c.bind(this._setUpFilter,this);$filters=d(".flt-mod",this.$element),c.each($filters,k),this._setUpFilterScroll(),this.$element.on("submit",c.bind(function(a){var b=d(this.config.queryInputSelector,this.$element).val();a.preventDefault(),history.pushState({reloadType:"changeQuery",query:b},"search query",window.location.href.replace(/query=.*?((?=&)|$)/,"query="+encodeURIComponent(b))),this.statusObj.page=1,this._reloadResults()},this))}g.length>0&&(this.$element=g,this.mode="category",this.statusObj.facets="products",this.statusObj.srhtype="products",this.statusObj.catid=d(".cat-lan-id").val(),this.$currentItmLst=d(".itm-lst",this.$element));var l=c.bind(this._handleReloadEvent,this),m=c.bind(this._handlePopEvent,this);if(this.$element.on("reloadSearch",l),this._reloadResults(),history.pushState){var n=window.location.href.match(/query=(.*?((?=&)|$))/,"query="+this.statusObj.query);history.replaceState({reloadType:"changeQuery",query:null!==n&&n.length>=1?n[1]:""},"search query",window.location.href),window.onpopstate=m}}},a.prototype._loadBV=function(a){var b={};void 0!==window.$BV&&(!1===a&&(a=[]),a.length>0&&(c.each(a,function(a){"undefined"!==a.Upc&&a.url&&(b[a.Upc.toString()]={url:document.location.protocol+"//"+document.location.host+a.url.toString()})}),$BV.ui("rr","inline_ratings",{productIds:b,containerPrefix:"BVRRInlineRating"})))},f.SearchResults=function(b,c){var e={searchResultsClass:"srh-res-form",categoryLandingClass:"cat-lan-form",loadMoreClass:"itm-lst-more",filterClass:"flt-mod",queryInputSelector:'[name="query"]',resultsPerPage:18,defaultFacets:"articles,conditions,products",defaultSort:"relavance",loadingClass:"srh-loading"};return this.config=d.extend(!0,e,b||{}),new a(this.config,c)},a.prototype._handleReloadEvent=function(a,b){var e=c.bind(this._parseCurrentFilters,this);if(!c.isUndefined(b))switch("changePage"!==b.reloadType&&(this.statusObj.page=1),b.reloadType){case"changeQuery":this.statusObj.query=d(this.config.queryInputSelector,this.$element).val(),this.newfilters=!0,this.statusObj.filters="";break;case"changeTab":this.statusObj.srhtype=c.invert(this.tabKey)[b.newTabNum],this.statusObj.sort=this.config.defaultSort,this.newfilters=!0,this.statusObj.filters="";break;case"changeSort":this.statusObj.sort=b.newSortType;break;case"changeFilter":this.statusObj.filters=e();break;case"changePage":this.statusObj.page=b.newPage,this.statusObj.filters=e()}this._reloadResults(b.reloadType)},a.prototype._handlePopEvent=function(a){"changeQuery"===a.state.reloadType&&(d(this.config.queryInputSelector,this.$element).val(a.state.query),this._handleReloadEvent(a,a.state))},a.prototype._parseCurrentFilters=function(){var a="",b=d(".flt-mod",this.$currentItmLst);return c.each(b,function(b){var e=d(b),f=d(".flt-lst-checked",e),g=d(".flt-lst-chbx",e).first().data("srh-flt-type");0===f.length?a=a+g+"NOFILTERS,":c.each(f,function(b){var e=d(b),f=e.data("srh-flt-type");f=c.isUndefined(f)?"sections,":f,a=a+f+encodeURIComponent(e.data("srh-checkbox"))+","})}),a},a.prototype._reloadResults=function(a){"search"===this.mode&&(this.currentTabNum=this.tabKey[this.statusObj.srhtype],this.currentTabNum=c.isUndefined(this.currentTabNum)?1:this.currentTabNum,this.tabs.goToTab(this.currentTabNum,!0)),"changePage"!==a&&this._clearResults(),this._makeQuery()},a.prototype._clearResults=function(){d(".itm-lst-header, .itm-lst-cnt",this.$currentItmLst).html(""),!0===this.newfilters&&d(".itm-lst-menu",this.$currentItmLst).hide(),"search"===this.mode&&(this.$currentItmLst=d(".tab-cont-"+this.statusObj.srhtype+" .itm-lst")),!0===this.newfilters&&"search"===this.mode&&d(".itm-lst-menu",this.$currentItmLst).html(""),this.$element.addClass(this.config.loadingClass)},a.prototype._makeQuery=function(){c.isUndefined(this.currentRequest)||this.currentRequest.abort();var a="type";"all"!==this.statusObj.srhtype&&(a+=",sections");var b="";switch(this.statusObj.srhtype){case"all":break;case"products":b="type,Product,"+this.statusObj.filters;break;case"articles":b="type,Article,"+this.statusObj.filters;break;case"conditions":b="type,Condition,"+this.statusObj.filters}var e=d(this.config.queryInputSelector,this.$element).val();if(this.queryObj={query:e,page:this.statusObj.page,numRes:this.statusObj.numres,facets:a,filters:b,getFilters:this.newfilters},"category"===this.mode){"0"===this.statusObj.catid||c.isUndefined(this.statusObj.catid)||(this.queryObj.categoryId=this.statusObj.catid);var f=c.isUndefined(this.urlVars.fltCat)?this.urlVars.fltcat:this.urlVars.fltCat;if(!(c.isUndefined(this.urlVars.brand)&&c.isUndefined(f)||(this.queryObj.brand=this.urlVars.brand,!0!==this.newfilters||!0!==this.langMatch))){var g="";c.each(this.urlVars,function(a,b){"flt-"!==b.slice(0,4)&&b.slice(0,6).toUpperCase()!=="fltCat".toUpperCase()||(g=g+","+encodeURIComponent(a)+",")}),this.queryObj.filters=b+g}}else c.isUndefined(this.urlVars.permflt)||(this.queryObj.andFilters=this.urlVars.permflt);var h=c.bind(this._populateResults,this),i=c.bind(this._ajaxErrorHandler,this);this.currentRequest=d.ajax({type:"POST",url:this.searchURL,data:this.queryObj,success:h,error:i})},a.prototype._ajaxErrorHandler=function(a,b,e){if("abort"!==e){var f=d("#SrhTemplError").html();d(".itm-lst-header",this.$currentItmLst).html(c.template(f,{})),this.$element.removeClass(this.config.loadingClass),d(".itm-lst-more--loading").removeClass("itm-lst-more--loading")}},a.prototype._populateResults=function(a){this.responseObj=a;var b={srhtype:this.statusObj.srhtype,query:this.responseObj.SwiftypeResults.info.page.query,current_page:this.responseObj.SwiftypeResults.info.page.current_page,num_pages:this.responseObj.SwiftypeResults.info.page.num_pages,per_page:this.responseObj.SwiftypeResults.info.page.per_page,total_result_count:this.responseObj.SwiftypeResults.info.page.total_result_count,results:this.responseObj.SwiftypeResults.records.page,storeResultTitle:this.responseObj.StoreResult.Title,storeResultUrl:"store-locator/store/"+this.responseObj.StoreResult.Id,filter_modules:this.responseObj.FilterModules,event_label:this.mode};b.storeResultTitle&&b.total_result_count++,c.isUndefined(this.responseObj.Info)||(b.all_total_result_count=this.responseObj.Info.page.total_result_count,b.facets_type=this.responseObj.Info.page.facets.type),c.each(b.results,function(a){if(a.published_at){var b,c=new Date(a.published_at);if(isNaN(c.getTime()))return void(a.published_at_formatted=null);b="fr"===i.getShortLanguageCode()?c.format("%r %B %Y","fr"):c.format("%b %r, %Y","en"),a.published_at_formatted=b}}),c.isNull(this.responseObj.SwiftypeResults.info.page.facets)||(b.facets_sections=this.responseObj.SwiftypeResults.info.page.facets.sections),"search"===this.mode&&(d(".res-num",this.$element).html("0"),d(".tab-all .res-num",this.$element).html(b.all_total_result_count),c.each(b.facets_type,function(a,b){var c=b.toLowerCase(),e=null===a?"0":a;d(".tab-"+c+" .res-num").html(e)}));var e=d("#SrhTemplHeader").html();d(".itm-lst-header",this.$currentItmLst).html(c.template(e)({templData:b}));var f=d(".itm-lst-menu",this.$currentItmLst);if("articles"!==this.statusObj.srhtype&&"conditions"!==this.statusObj.srhtype||!0!==this.newfilters){if("products"===this.statusObj.srhtype&&!0===this.newfilters&&!c.isUndefined(b.filter_modules)){if("search"!==this.mode&&this.urlVars.brand&&d(".flt-tax").hide(),!c.isUndefined(b.filter_modules.Brands)&&!c.isNull(b.filter_modules.Brands)){var g=c(b.filter_modules.Brands.Results).sortBy("Name"),h=c.groupBy(g,function(a){return a.Name.charAt(0).toLowerCase()}),j=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],k={};c.each(j,function(a){c.isUndefined(h[a])?k[a]=[]:k[a]=h[a]}),b.groupedBrands=k,b.numBrands=b.filter_modules.Brands.Results.length;var l=d("#SrhTemplBrandFlt").html();d(".itm-lst-menu",this.$currentItmLst).append(c.template(l)({templData:b}))}var m=d("#SrhTemplChbx").html();if(!c.isUndefined(b.filter_modules.Tags)&&!c.isNull(b.filter_modules.Tags)){var n={fltName:"Tags",prefix:b.filter_modules.Tags.Info[0].Prefix,filterByName:b.filter_modules.Tags.Info[0].FilterName,results:b.filter_modules.Tags.Results};d(".itm-lst-menu",this.$currentItmLst).prepend(c.template(m)({specTempData:n}))}c.each(b.filter_modules,function(a,b){if("Brands"!==b&&"Tags"!==b&&!c.isNull(a)){var e={fltName:b,prefix:a.Info[0].Prefix,filterByName:a.Info[0].FilterName,results:a.Results};0!==e.results.length&&d(".itm-lst-menu",this.$currentItmLst).append(c.template(m)({specTempData:e}))}});var o=c.bind(this._setUpFilter,this);$filters=d(".flt-mod",this.$currentItmLst),c.each($filters,o)}}else d(".flt-res-num",f).html("0"),c.each(b.facets_sections,function(a,b){d("[data-srh-checkbox='"+b.toLowerCase()+"']",f).siblings(".flt-lst-name-wrp").find(".flt-res-num").html(a)});d(".itm-lst-menu",this.$currentItmLst).show();var p=c.isUndefined(this.urlVars.fltCat)?this.urlVars.fltcat:this.urlVars.fltCat;"category"!==this.mode||!0!==this.newfilters||c.isUndefined(this.urlVars.brand)&&c.isUndefined(p)||!0!==this.langMatch||c.each(this.urlVars,function(a){var b=decodeURIComponent(a).split(":"),c=b[0],e=b[1]||"",f=d("[data-srh-flt-type='"+c+":'][data-srh-checkbox='"+e.replace(/'/g,"\\'")+"']"),g=f.parents(".flt-mod");f.length>0&&(d(".flt-lst-checked",g).removeClass("flt-lst-checked").attr("aria-checked",!1),f.addClass("flt-lst-checked").attr("aria-checked",!0),d(".nano",g).nanoScroller({scrollTo:f.parents(".flt-lst-item")}))});var q=d("#SrhTemplContProducts").html(),r=d("#SrhTemplContText").html();if("products"===this.statusObj.srhtype){if(d(".itm-lst-prod-items",this.$currentItmLst)[0]){var s=d(c.template(q)({templData:b})).children();d(".itm-lst-prod-items",this.$currentItmLst).append(s)}else d(".itm-lst-cnt",this.$currentItmLst).append(c.template(q)({templData:b}));this._loadBV(b.results)}else d(".itm-lst-cnt",this.$currentItmLst).append(c.template(r)({templData:b}));var t=d("#SrhTemplLoadMoreFooter").html();d(".itm-lst-footer",this.$currentItmLst).html(c.template(t)({templData:b})),0===b.total_result_count&&d(".itm-lst-footer",this.$currentItmLst).html(""),this._reinitialiseJS(),this.newfilters=!1,this.$element.removeClass(this.config.loadingClass)},a.prototype._reinitialiseJS=function(){var a=c.bind(this._loadMoreHandler,this),b=c.bind(this._changeDisplayNumber,this);d("."+this.config.loadMoreClass,this.$element).on("click",a),d(".itm-lst-display-num",".itm-lst-header").on("click",b),setTimeout(c.bind(this._setUpFilterScroll,this),0)},a.prototype._changeDisplayNumber=function(a){a.preventDefault(),this.statusObj.numres=d(a.currentTarget).data("itm-lst-display-num"),this.statusObj.page=1,this._reloadResults()},a.prototype._loadMoreHandler=function(a){a.preventDefault(),this.statusObj.page+=1;var b=this.statusObj.page;this.$element.trigger("reloadSearch",[{reloadType:"changePage",newPage:b}]),d(a.currentTarget).addClass("itm-lst-more--loading")},a.prototype._sortHandler=function(a){this.$element.trigger("reloadSearch",[{reloadType:"changeSort",newSortType:d(a.currentTarget).val()}])},a.prototype._setUpFilter=function(a){var b=d(a),e=c.bind(this._filterCollapseToggle,this),f=c.bind(this._filterAlphabet,this),g=c.bind(this._filterClear,this),h=c.bind(this._filterSelect,this),i=c.bind(this._chbxToggle,this);if(d(".flt-title",b).off().on("click",e),d(".flt-lst-alph-groups button",b).off().on("click",f),d(".flt-clr",b).off().on("click",g),d(".flt-sel",b).off().on("click",h),d(".flt-lst-chbx",b).off().on("click",i),b.hasClass("chbx-mod")){var j=c.bind(this._filterTreeCollapseToggle,this);d(".flt-lst-name",b).off().on("click",j)}this.filters.push({$filterElement:b})},a.prototype._setUpFilterScroll=function(){c.each(this.filters,function(a){d(".flt-lst-scl-wrp",a.$filterElement).nanoScroller({preventPageScrolling:!0,alwaysVisible:!0})})},a.prototype._chbxToggle=function(a){a.preventDefault();var b=d(a.currentTarget),c="flt-lst-checked";b.hasClass(c)?(b.removeClass(c).attr("aria-checked",!1),b.closest(".flt-lst-item").find("."+c).removeClass(c)):(b.addClass(c).attr("aria-checked",!0),b.parents(".flt-lst-item").children(".flt-lst-itm-label").find(".flt-lst-chbx").addClass(c)),this.$element.trigger("reloadSearch",[{reloadType:"changeFilter"}])},a.prototype._filterCollapseToggle=function(a){a.preventDefault(),$title=d(a.currentTarget),$title.parent().toggleClass("flt-collapsed")},a.prototype._filterTreeCollapseToggle=function(a){a.preventDefault(),$groupTitle=d(a.currentTarget),$groupTitle.parents(".flt-lst-item").first().toggleClass("flt-lst-closed")},a.prototype._filterAlphabet=function(a){a.preventDefault();var b=d(a.currentTarget),c=b.parent(),e=b.parents(".flt-mod"),f="active";c.siblings("."+f).removeClass(f),c.addClass(f),scrollToLetter=d(a.currentTarget).data("scrollto"),$scrolltoElement=d(".flt-lst-alph-let-"+scrollToLetter,e),d(".nano",e).nanoScroller({scrollTo:$scrolltoElement})},a.prototype._filterClear=function(a){a.preventDefault();var b=d(a.currentTarget).parents(".flt-mod");d(".flt-lst-chbx",b).removeClass("flt-lst-checked").attr("aria-checked",!1),this.$element.trigger("reloadSearch",[{reloadType:"changeFilter"}])},a.prototype._filterSelect=function(a){a.preventDefault();var b=d(a.currentTarget).parents(".flt-mod");d(".flt-lst-chbx",b).addClass("flt-lst-checked").attr("aria-checked",!0),this.$element.trigger("reloadSearch",[{reloadType:"changeFilter"}])}}.call(this),function(){var a=this,b=a._,c=a.jQuery,d=a.SDM||(a.SDM={}),e=d.Util,f=d.QAB=function(a){var b={qabClass:"qab-wrp",activeClass:"active",preActiveClass:"pre-active",barOpenClass:"qab-open",panelSelector:".qab-tls-cnt",namespace:"qab",fadeDelay:5e3,fadeLength:1e3,input_focus_types:"input[type=text], input[type=tel]",navigateOnClickSelector:"[data-qab-tls-itm-nav-on-click]"};this.config=c.extend(!0,b,a||{}),this.namespace="qab",c("."+this.config.qabClass).length>0&&this._initialize()};f.prototype._initialize=function(){this.$element=c("."+this.config.qabClass);var d=b.bind(this._toggleItem,this);c(".qab-tls-btn",this.$element).on("click",d);var e=b.bind(this._toggleMinimode,this);if(c(".qab-icon",this.$element).on("click",e),c("."+this.config.preActiveClass,this.$element).length>0){var f=b.bind(this._fadeOutItem,this),g=setTimeout(f,this.config.fadeDelay);this.$element.on("mouseenter",function(){clearTimeout(g)})}var h=b.bind(this._toggleVisibleSelect,this);c('.rdo-rpl[data-rdo-name="choice"]',this.$element).on("click",h);var i=c(a);i.on("becometowide",b.bind(this._onWindowBecomeWide,this)),i.on("resizewhennarrow",b.bind(this._onWindowResizeWhenNarrow,this))},f.prototype._toggleItem=function(a){var d=c(a.currentTarget).parent();if(!d.is(this.config.navigateOnClickSelector)){if(a.preventDefault(),d.hasClass(this.config.activeClass))this._hideItems();else{this._showItem(d),c("."+this.config.activeClass,this.$element).not(d).removeClass(this.config.activeClass);var e=b.bind(function(a){0===c(a.target).parents(this.$element.selector).length&&this._hideItems()},this);c("body").on("click."+this.namespace,e)}this._updateBarAndPanelHeightsIfMobile()}},f.prototype._showItem=function(a){a.addClass(this.config.activeClass),a.find(this.config.input_focus_types).first().focus()},f.prototype._hideItems=function(){c("."+this.config.activeClass,this.$element).removeClass(this.config.activeClass),c("body").off("click."+this.namespace)},f.prototype._toggleMinimode=function(a){a.preventDefault(),c(a.currentTarget).parents(".qab-wrp").toggleClass(this.config.barOpenClass),this._updateBarAndPanelHeightsIfMobile()},f.prototype._fadeOutItem=function(){var a=b.bind(this._hideItems,this);c("."+this.config.preActiveClass+" .qab-tls-cnt",this.$element).fadeOut(this.config.fadeLength,function(){a(),c(this).attr("style","")}),this._updateBarAndPanelHeightsIfMobile()},f.prototype._toggleVisibleSelect=function(a){a.preventDefault();var b=c(a.currentTarget),d=b.data("rdo-name"),e=b.data("rdo-value"),f="qab-slt-active",g="rdo-active";c("."+g+'[data-rdo-name="'+d+'"]').removeClass(g),b.addClass(g);var h=c(".qab-slt."+f),i=h.find('select [value=""]').text();h.removeClass(f),h.find("select").val(""),h.find("[data-selectbox-text-container]").text(i),c('.qab-slt[data-qab-srh-selectbox="'+e+'"]').addClass(f)},f.prototype._onWindowResizeWhenNarrow=function(){this._updateBarAndPanelHeightsIfMobile()},f.prototype._onWindowBecomeWide=function(){this.$element.css({bottom:"auto"}),this.$element.find(".qab-tls-cnt").removeAttr("style")},f.prototype._updateBarAndPanelHeightsIfMobile=function(){if(!1!==e.isWindowNarrow()){var b="."+this.config.activeClass,d=this.$element.find(b),f=d.length>0;if(this.$element.hasClass(this.config.barOpenClass)&&f){var g=c(a).width(),h=d.find(this.config.panelSelector);h.css({width:g});var i=h.outerHeight(),j=this.$element.outerHeight(),k=i-j;this._setBottomIfMobile(Math.max(0,k))}else this._setBottomIfMobile(0)}},f.prototype._setBottomIfMobile=function(a){!1!==e.isWindowNarrow()&&this.$element.css({bottom:Math.max(0,a)+"px"})}}.call(this),function(){var a=this,b=a.$SDM||a.jQuery,c=a.NR||(a.NR={}),d=c.resolve("SDM"),e=c.resolve("SDM.Core"),f=c.resolve("SDM.Core.Components"),g=c.resolve("SDM.Core.Modules"),h=c.resolve("SDM.Core.Utils"),i=c.resolve("SDM.Core.Widgets"),j=c.resolve("SDM.Core.Components.BrooklynAuth.Settings"),k=c.resolve("SDM.Subscription"),l=c.resolve("SDM.Vue.Modules"),m=f.EventHub,n=h.OmnitureUtil,o=h.SiteTypes,p=e.Initializer=function(a){var c={modules:{article_and_video_badge_grid:"article-and-video-badge-grid",article_details:"article-details",article_grid_with_vertical_side:"article-grid-with-vertical-side",beauty_blog_post_details:"beauty-blog-post-details",beauty_blog_posts:"beauty-blog-posts",beauty_brands_listing:"beauty-brands-listing",bmi_calculator:"bmi-calculator",brooklyn_offers:"brooklyn-offers",condition_search:"condition-search",filter_toggle:"filter-toggle",image_gallery:"image-gallery",faq_section:"faq-section",featured_deals:"featured-deals",accordion_content_list:"accordion-content-list",video_player_mvc:"video-player-mvc",promo_badge:"promo-badge",pharmacy_service_list:"pharmacy-service-list",pharmacy_service_detail:"pharmacy-service-detail",flyer:"flyer",global_slider:"global-slider",contact_us:"contact-us",overlays:"overlays",brand_details:"brand-details",minor_ailments_list:"minor-ailments-list",custom_product_list:"custom-product-list",store_service_listing:"store-service-listing",global_tile_grid:"global-tile-grid",article_content_grid:"article-content-grid",flu_shot_finder:"flu-shot-finder",covid_shot_finder:"covid-shot-finder",store_locator_per_service:"store-locator-per-service",gift_card_mall:"gift-card-mall",dietitian_quiz:"dietitian-quiz",console_preorder:"console-preorder",console_preorder_banner:"console-preorder-banner",drug_finder_search:"drug-finder-search",drug_finder_listing:"drug-finder-listing",drug_finder_details:"drug-finder-details",subscription:"subscription",find_in_store:"find-in-store",love_you_donation:"love-you-donation",womens_health:"womens-health",apple:"apple",shoebox:"shoebox",sticky_navigation:"sticky-navigation",p3_2021:"p3-2021",global_cta_list:"global-cta-list",featured_products_carousel:"featured-products-carousel",featured_products_carousel_with_badge:"featured-products-carousel-with-badge",stick_promotion_bar:"stick-promotion-bar",dietitian_navigation:"dietitian-navigation",dietitian_book_appointment:"dietitian-book-appointment",dietitian_biography:"dietitian-biography",dietitian_socialfeed:"dietitian-socialfeed",spring_2021:"spring-2021",two_level_navigation_menu:"two-level-navigation-menu",product_listing_with_feature_filter:"product-listing-with-feature-filter",summer_2021:"summer-2021",rich_text_area_geo:"rich-text-area-geo",video_product_carousel:"video-product-carousel",province_selector:"province-selector",text_badge_grid:"text-badge-grid",faq:"faq",global_promotion_grid:"global-promotion-grid",universal_cta_item_grid:"universal-cta-item-grid"},widgets:{print:"print",dscv_accordion:"dscv-accordion",accordion:"accordion",brooklyn_login:"brooklyn-login",brooklyn_logout:"brooklyn-logout",brooklyn_user_controls:"brooklyn-user-controls",brooklyn_points_refresh:"brooklyn-points-refresh",tab_group:"tab-group",eflyer:"eflyer",hero_carousel:"hero-carousel",slider_carousel:"slider-carousel",redemption_event:"redemption-event",faq_modal:"faq-modal",faq:"faq",unsupported_browser_warning:"unsupported-browser-warning",newsletter_subscription:"newsletter-subscription",image_popup:"image-popup",email_signup_popup:"email-signup-popup",email_signup:"email-signup",pharmacy_service_qab:"pharmacy-service-quick-access-bar",condition_alphabet:"condition-alphabet",featured_video:"featured-video",product_rating:"product-rating",general_article_summary_listing:"general-article-summary-listing",pop_up:"pop-up",pop_up_manager:"pop-up-manager",anchors_in_page:"anchors-in-page",search_bar:"search-bar",social_share:"social-share",flu_shot_finder_banner:"flu-shot-finder-banner",covid_shot_finder_banner:"covid-shot-finder-banner"},analytics:{userId_cookie:"sdm-analytics",custom_dimension_keys:{customer_key:"dimension1",channel:"dimension8",channel_details:"dimension9"}},youtube_api_key:"AIzaSyAqyipvzq62aB7-5OZ35FiVAp4T2WszDTM"};d.Vue.Vuex=new Vuex.Store({}),this.config=b.extend(!0,c,a||{}),j=_.extend(j,{loginEndPoint:this.config.LOGIN_ENDPOINT,protegrityDomain:this.config.PROTEGRITY_DOMAIN}),this._initialize()};p.prototype._initialize=function(){var c=b(a);d.Util({user_ip:this.config.user_ip,lang_code:this.config.lang_code,region:this.config.region}),k({});var e=d.GeoLocation();this._initializeModules(e),this._initializeWidgets(e),this._initializeMultiLinesTextOverflow(),this._initializeProperCase(),this._initializePlaceholder(),this._initializeSearchResults(),this._initializeAnalytics(),this._initializeQAB(),this._initializeImageTitleTag(),new d.Footer,d.Util.activateResizeEvent(),c.on("becometowide",_.bind(n.setSiteType,null,o.DESKTOP)),c.on("becometonarrow",_.bind(n.setSiteType,null,o.MOBILE)),n.setPageLanguage(d.Util.getFullLanguageCode()).setCustomerWalletId("").setLoginStatus(!1).setOptimumClaimed(!1).setSiteType(d.Util.isMobileDevice()?o.MOBILE:o.DESKTOP)},p.prototype._initializeModules=function(a){var c=b("[data-module]"),e=this.config.modules;c.each(_.bind(function(c,f){var h=b(f),i=h.data("module").split(/\s+/);_(i).each(_(function(c){switch(c){case e.article_grid_with_vertical_side:g.ArticleGridWithVerticalSide(h);break;case e.beauty_blog_post_details:this._initializeBeautyBlogPostDetailsModule(h);break;case e.beauty_blog_posts:this._initializeBeautyBlogPostsModule(h);break;case e.beauty_brands_listing:new g.BeautyBrandsListing(h);break;case e.bmi_calculator:this._initializeBmiCalculatorModule(h);break;case e.condition_search:g.ConditionSearch(h);break;case e.filter_toggle:this._initializeFilterToggles(h);break;case e.article_details:g.ArticleDetails(h.get(0));break;case e.image_gallery:this._initializeZooms(h);break;case e.faq_section:if(!l.FaqSection)break;l.FaqSection(h);break;case e.featured_deals:this._initializeFeatuedDeals(h);break;case e.global_slider:g.GlobalSlider(h);break;case e.video_player_mvc:this._initializeVideoPlayerMVC(h);break;case e.accordion_content_list:this._initializeAccordionContentList(h);break;case e.promo_badge:this._initializePromoBadge(h);break;case e.pharmacy_service_list:b.when(a).then(_.bind(function(){this._initializePharmacyServiceList(h,d.GeoLocation.getUsersProvince())},this));break;case e.pharmacy_service_detail:b.when(a).then(_.bind(function(){this._initializePharmacyServiceDetail(h,d.GeoLocation.getUsersProvince())},this));break;case e.flyer:this._initializFlyer(h);break;case e.contact_us:this._initializeContactUs(h);break;case e.overlays:this._initializeOverlays(h);break;case e.brand_details:this._initializeBrandDetails();break;case e.minor_ailments_list:b.when(a).then(_.bind(function(){this._initializeMinorAilmentsList(h,d.GeoLocation.getUsersProvince())},this));break;case e.custom_product_list:this._initializeCustomProductList(h);break;case e.store_service_listing:new g.StoreServiceListing(h);break;case e.global_tile_grid:new g.GlobalTileGrid(h);break;case e.article_content_grid:new g.ArticleContentGrid(h);break;case e.flu_shot_finder:new g.FluShotFinder(h);break;case e.covid_shot_finder:new g.CovidShotFinder(h);break;case e.drug_finder_search:new g.DrugFinderSearch(h);break;case e.drug_finder_listing:new g.DrugFinderListing(h);break;case e.drug_finder_details:new g.DrugFinderDetails(h);break;case e.store_locator_per_service:new g.StoreLocatorPerService(h);break;case e.gift_card_mall:new g.GiftCardMall(h);break;case e.dietitian_quiz:new g.DietitianQuiz(h);break;case e.console_preorder:new l.ConsolePreorder(h);break;case e.console_preorder_banner:new l.ConsolePreorderBanner(h);break;case e.love_you_donation:new l.LoveYouDonation(h);break;case e.apple:new l.Apple(h);break;case e.subscription:new g.Subscription(h);break;case e.find_in_store:new l.FindInStore(h);break;case e.womens_health:new l.WomensHealth(h);break;case e.shoebox:new l.Shoebox(h);break;case e.sticky_navigation:new l.StickyNavigation(h);break;case e.p3_2021:new l.P32021(h);break
;case e.global_cta_list:new l.GlobalCtaList(h);break;case e.featured_products_carousel:new l.FeaturedProductsCarousel(h);break;case e.featured_products_carousel_with_badge:new l.FeaturedProductsCarouselWithBadge(h);break;case e.stick_promotion_bar:new l.StickyPromotionBar(h);break;case e.spring_2021:new l.Spring2021(h);break;case e.dietitian_navigation:new l.DietitionNavigation(h);break;case e.dietitian_book_appointment:new l.DietitianBookAppointment(h);break;case e.dietitian_biography:new l.DietitionBiography(h);break;case e.dietitian_socialfeed:new l.DietitionSocialFeed(h);break;case e.two_level_navigation_menu:new l.TwoLevelNavigationMenu(h);break;case e.product_listing_with_feature_filter:new l.ProductListingWithFeatureFilter(h);break;case e.article_and_video_badge_grid:new l.ArticleAndVideoBadgeGrid(h);break;case e.summer_2021:new l.Summer2021(h);break;case e.rich_text_area_geo:new l.RichTextAreaGeo(h);break;case e.video_product_carousel:new l.VideoProductCarousel(h);break;case e.province_selector:new l.ProvinceSelector(h);break;case e.text_badge_grid:new l.TextBadgeGrid(h);break;case e.faq:new l.Faq(h);break;case e.global_promotion_grid:new l.GlobalPromotionGrid(h);break;case e.universal_cta_item_grid:new l.UniversalCTAItemGrid(h)}}).bind(this))},this))},p.prototype._initializeWidgets=function(a){var c=b("[data-widget]"),e=this.config.widgets;c.each(_.bind(function(c,f){var g=b(f),h=g.data("widget").split(/\s+/),j=this.config;_(h).each(_(function(c){switch(c){case e.print:this._initializePrintIcons(g);break;case e.dscv_accordion:this._initializeDiscoveryAccordions(g);break;case e.accordion:this._initializeAccordions(g);break;case e.brooklyn_login:new i.BrooklynLogin(g,j);break;case e.brooklyn_logout:new i.BrooklynLogout(g);break;case e.brooklyn_points_refresh:new i.BrooklynPointsRefresh({el:f});break;case e.tab_group:this._initializeTabGroup(g);break;case e.eflyer:b.when(a).then(_.bind(this._initializeEflyer,this,g));break;case e.slider_carousel:this._initializeSliderCarousel(g);break;case e.hero_carousel:this._initializeHeroCarousels(g);break;case e.redemption_event:this._initializeRedemptionEvent(g);break;case e.pharmacy_service_qab:b.when(a).then(_.bind(function(){this._initializePharmacyServicesQAB(g,d.GeoLocation.getUsersProvince())},this));break;case e.condition_alphabet:this._initializeConditionAlphabet(g);break;case e.featured_video:this._initializeFeaturedVideo(g);break;case e.product_rating:this._initializeProductRating(g);break;case e.faq_modal:this._initializeFAQModal(g);break;case e.faq:this._initializeFAQ(g);break;case e.unsupported_browser_warning:this._initializeUnsupportedBrowserWarning(g);break;case e.general_article_summary_listing:this._initializeGeneralArticleSummaryListing(g);break;case e.anchors_in_page:this._initializeAnchorsInPage(g);break;case e.pop_up:new i.PopUp(g);break;case e.pop_up_manager:this._initializePopUpManager(g);break;case e.social_share:this._initializeSocialShare(g);break;case e.newsletter_subscription:new i.NewsletterSubscription(g);break;case e.image_popup:new i.ImagePopup(g);break;case e.email_signup_popup:new i.EmailSignupPopup(g);break;case e.email_signup:new i.EmailSignup(g);break;case e.flu_shot_finder_banner:new i.FluShotFinderBanner(g);break;case e.search_bar:i.SearchBar(g);break;case e.covid_shot_finder_banner:new i.CovidShotFinderBanner(g)}}).bind(this))},this))},p.prototype._initializeSliderCarousel=function(a){var b=new f.SliderCarousel(a);m.subscribe(m.EVENTS.TAB_SWITCHED,function(){b.updateMode()})},p.prototype._initializeEflyer=function(a){var b=new d.Eflyer(a);m.subscribe(m.EVENTS.TAB_SWITCHED,function(){b.updateCarousel()})},p.prototype._initializeBeautyBlogPostDetailsModule=function(a){new g.BeautyBlogPostDetails(a)},p.prototype._initializeBeautyBlogPostsModule=function(a){new g.BeautyBlogPosts(a)},p.prototype._initializeBmiCalculatorModule=function(a){new g.BmiCalculator(a)},p.prototype._initializeFilterToggles=function(a){var b=a.find("[data-filter-toggle-button]"),c=a.find("[data-filter-toggle-content]"),d=!0;b.addClass("active"),c.show(),b.on("click.toggle",function(){d?(b.removeClass("active"),c.hide(),d=!1):(b.addClass("active"),c.show(),d=!0)})},p.prototype._initializeAnalytics=function(){var a=d.Util.getValueFromCookie(this.config.analytics.userId_cookie),b=this.config.analytics.custom_dimension_keys,c={},e=d.Util.getUrlVars()||{},f=e.channel||null,g=e.channelDetails||e.channeldetails||null;c[b.customer_key]=a,c[b.channel]=f,c[b.channel_details]=g},p.prototype._initializeMultiLinesTextOverflow=function(){b("[data-ml-text-overflow]").mlTextOverflow(),m.subscribe(m.EVENTS.TAB_SWITCHED,function(a){a.$content.find("[data-ml-text-overflow]").mlTextOverflow()})},p.prototype._initializeProperCase=function(){b("[data-prp-case]").each(function(){var a=b(this).text();b(this).text(d.Util.properCase(a))})},p.prototype._initializePlaceholder=function(){new Placeholder},p.prototype._initializeSearchResults=function(){new d.SearchResults({},"")},p.prototype._initializeHeroCarousels=function(a){new f.HeroCarousel(a)},p.prototype._initializeFeatuedDeals=function(a){new g.FeaturedDeals(a)},p.prototype._initializeAccordions=function(a){var b=new Accordion(a);b.isActive()&&b.open(0)},p.prototype._initializeTabGroup=function(a){new f.TabGroup(a).onSwitch(function(a,b,c){m.fire(m.EVENTS.TAB_SWITCHED,{tabId:a,$button:b,$content:c})})},p.prototype._initializePharmacyServicesQAB=function(a,b){new f.PharmacyServicesQAB(a,b)},p.prototype._initializeDiscoveryAccordions=function(){var a=[];return function(c){var d=new Accordion(c,{selectors:{button:"[data-dscv-accordion-button]",content:"[data-dscv-accordion-content]"},classnames:{active:"dscv-accordion-active",progress_of_showing:"dscv-accordion-showing",progress_of_hiding:"dscv-accordion-hiding"}});Accordion.validate(d)&&a.push(d),1===a.length&&(b(window).on("widen.dscv_accordion",function(){_(a).each(function(a){a.disable(),a.open(0)})}),b(window).on("narrow.dscv_accordion",function(){_(a).each(function(a,b){a.enable(),0===b?a.open(0):a.close(0)})}))}}(),p.prototype._initializeConditionAlphabet=function(a){new i.ConditionAlphabet(a)},p.prototype._initializeZooms=function(){return new f.Zoom},p.prototype._initializeFeaturedVideo=function(a){new i.FeaturedVideo(a,{youtube_api_key:this.config.youtube_api_key})},p.prototype._initializeProductRating=function(a){new i.ProductRating(a)},p.prototype._initializeQAB=function(){new d.QAB},p.prototype._initializePrintIcons=function(a){a.on("click",function(a){a.preventDefault(),window.print()})},p.prototype._initializeRedemptionEvent=function(a){new i.RedemptionEvent(a)},p.prototype._initializeVideoPlayerMVC=function(a){new g.VideoPlayerMVC(a)},p.prototype._initializeImageTitleTag=function(){b("img").each(function(){var a=b(this).attr("alt");if(""===a||void 0===a)return!0;var c=b(this).attr("title");""!==c&&void 0!==c||b(this).attr("title",a)})},p.prototype._initializeFAQModal=function(a){new i.FAQModal(a)},p.prototype._initializeFAQ=function(a){new i.FAQ(a)},p.prototype._initializeUnsupportedBrowserWarning=function(a){new i.UnsupportedBrowserWarning(a)},p.prototype._initializeGeneralArticleSummaryListing=function(a){new i.GeneralArticleSummaryListing(a)},p.prototype._initializeAnchorsInPage=function(a){new i.AnchorsInPage(a)},p.prototype._initializeAccordionContentList=function(a){new g.AccordionContentList(a)},p.prototype._initializePharmacyServiceList=function(a,b){new g.PharmacyServiceList(a,b)},p.prototype._initializePharmacyServiceDetail=function(a,b){new g.PharmacyServiceDetail(a,b)},p.prototype._initializePromoBadge=function(a){new g.PromoBadge(a)},p.prototype._initializFlyer=function(a){new g.Flyer(a)},p.prototype._initializeContactUs=function(a){new g.ContactUs(a)},p.prototype._initializeOverlays=function(a){new g.Overlays(a)},p.prototype._initializeBrandDetails=function(){new g.BrandDetails},p.prototype._initializeMinorAilmentsList=function(a,b){new g.MinorAilmentsList(a,b)},p.prototype._initializePopUpManager=function(a){new i.PopUpManager(a)},p.prototype._initializeSocialShare=function(a){new i.SocialShare(a)},p.prototype._initializeCustomProductList=function(a){new g.CustomProductList.Controller(a)}}.call(this);